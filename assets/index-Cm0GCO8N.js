(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function e(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(c){if(c.ep)return;c.ep=!0;const r=e(c);fetch(c.href,r)}})();class Ot{constructor(t,e){this.x=t,this.y=e}add(t){return new Ot(this.x+t.x,this.y+t.y)}subtract(t){return new Ot(this.x-t.x,this.y-t.y)}multiply(t){return new Ot(this.x*t,this.y*t)}divide(t){if(t===0)throw new Error("Division by zero");return new Ot(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){const t=this.length();if(t===0)throw new Error("Cannot normalize zero vector");return this.divide(t)}angleTo(t){return Math.acos(Math.min(1,Math.max(-1,this.dot(t)/(this.length()*t.length()))))}rotate(t,e){if(!e){const r=Math.cos(t),m=Math.sin(t);return new Ot(this.x*r-this.y*m,this.x*m+this.y*r)}const c=new Ot(this.x-e.x,this.y-e.y).rotate(t);return new Ot(c.x+e.x,c.y+e.y)}get xx(){return new Ot(this.x,this.x)}get xy(){return new Ot(this.x,this.y)}get yx(){return new Ot(this.y,this.x)}get yy(){return new Ot(this.y,this.y)}distanceTo(t){return this.subtract(t).length()}distanceToSquared(t){return this.subtract(t).lengthSquared()}perpendicular(){return new Ot(-this.y,this.x)}projectOnto(t){const e=this.dot(t),n=t.lengthSquared();if(n===0)throw new Error("Cannot project onto zero vector");return t.multiply(e/n)}static degreesToRadians(t){return t*(Math.PI/180)}static radiansToDegrees(t){return t*(180/Math.PI)}}var Wc=(()=>{var a=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return function(t={}){var e=t,n,c;e.ready=new Promise((i,s)=>{n=i,c=s});function r(){function i(B){const I=l;o=s=0,l=new Map,I.forEach(E=>{try{E(B)}catch(F){console.error(F)}}),this.kb(),h&&h.Mb()}let s=0,o=0,l=new Map,h=null,v=null;this.requestAnimationFrame=function(B){s||(s=requestAnimationFrame(i.bind(this)));const I=++o;return l.set(I,B),I},this.cancelAnimationFrame=function(B){l.delete(B),s&&l.size==0&&(cancelAnimationFrame(s),s=0)},this.Kb=function(B){v&&(document.body.remove(v),v=null),B||(v=document.createElement("div"),v.style.backgroundColor="black",v.style.position="fixed",v.style.right=0,v.style.top=0,v.style.color="white",v.style.padding="4px",v.innerHTML="RIVE FPS",B=function(I){v.innerHTML="RIVE FPS "+I.toFixed(1)},document.body.appendChild(v)),h=new function(){let I=0,E=0;this.Mb=function(){var F=performance.now();E?(++I,F-=E,1e3<F&&(B(1e3*I/F),I=E=0)):(E=F,I=0)}}},this.kb=function(){}}function m(){console.assert(!0);const i=new Map;let s=-1/0;this.push=function(o){return o=o+255>>8,i.has(o)&&clearTimeout(i.get(o)),i.set(o,setTimeout(function(){i.delete(o),i.length==0?s=-1/0:o==s&&(s=Math.max(...i.keys()),console.assert(s<o))},1e3)),s=Math.max(o,s),s<<8}}const u=e.onRuntimeInitialized;e.onRuntimeInitialized=function(){u&&u();let i=e.decodeAudio;e.decodeAudio=function(l,h){l=i(l),h(l)};let s=e.decodeFont;e.decodeFont=function(l,h){l=s(l),h(l)};const o=e.FileAssetLoader;e.ptrToAsset=l=>{let h=e.ptrToFileAsset(l);return h.isImage?e.ptrToImageAsset(l):h.isFont?e.ptrToFontAsset(l):h.isAudio?e.ptrToAudioAsset(l):h},e.CustomFileAssetLoader=o.extend("CustomFileAssetLoader",{__construct:function({loadContents:l}){this.__parent.__construct.call(this),this.Bb=l},loadContents:function(l,h){return l=e.ptrToAsset(l),this.Bb(l,h)}}),e.CDNFileAssetLoader=o.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this)},loadContents:function(l){let h=e.ptrToAsset(l);return l=h.cdnUuid,l===""?!1:(function(v,B){var I=new XMLHttpRequest;I.responseType="arraybuffer",I.onreadystatechange=function(){I.readyState==4&&I.status==200&&B(I)},I.open("GET",v,!0),I.send(null)}(h.cdnBaseUrl+"/"+l,v=>{h.decode(new Uint8Array(v.response))}),!0)}}),e.FallbackFileAssetLoader=o.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.fb=[]},addLoader:function(l){this.fb.push(l)},loadContents:function(l,h){for(let v of this.fb)if(v.loadContents(l,h))return!0;return!1}})};const p=e.onRuntimeInitialized;e.onRuntimeInitialized=function(){function i(P){this.F=P,this.yb=P.getContext("2d"),this.Db=h,this.R=[],this.ja=0,this.clear=function(){console.assert(this.ja==0),this.R=[],v.delete(this)},this.save=function(){++this.ja,this.R.push(h.save.bind(h))},this.restore=function(){0<this.ja&&(this.R.push(h.restore.bind(h)),--this.ja)},this.transform=function($){this.R.push(h.transform.bind(h,$))},this.align=function($,ct,bt,Gt){this.R.push(h.align.bind(h,$,ct,bt,Gt))},this.flush=function(){console.assert(this.ja==0),v.add(this),l&&o()}}function s(P){var $={alpha:1,depth:0,stencil:8,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,preferLowPowerToHighPerformance:0,failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:0,renderViaOffscreenBackBuffer:0},ct=P.getContext("webgl2",$);ct||(ct=P.getContext("webgl",$));var bt=ct,Gt=Rs(wo),gt={handle:Gt,attributes:$,version:$.Dc,Ta:bt};return bt.canvas&&(bt.canvas.pc=gt),wo[Gt]=gt,(typeof $.Jb>"u"||$.Jb)&&Vc(gt),go(Gt),$=B(P.width,P.height),$.Ab=Gt,$.F=P,$.Va=P.width,$.Ua=P.height,$.zb=ct,$}function o(){if(h){var P=h.Cb,$=0,ct=0,bt=0,Gt=Array(v.size),gt=0;for(var Wt of v)Wt.da=Math.min(Wt.F.width,P),Wt.ca=Math.min(Wt.F.height,P),Wt.Ja=Wt.ca*Wt.da,$=Math.max($,Wt.da),ct=Math.max(ct,Wt.ca),bt+=Wt.Ja,Gt[gt++]=Wt;if(v.clear(),!(0>=bt)){for($=1<<(0>=$?0:32-Math.clz32($-1)),ct=1<<(0>=ct?0:32-Math.clz32(ct-1));ct*$<bt;)$<=ct?$*=2:ct*=2;for($=Math.min($,P),$=Math.min(ct,P),Gt.sort((xi,Vo)=>Vo.Ja-xi.Ja),bt=new e.DynamicRectanizer(P),Wt=0;Wt<Gt.length;){for(bt.reset($,ct),gt=Wt;gt<Gt.length;++gt){var ee=Gt[gt],Ht=bt.addRect(ee.da,ee.ca);if(0>Ht){console.assert(gt>Wt);break}ee.pa=Ht&65535,ee.qa=Ht>>16}for(ee=E.push(bt.drawWidth()),Ht=F.push(bt.drawHeight()),console.assert(ee>=bt.drawWidth()),console.assert(Ht>=bt.drawHeight()),console.assert(ee<=P),console.assert(Ht<=P),h.F.width!=ee&&(h.F.width=ee),h.F.height!=Ht&&(h.F.height=Ht),h.clear(),ee=Wt;ee<gt;++ee){Ht=Gt[ee],h.saveClipRect(Ht.pa,Ht.qa,Ht.pa+Ht.da,Ht.qa+Ht.ca);let xi=new e.Mat2D;xi.xx=Ht.da/Ht.F.width,xi.yy=Ht.ca/Ht.F.height,xi.xy=xi.yx=0,xi.tx=Ht.pa,xi.ty=Ht.qa,h.transform(xi);for(const Vo of Ht.R)Vo();h.restoreClipRect(),Ht.R=[]}for(h.flush();Wt<gt;++Wt)ee=Gt[Wt],Ht=ee.yb,Ht.globalCompositeOperation="copy",Ht.drawImage(h.F,ee.pa,ee.qa,ee.da,ee.ca,0,0,ee.F.width,ee.F.height);Wt=gt}}}}p&&p();const l=navigator.userAgent.match(/firefox|fxios/i);let h=null;const v=new Set,B=e.makeRenderer;e.makeRenderer=function(P,$){return $?(h||(h=s(document.createElement("canvas")),$=h.zb,h.Cb=Math.min($.getParameter($.MAX_RENDERBUFFER_SIZE),$.getParameter($.MAX_TEXTURE_SIZE))),new i(P)):s(P)};const I=e.Artboard.prototype.draw;e.Artboard.prototype.draw=function(P){P.R?P.R.push(I.bind(this,P.Db)):I.call(this,P)};const E=new m,F=new m,Z=new r;e.requestAnimationFrame=Z.requestAnimationFrame.bind(Z),e.cancelAnimationFrame=Z.cancelAnimationFrame.bind(Z),e.enableFPSCounter=Z.Kb.bind(Z),Z.kb=o,e.resolveAnimationFrame=o;let et=e.load;e.load=function(P,$,ct=!0){const bt=new e.FallbackFileAssetLoader;return $!==void 0&&bt.addLoader($),ct&&($=new e.CDNFileAssetLoader,bt.addLoader($)),Promise.resolve(et(P,bt))};const at=e.WebGLRenderer.prototype.clear;e.WebGLRenderer.prototype.clear=function(){go(this.Ab);const P=this.F;(this.Va!=P.width||this.Ua!=P.height)&&(this.resize(P.width,P.height),this.Va=P.width,this.Ua=P.height),at.call(this)},e.decodeImage=function(P,$){P=e.decodeImageSkia(P),$(P)}};var b=Object.assign({},e),d="./this.program",A=typeof window=="object",y=typeof importScripts=="function",f="",x,S;(A||y)&&(y?f=self.location.href:typeof document<"u"&&document.currentScript&&(f=document.currentScript.src),a&&(f=a),f.indexOf("blob:")!==0?f=f.substr(0,f.replace(/[?#].*/,"").lastIndexOf("/")+1):f="",y&&(S=i=>{var s=new XMLHttpRequest;return s.open("GET",i,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),x=(i,s,o)=>{var l=new XMLHttpRequest;l.open("GET",i,!0),l.responseType="arraybuffer",l.onload=()=>{l.status==200||l.status==0&&l.response?s(l.response):o()},l.onerror=o,l.send(null)});var V=e.print||console.log.bind(console),C=e.printErr||console.error.bind(console);Object.assign(e,b),b=null,e.thisProgram&&(d=e.thisProgram);var _;e.wasmBinary&&(_=e.wasmBinary),e.noExitRuntime,typeof WebAssembly!="object"&&ft("no native wasm support detected");var g,w,M=!1,L,R,z,N,G,H,k,j;function O(){var i=g.buffer;e.HEAP8=L=new Int8Array(i),e.HEAP16=z=new Int16Array(i),e.HEAP32=G=new Int32Array(i),e.HEAPU8=R=new Uint8Array(i),e.HEAPU16=N=new Uint16Array(i),e.HEAPU32=H=new Uint32Array(i),e.HEAPF32=k=new Float32Array(i),e.HEAPF64=j=new Float64Array(i)}var W,tt=[],st=[],_t=[];function pt(){var i=e.preRun.shift();tt.unshift(i)}var Q=0,nt=null;function ft(i){throw e.onAbort&&e.onAbort(i),i="Aborted("+i+")",C(i),M=!0,i=new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info."),c(i),i}function Mt(i){return i.startsWith("data:application/octet-stream;base64,")}var Tt;if(Tt="webgl_advanced.wasm",!Mt(Tt)){var Vt=Tt;Tt=e.locateFile?e.locateFile(Vt,f):f+Vt}function ce(i){if(i==Tt&&_)return new Uint8Array(_);if(S)return S(i);throw"both async and sync fetching of the wasm failed"}function Qt(i){if(!_&&(A||y)){if(typeof fetch=="function"&&!i.startsWith("file://"))return fetch(i,{credentials:"same-origin"}).then(s=>{if(!s.ok)throw"failed to load wasm binary file at '"+i+"'";return s.arrayBuffer()}).catch(()=>ce(i));if(x)return new Promise((s,o)=>{x(i,l=>s(new Uint8Array(l)),o)})}return Promise.resolve().then(()=>ce(i))}function Ct(i,s,o){return Qt(i).then(l=>WebAssembly.instantiate(l,s)).then(l=>l).then(o,l=>{C("failed to asynchronously prepare wasm: "+l),ft(l)})}function se(i,s){var o=Tt;return _||typeof WebAssembly.instantiateStreaming!="function"||Mt(o)||o.startsWith("file://")||typeof fetch!="function"?Ct(o,i,s):fetch(o,{credentials:"same-origin"}).then(l=>WebAssembly.instantiateStreaming(l,i).then(s,function(h){return C("wasm streaming compile failed: "+h),C("falling back to ArrayBuffer instantiation"),Ct(o,i,s)}))}var It,Ut,pe={692684:(i,s,o,l,h)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={Ea:0},window.h.H={},window.h.H.Ca=i,window.h.H.capture=s,window.h.H.La=o,window.h.ha={},window.h.ha.stopped=l,window.h.ha.sb=h;let v=window.h;v.C=[],v.nc=function(B){for(var I=0;I<v.C.length;++I)if(v.C[I]==null)return v.C[I]=B,I;return v.C.push(B),v.C.length-1},v.xb=function(B){for(v.C[B]=null;0<v.C.length&&v.C[v.C.length-1]==null;)v.C.pop()},v.Kc=function(B){for(var I=0;I<v.C.length;++I)if(v.C[I]==B)return v.xb(I)},v.ta=function(B){return v.C[B]},v.wb=["touchend","click"],v.unlock=function(){for(var B=0;B<v.C.length;++B){var I=v.C[B];I!=null&&I.I!=null&&I.state===v.ha.sb&&I.I.resume().then(()=>{ta(I.lb)},E=>{console.error("Failed to resume audiocontext",E)})}v.wb.map(function(E){document.removeEventListener(E,v.unlock,!0)})},v.wb.map(function(B){document.addEventListener(B,v.unlock,!0)})}return window.h.Ea+=1,1},694862:()=>{typeof window.h<"u"&&(--window.h.Ea,window.h.Ea===0&&delete window.h)},695026:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,695130:()=>{try{var i=new(window.AudioContext||window.webkitAudioContext),s=i.sampleRate;return i.close(),s}catch{return 0}},695301:(i,s,o,l,h,v)=>{if(typeof window.h>"u")return-1;var B={},I={};return i==window.h.H.Ca&&o!=0&&(I.sampleRate=o),B.I=new(window.AudioContext||window.webkitAudioContext)(I),B.I.suspend(),B.state=window.h.ha.stopped,o=0,i!=window.h.H.Ca&&(o=s),B.X=B.I.createScriptProcessor(l,o,s),B.X.onaudioprocess=function(E){if((B.ua==null||B.ua.length==0)&&(B.ua=new Float32Array(k.buffer,h,l*s)),i==window.h.H.capture||i==window.h.H.La){for(var F=0;F<s;F+=1)for(var Z=E.inputBuffer.getChannelData(F),et=B.ua,at=0;at<l;at+=1)et[at*s+F]=Z[at];ea(v,l,h)}if(i==window.h.H.Ca||i==window.h.H.La)for(ia(v,l,h),F=0;F<E.outputBuffer.numberOfChannels;++F)for(Z=E.outputBuffer.getChannelData(F),et=B.ua,at=0;at<l;at+=1)Z[at]=et[at*s+F];else for(F=0;F<E.outputBuffer.numberOfChannels;++F)E.outputBuffer.getChannelData(F).fill(0)},i!=window.h.H.capture&&i!=window.h.H.La||navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(E){B.Fa=B.I.createMediaStreamSource(E),B.Fa.connect(B.X),B.X.connect(B.I.destination)}).catch(function(E){console.log("Failed to get user media: "+E)}),i==window.h.H.Ca&&B.X.connect(B.I.destination),B.lb=v,window.h.nc(B)},698178:i=>window.h.ta(i).I.sampleRate,698251:i=>{i=window.h.ta(i),i.X!==void 0&&(i.X.onaudioprocess=function(){},i.X.disconnect(),i.X=void 0),i.Fa!==void 0&&(i.Fa.disconnect(),i.Fa=void 0),i.I.close(),i.I=void 0,i.lb=void 0},698651:i=>{window.h.xb(i)},698701:i=>{i=window.h.ta(i),i.I.resume(),i.state=window.h.ha.sb},698840:i=>{i=window.h.ta(i),i.I.suspend(),i.state=window.h.ha.stopped}},be=i=>{for(;0<i.length;)i.shift()(e)},Ie=(i,s)=>{for(var o=0,l=i.length-1;0<=l;l--){var h=i[l];h==="."?i.splice(l,1):h===".."?(i.splice(l,1),o++):o&&(i.splice(l,1),o--)}if(s)for(;o;o--)i.unshift("..");return i},te=i=>{var s=i.charAt(0)==="/",o=i.substr(-1)==="/";return(i=Ie(i.split("/").filter(l=>!!l),!s).join("/"))||s||(i="."),i&&o&&(i+="/"),(s?"/":"")+i},Ue=i=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=s[0],s=s[1],!i&&!s?".":(s&&(s=s.substr(0,s.length-1)),i+s)},fe=i=>{if(i==="/")return"/";i=te(i),i=i.replace(/\/$/,"");var s=i.lastIndexOf("/");return s===-1?i:i.substr(s+1)},zi=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);ft("initRandomDevice")},ai=i=>(ai=zi())(i);function Le(){for(var i="",s=!1,o=arguments.length-1;-1<=o&&!s;o--){if(s=0<=o?arguments[o]:"/",typeof s!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";i=s+"/"+i,s=s.charAt(0)==="/"}return i=Ie(i.split("/").filter(l=>!!l),!s).join("/"),(s?"/":"")+i||"."}var we=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,ge=(i,s,o)=>{var l=s+o;for(o=s;i[o]&&!(o>=l);)++o;if(16<o-s&&i.buffer&&we)return we.decode(i.subarray(s,o));for(l="";s<o;){var h=i[s++];if(h&128){var v=i[s++]&63;if((h&224)==192)l+=String.fromCharCode((h&31)<<6|v);else{var B=i[s++]&63;h=(h&240)==224?(h&15)<<12|v<<6|B:(h&7)<<18|v<<12|B<<6|i[s++]&63,65536>h?l+=String.fromCharCode(h):(h-=65536,l+=String.fromCharCode(55296|h>>10,56320|h&1023))}}else l+=String.fromCharCode(h)}return l},$i=[],ci=i=>{for(var s=0,o=0;o<i.length;++o){var l=i.charCodeAt(o);127>=l?s++:2047>=l?s+=2:55296<=l&&57343>=l?(s+=4,++o):s+=3}return s},li=(i,s,o,l)=>{if(!(0<l))return 0;var h=o;l=o+l-1;for(var v=0;v<i.length;++v){var B=i.charCodeAt(v);if(55296<=B&&57343>=B){var I=i.charCodeAt(++v);B=65536+((B&1023)<<10)|I&1023}if(127>=B){if(o>=l)break;s[o++]=B}else{if(2047>=B){if(o+1>=l)break;s[o++]=192|B>>6}else{if(65535>=B){if(o+2>=l)break;s[o++]=224|B>>12}else{if(o+3>=l)break;s[o++]=240|B>>18,s[o++]=128|B>>12&63}s[o++]=128|B>>6&63}s[o++]=128|B&63}}return s[o]=0,o-h};function rr(i,s){var o=Array(ci(i)+1);return i=li(i,o,0,o.length),s&&(o.length=i),o}var ar=[];function cr(i,s){ar[i]={input:[],D:[],T:s},ao(i,Ya)}var Ya={open:function(i){var s=ar[i.node.Da];if(!s)throw new rt(43);i.s=s,i.seekable=!1},close:function(i){i.s.T.sa(i.s)},sa:function(i){i.s.T.sa(i.s)},read:function(i,s,o,l){if(!i.s||!i.s.T.eb)throw new rt(60);for(var h=0,v=0;v<l;v++){try{var B=i.s.T.eb(i.s)}catch{throw new rt(29)}if(B===void 0&&h===0)throw new rt(6);if(B==null)break;h++,s[o+v]=B}return h&&(i.node.timestamp=Date.now()),h},write:function(i,s,o,l){if(!i.s||!i.s.T.Oa)throw new rt(60);try{for(var h=0;h<l;h++)i.s.T.Oa(i.s,s[o+h])}catch{throw new rt(29)}return l&&(i.node.timestamp=Date.now()),h}},Qa={eb:function(){t:{if(!$i.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i){i=null;break t}$i=rr(i,!0)}i=$i.shift()}return i},Oa:function(i,s){s===null||s===10?(V(ge(i.D,0)),i.D=[]):s!=0&&i.D.push(s)},sa:function(i){i.D&&0<i.D.length&&(V(ge(i.D,0)),i.D=[])},Wb:function(){return{uc:25856,wc:5,tc:191,vc:35387,sc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Xb:function(){return 0},Yb:function(){return[24,80]}},Ua={Oa:function(i,s){s===null||s===10?(C(ge(i.D,0)),i.D=[]):s!=0&&i.D.push(s)},sa:function(i){i.D&&0<i.D.length&&(C(ge(i.D,0)),i.D=[])}};function lr(i,s){var o=i.j?i.j.length:0;o>=s||(s=Math.max(s,o*(1048576>o?2:1.125)>>>0),o!=0&&(s=Math.max(s,256)),o=i.j,i.j=new Uint8Array(s),0<i.v&&i.j.set(o.subarray(0,i.v),0))}var wt={N:null,S(){return wt.createNode(null,"/",16895,0)},createNode(i,s,o,l){if((o&61440)===24576||(o&61440)===4096)throw new rt(63);return wt.N||(wt.N={dir:{node:{W:wt.l.W,O:wt.l.O,ka:wt.l.ka,Aa:wt.l.Aa,qb:wt.l.qb,vb:wt.l.vb,rb:wt.l.rb,ob:wt.l.ob,Ga:wt.l.Ga},stream:{$:wt.m.$}},file:{node:{W:wt.l.W,O:wt.l.O},stream:{$:wt.m.$,read:wt.m.read,write:wt.m.write,ra:wt.m.ra,hb:wt.m.hb,jb:wt.m.jb}},link:{node:{W:wt.l.W,O:wt.l.O,la:wt.l.la},stream:{}},Wa:{node:{W:wt.l.W,O:wt.l.O},stream:ic}}),o=dr(i,s,o,l),(o.mode&61440)===16384?(o.l=wt.N.dir.node,o.m=wt.N.dir.stream,o.j={}):(o.mode&61440)===32768?(o.l=wt.N.file.node,o.m=wt.N.file.stream,o.v=0,o.j=null):(o.mode&61440)===40960?(o.l=wt.N.link.node,o.m=wt.N.link.stream):(o.mode&61440)===8192&&(o.l=wt.N.Wa.node,o.m=wt.N.Wa.stream),o.timestamp=Date.now(),i&&(i.j[s]=o,i.timestamp=o.timestamp),o},Ac(i){return i.j?i.j.subarray?i.j.subarray(0,i.v):new Uint8Array(i.j):new Uint8Array(0)},l:{W(i){var s={};return s.zc=(i.mode&61440)===8192?i.id:1,s.Cc=i.id,s.mode=i.mode,s.Gc=1,s.uid=0,s.Bc=0,s.Da=i.Da,(i.mode&61440)===16384?s.size=4096:(i.mode&61440)===32768?s.size=i.v:(i.mode&61440)===40960?s.size=i.link.length:s.size=0,s.qc=new Date(i.timestamp),s.Ec=new Date(i.timestamp),s.xc=new Date(i.timestamp),s.Eb=4096,s.rc=Math.ceil(s.size/s.Eb),s},O(i,s){if(s.mode!==void 0&&(i.mode=s.mode),s.timestamp!==void 0&&(i.timestamp=s.timestamp),s.size!==void 0&&(s=s.size,i.v!=s))if(s==0)i.j=null,i.v=0;else{var o=i.j;i.j=new Uint8Array(s),o&&i.j.set(o.subarray(0,Math.min(s,i.v))),i.v=s}},ka(){throw ro[44]},Aa(i,s,o,l){return wt.createNode(i,s,o,l)},qb(i,s,o){if((i.mode&61440)===16384){try{var l=en(s,o)}catch{}if(l)for(var h in l.j)throw new rt(55)}delete i.parent.j[i.name],i.parent.timestamp=Date.now(),i.name=o,s.j[o]=i,s.timestamp=i.parent.timestamp,i.parent=s},vb(i,s){delete i.j[s],i.timestamp=Date.now()},rb(i,s){var o=en(i,s),l;for(l in o.j)throw new rt(55);delete i.j[s],i.timestamp=Date.now()},ob(i){var s=[".",".."],o;for(o in i.j)i.j.hasOwnProperty(o)&&s.push(o);return s},Ga(i,s,o){return i=wt.createNode(i,s,41471,0),i.link=o,i},la(i){if((i.mode&61440)!==40960)throw new rt(28);return i.link}},m:{read(i,s,o,l,h){var v=i.node.j;if(h>=i.node.v)return 0;if(i=Math.min(i.node.v-h,l),8<i&&v.subarray)s.set(v.subarray(h,h+i),o);else for(l=0;l<i;l++)s[o+l]=v[h+l];return i},write(i,s,o,l,h,v){if(s.buffer===L.buffer&&(v=!1),!l)return 0;if(i=i.node,i.timestamp=Date.now(),s.subarray&&(!i.j||i.j.subarray)){if(v)return i.j=s.subarray(o,o+l),i.v=l;if(i.v===0&&h===0)return i.j=s.slice(o,o+l),i.v=l;if(h+l<=i.v)return i.j.set(s.subarray(o,o+l),h),l}if(lr(i,h+l),i.j.subarray&&s.subarray)i.j.set(s.subarray(o,o+l),h);else for(v=0;v<l;v++)i.j[h+v]=s[o+v];return i.v=Math.max(i.v,h+l),l},$(i,s,o){if(o===1?s+=i.position:o===2&&(i.node.mode&61440)===32768&&(s+=i.node.v),0>s)throw new rt(28);return s},ra(i,s,o){lr(i.node,s+o),i.node.v=Math.max(i.node.v,s+o)},hb(i,s,o,l,h){if((i.node.mode&61440)!==32768)throw new rt(43);if(i=i.node.j,h&2||i.buffer!==L.buffer){if((0<o||o+s<i.length)&&(i.subarray?i=i.subarray(o,o+s):i=Array.prototype.slice.call(i,o,o+s)),o=!0,s=65536*Math.ceil(s/65536),(h=oa(65536,s))?(R.fill(0,h,h+s),s=h):s=0,!s)throw new rt(48);L.set(i,s)}else o=!1,s=i.byteOffset;return{o:s,L:o}},jb(i,s,o,l){return wt.m.write(i,s,0,l,o,!1),0}}};function Ka(i,s){var o=0;return i&&(o|=365),s&&(o|=146),o}var oo=null,mr={},tn=[],tc=1,Vs=null,hr=!0,rt=null,ro={},Ni=(i,s={})=>{if(i=Le(i),!i)return{path:"",node:null};if(s=Object.assign({bb:!0,Qa:0},s),8<s.Qa)throw new rt(32);i=i.split("/").filter(B=>!!B);for(var o=oo,l="/",h=0;h<i.length;h++){var v=h===i.length-1;if(v&&s.parent)break;if(o=en(o,i[h]),l=te(l+"/"+i[h]),o.Ba&&(!v||v&&s.bb)&&(o=o.Ba.root),!v||s.ab){for(v=0;(o.mode&61440)===40960;)if(o=sc(l),l=Le(Ue(l),o),o=Ni(l,{Qa:s.Qa+1}).node,40<v++)throw new rt(32)}}return{path:l,node:o}},_r=i=>{for(var s;;){if(i===i.parent)return i=i.S.ib,s?i[i.length-1]!=="/"?`${i}/${s}`:i+s:i;s=s?`${i.name}/${s}`:i.name,i=i.parent}},ur=(i,s)=>{for(var o=0,l=0;l<s.length;l++)o=(o<<5)-o+s.charCodeAt(l)|0;return(i+o>>>0)%Vs.length},en=(i,s)=>{var o;if(o=(o=sn(i,"x"))?o:i.l.ka?0:2)throw new rt(o,i);for(o=Vs[ur(i.id,s)];o;o=o.ac){var l=o.name;if(o.parent.id===i.id&&l===s)return o}return i.l.ka(i,s)},dr=(i,s,o,l)=>(i=new Qr(i,s,o,l),s=ur(i.parent.id,i.name),i.ac=Vs[s],Vs[s]=i),pr=i=>{var s=["r","w","rw"][i&3];return i&512&&(s+="w"),s},sn=(i,s)=>{if(hr)return 0;if(!s.includes("r")||i.mode&292){if(s.includes("w")&&!(i.mode&146)||s.includes("x")&&!(i.mode&73))return 2}else return 2;return 0},br=(i,s)=>{try{return en(i,s),20}catch{}return sn(i,"wx")},ec=()=>{for(var i=0;4096>=i;i++)if(!tn[i])return i;throw new rt(33)},Ti=i=>{if(i=tn[i],!i)throw new rt(8);return i},fr=(i,s=-1)=>(Ms||(Ms=function(){this.h={}},Ms.prototype={},Object.defineProperties(Ms.prototype,{object:{get(){return this.node},set(o){this.node=o}},flags:{get(){return this.h.flags},set(o){this.h.flags=o}},position:{get(){return this.h.position},set(o){this.h.position=o}}})),i=Object.assign(new Ms,i),s==-1&&(s=ec()),i.V=s,tn[s]=i),ic={open:i=>{i.m=mr[i.node.Da].m,i.m.open&&i.m.open(i)},$:()=>{throw new rt(70)}},ao=(i,s)=>{mr[i]={m:s}},yr=(i,s)=>{var o=s==="/",l=!s;if(o&&oo)throw new rt(10);if(!o&&!l){var h=Ni(s,{bb:!1});if(s=h.path,h=h.node,h.Ba)throw new rt(10);if((h.mode&61440)!==16384)throw new rt(54)}s={type:i,Ic:{},ib:s,$b:[]},i=i.S(s),i.S=s,s.root=i,o?oo=i:h&&(h.Ba=s,h.S&&h.S.$b.push(s))},Ke=(i,s,o)=>{var l=Ni(i,{parent:!0}).node;if(i=fe(i),!i||i==="."||i==="..")throw new rt(28);var h=br(l,i);if(h)throw new rt(h);if(!l.l.Aa)throw new rt(63);return l.l.Aa(l,i,s,o)},nn=(i,s,o)=>{typeof o>"u"&&(o=s,s=438),Ke(i,s|8192,o)},co=(i,s)=>{if(!Le(i))throw new rt(44);var o=Ni(s,{parent:!0}).node;if(!o)throw new rt(44);s=fe(s);var l=br(o,s);if(l)throw new rt(l);if(!o.l.Ga)throw new rt(63);o.l.Ga(o,s,i)},sc=i=>{if(i=Ni(i).node,!i)throw new rt(44);if(!i.l.la)throw new rt(28);return Le(_r(i.parent),i.l.la(i))},on=(i,s,o)=>{if(i==="")throw new rt(44);if(typeof s=="string"){var l={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[s];if(typeof l>"u")throw Error(`Unknown file open mode: ${s}`);s=l}if(o=s&64?(typeof o>"u"?438:o)&4095|32768:0,typeof i=="object")var h=i;else{i=te(i);try{h=Ni(i,{ab:!(s&131072)}).node}catch{}}if(l=!1,s&64)if(h){if(s&128)throw new rt(20)}else h=Ke(i,o,0),l=!0;if(!h)throw new rt(44);if((h.mode&61440)===8192&&(s&=-513),s&65536&&(h.mode&61440)!==16384)throw new rt(54);if(!l&&(o=h?(h.mode&61440)===40960?32:(h.mode&61440)===16384&&(pr(s)!=="r"||s&512)?31:sn(h,pr(s)):44))throw new rt(o);if(s&512&&!l){if(o=h,o=typeof o=="string"?Ni(o,{ab:!0}).node:o,!o.l.O)throw new rt(63);if((o.mode&61440)===16384)throw new rt(31);if((o.mode&61440)!==32768)throw new rt(28);if(l=sn(o,"w"))throw new rt(l);o.l.O(o,{size:0,timestamp:Date.now()})}return s&=-131713,h=fr({node:h,path:_r(h),flags:s,seekable:!0,position:0,m:h.m,oc:[],error:!1}),h.m.open&&h.m.open(h),!e.logReadFiles||s&1||(rn||(rn={}),i in rn||(rn[i]=1)),h},vr=(i,s,o)=>{if(i.V===null)throw new rt(8);if(!i.seekable||!i.m.$)throw new rt(70);if(o!=0&&o!=1&&o!=2)throw new rt(28);i.position=i.m.$(i,s,o),i.oc=[]},Ar=()=>{rt||(rt=function(i,s){this.name="ErrnoError",this.node=s,this.dc=function(o){this.Z=o},this.dc(i),this.message="FS error"},rt.prototype=Error(),rt.prototype.constructor=rt,[44].forEach(i=>{ro[i]=new rt(i),ro[i].stack="<generic error, no stack>"}))},wr,Cs=(i,s,o)=>{i=te("/dev/"+i);var l=Ka(!!s,!!o);lo||(lo=64);var h=lo++<<8|0;ao(h,{open:v=>{v.seekable=!1},close:()=>{o&&o.buffer&&o.buffer.length&&o(10)},read:(v,B,I,E)=>{for(var F=0,Z=0;Z<E;Z++){try{var et=s()}catch{throw new rt(29)}if(et===void 0&&F===0)throw new rt(6);if(et==null)break;F++,B[I+Z]=et}return F&&(v.node.timestamp=Date.now()),F},write:(v,B,I,E)=>{for(var F=0;F<E;F++)try{o(B[I+F])}catch{throw new rt(29)}return E&&(v.node.timestamp=Date.now()),F}}),nn(i,l,h)},lo,Wi={},Ms,rn,Is=void 0;function fi(){return Is+=4,G[Is-4>>2]}function gr(i){if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var s=i.charCodeAt(0);return 48<=s&&57>=s?`_${i}`:i}function an(i,s){return i=gr(i),{[i]:function(){return s.apply(this,arguments)}}[i]}function xr(){this.L=[void 0],this.cb=[]}var He=new xr,us=void 0;function At(i){throw new us(i)}var ti=i=>(i||At("Cannot use deleted val. handle = "+i),He.get(i).value),yi=i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return He.ra({pb:1,value:i})}};function Sr(i){var s=Error,o=an(i,function(l){this.name=i,this.message=l,l=Error(l).stack,l!==void 0&&(this.stack=this.toString()+`
`+l.replace(/^Error(:[^\n]*)?\n/,""))});return o.prototype=Object.create(s.prototype),o.prototype.constructor=o,o.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},o}var Br=void 0,Vr=void 0;function ne(i){for(var s="";R[i];)s+=Vr[R[i++]];return s}var Ps=[];function mo(){for(;Ps.length;){var i=Ps.pop();i.g.ga=!1,i.delete()}}var Ts=void 0,vi={};function ho(i,s){for(s===void 0&&At("ptr should not be undefined");i.A;)s=i.na(s),i=i.A;return s}var Hi={};function Cr(i){i=na(i);var s=ne(i);return gi(i),s}function Ds(i,s){var o=Hi[i];return o===void 0&&At(s+" has unknown type "+Cr(i)),o}function cn(){}var _o=!1;function Mr(i){--i.count.value,i.count.value===0&&(i.G?i.K.U(i.G):i.u.i.U(i.o))}function Ir(i,s,o){return s===o?i:o.A===void 0?null:(i=Ir(i,s,o.A),i===null?null:o.Ib(i))}var Pr={};function nc(i,s){return s=ho(i,s),vi[s]}var Tr=void 0;function ln(i){throw new Tr(i)}function mn(i,s){return s.u&&s.o||ln("makeClassHandle requires ptr and ptrType"),!!s.K!=!!s.G&&ln("Both smartPtrType and smartPtr must be specified"),s.count={value:1},ds(Object.create(i,{g:{value:s}}))}function ds(i){return typeof FinalizationRegistry>"u"?(ds=s=>s,i):(_o=new FinalizationRegistry(s=>{Mr(s.g)}),ds=s=>{var o=s.g;return o.G&&_o.register(s,{g:o},s),s},cn=s=>{_o.unregister(s)},ds(i))}var hn={};function Gs(i){for(;i.length;){var s=i.pop();i.pop()(s)}}function Ls(i){return this.fromWireType(G[i>>2])}var ps={},_n={};function je(i,s,o){function l(I){I=o(I),I.length!==i.length&&ln("Mismatched type converter count");for(var E=0;E<i.length;++E)mi(i[E],I[E])}i.forEach(function(I){_n[I]=s});var h=Array(s.length),v=[],B=0;s.forEach((I,E)=>{Hi.hasOwnProperty(I)?h[E]=Hi[I]:(v.push(I),ps.hasOwnProperty(I)||(ps[I]=[]),ps[I].push(()=>{h[E]=Hi[I],++B,B===v.length&&l(h)}))}),v.length===0&&l(h)}function un(i){switch(i){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${i}`)}}function oc(i,s,o={}){var l=s.name;if(i||At(`type "${l}" must have a positive integer typeid pointer`),Hi.hasOwnProperty(i)){if(o.Tb)return;At(`Cannot register type '${l}' twice`)}Hi[i]=s,delete _n[i],ps.hasOwnProperty(i)&&(s=ps[i],delete ps[i],s.forEach(h=>h()))}function mi(i,s,o={}){if(!("argPackAdvance"in s))throw new TypeError("registerType registeredInstance requires argPackAdvance");oc(i,s,o)}function uo(i){At(i.g.u.i.name+" instance already deleted")}function Di(){}function po(i,s,o){if(i[s].B===void 0){var l=i[s];i[s]=function(){return i[s].B.hasOwnProperty(arguments.length)||At(`Function '${o}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[s].B})!`),i[s].B[arguments.length].apply(this,arguments)},i[s].B=[],i[s].B[l.ea]=l}}function bo(i,s,o){e.hasOwnProperty(i)?((o===void 0||e[i].B!==void 0&&e[i].B[o]!==void 0)&&At(`Cannot register public name '${i}' twice`),po(e,i,i),e.hasOwnProperty(o)&&At(`Cannot register multiple overloads of a function with the same number of arguments (${o})!`),e[i].B[o]=s):(e[i]=s,o!==void 0&&(e[i].Hc=o))}function rc(i,s,o,l,h,v,B,I){this.name=i,this.constructor=s,this.M=o,this.U=l,this.A=h,this.Nb=v,this.na=B,this.Ib=I,this.mb=[]}function dn(i,s,o){for(;s!==o;)s.na||At(`Expected null or instance of ${o.name}, got an instance of ${s.name}`),i=s.na(i),s=s.A;return i}function ac(i,s){return s===null?(this.Na&&At(`null is not a valid ${this.name}`),0):(s.g||At(`Cannot pass "${yo(s)}" as a ${this.name}`),s.g.o||At(`Cannot pass deleted object as a pointer of type ${this.name}`),dn(s.g.o,s.g.u.i,this.i))}function cc(i,s){if(s===null){if(this.Na&&At(`null is not a valid ${this.name}`),this.wa){var o=this.Pa();return i!==null&&i.push(this.U,o),o}return 0}if(s.g||At(`Cannot pass "${yo(s)}" as a ${this.name}`),s.g.o||At(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.va&&s.g.u.va&&At(`Cannot convert argument of type ${s.g.K?s.g.K.name:s.g.u.name} to parameter type ${this.name}`),o=dn(s.g.o,s.g.u.i,this.i),this.wa)switch(s.g.G===void 0&&At("Passing raw pointer to smart pointer is illegal"),this.ic){case 0:s.g.K===this?o=s.g.G:At(`Cannot convert argument of type ${s.g.K?s.g.K.name:s.g.u.name} to parameter type ${this.name}`);break;case 1:o=s.g.G;break;case 2:if(s.g.K===this)o=s.g.G;else{var l=s.clone();o=this.cc(o,yi(function(){l.delete()})),i!==null&&i.push(this.U,o)}break;default:At("Unsupporting sharing policy")}return o}function lc(i,s){return s===null?(this.Na&&At(`null is not a valid ${this.name}`),0):(s.g||At(`Cannot pass "${yo(s)}" as a ${this.name}`),s.g.o||At(`Cannot pass deleted object as a pointer of type ${this.name}`),s.g.u.va&&At(`Cannot convert argument of type ${s.g.u.name} to parameter type ${this.name}`),dn(s.g.o,s.g.u.i,this.i))}function Ai(i,s,o,l){this.name=i,this.i=s,this.Na=o,this.va=l,this.wa=!1,this.U=this.cc=this.Pa=this.nb=this.ic=this.bc=void 0,s.A!==void 0?this.toWireType=cc:(this.toWireType=l?ac:lc,this.J=null)}function Dr(i,s,o){e.hasOwnProperty(i)||ln("Replacing nonexistant public symbol"),e[i].B!==void 0&&o!==void 0?e[i].B[o]=s:(e[i]=s,e[i].ea=o)}var pn=[],ye=i=>{var s=pn[i];return s||(i>=pn.length&&(pn.length=i+1),pn[i]=s=W.get(i)),s},mc=(i,s)=>{var o=[];return function(){if(o.length=0,Object.assign(o,arguments),i.includes("j")){var l=e["dynCall_"+i];l=o&&o.length?l.apply(null,[s].concat(o)):l.call(null,s)}else l=ye(s).apply(null,o);return l}};function xe(i,s){i=ne(i);var o=i.includes("j")?mc(i,s):ye(s);return typeof o!="function"&&At(`unknown function pointer with signature ${i}: ${s}`),o}var Gr=void 0;function wi(i,s){function o(v){h[v]||Hi[v]||(_n[v]?_n[v].forEach(o):(l.push(v),h[v]=!0))}var l=[],h={};throw s.forEach(o),new Gr(`${i}: `+l.map(Cr).join([", "]))}function bn(i,s,o,l,h){var v=s.length;2>v&&At("argTypes array size mismatch! Must at least get return value and 'this' types!");var B=s[1]!==null&&o!==null,I=!1;for(o=1;o<s.length;++o)if(s[o]!==null&&s[o].J===void 0){I=!0;break}var E=s[0].name!=="void",F=v-2,Z=Array(F),et=[],at=[];return function(){if(arguments.length!==F&&At(`function ${i} called with ${arguments.length} arguments, expected ${F} args!`),at.length=0,et.length=B?2:1,et[0]=h,B){var P=s[1].toWireType(at,this);et[1]=P}for(var $=0;$<F;++$)Z[$]=s[$+2].toWireType(at,arguments[$]),et.push(Z[$]);if($=l.apply(null,et),I)Gs(at);else for(var ct=B?1:2;ct<s.length;ct++){var bt=ct===1?P:Z[ct-2];s[ct].J!==null&&s[ct].J(bt)}return P=E?s[0].fromWireType($):void 0,P}}function fn(i,s){for(var o=[],l=0;l<i;l++)o.push(H[s+4*l>>2]);return o}function Lr(i,s,o){return i instanceof Object||At(`${o} with invalid "this": ${i}`),i instanceof s.i.constructor||At(`${o} incompatible with "this" of type ${i.constructor.name}`),i.g.o||At(`cannot call emscripten binding method ${o} on deleted object`),dn(i.g.o,i.g.u.i,s.i)}function fo(i){i>=He.h&&--He.get(i).pb===0&&He.Sb(i)}function hc(i,s,o){switch(s){case 0:return function(l){return this.fromWireType((o?L:R)[l])};case 1:return function(l){return this.fromWireType((o?z:N)[l>>1])};case 2:return function(l){return this.fromWireType((o?G:H)[l>>2])};default:throw new TypeError("Unknown integer type: "+i)}}function yo(i){if(i===null)return"null";var s=typeof i;return s==="object"||s==="array"||s==="function"?i.toString():""+i}function _c(i,s){switch(s){case 2:return function(o){return this.fromWireType(k[o>>2])};case 3:return function(o){return this.fromWireType(j[o>>3])};default:throw new TypeError("Unknown float type: "+i)}}function uc(i,s,o){switch(s){case 0:return o?function(l){return L[l]}:function(l){return R[l]};case 1:return o?function(l){return z[l>>1]}:function(l){return N[l>>1]};case 2:return o?function(l){return G[l>>2]}:function(l){return H[l>>2]};default:throw new TypeError("Unknown integer type: "+i)}}var Fr=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,dc=(i,s)=>{for(var o=i>>1,l=o+s/2;!(o>=l)&&N[o];)++o;if(o<<=1,32<o-i&&Fr)return Fr.decode(R.subarray(i,o));for(o="",l=0;!(l>=s/2);++l){var h=z[i+2*l>>1];if(h==0)break;o+=String.fromCharCode(h)}return o},pc=(i,s,o)=>{if(o===void 0&&(o=2147483647),2>o)return 0;o-=2;var l=s;o=o<2*i.length?o/2:i.length;for(var h=0;h<o;++h)z[s>>1]=i.charCodeAt(h),s+=2;return z[s>>1]=0,s-l},bc=i=>2*i.length,fc=(i,s)=>{for(var o=0,l="";!(o>=s/4);){var h=G[i+4*o>>2];if(h==0)break;++o,65536<=h?(h-=65536,l+=String.fromCharCode(55296|h>>10,56320|h&1023)):l+=String.fromCharCode(h)}return l},yc=(i,s,o)=>{if(o===void 0&&(o=2147483647),4>o)return 0;var l=s;o=l+o-4;for(var h=0;h<i.length;++h){var v=i.charCodeAt(h);if(55296<=v&&57343>=v){var B=i.charCodeAt(++h);v=65536+((v&1023)<<10)|B&1023}if(G[s>>2]=v,s+=4,s+4>o)break}return G[s>>2]=0,s-l},vc=i=>{for(var s=0,o=0;o<i.length;++o){var l=i.charCodeAt(o);55296<=l&&57343>=l&&++o,s+=4}return s},Ac={};function vo(i){var s=Ac[i];return s===void 0?ne(i):s}var yn=[];function wc(i){var s=yn.length;return yn.push(i),s}function gc(i,s){for(var o=Array(i),l=0;l<i;++l)o[l]=Ds(H[s+4*l>>2],"parameter "+l);return o}var Rr=[],Ao=[];function xc(i){var s=i.getExtension("ANGLE_instanced_arrays");s&&(i.vertexAttribDivisor=function(o,l){s.vertexAttribDivisorANGLE(o,l)},i.drawArraysInstanced=function(o,l,h,v){s.drawArraysInstancedANGLE(o,l,h,v)},i.drawElementsInstanced=function(o,l,h,v,B){s.drawElementsInstancedANGLE(o,l,h,v,B)})}function Sc(i){var s=i.getExtension("OES_vertex_array_object");s&&(i.createVertexArray=function(){return s.createVertexArrayOES()},i.deleteVertexArray=function(o){s.deleteVertexArrayOES(o)},i.bindVertexArray=function(o){s.bindVertexArrayOES(o)},i.isVertexArray=function(o){return s.isVertexArrayOES(o)})}function Bc(i){var s=i.getExtension("WEBGL_draw_buffers");s&&(i.drawBuffers=function(o,l){s.drawBuffersWEBGL(o,l)})}var kr=1,vn=[],ei=[],An=[],Fs=[],bs=[],ii=[],wn=[],wo=[],fs=[],Zi=[],Er={},jr={},Or=4;function Kt(i){gn||(gn=i)}function Rs(i){for(var s=kr++,o=i.length;o<s;o++)i[o]=null;return s}function go(i){return zt=wo[i],e.yc=T=zt&&zt.Ta,!(i&&!T)}function Vc(i){if(i||(i=zt),!i.Ub){i.Ub=!0;var s=i.Ta;xc(s),Sc(s),Bc(s),s.Ya=s.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),s.gb=s.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance"),2<=i.version&&(s.Za=s.getExtension("EXT_disjoint_timer_query_webgl2")),(2>i.version||!s.Za)&&(s.Za=s.getExtension("EXT_disjoint_timer_query")),s.Fc=s.getExtension("WEBGL_multi_draw"),(s.getSupportedExtensions()||[]).forEach(function(o){o.includes("lose_context")||o.includes("debug")||s.getExtension(o)})}}var gn,zt;function Jr(i,s){T.bindFramebuffer(i,An[s])}function qr(i){T.bindVertexArray(wn[i])}function zr(i,s){for(var o=0;o<i;o++){var l=G[s+4*o>>2];T.deleteVertexArray(wn[l]),wn[l]=null}}var xn=[];function $r(i,s,o,l){T.drawElements(i,s,o,l)}function ys(i,s,o,l){for(var h=0;h<i;h++){var v=T[o](),B=v&&Rs(l);v?(v.name=B,l[B]=v):Kt(1282),G[s+4*h>>2]=B}}function Nr(i,s){ys(i,s,"createVertexArray",wn)}function Cc(i,s){if(s){var o=void 0;switch(i){case 36346:o=1;break;case 36344:return;case 34814:case 36345:o=0;break;case 34466:var l=T.getParameter(34467);o=l?l.length:0;break;case 33309:if(2>zt.version){Kt(1282);return}o=2*(T.getSupportedExtensions()||[]).length;break;case 33307:case 33308:if(2>zt.version){Kt(1280);return}o=i==33307?3:0}if(o===void 0)switch(l=T.getParameter(i),typeof l){case"number":o=l;break;case"boolean":o=l?1:0;break;case"string":Kt(1280);return;case"object":if(l===null)switch(i){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 36662:case 36663:case 35053:case 35055:case 36010:case 35097:case 35869:case 32874:case 36389:case 35983:case 35368:case 34068:o=0;break;default:Kt(1280);return}else{if(l instanceof Float32Array||l instanceof Uint32Array||l instanceof Int32Array||l instanceof Array){for(i=0;i<l.length;++i)G[s+4*i>>2]=l[i];return}try{o=l.name|0}catch(h){Kt(1280),C("GL_INVALID_ENUM in glGet0v: Unknown object returned from WebGL getParameter("+i+")! (error: "+h+")");return}}break;default:Kt(1280),C("GL_INVALID_ENUM in glGet0v: Native code calling glGet0v("+i+") and it returns "+l+" of type "+typeof l+"!");return}G[s>>2]=o}else Kt(1281)}function Wr(i,s){Cc(i,s)}var ks=i=>{var s=ci(i)+1,o=Cn(s);return o&&li(i,R,o,s),o};function Hr(i){return i.slice(-1)=="]"&&i.lastIndexOf("[")}function Sn(i){return i-=5120,i==0?L:i==1?R:i==2?z:i==4?G:i==6?k:i==5||i==28922||i==28520||i==30779||i==30782?H:N}function xo(i,s,o,l,h){i=Sn(i);var v=31-Math.clz32(i.BYTES_PER_ELEMENT),B=Or;return i.subarray(h>>v,h+l*(o*({5:3,6:4,8:2,29502:3,29504:4,26917:2,26918:2,29846:3,29847:4}[s-6402]||1)*(1<<v)+B-1&-B)>>v)}function Jt(i){var s=T.Gb;if(s){var o=s.ma[i];return typeof o=="number"&&(s.ma[i]=o=T.getUniformLocation(s,s.tb[i]+(0<o?"["+o+"]":""))),o}Kt(1282)}var Gi=[],Es=[],So={},Zr=()=>{if(!Bo){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:d||"./this.program"},s;for(s in So)So[s]===void 0?delete i[s]:i[s]=So[s];var o=[];for(s in i)o.push(`${s}=${i[s]}`);Bo=o}return Bo},Bo,Bn=i=>i%4===0&&(i%100!==0||i%400===0),Xr=[31,29,31,30,31,30,31,31,30,31,30,31],Yr=[31,28,31,30,31,30,31,31,30,31,30,31],Mc=(i,s,o,l)=>{function h(P,$,ct){for(P=typeof P=="number"?P.toString():P||"";P.length<$;)P=ct[0]+P;return P}function v(P,$){return h(P,$,"0")}function B(P,$){function ct(Gt){return 0>Gt?-1:0<Gt?1:0}var bt;return(bt=ct(P.getFullYear()-$.getFullYear()))===0&&(bt=ct(P.getMonth()-$.getMonth()))===0&&(bt=ct(P.getDate()-$.getDate())),bt}function I(P){switch(P.getDay()){case 0:return new Date(P.getFullYear()-1,11,29);case 1:return P;case 2:return new Date(P.getFullYear(),0,3);case 3:return new Date(P.getFullYear(),0,2);case 4:return new Date(P.getFullYear(),0,1);case 5:return new Date(P.getFullYear()-1,11,31);case 6:return new Date(P.getFullYear()-1,11,30)}}function E(P){var $=P.aa;for(P=new Date(new Date(P.ba+1900,0,1).getTime());0<$;){var ct=P.getMonth(),bt=(Bn(P.getFullYear())?Xr:Yr)[ct];if($>bt-P.getDate())$-=bt-P.getDate()+1,P.setDate(1),11>ct?P.setMonth(ct+1):(P.setMonth(0),P.setFullYear(P.getFullYear()+1));else{P.setDate(P.getDate()+$);break}}return ct=new Date(P.getFullYear()+1,0,4),$=I(new Date(P.getFullYear(),0,4)),ct=I(ct),0>=B($,P)?0>=B(ct,P)?P.getFullYear()+1:P.getFullYear():P.getFullYear()-1}var F=G[l+40>>2];l={lc:G[l>>2],kc:G[l+4>>2],Ha:G[l+8>>2],Ra:G[l+12>>2],Ia:G[l+16>>2],ba:G[l+20>>2],P:G[l+24>>2],aa:G[l+28>>2],Jc:G[l+32>>2],jc:G[l+36>>2],mc:F&&F?ge(R,F):""},o=o?ge(R,o):"",F={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var Z in F)o=o.replace(new RegExp(Z,"g"),F[Z]);var et="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),at="January February March April May June July August September October November December".split(" ");F={"%a":P=>et[P.P].substring(0,3),"%A":P=>et[P.P],"%b":P=>at[P.Ia].substring(0,3),"%B":P=>at[P.Ia],"%C":P=>v((P.ba+1900)/100|0,2),"%d":P=>v(P.Ra,2),"%e":P=>h(P.Ra,2," "),"%g":P=>E(P).toString().substring(2),"%G":P=>E(P),"%H":P=>v(P.Ha,2),"%I":P=>(P=P.Ha,P==0?P=12:12<P&&(P-=12),v(P,2)),"%j":P=>{for(var $=0,ct=0;ct<=P.Ia-1;$+=(Bn(P.ba+1900)?Xr:Yr)[ct++]);return v(P.Ra+$,3)},"%m":P=>v(P.Ia+1,2),"%M":P=>v(P.kc,2),"%n":()=>`
`,"%p":P=>0<=P.Ha&&12>P.Ha?"AM":"PM","%S":P=>v(P.lc,2),"%t":()=>"	","%u":P=>P.P||7,"%U":P=>v(Math.floor((P.aa+7-P.P)/7),2),"%V":P=>{var $=Math.floor((P.aa+7-(P.P+6)%7)/7);if(2>=(P.P+371-P.aa-2)%7&&$++,$)$==53&&(ct=(P.P+371-P.aa)%7,ct==4||ct==3&&Bn(P.ba)||($=1));else{$=52;var ct=(P.P+7-P.aa-1)%7;(ct==4||ct==5&&Bn(P.ba%400-1))&&$++}return v($,2)},"%w":P=>P.P,"%W":P=>v(Math.floor((P.aa+7-(P.P+6)%7)/7),2),"%y":P=>(P.ba+1900).toString().substring(2),"%Y":P=>P.ba+1900,"%z":P=>{P=P.jc;var $=0<=P;return P=Math.abs(P)/60,($?"+":"-")+("0000"+(P/60*100+P%60)).slice(-4)},"%Z":P=>P.mc,"%%":()=>"%"},o=o.replace(/%%/g,"\0\0");for(Z in F)o.includes(Z)&&(o=o.replace(new RegExp(Z,"g"),F[Z](l)));return o=o.replace(/\0\0/g,"%"),Z=rr(o,!1),Z.length>s?0:(L.set(Z,i),Z.length-1)};function Qr(i,s,o,l){i||(i=this),this.parent=i,this.S=i.S,this.Ba=null,this.id=tc++,this.name=s,this.mode=o,this.l={},this.m={},this.Da=l}Object.defineProperties(Qr.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),Ar(),Vs=Array(4096),yr(wt,"/"),Ke("/tmp",16895,0),Ke("/home",16895,0),Ke("/home/web_user",16895,0),(()=>{Ke("/dev",16895,0),ao(259,{read:()=>0,write:(l,h,v,B)=>B}),nn("/dev/null",259),cr(1280,Qa),cr(1536,Ua),nn("/dev/tty",1280),nn("/dev/tty1",1536);var i=new Uint8Array(1024),s=0,o=()=>(s===0&&(s=ai(i).byteLength),i[--s]);Cs("random",o),Cs("urandom",o),Ke("/dev/shm",16895,0),Ke("/dev/shm/tmp",16895,0)})(),(()=>{Ke("/proc",16895,0);var i=Ke("/proc/self",16895,0);Ke("/proc/self/fd",16895,0),yr({S:()=>{var s=dr(i,"fd",16895,73);return s.l={ka:(o,l)=>{var h=Ti(+l);return o={parent:null,S:{ib:"fake"},l:{la:()=>h.path}},o.parent=o}},s}},"/proc/self/fd")})(),Object.assign(xr.prototype,{get(i){return this.L[i]},has(i){return this.L[i]!==void 0},ra(i){var s=this.cb.pop()||this.L.length;return this.L[s]=i,s},Sb(i){this.L[i]=void 0,this.cb.push(i)}}),us=e.BindingError=class extends Error{constructor(i){super(i),this.name="BindingError"}},He.L.push({value:void 0},{value:null},{value:!0},{value:!1}),He.h=He.L.length,e.count_emval_handles=function(){for(var i=0,s=He.h;s<He.L.length;++s)He.L[s]!==void 0&&++i;return i},Br=e.PureVirtualError=Sr("PureVirtualError");for(var Ur=Array(256),Vn=0;256>Vn;++Vn)Ur[Vn]=String.fromCharCode(Vn);Vr=Ur,e.getInheritedInstanceCount=function(){return Object.keys(vi).length},e.getLiveInheritedInstances=function(){var i=[],s;for(s in vi)vi.hasOwnProperty(s)&&i.push(vi[s]);return i},e.flushPendingDeletes=mo,e.setDelayFunction=function(i){Ts=i,Ps.length&&Ts&&Ts(mo)},Tr=e.InternalError=class extends Error{constructor(i){super(i),this.name="InternalError"}},Di.prototype.isAliasOf=function(i){if(!(this instanceof Di&&i instanceof Di))return!1;var s=this.g.u.i,o=this.g.o,l=i.g.u.i;for(i=i.g.o;s.A;)o=s.na(o),s=s.A;for(;l.A;)i=l.na(i),l=l.A;return s===l&&o===i},Di.prototype.clone=function(){if(this.g.o||uo(this),this.g.ia)return this.g.count.value+=1,this;var i=ds,s=Object,o=s.create,l=Object.getPrototypeOf(this),h=this.g;return i=i(o.call(s,l,{g:{value:{count:h.count,ga:h.ga,ia:h.ia,o:h.o,u:h.u,G:h.G,K:h.K}}})),i.g.count.value+=1,i.g.ga=!1,i},Di.prototype.delete=function(){this.g.o||uo(this),this.g.ga&&!this.g.ia&&At("Object already scheduled for deletion"),cn(this),Mr(this.g),this.g.ia||(this.g.G=void 0,this.g.o=void 0)},Di.prototype.isDeleted=function(){return!this.g.o},Di.prototype.deleteLater=function(){return this.g.o||uo(this),this.g.ga&&!this.g.ia&&At("Object already scheduled for deletion"),Ps.push(this),Ps.length===1&&Ts&&Ts(mo),this.g.ga=!0,this},Ai.prototype.Ob=function(i){return this.nb&&(i=this.nb(i)),i},Ai.prototype.Xa=function(i){this.U&&this.U(i)},Ai.prototype.argPackAdvance=8,Ai.prototype.readValueFromPointer=Ls,Ai.prototype.deleteObject=function(i){i!==null&&i.delete()},Ai.prototype.fromWireType=function(i){function s(){return this.wa?mn(this.i.M,{u:this.bc,o,K:this,G:i}):mn(this.i.M,{u:this,o:i})}var o=this.Ob(i);if(!o)return this.Xa(i),null;var l=nc(this.i,o);if(l!==void 0)return l.g.count.value===0?(l.g.o=o,l.g.G=i,l.clone()):(l=l.clone(),this.Xa(i),l);if(l=this.i.Nb(o),l=Pr[l],!l)return s.call(this);l=this.va?l.Fb:l.pointerType;var h=Ir(o,this.i,l.i);return h===null?s.call(this):this.wa?mn(l.i.M,{u:l,o:h,K:this,G:i}):mn(l.i.M,{u:l,o:h})},Gr=e.UnboundTypeError=Sr("UnboundTypeError");for(var T,Oe=0;32>Oe;++Oe)xn.push(Array(Oe));var Ic=new Float32Array(288);for(Oe=0;288>Oe;++Oe)Gi[Oe]=Ic.subarray(0,Oe+1);var Pc=new Int32Array(288);for(Oe=0;288>Oe;++Oe)Es[Oe]=Pc.subarray(0,Oe+1);var Kr={__syscall_fcntl64:function(i,s,o){Is=o;try{var l=Ti(i);switch(s){case 0:var h=fi();return 0>h?-28:fr(l,h).V;case 1:case 2:return 0;case 3:return l.flags;case 4:return h=fi(),l.flags|=h,0;case 5:return h=fi(),z[h+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return G[sa()>>2]=28,-1;default:return-28}}catch(v){if(typeof Wi>"u"||v.name!=="ErrnoError")throw v;return-v.Z}},__syscall_ioctl:function(i,s,o){Is=o;try{var l=Ti(i);switch(s){case 21509:return l.s?0:-59;case 21505:if(!l.s)return-59;if(l.s.T.Wb){s=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var h=fi();G[h>>2]=25856,G[h+4>>2]=5,G[h+8>>2]=191,G[h+12>>2]=35387;for(var v=0;32>v;v++)L[h+v+17>>0]=s[v]||0}return 0;case 21510:case 21511:case 21512:return l.s?0:-59;case 21506:case 21507:case 21508:if(!l.s)return-59;if(l.s.T.Xb)for(h=fi(),s=[],v=0;32>v;v++)s.push(L[h+v+17>>0]);return 0;case 21519:return l.s?(h=fi(),G[h>>2]=0):-59;case 21520:return l.s?-28:-59;case 21531:if(h=fi(),!l.m.Vb)throw new rt(59);return l.m.Vb(l,s,h);case 21523:return l.s?(l.s.T.Yb&&(v=[24,80],h=fi(),z[h>>1]=v[0],z[h+2>>1]=v[1]),0):-59;case 21524:return l.s?0:-59;case 21515:return l.s?0:-59;default:return-28}}catch(B){if(typeof Wi>"u"||B.name!=="ErrnoError")throw B;return-B.Z}},__syscall_openat:function(i,s,o,l){Is=l;try{s=s?ge(R,s):"";var h=s;if(h.charAt(0)==="/")s=h;else{var v=i===-100?"/":Ti(i).path;if(h.length==0)throw new rt(44);s=te(v+"/"+h)}var B=l?fi():0;return on(s,o,B).V}catch(I){if(typeof Wi>"u"||I.name!=="ErrnoError")throw I;return-I.Z}},_embind_create_inheriting_constructor:function(i,s,o){i=ne(i),s=Ds(s,"wrapper"),o=ti(o);var l=[].slice,h=s.i,v=h.M,B=h.A.M,I=h.A.constructor;i=an(i,function(){h.A.mb.forEach((function(F){if(this[F]===B[F])throw new Br(`Pure virtual function ${F} must be implemented in JavaScript`)}).bind(this)),Object.defineProperty(this,"__parent",{value:v}),this.__construct.apply(this,l.call(arguments))}),v.__construct=function(){this===v&&At("Pass correct 'this' to __construct");var F=I.implement.apply(void 0,[this].concat(l.call(arguments)));cn(F);var Z=F.g;F.notifyOnDestruction(),Z.ia=!0,Object.defineProperties(this,{g:{value:Z}}),ds(this),F=Z.o,F=ho(h,F),vi.hasOwnProperty(F)?At(`Tried to register registered instance: ${F}`):vi[F]=this},v.__destruct=function(){this===v&&At("Pass correct 'this' to __destruct"),cn(this);var F=this.g.o;F=ho(h,F),vi.hasOwnProperty(F)?delete vi[F]:At(`Tried to unregister unregistered instance: ${F}`)},i.prototype=Object.create(v);for(var E in o)i.prototype[E]=o[E];return yi(i)},_embind_finalize_value_object:function(i){var s=hn[i];delete hn[i];var o=s.Pa,l=s.U,h=s.$a,v=h.map(B=>B.Rb).concat(h.map(B=>B.fc));je([i],v,B=>{var I={};return h.forEach((E,F)=>{var Z=B[F],et=E.Pb,at=E.Qb,P=B[F+h.length],$=E.ec,ct=E.hc;I[E.Lb]={read:bt=>Z.fromWireType(et(at,bt)),write:(bt,Gt)=>{var gt=[];$(ct,bt,P.toWireType(gt,Gt)),Gs(gt)}}}),[{name:s.name,fromWireType:function(E){var F={},Z;for(Z in I)F[Z]=I[Z].read(E);return l(E),F},toWireType:function(E,F){for(var Z in I)if(!(Z in F))throw new TypeError(`Missing field: "${Z}"`);var et=o();for(Z in I)I[Z].write(et,F[Z]);return E!==null&&E.push(l,et),et},argPackAdvance:8,readValueFromPointer:Ls,J:l}]})},_embind_register_bigint:function(){},_embind_register_bool:function(i,s,o,l,h){var v=un(o);s=ne(s),mi(i,{name:s,fromWireType:function(B){return!!B},toWireType:function(B,I){return I?l:h},argPackAdvance:8,readValueFromPointer:function(B){if(o===1)var I=L;else if(o===2)I=z;else if(o===4)I=G;else throw new TypeError("Unknown boolean type size: "+s);return this.fromWireType(I[B>>v])},J:null})},_embind_register_class:function(i,s,o,l,h,v,B,I,E,F,Z,et,at){Z=ne(Z),v=xe(h,v),I&&(I=xe(B,I)),F&&(F=xe(E,F)),at=xe(et,at);var P=gr(Z);bo(P,function(){wi(`Cannot construct ${Z} due to unbound types`,[l])}),je([i,s,o],l?[l]:[],function($){if($=$[0],l)var ct=$.i,bt=ct.M;else bt=Di.prototype;$=an(P,function(){if(Object.getPrototypeOf(this)!==Gt)throw new us("Use 'new' to construct "+Z);if(gt.Y===void 0)throw new us(Z+" has no accessible constructor");var ee=gt.Y[arguments.length];if(ee===void 0)throw new us(`Tried to invoke ctor of ${Z} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(gt.Y).toString()}) parameters instead!`);return ee.apply(this,arguments)});var Gt=Object.create(bt,{constructor:{value:$}});$.prototype=Gt;var gt=new rc(Z,$,Gt,at,ct,v,I,F);gt.A&&(gt.A.oa===void 0&&(gt.A.oa=[]),gt.A.oa.push(gt)),ct=new Ai(Z,gt,!0,!1),bt=new Ai(Z+"*",gt,!1,!1);var Wt=new Ai(Z+" const*",gt,!1,!0);return Pr[i]={pointerType:bt,Fb:Wt},Dr(P,$),[ct,bt,Wt]})},_embind_register_class_class_function:function(i,s,o,l,h,v,B){var I=fn(o,l);s=ne(s),v=xe(h,v),je([],[i],function(E){function F(){wi(`Cannot call ${Z} due to unbound types`,I)}E=E[0];var Z=`${E.name}.${s}`;s.startsWith("@@")&&(s=Symbol[s.substring(2)]);var et=E.i.constructor;return et[s]===void 0?(F.ea=o-1,et[s]=F):(po(et,s,Z),et[s].B[o-1]=F),je([],I,function(at){if(at=bn(Z,[at[0],null].concat(at.slice(1)),null,v,B),et[s].B===void 0?(at.ea=o-1,et[s]=at):et[s].B[o-1]=at,E.i.oa)for(const P of E.i.oa)P.constructor.hasOwnProperty(s)||(P.constructor[s]=at);return[]}),[]})},_embind_register_class_class_property:function(i,s,o,l,h,v,B,I){s=ne(s),v=xe(h,v),je([],[i],function(E){E=E[0];var F=`${E.name}.${s}`,Z={get(){wi(`Cannot access ${F} due to unbound types`,[o])},enumerable:!0,configurable:!0};return Z.set=I?()=>{wi(`Cannot access ${F} due to unbound types`,[o])}:()=>{At(`${F} is a read-only property`)},Object.defineProperty(E.i.constructor,s,Z),je([],[o],function(et){et=et[0];var at={get(){return et.fromWireType(v(l))},enumerable:!0};return I&&(I=xe(B,I),at.set=P=>{var $=[];I(l,et.toWireType($,P)),Gs($)}),Object.defineProperty(E.i.constructor,s,at),[]}),[]})},_embind_register_class_constructor:function(i,s,o,l,h,v){var B=fn(s,o);h=xe(l,h),je([],[i],function(I){I=I[0];var E=`constructor ${I.name}`;if(I.i.Y===void 0&&(I.i.Y=[]),I.i.Y[s-1]!==void 0)throw new us(`Cannot register multiple constructors with identical number of parameters (${s-1}) for class '${I.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return I.i.Y[s-1]=()=>{wi(`Cannot construct ${I.name} due to unbound types`,B)},je([],B,function(F){return F.splice(1,0,null),I.i.Y[s-1]=bn(E,F,null,h,v),[]}),[]})},_embind_register_class_function:function(i,s,o,l,h,v,B,I){var E=fn(o,l);s=ne(s),v=xe(h,v),je([],[i],function(F){function Z(){wi(`Cannot call ${et} due to unbound types`,E)}F=F[0];var et=`${F.name}.${s}`;s.startsWith("@@")&&(s=Symbol[s.substring(2)]),I&&F.i.mb.push(s);var at=F.i.M,P=at[s];return P===void 0||P.B===void 0&&P.className!==F.name&&P.ea===o-2?(Z.ea=o-2,Z.className=F.name,at[s]=Z):(po(at,s,et),at[s].B[o-2]=Z),je([],E,function($){return $=bn(et,$,F,v,B),at[s].B===void 0?($.ea=o-2,at[s]=$):at[s].B[o-2]=$,[]}),[]})},_embind_register_class_property:function(i,s,o,l,h,v,B,I,E,F){s=ne(s),h=xe(l,h),je([],[i],function(Z){Z=Z[0];var et=`${Z.name}.${s}`,at={get(){wi(`Cannot access ${et} due to unbound types`,[o,B])},enumerable:!0,configurable:!0};return at.set=E?()=>{wi(`Cannot access ${et} due to unbound types`,[o,B])}:()=>{At(et+" is a read-only property")},Object.defineProperty(Z.i.M,s,at),je([],E?[o,B]:[o],function(P){var $=P[0],ct={get(){var Gt=Lr(this,Z,et+" getter");return $.fromWireType(h(v,Gt))},enumerable:!0};if(E){E=xe(I,E);var bt=P[1];ct.set=function(Gt){var gt=Lr(this,Z,et+" setter"),Wt=[];E(F,gt,bt.toWireType(Wt,Gt)),Gs(Wt)}}return Object.defineProperty(Z.i.M,s,ct),[]}),[]})},_embind_register_emval:function(i,s){s=ne(s),mi(i,{name:s,fromWireType:function(o){var l=ti(o);return fo(o),l},toWireType:function(o,l){return yi(l)},argPackAdvance:8,readValueFromPointer:Ls,J:null})},_embind_register_enum:function(i,s,o,l){function h(){}o=un(o),s=ne(s),h.values={},mi(i,{name:s,constructor:h,fromWireType:function(v){return this.constructor.values[v]},toWireType:function(v,B){return B.value},argPackAdvance:8,readValueFromPointer:hc(s,o,l),J:null}),bo(s,h)},_embind_register_enum_value:function(i,s,o){var l=Ds(i,"enum");s=ne(s),i=l.constructor,l=Object.create(l.constructor.prototype,{value:{value:o},constructor:{value:an(`${l.name}_${s}`,function(){})}}),i.values[o]=l,i[s]=l},_embind_register_float:function(i,s,o){o=un(o),s=ne(s),mi(i,{name:s,fromWireType:function(l){return l},toWireType:function(l,h){return h},argPackAdvance:8,readValueFromPointer:_c(s,o),J:null})},_embind_register_function:function(i,s,o,l,h,v){var B=fn(s,o);i=ne(i),h=xe(l,h),bo(i,function(){wi(`Cannot call ${i} due to unbound types`,B)},s-1),je([],B,function(I){return Dr(i,bn(i,[I[0],null].concat(I.slice(1)),null,h,v),s-1),[]})},_embind_register_integer:function(i,s,o,l,h){s=ne(s),h===-1&&(h=4294967295),h=un(o);var v=I=>I;if(l===0){var B=32-8*o;v=I=>I<<B>>>B}o=s.includes("unsigned")?function(I,E){return E>>>0}:function(I,E){return E},mi(i,{name:s,fromWireType:v,toWireType:o,argPackAdvance:8,readValueFromPointer:uc(s,h,l!==0),J:null})},_embind_register_memory_view:function(i,s,o){function l(v){v>>=2;var B=H;return new h(B.buffer,B[v+1],B[v])}var h=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][s];o=ne(o),mi(i,{name:o,fromWireType:l,argPackAdvance:8,readValueFromPointer:l},{Tb:!0})},_embind_register_std_string:function(i,s){s=ne(s);var o=s==="std::string";mi(i,{name:s,fromWireType:function(l){var h=H[l>>2],v=l+4;if(o)for(var B=v,I=0;I<=h;++I){var E=v+I;if(I==h||R[E]==0){if(B=B?ge(R,B,E-B):"",F===void 0)var F=B;else F+="\0",F+=B;B=E+1}}else{for(F=Array(h),I=0;I<h;++I)F[I]=String.fromCharCode(R[v+I]);F=F.join("")}return gi(l),F},toWireType:function(l,h){h instanceof ArrayBuffer&&(h=new Uint8Array(h));var v=typeof h=="string";v||h instanceof Uint8Array||h instanceof Uint8ClampedArray||h instanceof Int8Array||At("Cannot pass non-string to std::string");var B=o&&v?ci(h):h.length,I=Cn(4+B+1),E=I+4;if(H[I>>2]=B,o&&v)li(h,R,E,B+1);else if(v)for(v=0;v<B;++v){var F=h.charCodeAt(v);255<F&&(gi(E),At("String has UTF-16 code units that do not fit in 8 bits")),R[E+v]=F}else for(v=0;v<B;++v)R[E+v]=h[v];return l!==null&&l.push(gi,I),I},argPackAdvance:8,readValueFromPointer:Ls,J:function(l){gi(l)}})},_embind_register_std_wstring:function(i,s,o){if(o=ne(o),s===2)var l=dc,h=pc,v=bc,B=()=>N,I=1;else s===4&&(l=fc,h=yc,v=vc,B=()=>H,I=2);mi(i,{name:o,fromWireType:function(E){for(var F=H[E>>2],Z=B(),et,at=E+4,P=0;P<=F;++P){var $=E+4+P*s;(P==F||Z[$>>I]==0)&&(at=l(at,$-at),et===void 0?et=at:(et+="\0",et+=at),at=$+s)}return gi(E),et},toWireType:function(E,F){typeof F!="string"&&At(`Cannot pass non-string to C++ string type ${o}`);var Z=v(F),et=Cn(4+Z+s);return H[et>>2]=Z>>I,h(F,et+4,Z+s),E!==null&&E.push(gi,et),et},argPackAdvance:8,readValueFromPointer:Ls,J:function(E){gi(E)}})},_embind_register_value_object:function(i,s,o,l,h,v){hn[i]={name:ne(s),Pa:xe(o,l),U:xe(h,v),$a:[]}},_embind_register_value_object_field:function(i,s,o,l,h,v,B,I,E,F){hn[i].$a.push({Lb:ne(s),Rb:o,Pb:xe(l,h),Qb:v,fc:B,ec:xe(I,E),hc:F})},_embind_register_void:function(i,s){s=ne(s),mi(i,{Zb:!0,name:s,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},_emscripten_get_now_is_monotonic:()=>!0,_emscripten_throw_longjmp:()=>{throw 1/0},_emval_as:function(i,s,o){i=ti(i),s=Ds(s,"emval::as");var l=[],h=yi(l);return H[o>>2]=h,s.toWireType(l,i)},_emval_call_method:function(i,s,o,l,h){i=yn[i],s=ti(s),o=vo(o);var v=[];return H[l>>2]=yi(v),i(s,o,v,h)},_emval_call_void_method:function(i,s,o,l){i=yn[i],s=ti(s),o=vo(o),i(s,o,null,l)},_emval_decref:fo,_emval_get_method_caller:function(i,s){var o=gc(i,s),l=o[0];s=l.name+"_$"+o.slice(1).map(function(B){return B.name}).join("_")+"$";var h=Rr[s];if(h!==void 0)return h;var v=Array(i-1);return h=wc((B,I,E,F)=>{for(var Z=0,et=0;et<i-1;++et)v[et]=o[et+1].readValueFromPointer(F+Z),Z+=o[et+1].argPackAdvance;for(B=B[I].apply(B,v),et=0;et<i-1;++et)o[et+1].Hb&&o[et+1].Hb(v[et]);if(!l.Zb)return l.toWireType(E,B)}),Rr[s]=h},_emval_get_property:function(i,s){return i=ti(i),s=ti(s),yi(i[s])},_emval_incref:function(i){4<i&&(He.get(i).pb+=1)},_emval_new_cstring:function(i){return yi(vo(i))},_emval_new_object:function(){return yi({})},_emval_run_destructors:function(i){var s=ti(i);Gs(s),fo(i)},_emval_set_property:function(i,s,o){i=ti(i),s=ti(s),o=ti(o),i[s]=o},_emval_take_value:function(i,s){return i=Ds(i,"_emval_take_value"),i=i.readValueFromPointer(s),yi(i)},abort:()=>{ft("")},emscripten_asm_const_int:(i,s,o)=>{Ao.length=0;var l;for(o>>=2;l=R[s++];)o+=l!=105&o,Ao.push(l==105?G[o]:j[o++>>1]),++o;return pe[i].apply(null,Ao)},emscripten_date_now:function(){return Date.now()},emscripten_get_now:()=>performance.now(),emscripten_glActiveTexture:function(i){T.activeTexture(i)},emscripten_glAttachShader:function(i,s){T.attachShader(ei[i],ii[s])},emscripten_glBindAttribLocation:function(i,s,o){T.bindAttribLocation(ei[i],s,o?ge(R,o):"")},emscripten_glBindBuffer:function(i,s){i==35051?T.Ka=s:i==35052&&(T.fa=s),T.bindBuffer(i,vn[s])},emscripten_glBindFramebuffer:Jr,emscripten_glBindRenderbuffer:function(i,s){T.bindRenderbuffer(i,Fs[s])},emscripten_glBindSampler:function(i,s){T.bindSampler(i,fs[s])},emscripten_glBindTexture:function(i,s){T.bindTexture(i,bs[s])},emscripten_glBindVertexArray:qr,emscripten_glBindVertexArrayOES:qr,emscripten_glBlendColor:function(i,s,o,l){T.blendColor(i,s,o,l)},emscripten_glBlendEquation:function(i){T.blendEquation(i)},emscripten_glBlendFunc:function(i,s){T.blendFunc(i,s)},emscripten_glBlitFramebuffer:function(i,s,o,l,h,v,B,I,E,F){T.blitFramebuffer(i,s,o,l,h,v,B,I,E,F)},emscripten_glBufferData:function(i,s,o,l){2<=zt.version?o&&s?T.bufferData(i,R,l,o,s):T.bufferData(i,s,l):T.bufferData(i,o?R.subarray(o,o+s):s,l)},emscripten_glBufferSubData:function(i,s,o,l){2<=zt.version?o&&T.bufferSubData(i,s,R,l,o):T.bufferSubData(i,s,R.subarray(l,l+o))},emscripten_glCheckFramebufferStatus:function(i){return T.checkFramebufferStatus(i)},emscripten_glClear:function(i){T.clear(i)},emscripten_glClearColor:function(i,s,o,l){T.clearColor(i,s,o,l)},emscripten_glClearStencil:function(i){T.clearStencil(i)},emscripten_glClientWaitSync:function(i,s,o,l){return T.clientWaitSync(Zi[i],s,(o>>>0)+4294967296*l)},emscripten_glColorMask:function(i,s,o,l){T.colorMask(!!i,!!s,!!o,!!l)},emscripten_glCompileShader:function(i){T.compileShader(ii[i])},emscripten_glCompressedTexImage2D:function(i,s,o,l,h,v,B,I){2<=zt.version?T.fa||!B?T.compressedTexImage2D(i,s,o,l,h,v,B,I):T.compressedTexImage2D(i,s,o,l,h,v,R,I,B):T.compressedTexImage2D(i,s,o,l,h,v,I?R.subarray(I,I+B):null)},emscripten_glCompressedTexSubImage2D:function(i,s,o,l,h,v,B,I,E){2<=zt.version?T.fa||!I?T.compressedTexSubImage2D(i,s,o,l,h,v,B,I,E):T.compressedTexSubImage2D(i,s,o,l,h,v,B,R,E,I):T.compressedTexSubImage2D(i,s,o,l,h,v,B,E?R.subarray(E,E+I):null)},emscripten_glCopyTexSubImage2D:function(i,s,o,l,h,v,B,I){T.copyTexSubImage2D(i,s,o,l,h,v,B,I)},emscripten_glCreateProgram:function(){var i=Rs(ei),s=T.createProgram();return s.name=i,s.za=s.xa=s.ya=0,s.Sa=1,ei[i]=s,i},emscripten_glCreateShader:function(i){var s=Rs(ii);return ii[s]=T.createShader(i),s},emscripten_glCullFace:function(i){T.cullFace(i)},emscripten_glDeleteBuffers:function(i,s){for(var o=0;o<i;o++){var l=G[s+4*o>>2],h=vn[l];h&&(T.deleteBuffer(h),h.name=0,vn[l]=null,l==T.Ka&&(T.Ka=0),l==T.fa&&(T.fa=0))}},emscripten_glDeleteFramebuffers:function(i,s){for(var o=0;o<i;++o){var l=G[s+4*o>>2],h=An[l];h&&(T.deleteFramebuffer(h),h.name=0,An[l]=null)}},emscripten_glDeleteProgram:function(i){if(i){var s=ei[i];s?(T.deleteProgram(s),s.name=0,ei[i]=null):Kt(1281)}},emscripten_glDeleteRenderbuffers:function(i,s){for(var o=0;o<i;o++){var l=G[s+4*o>>2],h=Fs[l];h&&(T.deleteRenderbuffer(h),h.name=0,Fs[l]=null)}},emscripten_glDeleteSamplers:function(i,s){for(var o=0;o<i;o++){var l=G[s+4*o>>2],h=fs[l];h&&(T.deleteSampler(h),h.name=0,fs[l]=null)}},emscripten_glDeleteShader:function(i){if(i){var s=ii[i];s?(T.deleteShader(s),ii[i]=null):Kt(1281)}},emscripten_glDeleteSync:function(i){if(i){var s=Zi[i];s?(T.deleteSync(s),s.name=0,Zi[i]=null):Kt(1281)}},emscripten_glDeleteTextures:function(i,s){for(var o=0;o<i;o++){var l=G[s+4*o>>2],h=bs[l];h&&(T.deleteTexture(h),h.name=0,bs[l]=null)}},emscripten_glDeleteVertexArrays:zr,emscripten_glDeleteVertexArraysOES:zr,emscripten_glDepthMask:function(i){T.depthMask(!!i)},emscripten_glDisable:function(i){T.disable(i)},emscripten_glDisableVertexAttribArray:function(i){T.disableVertexAttribArray(i)},emscripten_glDrawArrays:function(i,s,o){T.drawArrays(i,s,o)},emscripten_glDrawArraysInstanced:function(i,s,o,l){T.drawArraysInstanced(i,s,o,l)},emscripten_glDrawArraysInstancedBaseInstanceWEBGL:function(i,s,o,l,h){T.Ya.drawArraysInstancedBaseInstanceWEBGL(i,s,o,l,h)},emscripten_glDrawBuffers:function(i,s){for(var o=xn[i],l=0;l<i;l++)o[l]=G[s+4*l>>2];T.drawBuffers(o)},emscripten_glDrawElements:$r,emscripten_glDrawElementsInstanced:function(i,s,o,l,h){T.drawElementsInstanced(i,s,o,l,h)},emscripten_glDrawElementsInstancedBaseVertexBaseInstanceWEBGL:function(i,s,o,l,h,v,B){T.Ya.drawElementsInstancedBaseVertexBaseInstanceWEBGL(i,s,o,l,h,v,B)},emscripten_glDrawRangeElements:function(i,s,o,l,h,v){$r(i,l,h,v)},emscripten_glEnable:function(i){T.enable(i)},emscripten_glEnableVertexAttribArray:function(i){T.enableVertexAttribArray(i)},emscripten_glFenceSync:function(i,s){return(i=T.fenceSync(i,s))?(s=Rs(Zi),i.name=s,Zi[s]=i,s):0},emscripten_glFinish:function(){T.finish()},emscripten_glFlush:function(){T.flush()},emscripten_glFramebufferRenderbuffer:function(i,s,o,l){T.framebufferRenderbuffer(i,s,o,Fs[l])},emscripten_glFramebufferTexture2D:function(i,s,o,l,h){T.framebufferTexture2D(i,s,o,bs[l],h)},emscripten_glFrontFace:function(i){T.frontFace(i)},emscripten_glGenBuffers:function(i,s){ys(i,s,"createBuffer",vn)},emscripten_glGenFramebuffers:function(i,s){ys(i,s,"createFramebuffer",An)},emscripten_glGenRenderbuffers:function(i,s){ys(i,s,"createRenderbuffer",Fs)},emscripten_glGenSamplers:function(i,s){ys(i,s,"createSampler",fs)},emscripten_glGenTextures:function(i,s){ys(i,s,"createTexture",bs)},emscripten_glGenVertexArrays:Nr,emscripten_glGenVertexArraysOES:Nr,emscripten_glGenerateMipmap:function(i){T.generateMipmap(i)},emscripten_glGetBufferParameteriv:function(i,s,o){o?G[o>>2]=T.getBufferParameter(i,s):Kt(1281)},emscripten_glGetError:function(){var i=T.getError()||gn;return gn=0,i},emscripten_glGetFramebufferAttachmentParameteriv:function(i,s,o,l){i=T.getFramebufferAttachmentParameter(i,s,o),(i instanceof WebGLRenderbuffer||i instanceof WebGLTexture)&&(i=i.name|0),G[l>>2]=i},emscripten_glGetIntegerv:Wr,emscripten_glGetProgramInfoLog:function(i,s,o,l){i=T.getProgramInfoLog(ei[i]),i===null&&(i="(unknown error)"),s=0<s&&l?li(i,R,l,s):0,o&&(G[o>>2]=s)},emscripten_glGetProgramiv:function(i,s,o){if(o)if(i>=kr)Kt(1281);else if(i=ei[i],s==35716)i=T.getProgramInfoLog(i),i===null&&(i="(unknown error)"),G[o>>2]=i.length+1;else if(s==35719){if(!i.za)for(s=0;s<T.getProgramParameter(i,35718);++s)i.za=Math.max(i.za,T.getActiveUniform(i,s).name.length+1);G[o>>2]=i.za}else if(s==35722){if(!i.xa)for(s=0;s<T.getProgramParameter(i,35721);++s)i.xa=Math.max(i.xa,T.getActiveAttrib(i,s).name.length+1);G[o>>2]=i.xa}else if(s==35381){if(!i.ya)for(s=0;s<T.getProgramParameter(i,35382);++s)i.ya=Math.max(i.ya,T.getActiveUniformBlockName(i,s).length+1);G[o>>2]=i.ya}else G[o>>2]=T.getProgramParameter(i,s);else Kt(1281)},emscripten_glGetRenderbufferParameteriv:function(i,s,o){o?G[o>>2]=T.getRenderbufferParameter(i,s):Kt(1281)},emscripten_glGetShaderInfoLog:function(i,s,o,l){i=T.getShaderInfoLog(ii[i]),i===null&&(i="(unknown error)"),s=0<s&&l?li(i,R,l,s):0,o&&(G[o>>2]=s)},emscripten_glGetShaderPrecisionFormat:function(i,s,o,l){i=T.getShaderPrecisionFormat(i,s),G[o>>2]=i.rangeMin,G[o+4>>2]=i.rangeMax,G[l>>2]=i.precision},emscripten_glGetShaderiv:function(i,s,o){o?s==35716?(i=T.getShaderInfoLog(ii[i]),i===null&&(i="(unknown error)"),G[o>>2]=i?i.length+1:0):s==35720?(i=T.getShaderSource(ii[i]),G[o>>2]=i?i.length+1:0):G[o>>2]=T.getShaderParameter(ii[i],s):Kt(1281)},emscripten_glGetString:function(i){var s=Er[i];if(!s){switch(i){case 7939:s=T.getSupportedExtensions()||[],s=s.concat(s.map(function(l){return"GL_"+l})),s=ks(s.join(" "));break;case 7936:case 7937:case 37445:case 37446:(s=T.getParameter(i))||Kt(1280),s=s&&ks(s);break;case 7938:s=T.getParameter(7938),s=2<=zt.version?"OpenGL ES 3.0 ("+s+")":"OpenGL ES 2.0 ("+s+")",s=ks(s);break;case 35724:s=T.getParameter(35724);var o=s.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);o!==null&&(o[1].length==3&&(o[1]+="0"),s="OpenGL ES GLSL ES "+o[1]+" ("+s+")"),s=ks(s);break;default:Kt(1280)}Er[i]=s}return s},emscripten_glGetStringi:function(i,s){if(2>zt.version)return Kt(1282),0;var o=jr[i];if(o)return 0>s||s>=o.length?(Kt(1281),0):o[s];switch(i){case 7939:return o=T.getSupportedExtensions()||[],o=o.concat(o.map(function(l){return"GL_"+l})),o=o.map(function(l){return ks(l)}),o=jr[i]=o,0>s||s>=o.length?(Kt(1281),0):o[s];default:return Kt(1280),0}},emscripten_glGetUniformLocation:function(i,s){if(s=s?ge(R,s):"",i=ei[i]){var o=i,l=o.ma,h=o.ub,v;if(!l)for(o.ma=l={},o.tb={},v=0;v<T.getProgramParameter(o,35718);++v){var B=T.getActiveUniform(o,v),I=B.name;B=B.size;var E=Hr(I);E=0<E?I.slice(0,E):I;var F=o.Sa;for(o.Sa+=B,h[E]=[B,F],I=0;I<B;++I)l[F]=I,o.tb[F++]=E}if(o=i.ma,l=0,h=s,v=Hr(s),0<v&&(l=parseInt(s.slice(v+1))>>>0,h=s.slice(0,v)),(h=i.ub[h])&&l<h[0]&&(l+=h[1],o[l]=o[l]||T.getUniformLocation(i,s)))return l}else Kt(1281);return-1},emscripten_glInvalidateFramebuffer:function(i,s,o){for(var l=xn[s],h=0;h<s;h++)l[h]=G[o+4*h>>2];T.invalidateFramebuffer(i,l)},emscripten_glInvalidateSubFramebuffer:function(i,s,o,l,h,v,B){for(var I=xn[s],E=0;E<s;E++)I[E]=G[o+4*E>>2];T.invalidateSubFramebuffer(i,I,l,h,v,B)},emscripten_glIsSync:function(i){return T.isSync(Zi[i])},emscripten_glIsTexture:function(i){return(i=bs[i])?T.isTexture(i):0},emscripten_glLineWidth:function(i){T.lineWidth(i)},emscripten_glLinkProgram:function(i){i=ei[i],T.linkProgram(i),i.ma=0,i.ub={}},emscripten_glMultiDrawArraysInstancedBaseInstanceWEBGL:function(i,s,o,l,h,v){T.gb.multiDrawArraysInstancedBaseInstanceWEBGL(i,G,s>>2,G,o>>2,G,l>>2,H,h>>2,v)},emscripten_glMultiDrawElementsInstancedBaseVertexBaseInstanceWEBGL:function(i,s,o,l,h,v,B,I){T.gb.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL(i,G,s>>2,o,G,l>>2,G,h>>2,G,v>>2,H,B>>2,I)},emscripten_glPixelStorei:function(i,s){i==3317&&(Or=s),T.pixelStorei(i,s)},emscripten_glReadBuffer:function(i){T.readBuffer(i)},emscripten_glReadPixels:function(i,s,o,l,h,v,B){if(2<=zt.version)if(T.Ka)T.readPixels(i,s,o,l,h,v,B);else{var I=Sn(v);T.readPixels(i,s,o,l,h,v,I,B>>31-Math.clz32(I.BYTES_PER_ELEMENT))}else(B=xo(v,h,o,l,B))?T.readPixels(i,s,o,l,h,v,B):Kt(1280)},emscripten_glRenderbufferStorage:function(i,s,o,l){T.renderbufferStorage(i,s,o,l)},emscripten_glRenderbufferStorageMultisample:function(i,s,o,l,h){T.renderbufferStorageMultisample(i,s,o,l,h)},emscripten_glSamplerParameteri:function(i,s,o){T.samplerParameteri(fs[i],s,o)},emscripten_glSamplerParameteriv:function(i,s,o){T.samplerParameteri(fs[i],s,G[o>>2])},emscripten_glScissor:function(i,s,o,l){T.scissor(i,s,o,l)},emscripten_glShaderSource:function(i,s,o,l){for(var h="",v=0;v<s;++v){var B=l?G[l+4*v>>2]:-1,I=G[o+4*v>>2];B=I?ge(R,I,0>B?void 0:B):"",h+=B}T.shaderSource(ii[i],h)},emscripten_glStencilFunc:function(i,s,o){T.stencilFunc(i,s,o)},emscripten_glStencilFuncSeparate:function(i,s,o,l){T.stencilFuncSeparate(i,s,o,l)},emscripten_glStencilMask:function(i){T.stencilMask(i)},emscripten_glStencilMaskSeparate:function(i,s){T.stencilMaskSeparate(i,s)},emscripten_glStencilOp:function(i,s,o){T.stencilOp(i,s,o)},emscripten_glStencilOpSeparate:function(i,s,o,l){T.stencilOpSeparate(i,s,o,l)},emscripten_glTexImage2D:function(i,s,o,l,h,v,B,I,E){if(2<=zt.version)if(T.fa)T.texImage2D(i,s,o,l,h,v,B,I,E);else if(E){var F=Sn(I);T.texImage2D(i,s,o,l,h,v,B,I,F,E>>31-Math.clz32(F.BYTES_PER_ELEMENT))}else T.texImage2D(i,s,o,l,h,v,B,I,null);else T.texImage2D(i,s,o,l,h,v,B,I,E?xo(I,B,l,h,E):null)},emscripten_glTexParameterf:function(i,s,o){T.texParameterf(i,s,o)},emscripten_glTexParameterfv:function(i,s,o){T.texParameterf(i,s,k[o>>2])},emscripten_glTexParameteri:function(i,s,o){T.texParameteri(i,s,o)},emscripten_glTexParameteriv:function(i,s,o){T.texParameteri(i,s,G[o>>2])},emscripten_glTexStorage2D:function(i,s,o,l,h){T.texStorage2D(i,s,o,l,h)},emscripten_glTexSubImage2D:function(i,s,o,l,h,v,B,I,E){if(2<=zt.version)if(T.fa)T.texSubImage2D(i,s,o,l,h,v,B,I,E);else if(E){var F=Sn(I);T.texSubImage2D(i,s,o,l,h,v,B,I,F,E>>31-Math.clz32(F.BYTES_PER_ELEMENT))}else T.texSubImage2D(i,s,o,l,h,v,B,I,null);else F=null,E&&(F=xo(I,B,h,v,E)),T.texSubImage2D(i,s,o,l,h,v,B,I,F)},emscripten_glUniform1f:function(i,s){T.uniform1f(Jt(i),s)},emscripten_glUniform1fv:function(i,s,o){if(2<=zt.version)s&&T.uniform1fv(Jt(i),k,o>>2,s);else{if(288>=s)for(var l=Gi[s-1],h=0;h<s;++h)l[h]=k[o+4*h>>2];else l=k.subarray(o>>2,o+4*s>>2);T.uniform1fv(Jt(i),l)}},emscripten_glUniform1i:function(i,s){T.uniform1i(Jt(i),s)},emscripten_glUniform1iv:function(i,s,o){if(2<=zt.version)s&&T.uniform1iv(Jt(i),G,o>>2,s);else{if(288>=s)for(var l=Es[s-1],h=0;h<s;++h)l[h]=G[o+4*h>>2];else l=G.subarray(o>>2,o+4*s>>2);T.uniform1iv(Jt(i),l)}},emscripten_glUniform2f:function(i,s,o){T.uniform2f(Jt(i),s,o)},emscripten_glUniform2fv:function(i,s,o){if(2<=zt.version)s&&T.uniform2fv(Jt(i),k,o>>2,2*s);else{if(144>=s)for(var l=Gi[2*s-1],h=0;h<2*s;h+=2)l[h]=k[o+4*h>>2],l[h+1]=k[o+(4*h+4)>>2];else l=k.subarray(o>>2,o+8*s>>2);T.uniform2fv(Jt(i),l)}},emscripten_glUniform2i:function(i,s,o){T.uniform2i(Jt(i),s,o)},emscripten_glUniform2iv:function(i,s,o){if(2<=zt.version)s&&T.uniform2iv(Jt(i),G,o>>2,2*s);else{if(144>=s)for(var l=Es[2*s-1],h=0;h<2*s;h+=2)l[h]=G[o+4*h>>2],l[h+1]=G[o+(4*h+4)>>2];else l=G.subarray(o>>2,o+8*s>>2);T.uniform2iv(Jt(i),l)}},emscripten_glUniform3f:function(i,s,o,l){T.uniform3f(Jt(i),s,o,l)},emscripten_glUniform3fv:function(i,s,o){if(2<=zt.version)s&&T.uniform3fv(Jt(i),k,o>>2,3*s);else{if(96>=s)for(var l=Gi[3*s-1],h=0;h<3*s;h+=3)l[h]=k[o+4*h>>2],l[h+1]=k[o+(4*h+4)>>2],l[h+2]=k[o+(4*h+8)>>2];else l=k.subarray(o>>2,o+12*s>>2);T.uniform3fv(Jt(i),l)}},emscripten_glUniform3i:function(i,s,o,l){T.uniform3i(Jt(i),s,o,l)},emscripten_glUniform3iv:function(i,s,o){if(2<=zt.version)s&&T.uniform3iv(Jt(i),G,o>>2,3*s);else{if(96>=s)for(var l=Es[3*s-1],h=0;h<3*s;h+=3)l[h]=G[o+4*h>>2],l[h+1]=G[o+(4*h+4)>>2],l[h+2]=G[o+(4*h+8)>>2];else l=G.subarray(o>>2,o+12*s>>2);T.uniform3iv(Jt(i),l)}},emscripten_glUniform4f:function(i,s,o,l,h){T.uniform4f(Jt(i),s,o,l,h)},emscripten_glUniform4fv:function(i,s,o){if(2<=zt.version)s&&T.uniform4fv(Jt(i),k,o>>2,4*s);else{if(72>=s){var l=Gi[4*s-1],h=k;o>>=2;for(var v=0;v<4*s;v+=4){var B=o+v;l[v]=h[B],l[v+1]=h[B+1],l[v+2]=h[B+2],l[v+3]=h[B+3]}}else l=k.subarray(o>>2,o+16*s>>2);T.uniform4fv(Jt(i),l)}},emscripten_glUniform4i:function(i,s,o,l,h){T.uniform4i(Jt(i),s,o,l,h)},emscripten_glUniform4iv:function(i,s,o){if(2<=zt.version)s&&T.uniform4iv(Jt(i),G,o>>2,4*s);else{if(72>=s)for(var l=Es[4*s-1],h=0;h<4*s;h+=4)l[h]=G[o+4*h>>2],l[h+1]=G[o+(4*h+4)>>2],l[h+2]=G[o+(4*h+8)>>2],l[h+3]=G[o+(4*h+12)>>2];else l=G.subarray(o>>2,o+16*s>>2);T.uniform4iv(Jt(i),l)}},emscripten_glUniformMatrix2fv:function(i,s,o,l){if(2<=zt.version)s&&T.uniformMatrix2fv(Jt(i),!!o,k,l>>2,4*s);else{if(72>=s)for(var h=Gi[4*s-1],v=0;v<4*s;v+=4)h[v]=k[l+4*v>>2],h[v+1]=k[l+(4*v+4)>>2],h[v+2]=k[l+(4*v+8)>>2],h[v+3]=k[l+(4*v+12)>>2];else h=k.subarray(l>>2,l+16*s>>2);T.uniformMatrix2fv(Jt(i),!!o,h)}},emscripten_glUniformMatrix3fv:function(i,s,o,l){if(2<=zt.version)s&&T.uniformMatrix3fv(Jt(i),!!o,k,l>>2,9*s);else{if(32>=s)for(var h=Gi[9*s-1],v=0;v<9*s;v+=9)h[v]=k[l+4*v>>2],h[v+1]=k[l+(4*v+4)>>2],h[v+2]=k[l+(4*v+8)>>2],h[v+3]=k[l+(4*v+12)>>2],h[v+4]=k[l+(4*v+16)>>2],h[v+5]=k[l+(4*v+20)>>2],h[v+6]=k[l+(4*v+24)>>2],h[v+7]=k[l+(4*v+28)>>2],h[v+8]=k[l+(4*v+32)>>2];else h=k.subarray(l>>2,l+36*s>>2);T.uniformMatrix3fv(Jt(i),!!o,h)}},emscripten_glUniformMatrix4fv:function(i,s,o,l){if(2<=zt.version)s&&T.uniformMatrix4fv(Jt(i),!!o,k,l>>2,16*s);else{if(18>=s){var h=Gi[16*s-1],v=k;l>>=2;for(var B=0;B<16*s;B+=16){var I=l+B;h[B]=v[I],h[B+1]=v[I+1],h[B+2]=v[I+2],h[B+3]=v[I+3],h[B+4]=v[I+4],h[B+5]=v[I+5],h[B+6]=v[I+6],h[B+7]=v[I+7],h[B+8]=v[I+8],h[B+9]=v[I+9],h[B+10]=v[I+10],h[B+11]=v[I+11],h[B+12]=v[I+12],h[B+13]=v[I+13],h[B+14]=v[I+14],h[B+15]=v[I+15]}}else h=k.subarray(l>>2,l+64*s>>2);T.uniformMatrix4fv(Jt(i),!!o,h)}},emscripten_glUseProgram:function(i){i=ei[i],T.useProgram(i),T.Gb=i},emscripten_glVertexAttrib1f:function(i,s){T.vertexAttrib1f(i,s)},emscripten_glVertexAttrib2fv:function(i,s){T.vertexAttrib2f(i,k[s>>2],k[s+4>>2])},emscripten_glVertexAttrib3fv:function(i,s){T.vertexAttrib3f(i,k[s>>2],k[s+4>>2],k[s+8>>2])},emscripten_glVertexAttrib4fv:function(i,s){T.vertexAttrib4f(i,k[s>>2],k[s+4>>2],k[s+8>>2],k[s+12>>2])},emscripten_glVertexAttribDivisor:function(i,s){T.vertexAttribDivisor(i,s)},emscripten_glVertexAttribIPointer:function(i,s,o,l,h){T.vertexAttribIPointer(i,s,o,l,h)},emscripten_glVertexAttribPointer:function(i,s,o,l,h,v){T.vertexAttribPointer(i,s,o,!!l,h,v)},emscripten_glViewport:function(i,s,o,l){T.viewport(i,s,o,l)},emscripten_glWaitSync:function(i,s,o,l){T.waitSync(Zi[i],s,(o>>>0)+4294967296*l)},emscripten_memcpy_big:(i,s,o)=>R.copyWithin(i,s,s+o),emscripten_resize_heap:i=>{var s=R.length;if(i>>>=0,2147483648<i)return!1;for(var o=1;4>=o;o*=2){var l=s*(1+.2/o);l=Math.min(l,i+100663296);var h=Math;l=Math.max(i,l);t:{h=h.min.call(h,2147483648,l+(65536-l%65536)%65536)-g.buffer.byteLength+65535>>>16;try{g.grow(h),O();var v=1;break t}catch{}v=void 0}if(v)return!0}return!1},emscripten_webgl_get_current_context:function(){return zt?zt.handle:0},emscripten_webgl_make_context_current:function(i){return go(i)?0:-5},environ_get:(i,s)=>{var o=0;return Zr().forEach(function(l,h){var v=s+o;for(h=H[i+4*h>>2]=v,v=0;v<l.length;++v)L[h++>>0]=l.charCodeAt(v);L[h>>0]=0,o+=l.length+1}),0},environ_sizes_get:(i,s)=>{var o=Zr();H[i>>2]=o.length;var l=0;return o.forEach(function(h){l+=h.length+1}),H[s>>2]=l,0},fd_close:function(i){try{var s=Ti(i);if(s.V===null)throw new rt(8);s.Ma&&(s.Ma=null);try{s.m.close&&s.m.close(s)}catch(o){throw o}finally{tn[s.V]=null}return s.V=null,0}catch(o){if(typeof Wi>"u"||o.name!=="ErrnoError")throw o;return o.Z}},fd_read:function(i,s,o,l){try{t:{var h=Ti(i);i=s;for(var v,B=s=0;B<o;B++){var I=H[i>>2],E=H[i+4>>2];i+=8;var F=h,Z=I,et=E,at=v,P=L;if(0>et||0>at)throw new rt(28);if(F.V===null)throw new rt(8);if((F.flags&2097155)===1)throw new rt(8);if((F.node.mode&61440)===16384)throw new rt(31);if(!F.m.read)throw new rt(28);var $=typeof at<"u";if(!$)at=F.position;else if(!F.seekable)throw new rt(70);var ct=F.m.read(F,P,Z,et,at);$||(F.position+=ct);var bt=ct;if(0>bt){var Gt=-1;break t}if(s+=bt,bt<E)break;typeof v<"u"&&(v+=bt)}Gt=s}return H[l>>2]=Gt,0}catch(gt){if(typeof Wi>"u"||gt.name!=="ErrnoError")throw gt;return gt.Z}},fd_seek:function(i,s,o,l,h){s=o+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*o:NaN;try{if(isNaN(s))return 61;var v=Ti(i);return vr(v,s,l),Ut=[v.position>>>0,(It=v.position,1<=+Math.abs(It)?0<It?+Math.floor(It/4294967296)>>>0:~~+Math.ceil((It-+(~~It>>>0))/4294967296)>>>0:0)],G[h>>2]=Ut[0],G[h+4>>2]=Ut[1],v.Ma&&s===0&&l===0&&(v.Ma=null),0}catch(B){if(typeof Wi>"u"||B.name!=="ErrnoError")throw B;return B.Z}},fd_write:function(i,s,o,l){try{t:{var h=Ti(i);i=s;for(var v,B=s=0;B<o;B++){var I=H[i>>2],E=H[i+4>>2];i+=8;var F=h,Z=I,et=E,at=v,P=L;if(0>et||0>at)throw new rt(28);if(F.V===null)throw new rt(8);if(!(F.flags&2097155))throw new rt(8);if((F.node.mode&61440)===16384)throw new rt(31);if(!F.m.write)throw new rt(28);F.seekable&&F.flags&1024&&vr(F,0,2);var $=typeof at<"u";if(!$)at=F.position;else if(!F.seekable)throw new rt(70);var ct=F.m.write(F,P,Z,et,at,void 0);$||(F.position+=ct);var bt=ct;if(0>bt){var Gt=-1;break t}s+=bt,typeof v<"u"&&(v+=bt)}Gt=s}return H[l>>2]=Gt,0}catch(gt){if(typeof Wi>"u"||gt.name!=="ErrnoError")throw gt;return gt.Z}},glBindFramebuffer:Jr,glGetIntegerv:Wr,invoke_ii:Tc,invoke_iii:jc,invoke_iiii:Lc,invoke_iiiii:qc,invoke_iiiiii:$c,invoke_iiiiiii:Ec,invoke_iiiiiiiiii:Jc,invoke_v:kc,invoke_vi:Gc,invoke_vii:Dc,invoke_viii:Fc,invoke_viiii:Rc,invoke_viiiiii:Nc,invoke_viiiiiii:Oc,invoke_viiiiiiii:zc,strftime_l:(i,s,o,l)=>Mc(i,s,o,l)};(function(){function i(o){if(w=o=o.exports,g=w.memory,O(),W=w.__indirect_function_table,st.unshift(w.__wasm_call_ctors),Q--,e.monitorRunDependencies&&e.monitorRunDependencies(Q),Q==0&&nt){var l=nt;nt=null,l()}return o}var s={env:Kr,wasi_snapshot_preview1:Kr};if(Q++,e.monitorRunDependencies&&e.monitorRunDependencies(Q),e.instantiateWasm)try{return e.instantiateWasm(s,i)}catch(o){C("Module.instantiateWasm callback failed with error: "+o),c(o)}return se(s,function(o){i(o.instance)}).catch(c),{}})();var gi=i=>(gi=w.free)(i),Cn=i=>(Cn=w.malloc)(i),ta=e._ma_device__on_notification_unlocked=i=>(ta=e._ma_device__on_notification_unlocked=w.ma_device__on_notification_unlocked)(i);e._ma_malloc_emscripten=(i,s)=>(e._ma_malloc_emscripten=w.ma_malloc_emscripten)(i,s),e._ma_free_emscripten=(i,s)=>(e._ma_free_emscripten=w.ma_free_emscripten)(i,s);var ea=e._ma_device_process_pcm_frames_capture__webaudio=(i,s,o)=>(ea=e._ma_device_process_pcm_frames_capture__webaudio=w.ma_device_process_pcm_frames_capture__webaudio)(i,s,o),ia=e._ma_device_process_pcm_frames_playback__webaudio=(i,s,o)=>(ia=e._ma_device_process_pcm_frames_playback__webaudio=w.ma_device_process_pcm_frames_playback__webaudio)(i,s,o),sa=()=>(sa=w.__errno_location)(),na=i=>(na=w.__getTypeName)(i);e.__embind_initialize_bindings=()=>(e.__embind_initialize_bindings=w._embind_initialize_bindings)();var oa=(i,s)=>(oa=w.emscripten_builtin_memalign)(i,s),Se=(i,s)=>(Se=w.setThrew)(i,s),Be=()=>(Be=w.stackSave)(),Ve=i=>(Ve=w.stackRestore)(i);e.dynCall_iiiij=(i,s,o,l,h,v)=>(e.dynCall_iiiij=w.dynCall_iiiij)(i,s,o,l,h,v),e.dynCall_viiij=(i,s,o,l,h,v)=>(e.dynCall_viiij=w.dynCall_viiij)(i,s,o,l,h,v),e.dynCall_iiij=(i,s,o,l,h)=>(e.dynCall_iiij=w.dynCall_iiij)(i,s,o,l,h),e.dynCall_viij=(i,s,o,l,h)=>(e.dynCall_viij=w.dynCall_viij)(i,s,o,l,h),e.dynCall_iiji=(i,s,o,l,h)=>(e.dynCall_iiji=w.dynCall_iiji)(i,s,o,l,h),e.dynCall_jiji=(i,s,o,l,h)=>(e.dynCall_jiji=w.dynCall_jiji)(i,s,o,l,h),e.dynCall_iiiji=(i,s,o,l,h,v)=>(e.dynCall_iiiji=w.dynCall_iiiji)(i,s,o,l,h,v),e.dynCall_iij=(i,s,o,l)=>(e.dynCall_iij=w.dynCall_iij)(i,s,o,l),e.dynCall_jii=(i,s,o)=>(e.dynCall_jii=w.dynCall_jii)(i,s,o),e.dynCall_viiiiij=(i,s,o,l,h,v,B,I)=>(e.dynCall_viiiiij=w.dynCall_viiiiij)(i,s,o,l,h,v,B,I),e.dynCall_viji=(i,s,o,l,h)=>(e.dynCall_viji=w.dynCall_viji)(i,s,o,l,h),e.dynCall_ji=(i,s)=>(e.dynCall_ji=w.dynCall_ji)(i,s),e.dynCall_vij=(i,s,o,l)=>(e.dynCall_vij=w.dynCall_vij)(i,s,o,l),e.dynCall_viijii=(i,s,o,l,h,v,B)=>(e.dynCall_viijii=w.dynCall_viijii)(i,s,o,l,h,v,B),e.dynCall_iiiiij=(i,s,o,l,h,v,B)=>(e.dynCall_iiiiij=w.dynCall_iiiiij)(i,s,o,l,h,v,B),e.dynCall_iiiiijj=(i,s,o,l,h,v,B,I,E)=>(e.dynCall_iiiiijj=w.dynCall_iiiiijj)(i,s,o,l,h,v,B,I,E),e.dynCall_iiiiiijj=(i,s,o,l,h,v,B,I,E,F)=>(e.dynCall_iiiiiijj=w.dynCall_iiiiiijj)(i,s,o,l,h,v,B,I,E,F);function Tc(i,s){var o=Be();try{return ye(i)(s)}catch(l){if(Ve(o),l!==l+0)throw l;Se(1,0)}}function Dc(i,s,o){var l=Be();try{ye(i)(s,o)}catch(h){if(Ve(l),h!==h+0)throw h;Se(1,0)}}function Gc(i,s){var o=Be();try{ye(i)(s)}catch(l){if(Ve(o),l!==l+0)throw l;Se(1,0)}}function Lc(i,s,o,l){var h=Be();try{return ye(i)(s,o,l)}catch(v){if(Ve(h),v!==v+0)throw v;Se(1,0)}}function Fc(i,s,o,l){var h=Be();try{ye(i)(s,o,l)}catch(v){if(Ve(h),v!==v+0)throw v;Se(1,0)}}function Rc(i,s,o,l,h){var v=Be();try{ye(i)(s,o,l,h)}catch(B){if(Ve(v),B!==B+0)throw B;Se(1,0)}}function kc(i){var s=Be();try{ye(i)()}catch(o){if(Ve(s),o!==o+0)throw o;Se(1,0)}}function Ec(i,s,o,l,h,v,B){var I=Be();try{return ye(i)(s,o,l,h,v,B)}catch(E){if(Ve(I),E!==E+0)throw E;Se(1,0)}}function jc(i,s,o){var l=Be();try{return ye(i)(s,o)}catch(h){if(Ve(l),h!==h+0)throw h;Se(1,0)}}function Oc(i,s,o,l,h,v,B,I){var E=Be();try{ye(i)(s,o,l,h,v,B,I)}catch(F){if(Ve(E),F!==F+0)throw F;Se(1,0)}}function Jc(i,s,o,l,h,v,B,I,E,F){var Z=Be();try{return ye(i)(s,o,l,h,v,B,I,E,F)}catch(et){if(Ve(Z),et!==et+0)throw et;Se(1,0)}}function qc(i,s,o,l,h){var v=Be();try{return ye(i)(s,o,l,h)}catch(B){if(Ve(v),B!==B+0)throw B;Se(1,0)}}function zc(i,s,o,l,h,v,B,I,E){var F=Be();try{ye(i)(s,o,l,h,v,B,I,E)}catch(Z){if(Ve(F),Z!==Z+0)throw Z;Se(1,0)}}function $c(i,s,o,l,h,v){var B=Be();try{return ye(i)(s,o,l,h,v)}catch(I){if(Ve(B),I!==I+0)throw I;Se(1,0)}}function Nc(i,s,o,l,h,v,B){var I=Be();try{ye(i)(s,o,l,h,v,B)}catch(E){if(Ve(I),E!==E+0)throw E;Se(1,0)}}var Mn;nt=function i(){Mn||ra(),Mn||(nt=i)};function ra(){function i(){if(!Mn&&(Mn=!0,e.calledRun=!0,!M)){if(e.noFSInit||wr||(wr=!0,Ar(),e.stdin=e.stdin,e.stdout=e.stdout,e.stderr=e.stderr,e.stdin?Cs("stdin",e.stdin):co("/dev/tty","/dev/stdin"),e.stdout?Cs("stdout",null,e.stdout):co("/dev/tty","/dev/stdout"),e.stderr?Cs("stderr",null,e.stderr):co("/dev/tty1","/dev/stderr"),on("/dev/stdin",0),on("/dev/stdout",1),on("/dev/stderr",1)),hr=!1,be(st),n(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;){var s=e.postRun.shift();_t.unshift(s)}be(_t)}}if(!(0<Q)){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)pt();be(tt),0<Q||(e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),i()},1)):i())}}if(e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();return ra(),t.ready}})();const Hc="/assets/rive-BQGDGf3T.wasm",aa=Hc;class ke{static async loadRive(){console.log("Loading Rive from ",aa),ke.rive=await Wc({locateFile:t=>new URL(aa,import.meta.url).href})}static async loadFile(t){if(!ke.rive)throw new Error("RiveInstance not initialized");const e=await(await fetch(new Request(t))).arrayBuffer();return await ke.rive.load(new Uint8Array(e))}static logUnpackedRiveFile(t){let e="";for(let n=0;n<t.artboardCount();n++){let c=t.artboardByIndex(n);e+=`
 Artboard: ${c.name}`,e+=`
     ${c.stateMachineCount()} State Machines`;for(let r=0;r<c.stateMachineCount();r++){let m=c.stateMachineByIndex(r);e+=`
 ----SM: ${m.name}`;let u=new ke.rive.StateMachineInstance(m,c);for(let p=0;p<u.inputCount();p++){let b=u.input(p);e+=`
 -------SMI: ${b.name} | ${b.type} | ${b.value}`}u.delete()}e+=`
     ${c.animationCount()} Animations`;for(let r=0;r<c.animationCount();r++)e+=`
 ----AN: ${c.animationByIndex(r).name}`}console.log(e)}}const xt=class xt{static init(t,e){this.gameCanvas=t,this.finalCanvas=e,window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchstart",this.onMouseDown),window.addEventListener("touchend",this.onMouseUp),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchstart",this.preventDefault,{passive:!1}),window.addEventListener("touchmove",this.preventDefault,{passive:!1}),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}static clear(){this.isMouseClicked=!1,this.isMouseUp=!1,this.hasMouseMoved=!1,this.keysPressed.clear(),this.keysReleased.clear()}static onClick(t){this.isMouseClicked=!0,t.preventDefault()}static updateCoordinates(t){t instanceof MouseEvent?(this.windowMouseX=t.clientX,this.windowMouseY=t.clientY):t instanceof TouchEvent&&t.touches.length>0&&(this.windowMouseX=t.touches[0].clientX,this.windowMouseY=t.touches[0].clientY);let e=this.finalCanvas.getBoundingClientRect();this.gameMouseX=(this.windowMouseX-e.left)*re.resolution.x/e.width,this.gameMouseY=(this.windowMouseY-e.top)*re.resolution.y/e.height}static preventDefault(t){t.preventDefault()}static isKeyDown(t){return this.keysPressed.has(t)}static isKeyUp(t){return this.keysReleased.has(t)}static isKey(t){return this.keysDown.has(t)}static mouseToArtboardSpace(t){let e=ke.rive.computeAlignment(t.fit,t.alignment,t.frame,t.artboard.bounds),n=new ke.rive.Mat2D,c=0,r=0;return e.invert(n)&&(c=n.xx*this.gameMouseX+n.yx*this.gameMouseY+n.tx,r=n.xy*this.gameMouseX+n.yy*this.gameMouseY+n.ty),{x:c,y:r}}};xt.windowMouseX=0,xt.windowMouseY=0,xt.gameMouseX=0,xt.gameMouseY=0,xt.isMouseDown=!1,xt.isMouseClicked=!1,xt.isMouseUp=!1,xt.hasMouseMoved=!1,xt.keysDown=new Set,xt.keysPressed=new Set,xt.keysReleased=new Set,xt.onMouseDown=t=>{xt.isMouseDown=!0,xt.hasMouseMoved=!1,xt.updateCoordinates(t),t.preventDefault()},xt.onMouseUp=t=>{xt.isMouseDown=!1,xt.isMouseUp=!0,xt.updateCoordinates(t),xt.hasMouseMoved||xt.onClick(t),t.preventDefault()},xt.onMouseMove=t=>{xt.hasMouseMoved=!0,xt.updateCoordinates(t),t.preventDefault()},xt.onTouchMove=t=>{xt.hasMouseMoved=!0,xt.updateCoordinates(t),t.preventDefault()},xt.onKeyDown=t=>{const e=t.keyCode;xt.keysDown.has(e)||xt.keysPressed.add(e),xt.keysDown.add(e)},xt.onKeyUp=t=>{const e=t.keyCode;xt.keysDown.delete(e),xt.keysPressed.delete(e),xt.keysReleased.add(e)};let de=xt;var Lo=(a=>(a[a.Backspace=8]="Backspace",a[a.Tab=9]="Tab",a[a.Enter=13]="Enter",a[a.Shift=16]="Shift",a[a.Ctrl=17]="Ctrl",a[a.Alt=18]="Alt",a[a.PauseBreak=19]="PauseBreak",a[a.CapsLock=20]="CapsLock",a[a.Escape=27]="Escape",a[a.Space=32]="Space",a[a.PageUp=33]="PageUp",a[a.PageDown=34]="PageDown",a[a.End=35]="End",a[a.Home=36]="Home",a[a.LeftArrow=37]="LeftArrow",a[a.UpArrow=38]="UpArrow",a[a.RightArrow=39]="RightArrow",a[a.DownArrow=40]="DownArrow",a[a.Insert=45]="Insert",a[a.Delete=46]="Delete",a[a.Zero=48]="Zero",a[a.One=49]="One",a[a.Two=50]="Two",a[a.Three=51]="Three",a[a.Four=52]="Four",a[a.Five=53]="Five",a[a.Six=54]="Six",a[a.Seven=55]="Seven",a[a.Eight=56]="Eight",a[a.Nine=57]="Nine",a[a.A=65]="A",a[a.B=66]="B",a[a.C=67]="C",a[a.D=68]="D",a[a.E=69]="E",a[a.F=70]="F",a[a.G=71]="G",a[a.H=72]="H",a[a.I=73]="I",a[a.J=74]="J",a[a.K=75]="K",a[a.L=76]="L",a[a.M=77]="M",a[a.N=78]="N",a[a.O=79]="O",a[a.P=80]="P",a[a.Q=81]="Q",a[a.R=82]="R",a[a.S=83]="S",a[a.T=84]="T",a[a.U=85]="U",a[a.V=86]="V",a[a.W=87]="W",a[a.X=88]="X",a[a.Y=89]="Y",a[a.Z=90]="Z",a[a.LeftWindowKey=91]="LeftWindowKey",a[a.RightWindowKey=92]="RightWindowKey",a[a.Numpad0=96]="Numpad0",a[a.Numpad1=97]="Numpad1",a[a.Numpad2=98]="Numpad2",a[a.Numpad3=99]="Numpad3",a[a.Numpad4=100]="Numpad4",a[a.Numpad5=101]="Numpad5",a[a.Numpad6=102]="Numpad6",a[a.Numpad7=103]="Numpad7",a[a.Numpad8=104]="Numpad8",a[a.Numpad9=105]="Numpad9",a[a.Multiply=106]="Multiply",a[a.Add=107]="Add",a[a.Subtract=109]="Subtract",a[a.DecimalPoint=110]="DecimalPoint",a[a.Divide=111]="Divide",a[a.F1=112]="F1",a[a.F2=113]="F2",a[a.F3=114]="F3",a[a.F4=115]="F4",a[a.F5=116]="F5",a[a.F6=117]="F6",a[a.F7=118]="F7",a[a.F8=119]="F8",a[a.F9=120]="F9",a[a.F10=121]="F10",a[a.F11=122]="F11",a[a.F12=123]="F12",a[a.NumLock=144]="NumLock",a[a.ScrollLock=145]="ScrollLock",a[a.SemiColon=186]="SemiColon",a[a.EqualSign=187]="EqualSign",a[a.Comma=188]="Comma",a[a.Dash=189]="Dash",a[a.Period=190]="Period",a[a.ForwardSlash=191]="ForwardSlash",a[a.GraveAccent=192]="GraveAccent",a[a.OpenBracket=219]="OpenBracket",a[a.BackSlash=220]="BackSlash",a[a.CloseBracket=221]="CloseBracket",a[a.SingleQuote=222]="SingleQuote",a))(Lo||{});const oe=class oe{static init(t,e){oe.Box=document.getElementById("debug-content"),oe.gameCanvas=t,oe.finalCanvas=e}static clear(){this.Box.innerHTML=""}static add(t){oe.Box.innerHTML+="<br>"+t}static update(t){if(Ss.update(t),this.updateDebugInfo(),de.isKeyDown(Lo.D)){let e=document.getElementById("debug");e&&(e.style.visibility=e.style.visibility==="hidden"?"visible":"hidden")}de.isKeyDown(Lo.L)&&Ss.downloadCSVOfFPSandMouse()}static updateDebugInfo(){oe.clear(),oe.add(`Canvas Mouse: [${de.gameMouseX},${de.gameMouseY}]`),oe.add(`Game Canvas: [${oe.gameCanvas.width},${oe.gameCanvas.height}]`),oe.add(`Final Canvas: [${oe.finalCanvas.width},${oe.finalCanvas.height}]`),oe.add(`Resolution Scale: [${oe.finalCanvas.width/oe.gameCanvas.width}x, ${oe.finalCanvas.height/oe.gameCanvas.height}x]`),oe.add(`FPS: ${Ss.FPS}`),oe.add(`Average FPS: ${Ss.averageFPS}`)}static toggleCrosshair(){if(this.crosshair!==null){this.crosshair.remove(),this.crosshair=null;return}let t=`
      <style>
          .crosshair-h, .crosshair-v {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background-color: black;
          z-index: 9999;
          }
          .crosshair-h {
          width: 100%;
          height: 2px;
          }
          .crosshair-v {
          width: 2px;
          height: 100%;
          }
      </style>
        <div class="canvas-container">
          <div class="crosshair-h"></div>
          <div class="crosshair-v"></div>
        </div>

      `;this.crosshair=document.createElement("div"),this.crosshair.innerHTML=t,document.body.appendChild(this.crosshair)}};oe.crosshair=null;let Ln=oe;const Nt=class Nt{static update(t){let e=1/t;Nt.FPSArray.push(e),Nt.mouseClickedArray.push(de.isMouseClicked),Nt.mouseUpArray.push(de.isMouseUp),Nt.hasMouseMovedArray.push(de.hasMouseMoved),Nt.FPSArray.length>1e4&&(Nt.FPSArray=Nt.FPSArray.slice(-100),Nt.mouseClickedArray=Nt.mouseClickedArray.slice(-100),Nt.mouseUpArray=Nt.mouseUpArray.slice(-100),Nt.hasMouseMovedArray=Nt.hasMouseMovedArray.slice(-100))}static get averageFPS(){const t=Nt.FPSArray.slice(-100);let e=0;for(let n of t)e+=n;return Math.trunc(e/t.length)}static get FPS(){return Math.trunc(Nt.FPSArray[Nt.FPSArray.length-1])}static downloadCSVOfFPSandMouse(){let t=`FPS,MouseClicked,MouseUp,MouseMoved
`;for(let r=0;r<Nt.FPSArray.length;r++)t+=`${Nt.FPSArray[r]},${Nt.mouseClickedArray[r]},${Nt.mouseUpArray[r]},${Nt.hasMouseMovedArray[r]}
`;let e=new Blob([t],{type:"text/csv"}),n=URL.createObjectURL(e),c=document.createElement("a");c.href=n,c.download="fps_mouse_values.csv",c.click()}};Nt.FPSArray=[],Nt.mouseClickedArray=[],Nt.mouseUpArray=[],Nt.hasMouseMovedArray=[];let Ss=Nt;const Zc="gameCanvas",ot=class ot{static get isInitiated(){return ot._hasInitiated}static async initiate(t,e){if(ot._hasInitiated)throw console.error("Has already been initiated");await ke.loadRive(),ot._hasInitiated=!0,ot.resolution=new Ot(t,e),ot.gameCanvas=new OffscreenCanvas(t,e),ot.renderer=ke.rive.makeRenderer(ot.gameCanvas,!0),ot.finalCanvas=document.getElementById(Zc),de.init(ot.gameCanvas,ot.finalCanvas),Ln.init(ot.gameCanvas,ot.finalCanvas),console.log("After we init debug"),window.addEventListener("resize",ot.onResizeWindow),ot.onResizeWindow(),window.addEventListener("onvisibilitychange",ot.destroy),requestAnimationFrame(ot.update)}static update(t){if(ot.elapsedTime===-1){ot.elapsedTime=t,requestAnimationFrame(ot.update);return}let e=(t-ot.elapsedTime)/1e3;e*=ot.timeScale,e=Math.min(e,ot.MAX_DELTA_TIME),ot.elapsedTime=t,Ln.update(e),ot.fixedUpdateAccumulator+=e;let n=0;for(;ot.fixedUpdateAccumulator>=ot.FIXED_TIME_STEP&&n<ot.MAX_STEPS;)ot.fixedUpdateAccumulator-=ot.FIXED_TIME_STEP,ot.fixedUpdate(ot.FIXED_TIME_STEP),n++;ot.interpolationAlpha=ot.fixedUpdateAccumulator/ot.FIXED_TIME_STEP;for(const c of ot.scenes.values())c.enabled&&c.update(e);ot.render(),ot.renderer.flush(),ke.rive.resolveAnimationFrame(),ot.finalRenderPass(),de.clear(),requestAnimationFrame(ot.update)}static fixedUpdate(t){for(const e of ot.scenes.values())e.enabled&&e.fixedUpdate(t)}static render(){ot.renderer.clear();for(const t of ot.scenes.values())t.enabled&&t.render(ot.renderer)}static debugRender(){for(const t of ot.scenes.values())t.enabled&&t.debugRender(ot.gameCanvas)}static finalRenderPass(){const t=ot.finalCanvas.getContext("2d");if(!t)throw new Error("No 2D context found");t.clearRect(0,0,ot.finalCanvas.width,ot.finalCanvas.height),t.drawImage(ot.gameCanvas,0,0,ot.finalCanvas.width,ot.finalCanvas.height)}static onResizeWindow(){const t=ot.resolution.x/ot.resolution.y;let e=window.innerWidth,n=window.innerHeight;e/n>t?e=Math.floor(n*t):n=Math.floor(e/t),ot.finalCanvas.width=e,ot.finalCanvas.height=n}static addScene(t){ot.scenes.set(t.name,t)}static getScene(t){return ot.scenes.get(t)}static removeScene(t){ot.scenes.delete(t)}static destroy(t){t.preventDefault(),t.returnValue=!0,window.alert("Being Destroyed");for(const e of ot.scenes.values())e.destroy();ot.scenes.clear()}};ot.resolution=new Ot(400,400),ot._hasInitiated=!1,ot.MAX_DELTA_TIME=1/10,ot.FIXED_TIME_STEP=1/30,ot.MAX_STEPS=5,ot.timeScale=1,ot.elapsedTime=-1,ot.fixedUpdateAccumulator=0,ot.interpolationAlpha=0,ot.scenes=new Map;let re=ot;const ui=class ui{constructor(t){this.smiInput=t,this.name=t.name,this.inputType=this.determineInputType(t.type)}determineInputType(t){switch(t){case 56:return ui.InputType.Number;case 58:return ui.InputType.Trigger;case 59:return ui.InputType.Boolean;default:throw new Error(`SMIInput ${this.smiInput.name}: type could not be identified`)}}get value(){return this.smiInput.value}set value(t){if(this.inputType===ui.InputType.Trigger)throw new Error(`SMIInput ${this.smiInput.name}: Cannot set value for a Trigger input`);if(this.inputType===ui.InputType.Boolean&&typeof t!="boolean")throw new Error(`SMIInput ${this.smiInput.name}: Expected boolean value for Boolean input`);if(this.inputType===ui.InputType.Number&&typeof t!="number")throw new Error(`SMIInput ${this.smiInput.name}: Expected number value for Number input`);this.smiInput.value=t}fire(){if(this.inputType!==ui.InputType.Trigger)throw new Error(`SMIInput ${this.smiInput.name}: Tried to fire a non-trigger SMIInput`);this.smiInput.fire()}};ui.InputType={Boolean:"BOOLEAN",Number:"NUMBER",Trigger:"TRIGGER"};let Fo=ui;class Ra{constructor(t){this.enabled=!0,this.position=new Ot(0,0),this.scale=new Ot(1,1),this.rotation=0,this.name=t}update(t){}fixedUpdate(t){}destroy(){}initPhysics(t){if(this.physicsBody)throw new Error("Physics already initialized");this.physicsBody=t}addCollider(t,e=1,n=.3,c=.1){if(!this.physicsBody)throw new Error("Physics not initialized");this.physicsBody.CreateFixture({shape:t,density:e,friction:n,restitution:c})}}var In=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ki={},jt={},Qe={},ka={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.configure=a.settings=void 0;const t={lengthUnitsPerMeter:1,maxPolygonVertices:8};a.settings={...t};function e(n){Object.assign(a.settings,t,n)}a.configure=e})(ka);Object.defineProperty(Qe,"__esModule",{value:!0});Qe.b2_maxPolygonVertices=Qe.b2_lengthUnitsPerMeter=void 0;const Ea=ka;Qe.b2_lengthUnitsPerMeter=Ea.settings.lengthUnitsPerMeter;Qe.b2_maxPolygonVertices=Ea.settings.maxPolygonVertices;(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.b2MakeArray=a.b2MakeBooleanArray=a.b2MakeNumberArray=a.b2_version=a.b2_angularSleepTolerance=a.b2_linearSleepTolerance=a.b2_timeToSleep=a.b2_toiBaumgarte=a.b2_baumgarte=a.b2_maxRotationSquared=a.b2_maxRotation=a.b2_maxTranslationSquared=a.b2_maxTranslation=a.b2_maxAngularCorrection=a.b2_maxLinearCorrection=a.b2_maxTOIContacts=a.b2_maxSubSteps=a.b2_polygonRadius=a.b2_angularSlop=a.b2_linearSlop=a.b2_aabbMultiplier=a.b2_aabbExtension=a.b2_maxManifoldPoints=a.b2_epsilon_sq=a.b2_epsilon=a.b2_maxFloat=a.b2Verify=a.b2Assert=void 0;const t=Qe;function e(u,p){if(!u)throw new Error(p)}a.b2Assert=e;function n(u){if(u===null)throw new Error;return u}a.b2Verify=n,a.b2_maxFloat=1e37,a.b2_epsilon=1e-5,a.b2_epsilon_sq=a.b2_epsilon*a.b2_epsilon,a.b2_maxManifoldPoints=2,a.b2_aabbExtension=.1*t.b2_lengthUnitsPerMeter,a.b2_aabbMultiplier=4,a.b2_linearSlop=.005*t.b2_lengthUnitsPerMeter,a.b2_angularSlop=2/180*Math.PI,a.b2_polygonRadius=2*a.b2_linearSlop,a.b2_maxSubSteps=8,a.b2_maxTOIContacts=32,a.b2_maxLinearCorrection=.2*t.b2_lengthUnitsPerMeter,a.b2_maxAngularCorrection=8/180*Math.PI,a.b2_maxTranslation=2*t.b2_lengthUnitsPerMeter,a.b2_maxTranslationSquared=a.b2_maxTranslation*a.b2_maxTranslation,a.b2_maxRotation=.5*Math.PI,a.b2_maxRotationSquared=a.b2_maxRotation*a.b2_maxRotation,a.b2_baumgarte=.2,a.b2_toiBaumgarte=.75,a.b2_timeToSleep=.5,a.b2_linearSleepTolerance=.01*t.b2_lengthUnitsPerMeter,a.b2_angularSleepTolerance=2/180*Math.PI,a.b2_version={major:2,minor:4,patch:1};function c(u,p=0){const b=new Array(u);for(let d=0;d<u;d++)b[d]=p;return b}a.b2MakeNumberArray=c;function r(u,p=!1){const b=new Array(u);for(let d=0;d<u;d++)b[d]=p;return b}a.b2MakeBooleanArray=r;function m(u,p){const b=new Array(u);for(let d=0;d<u;d++)b[d]=new p;return b}a.b2MakeArray=m})(jt);var Dt={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.b2Sweep=a.b2Transform=a.b2Rot=a.b2Mat33=a.b2Mat22=a.b2Vec3=a.b2Vec2=a.b2RandomInt=a.b2RandomFloat=a.b2Random=a.b2IsPowerOfTwo=a.b2NextPowerOfTwo=a.b2RadToDeg=a.b2DegToRad=a.b2Clamp=a.b2_two_pi=a.b2_180_over_pi=a.b2_pi_over_180=void 0;const t=jt;a.b2_pi_over_180=Math.PI/180,a.b2_180_over_pi=180/Math.PI,a.b2_two_pi=2*Math.PI;function e(C,_,g){return C<_?_:C>g?g:C}a.b2Clamp=e;function n(C){return C*a.b2_pi_over_180}a.b2DegToRad=n;function c(C){return C*a.b2_180_over_pi}a.b2RadToDeg=c;function r(C){return C|=C>>1,C|=C>>2,C|=C>>4,C|=C>>8,C|=C>>16,C+1}a.b2NextPowerOfTwo=r;function m(C){return C>0&&(C&C-1)===0}a.b2IsPowerOfTwo=m;function u(){return Math.random()*2-1}a.b2Random=u;function p(C,_){return(_-C)*Math.random()+C}a.b2RandomFloat=p;function b(C,_){return Math.round((_-C)*Math.random()+C)}a.b2RandomInt=b;class d{constructor(_=0,g=0){this.x=_,this.y=g}Clone(){return new d(this.x,this.y)}SetZero(){return this.x=0,this.y=0,this}Set(_,g){return this.x=_,this.y=g,this}Copy(_){return this.x=_.x,this.y=_.y,this}Add(_){return this.x+=_.x,this.y+=_.y,this}AddXY(_,g){return this.x+=_,this.y+=g,this}Subtract(_){return this.x-=_.x,this.y-=_.y,this}SubtractXY(_,g){return this.x-=_,this.y-=g,this}Scale(_){return this.x*=_,this.y*=_,this}AddScaled(_,g){return this.x+=_*g.x,this.y+=_*g.y,this}SubtractScaled(_,g){return this.x-=_*g.x,this.y-=_*g.y,this}Dot(_){return this.x*_.x+this.y*_.y}Cross(_){return this.x*_.y-this.y*_.x}Length(){const{x:_,y:g}=this;return Math.sqrt(_*_+g*g)}LengthSquared(){const{x:_,y:g}=this;return _*_+g*g}Normalize(){const _=this.Length();if(_<t.b2_epsilon)return 0;const g=1/_;return this.x*=g,this.y*=g,_}Rotate(_){const g=Math.cos(_),w=Math.sin(_),{x:M}=this;return this.x=g*M-w*this.y,this.y=w*M+g*this.y,this}RotateCosSin(_,g){const{x:w}=this;return this.x=_*w-g*this.y,this.y=g*w+_*this.y,this}IsValid(){return Number.isFinite(this.x)&&Number.isFinite(this.y)}Abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}GetAbs(_){return _.x=Math.abs(this.x),_.y=Math.abs(this.y),_}Negate(){return this.x=-this.x,this.y=-this.y,this}Skew(){const{x:_}=this;return this.x=-this.y,this.y=_,this}static Min(_,g,w){return w.x=Math.min(_.x,g.x),w.y=Math.min(_.y,g.y),w}static Max(_,g,w){return w.x=Math.max(_.x,g.x),w.y=Math.max(_.y,g.y),w}static Clamp(_,g,w,M){return M.x=e(_.x,g.x,w.x),M.y=e(_.y,g.y,w.y),M}static Rotate(_,g,w){const M=_.x,L=_.y,R=Math.cos(g),z=Math.sin(g);return w.x=R*M-z*L,w.y=z*M+R*L,w}static Dot(_,g){return _.x*g.x+_.y*g.y}static Cross(_,g){return _.x*g.y-_.y*g.x}static CrossVec2Scalar(_,g,w){const M=_.x;return w.x=g*_.y,w.y=-g*M,w}static CrossVec2One(_,g){const w=_.x;return g.x=_.y,g.y=-w,g}static CrossScalarVec2(_,g,w){const M=g.x;return w.x=-_*g.y,w.y=_*M,w}static CrossOneVec2(_,g){const w=_.x;return g.x=-_.y,g.y=w,g}static Add(_,g,w){return w.x=_.x+g.x,w.y=_.y+g.y,w}static Subtract(_,g,w){return w.x=_.x-g.x,w.y=_.y-g.y,w}static Scale(_,g,w){return w.x=g.x*_,w.y=g.y*_,w}static AddScaled(_,g,w,M){return M.x=_.x+g*w.x,M.y=_.y+g*w.y,M}static SubtractScaled(_,g,w,M){return M.x=_.x-g*w.x,M.y=_.y-g*w.y,M}static AddCrossScalarVec2(_,g,w,M){const L=w.x;return M.x=_.x-g*w.y,M.y=_.y+g*L,M}static Mid(_,g,w){return w.x=(_.x+g.x)*.5,w.y=(_.y+g.y)*.5,w}static Extents(_,g,w){return w.x=(g.x-_.x)*.5,w.y=(g.y-_.y)*.5,w}static Equals(_,g){return _.x===g.x&&_.y===g.y}static Distance(_,g){return Math.sqrt((_.x-g.x)**2+(_.y-g.y)**2)}static DistanceSquared(_,g){return(_.x-g.x)**2+(_.y-g.y)**2}static Negate(_,g){return g.x=-_.x,g.y=-_.y,g}static Normalize(_,g){const w=_.x**2+_.y**2;if(w>=t.b2_epsilon_sq){const M=1/Math.sqrt(w);g.x=M*_.x,g.y=M*_.y}else g.x=0,g.y=0;return g}static Skew(_,g){const{x:w}=_;return g.x=-_.y,g.y=w,g}}a.b2Vec2=d,d.ZERO=new d,d.UNITX=new d(1,0),d.UNITY=new d(0,1),d.s_t0=new d,d.s_t1=new d,d.s_t2=new d,d.s_t3=new d;class A{constructor(_=0,g=0,w=0){this.x=_,this.y=g,this.z=w}Clone(){return new A(this.x,this.y,this.z)}SetZero(){return this.x=0,this.y=0,this.z=0,this}Set(_,g,w){return this.x=_,this.y=g,this.z=w,this}Copy(_){return this.x=_.x,this.y=_.y,this.z=_.z,this}Negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}Add(_){return this.x+=_.x,this.y+=_.y,this.z+=_.z,this}AddXYZ(_,g,w){return this.x+=_,this.y+=g,this.z+=w,this}Subtract(_){return this.x-=_.x,this.y-=_.y,this.z-=_.z,this}SubtractXYZ(_,g,w){return this.x-=_,this.y-=g,this.z-=w,this}Scale(_){return this.x*=_,this.y*=_,this.z*=_,this}static Dot(_,g){return _.x*g.x+_.y*g.y+_.z*g.z}static Cross(_,g,w){const M=_.x,L=_.y,R=_.z,z=g.x,N=g.y,G=g.z;return w.x=L*G-R*N,w.y=R*z-M*G,w.z=M*N-L*z,w}}a.b2Vec3=A,A.ZERO=new A(0,0,0),A.s_t0=new A;class y{constructor(){this.ex=new d(1,0),this.ey=new d(0,1)}Clone(){return new y().Copy(this)}static FromColumns(_,g){return new y().SetColumns(_,g)}static FromScalars(_,g,w,M){return new y().SetScalars(_,g,w,M)}static FromAngle(_){return new y().SetAngle(_)}SetScalars(_,g,w,M){return this.ex.Set(_,w),this.ey.Set(g,M),this}SetColumns(_,g){return this.ex.Copy(_),this.ey.Copy(g),this}SetAngle(_){const g=Math.cos(_),w=Math.sin(_);return this.ex.Set(g,w),this.ey.Set(-w,g),this}Copy(_){return this.ex.Copy(_.ex),this.ey.Copy(_.ey),this}SetIdentity(){return this.ex.Set(1,0),this.ey.Set(0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this}GetAngle(){return Math.atan2(this.ex.y,this.ex.x)}Solve(_,g,w){const M=this.ex.x,L=this.ey.x,R=this.ex.y,z=this.ey.y;let N=M*z-L*R;return N!==0&&(N=1/N),w.x=N*(z*_-L*g),w.y=N*(M*g-R*_),w}Abs(){return this.ex.Abs(),this.ey.Abs(),this}Inverse(){return this.GetInverse(this),this}Add(_){return this.ex.Add(_.ex),this.ey.Add(_.ey),this}Subtract(_){return this.ex.Subtract(_.ex),this.ey.Subtract(_.ey),this}GetInverse(_){const g=this.ex.x,w=this.ey.x,M=this.ex.y,L=this.ey.y;let R=g*L-w*M;return R!==0&&(R=1/R),_.ex.x=R*L,_.ey.x=-R*w,_.ex.y=-R*M,_.ey.y=R*g,_}GetAbs(_){return _.ex.x=Math.abs(this.ex.x),_.ex.y=Math.abs(this.ex.y),_.ey.x=Math.abs(this.ey.x),_.ey.y=Math.abs(this.ey.y),_}static MultiplyVec2(_,g,w){const M=g.x,L=g.y;return w.x=_.ex.x*M+_.ey.x*L,w.y=_.ex.y*M+_.ey.y*L,w}static TransposeMultiplyVec2(_,g,w){const M=g.x,L=g.y;return w.x=_.ex.x*M+_.ex.y*L,w.y=_.ey.x*M+_.ey.y*L,w}static Add(_,g,w){return w.ex.x=_.ex.x+g.ex.x,w.ex.y=_.ex.y+g.ex.y,w.ey.x=_.ey.x+g.ey.x,w.ey.y=_.ey.y+g.ey.y,w}static Multiply(_,g,w){const M=_.ex.x,L=_.ex.y,R=_.ey.x,z=_.ey.y,N=g.ex.x,G=g.ex.y,H=g.ey.x,k=g.ey.y;return w.ex.x=M*N+R*G,w.ex.y=L*N+z*G,w.ey.x=M*H+R*k,w.ey.y=L*H+z*k,w}static TransposeMultiply(_,g,w){const M=_.ex.x,L=_.ex.y,R=_.ey.x,z=_.ey.y,N=g.ex.x,G=g.ex.y,H=g.ey.x,k=g.ey.y;return w.ex.x=M*N+L*G,w.ex.y=R*N+z*G,w.ey.x=M*H+L*k,w.ey.y=R*H+z*k,w}}a.b2Mat22=y,y.IDENTITY=new y;class f{constructor(){this.ex=new A(1,0,0),this.ey=new A(0,1,0),this.ez=new A(0,0,1)}Clone(){return new f().Copy(this)}SetColumns(_,g,w){return this.ex.Copy(_),this.ey.Copy(g),this.ez.Copy(w),this}Copy(_){return this.ex.Copy(_.ex),this.ey.Copy(_.ey),this.ez.Copy(_.ez),this}SetIdentity(){return this.ex.Set(1,0,0),this.ey.Set(0,1,0),this.ez.Set(0,0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}Add(_){return this.ex.Add(_.ex),this.ey.Add(_.ey),this.ez.Add(_.ez),this}Solve33(_,g,w,M){const L=this.ex.x,R=this.ex.y,z=this.ex.z,N=this.ey.x,G=this.ey.y,H=this.ey.z,k=this.ez.x,j=this.ez.y,O=this.ez.z;let W=L*(G*O-H*j)+R*(H*k-N*O)+z*(N*j-G*k);return W!==0&&(W=1/W),M.x=W*(_*(G*O-H*j)+g*(H*k-N*O)+w*(N*j-G*k)),M.y=W*(L*(g*O-w*j)+R*(w*k-_*O)+z*(_*j-g*k)),M.z=W*(L*(G*w-H*g)+R*(H*_-N*w)+z*(N*g-G*_)),M}Solve22(_,g,w){const M=this.ex.x,L=this.ey.x,R=this.ex.y,z=this.ey.y;let N=M*z-L*R;return N!==0&&(N=1/N),w.x=N*(z*_-L*g),w.y=N*(M*g-R*_),w}GetInverse22(_){const g=this.ex.x,w=this.ey.x,M=this.ex.y,L=this.ey.y;let R=g*L-w*M;R!==0&&(R=1/R),_.ex.x=R*L,_.ey.x=-R*w,_.ex.z=0,_.ex.y=-R*M,_.ey.y=R*g,_.ey.z=0,_.ez.x=0,_.ez.y=0,_.ez.z=0}GetSymInverse33(_){let g=A.Dot(this.ex,A.Cross(this.ey,this.ez,A.s_t0));g!==0&&(g=1/g);const w=this.ex.x,M=this.ey.x,L=this.ez.x,R=this.ey.y,z=this.ez.y,N=this.ez.z;_.ex.x=g*(R*N-z*z),_.ex.y=g*(L*z-M*N),_.ex.z=g*(M*z-L*R),_.ey.x=_.ex.y,_.ey.y=g*(w*N-L*L),_.ey.z=g*(L*M-w*z),_.ez.x=_.ex.z,_.ez.y=_.ey.z,_.ez.z=g*(w*R-M*M)}static MultiplyVec3(_,g,w){const{x:M,y:L,z:R}=g;return w.x=_.ex.x*M+_.ey.x*L+_.ez.x*R,w.y=_.ex.y*M+_.ey.y*L+_.ez.y*R,w.z=_.ex.z*M+_.ey.z*L+_.ez.z*R,w}static MultiplyVec2(_,g,w){const{x:M,y:L}=g;return w.x=_.ex.x*M+_.ey.x*L,w.y=_.ex.y*M+_.ey.y*L,w}}a.b2Mat33=f,f.IDENTITY=new f;class x{constructor(_=0){this.s=0,this.c=1,_&&(this.s=Math.sin(_),this.c=Math.cos(_))}Clone(){return new x().Copy(this)}Copy(_){return this.s=_.s,this.c=_.c,this}Set(_){return this.s=Math.sin(_),this.c=Math.cos(_),this}SetIdentity(){return this.s=0,this.c=1,this}GetAngle(){return Math.atan2(this.s,this.c)}GetXAxis(_){return _.x=this.c,_.y=this.s,_}GetYAxis(_){return _.x=-this.s,_.y=this.c,_}static Multiply(_,g,w){const M=_.s*g.c+_.c*g.s,L=_.c*g.c-_.s*g.s;return w.s=M,w.c=L,w}static TransposeMultiply(_,g,w){const M=_.c*g.s-_.s*g.c,L=_.c*g.c+_.s*g.s;return w.s=M,w.c=L,w}static MultiplyVec2(_,g,w){const M=g.x,L=g.y;return w.x=_.c*M-_.s*L,w.y=_.s*M+_.c*L,w}static TransposeMultiplyVec2(_,g,w){const M=g.x,L=g.y;return w.x=_.c*M+_.s*L,w.y=-_.s*M+_.c*L,w}}a.b2Rot=x,x.IDENTITY=new x;class S{constructor(){this.p=new d,this.q=new x}Clone(){return new S().Copy(this)}Copy(_){return this.p.Copy(_.p),this.q.Copy(_.q),this}SetIdentity(){return this.p.SetZero(),this.q.SetIdentity(),this}SetPositionRotation(_,g){return this.p.Copy(_),this.q.Copy(g),this}SetPositionAngle(_,g){return this.p.Copy(_),this.q.Set(g),this}SetPosition(_){return this.p.Copy(_),this}SetPositionXY(_,g){return this.p.Set(_,g),this}SetRotation(_){return this.q.Copy(_),this}SetRotationAngle(_){return this.q.Set(_),this}GetPosition(){return this.p}GetRotation(){return this.q}GetAngle(){return this.q.GetAngle()}static MultiplyVec2(_,g,w){const M=g.x,L=g.y;return w.x=_.q.c*M-_.q.s*L+_.p.x,w.y=_.q.s*M+_.q.c*L+_.p.y,w}static TransposeMultiplyVec2(_,g,w){const M=g.x-_.p.x,L=g.y-_.p.y;return w.x=_.q.c*M+_.q.s*L,w.y=-_.q.s*M+_.q.c*L,w}static Multiply(_,g,w){return x.Multiply(_.q,g.q,w.q),x.MultiplyVec2(_.q,g.p,w.p).Add(_.p),w}static TransposeMultiply(_,g,w){return x.TransposeMultiply(_.q,g.q,w.q),x.TransposeMultiplyVec2(_.q,d.Subtract(g.p,_.p,w.p),w.p),w}}a.b2Transform=S,S.IDENTITY=new S;class V{constructor(){this.localCenter=new d,this.c0=new d,this.c=new d,this.a0=0,this.a=0,this.alpha0=0}Clone(){return new V().Copy(this)}Copy(_){return this.localCenter.Copy(_.localCenter),this.c0.Copy(_.c0),this.c.Copy(_.c),this.a0=_.a0,this.a=_.a,this.alpha0=_.alpha0,this}GetTransform(_,g){const w=1-g;_.p.x=w*this.c0.x+g*this.c.x,_.p.y=w*this.c0.y+g*this.c.y;const M=w*this.a0+g*this.a;return _.q.Set(M),_.p.Subtract(x.MultiplyVec2(_.q,this.localCenter,d.s_t0)),_}Advance(_){const g=(_-this.alpha0)/(1-this.alpha0);this.c0.x+=g*(this.c.x-this.c0.x),this.c0.y+=g*(this.c.y-this.c0.y),this.a0+=g*(this.a-this.a0),this.alpha0=_}Normalize(){const _=a.b2_two_pi*Math.floor(this.a0/a.b2_two_pi);this.a0-=_,this.a-=_}}a.b2Sweep=V})(Dt);var Ge={};Object.defineProperty(Ge,"__esModule",{value:!0});Ge.debugColors=Ge.b2Color=void 0;class Pt{constructor(t=.5,e=.5,n=.5,c=1){this.r=t,this.g=e,this.b=n,this.a=c}Clone(){return new Pt(this.r,this.g,this.b,this.a)}Copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}IsEqual(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}IsZero(){return this.r===0&&this.g===0&&this.b===0&&this.a===0}SetByteRGB(t,e,n){return this.r=t/255,this.g=e/255,this.b=n/255,this}SetByteRGBA(t,e,n,c){return this.r=t/255,this.g=e/255,this.b=n/255,this.a=c/255,this}SetRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}SetRGBA(t,e,n,c){return this.r=t,this.g=e,this.b=n,this.a=c,this}Add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}Subtract(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}Scale(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}Mix(t,e){Pt.MixColors(this,t,e)}static Add(t,e,n){return n.r=t.r+e.r,n.g=t.g+e.g,n.b=t.b+e.b,n.a=t.a+e.a,n}static Subtract(t,e,n){return n.r=t.r-e.r,n.g=t.g-e.g,n.b=t.b-e.b,n.a=t.a-e.a,n}static Scale(t,e,n){return n.r=t.r*e,n.g=t.g*e,n.b=t.b*e,n.a=t.a*e,n}static MixColors(t,e,n){const c=n*(e.r-t.r),r=n*(e.g-t.g),m=n*(e.b-t.b),u=n*(e.a-t.a);t.r+=c,t.g+=r,t.b+=m,t.a+=u,e.r-=c,e.g-=r,e.b-=m,e.a-=u}}Ge.b2Color=Pt;Pt.ZERO=new Pt(0,0,0,0);Pt.RED=new Pt(1,0,0);Pt.GREEN=new Pt(0,1,0);Pt.BLUE=new Pt(0,0,1);Pt.WHITE=new Pt(1,1,1);Pt.BLACK=new Pt(0,0,0);Ge.debugColors={badBody:new Pt(1,0,0),disabledBody:new Pt(.5,.5,.3),staticBody:new Pt(.5,.9,.5),kinematicBody:new Pt(.5,.5,.9),sleepingBody:new Pt(.6,.6,.6),body:new Pt(.9,.7,.7),pair:new Pt(.3,.9,.9),aabb:new Pt(.9,.3,.9),joint1:new Pt(.7,.7,.7),joint2:new Pt(.3,.9,.3),joint3:new Pt(.9,.3,.3),joint4:new Pt(.3,.3,.9),joint5:new Pt(.4,.4,.4),joint6:new Pt(.5,.8,.8),joint7:new Pt(0,1,0),joint8:new Pt(.8,.8,.8),rope:new Pt(.4,.5,.7),ropePointG:new Pt(.1,.8,.1),ropePointD:new Pt(.7,.2,.4)};var Re={},pi={},De={};Object.defineProperty(De,"__esModule",{value:!0});De.b2Shape=De.b2ShapeType=De.b2MassData=void 0;const Xc=Dt;class Yc{constructor(){this.mass=0,this.center=new Xc.b2Vec2,this.I=0}}De.b2MassData=Yc;var ca;(function(a){a[a.e_unknown=-1]="e_unknown",a[a.e_circle=0]="e_circle",a[a.e_edge=1]="e_edge",a[a.e_polygon=2]="e_polygon",a[a.e_chain=3]="e_chain",a[a.e_typeCount=4]="e_typeCount"})(ca||(De.b2ShapeType=ca={}));class Qc{constructor(t,e){this.m_radius=0,this.m_type=t,this.m_radius=e}Copy(t){return this.m_radius=t.m_radius,this}GetType(){return this.m_type}}De.b2Shape=Qc;var er={},yt={},On={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.b2ShapeCast=a.b2Distance=a.b2Gjk=a.b2ShapeCastOutput=a.b2ShapeCastInput=a.b2DistanceOutput=a.b2DistanceInput=a.b2SimplexCache=a.b2DistanceProxy=void 0;const t=jt,e=Dt;class n{constructor(){this.m_buffer=(0,t.b2MakeArray)(2,e.b2Vec2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}Copy(O){return O.m_vertices===O.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0]=O.m_buffer[0],this.m_buffer[1]=O.m_buffer[1]):this.m_vertices=O.m_vertices,this.m_count=O.m_count,this.m_radius=O.m_radius,this}Reset(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}SetShape(O,W){O.SetupDistanceProxy(this,W)}SetVerticesRadius(O,W,tt){this.m_vertices=O,this.m_count=W,this.m_radius=tt}GetSupport(O){let W=0,tt=e.b2Vec2.Dot(this.m_vertices[0],O);for(let st=1;st<this.m_count;++st){const _t=e.b2Vec2.Dot(this.m_vertices[st],O);_t>tt&&(W=st,tt=_t)}return W}GetSupportVertex(O){let W=0,tt=e.b2Vec2.Dot(this.m_vertices[0],O);for(let st=1;st<this.m_count;++st){const _t=e.b2Vec2.Dot(this.m_vertices[st],O);_t>tt&&(W=st,tt=_t)}return this.m_vertices[W]}GetVertexCount(){return this.m_count}GetVertex(O){return this.m_vertices[O]}}a.b2DistanceProxy=n;class c{constructor(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}Reset(){return this.metric=0,this.count=0,this}}a.b2SimplexCache=c;class r{constructor(){this.proxyA=new n,this.proxyB=new n,this.transformA=new e.b2Transform,this.transformB=new e.b2Transform,this.useRadii=!1}Reset(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}a.b2DistanceInput=r;class m{constructor(){this.pointA=new e.b2Vec2,this.pointB=new e.b2Vec2,this.distance=0,this.iterations=0}Reset(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}a.b2DistanceOutput=m;class u{constructor(){this.proxyA=new n,this.proxyB=new n,this.transformA=new e.b2Transform,this.transformB=new e.b2Transform,this.translationB=new e.b2Vec2}}a.b2ShapeCastInput=u;class p{constructor(){this.point=new e.b2Vec2,this.normal=new e.b2Vec2,this.lambda=0,this.iterations=0}}a.b2ShapeCastOutput=p,a.b2Gjk={calls:0,iters:0,maxIters:0,reset(){this.calls=0,this.iters=0,this.maxIters=0}};class b{constructor(){this.wA=new e.b2Vec2,this.wB=new e.b2Vec2,this.w=new e.b2Vec2,this.a=0,this.indexA=0,this.indexB=0}Copy(O){return this.wA.Copy(O.wA),this.wB.Copy(O.wB),this.w.Copy(O.w),this.a=O.a,this.indexA=O.indexA,this.indexB=O.indexB,this}}class d{constructor(){this.m_v1=new b,this.m_v2=new b,this.m_v3=new b,this.m_count=0,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]}ReadCache(O,W,tt,st,_t){this.m_count=O.count;const pt=this.m_vertices;for(let Q=0;Q<this.m_count;++Q){const nt=pt[Q];nt.indexA=O.indexA[Q],nt.indexB=O.indexB[Q];const ft=W.GetVertex(nt.indexA),Mt=st.GetVertex(nt.indexB);e.b2Transform.MultiplyVec2(tt,ft,nt.wA),e.b2Transform.MultiplyVec2(_t,Mt,nt.wB),e.b2Vec2.Subtract(nt.wB,nt.wA,nt.w),nt.a=0}if(this.m_count>1){const Q=O.metric,nt=this.GetMetric();(nt<.5*Q||2*Q<nt||nt<t.b2_epsilon)&&(this.m_count=0)}if(this.m_count===0){const Q=pt[0];Q.indexA=0,Q.indexB=0;const nt=W.GetVertex(0),ft=st.GetVertex(0);e.b2Transform.MultiplyVec2(tt,nt,Q.wA),e.b2Transform.MultiplyVec2(_t,ft,Q.wB),e.b2Vec2.Subtract(Q.wB,Q.wA,Q.w),Q.a=1,this.m_count=1}}WriteCache(O){O.metric=this.GetMetric(),O.count=this.m_count;const W=this.m_vertices;for(let tt=0;tt<this.m_count;++tt)O.indexA[tt]=W[tt].indexA,O.indexB[tt]=W[tt].indexB}GetSearchDirection(O){switch(this.m_count){case 1:return e.b2Vec2.Negate(this.m_v1.w,O);case 2:{const W=e.b2Vec2.Subtract(this.m_v2.w,this.m_v1.w,O);return e.b2Vec2.Cross(W,e.b2Vec2.Negate(this.m_v1.w,e.b2Vec2.s_t0))>0?e.b2Vec2.CrossOneVec2(W,O):e.b2Vec2.CrossVec2One(W,O)}default:return O.SetZero()}}GetClosestPoint(O){switch(this.m_count){case 0:return O.SetZero();case 1:return O.Copy(this.m_v1.w);case 2:return O.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:return O.SetZero();default:return O.SetZero()}}GetWitnessPoints(O,W){switch(this.m_count){case 0:break;case 1:O.Copy(this.m_v1.wA),W.Copy(this.m_v1.wB);break;case 2:O.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,O.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,W.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,W.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:W.x=O.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,W.y=O.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break}}GetMetric(){switch(this.m_count){case 0:return 0;case 1:return 0;case 2:return e.b2Vec2.Distance(this.m_v1.w,this.m_v2.w);case 3:return e.b2Vec2.Cross(e.b2Vec2.Subtract(this.m_v2.w,this.m_v1.w,e.b2Vec2.s_t0),e.b2Vec2.Subtract(this.m_v3.w,this.m_v1.w,e.b2Vec2.s_t1));default:return 0}}Solve2(){const O=this.m_v1.w,W=this.m_v2.w,tt=e.b2Vec2.Subtract(W,O,d.s_e12),st=-e.b2Vec2.Dot(O,tt);if(st<=0){this.m_v1.a=1,this.m_count=1;return}const _t=e.b2Vec2.Dot(W,tt);if(_t<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2);return}const pt=1/(_t+st);this.m_v1.a=_t*pt,this.m_v2.a=st*pt,this.m_count=2}Solve3(){const O=this.m_v1.w,W=this.m_v2.w,tt=this.m_v3.w,st=e.b2Vec2.Subtract(W,O,d.s_e12),_t=e.b2Vec2.Dot(O,st),Q=e.b2Vec2.Dot(W,st),nt=-_t,ft=e.b2Vec2.Subtract(tt,O,d.s_e13),Mt=e.b2Vec2.Dot(O,ft),Vt=e.b2Vec2.Dot(tt,ft),ce=-Mt,Qt=e.b2Vec2.Subtract(tt,W,d.s_e23),Ct=e.b2Vec2.Dot(W,Qt),It=e.b2Vec2.Dot(tt,Qt),Ut=-Ct,pe=e.b2Vec2.Cross(st,ft),be=pe*e.b2Vec2.Cross(W,tt),Ie=pe*e.b2Vec2.Cross(tt,O),te=pe*e.b2Vec2.Cross(O,W);if(nt<=0&&ce<=0){this.m_v1.a=1,this.m_count=1;return}if(Q>0&&nt>0&&te<=0){const fe=1/(Q+nt);this.m_v1.a=Q*fe,this.m_v2.a=nt*fe,this.m_count=2;return}if(Vt>0&&ce>0&&Ie<=0){const fe=1/(Vt+ce);this.m_v1.a=Vt*fe,this.m_v3.a=ce*fe,this.m_count=2,this.m_v2.Copy(this.m_v3);return}if(Q<=0&&Ut<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2);return}if(Vt<=0&&It<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.Copy(this.m_v3);return}if(It>0&&Ut>0&&be<=0){const fe=1/(It+Ut);this.m_v2.a=It*fe,this.m_v3.a=Ut*fe,this.m_count=2,this.m_v1.Copy(this.m_v3);return}const Ue=1/(be+Ie+te);this.m_v1.a=be*Ue,this.m_v2.a=Ie*Ue,this.m_v3.a=te*Ue,this.m_count=3}}d.s_e12=new e.b2Vec2,d.s_e13=new e.b2Vec2,d.s_e23=new e.b2Vec2;const A=new d,y=[0,0,0],f=[0,0,0],x=new e.b2Vec2,S=new e.b2Vec2,V=new e.b2Vec2,C=new e.b2Vec2,_=new e.b2Vec2;function g(j,O,W){++a.b2Gjk.calls;const{proxyA:tt,proxyB:st,transformA:_t,transformB:pt}=W,Q=A;Q.ReadCache(O,tt,_t,st,pt);const nt=Q.m_vertices,ft=20,Mt=y,Tt=f;let Vt=0,ce=0;for(;ce<ft;){Vt=Q.m_count;for(let It=0;It<Vt;++It)Mt[It]=nt[It].indexA,Tt[It]=nt[It].indexB;switch(Q.m_count){case 1:break;case 2:Q.Solve2();break;case 3:Q.Solve3();break}if(Q.m_count===3)break;const Qt=Q.GetSearchDirection(S);if(Qt.LengthSquared()<t.b2_epsilon_sq)break;const Ct=nt[Q.m_count];Ct.indexA=tt.GetSupport(e.b2Rot.TransposeMultiplyVec2(_t.q,e.b2Vec2.Negate(Qt,e.b2Vec2.s_t0),C)),e.b2Transform.MultiplyVec2(_t,tt.GetVertex(Ct.indexA),Ct.wA),Ct.indexB=st.GetSupport(e.b2Rot.TransposeMultiplyVec2(pt.q,Qt,_)),e.b2Transform.MultiplyVec2(pt,st.GetVertex(Ct.indexB),Ct.wB),e.b2Vec2.Subtract(Ct.wB,Ct.wA,Ct.w),++ce,++a.b2Gjk.iters;let se=!1;for(let It=0;It<Vt;++It)if(Ct.indexA===Mt[It]&&Ct.indexB===Tt[It]){se=!0;break}if(se)break;++Q.m_count}if(a.b2Gjk.maxIters=Math.max(a.b2Gjk.maxIters,ce),Q.GetWitnessPoints(j.pointA,j.pointB),j.distance=e.b2Vec2.Distance(j.pointA,j.pointB),j.iterations=ce,Q.WriteCache(O),W.useRadii)if(j.distance<t.b2_epsilon){const Qt=e.b2Vec2.Mid(j.pointA,j.pointB,x);j.pointA.Copy(Qt),j.pointB.Copy(Qt),j.distance=0}else{const Qt=tt.m_radius,Ct=st.m_radius,se=e.b2Vec2.Subtract(j.pointB,j.pointA,V);se.Normalize(),j.distance=Math.max(0,j.distance-Qt-Ct),j.pointA.AddScaled(Qt,se),j.pointB.SubtractScaled(Ct,se)}}a.b2Distance=g;const w=new e.b2Vec2,M=new d,L=new e.b2Vec2,R=new e.b2Vec2,z=new e.b2Vec2,N=new e.b2Vec2,G=new e.b2Vec2,H=new e.b2Vec2;function k(j,O){j.iterations=0,j.lambda=1,j.normal.SetZero(),j.point.SetZero();const{proxyA:W,proxyB:tt}=O,st=Math.max(W.m_radius,t.b2_polygonRadius),_t=Math.max(tt.m_radius,t.b2_polygonRadius),pt=st+_t,Q=O.transformA,nt=O.transformB,ft=O.translationB,Mt=w.SetZero();let Tt=0;const Vt=M;Vt.m_count=0;const ce=Vt.m_vertices;let Qt=W.GetSupport(e.b2Rot.TransposeMultiplyVec2(Q.q,e.b2Vec2.Negate(ft,e.b2Vec2.s_t1),e.b2Vec2.s_t0)),Ct=e.b2Transform.MultiplyVec2(Q,W.GetVertex(Qt),L),se=tt.GetSupport(e.b2Rot.TransposeMultiplyVec2(nt.q,ft,e.b2Vec2.s_t0)),It=e.b2Transform.MultiplyVec2(nt,tt.GetVertex(se),R);const Ut=e.b2Vec2.Subtract(Ct,It,z),pe=Math.max(t.b2_polygonRadius,pt-t.b2_polygonRadius),be=.5*t.b2_linearSlop,Ie=20;let te=0;for(;te<Ie&&Ut.Length()-pe>be;){j.iterations+=1,Qt=W.GetSupport(e.b2Rot.TransposeMultiplyVec2(Q.q,e.b2Vec2.Negate(Ut,e.b2Vec2.s_t1),e.b2Vec2.s_t0)),Ct=e.b2Transform.MultiplyVec2(Q,W.GetVertex(Qt),L),se=tt.GetSupport(e.b2Rot.TransposeMultiplyVec2(nt.q,Ut,e.b2Vec2.s_t0)),It=e.b2Transform.MultiplyVec2(nt,tt.GetVertex(se),R);const zi=e.b2Vec2.Subtract(Ct,It,N);Ut.Normalize();const ai=e.b2Vec2.Dot(Ut,zi),Le=e.b2Vec2.Dot(Ut,ft);if(ai-pe>Tt*Le){if(Le<=0||(Tt=(ai-pe)/Le,Tt>1))return!1;e.b2Vec2.Negate(Ut,Mt),Vt.m_count=0}const we=ce[Vt.m_count];switch(we.indexA=se,e.b2Vec2.AddScaled(It,Tt,ft,we.wA),we.indexB=Qt,we.wB.Copy(Ct),e.b2Vec2.Subtract(we.wB,we.wA,we.w),we.a=1,Vt.m_count+=1,Vt.m_count){case 1:break;case 2:Vt.Solve2();break;case 3:Vt.Solve3();break}if(Vt.m_count===3)return!1;Vt.GetClosestPoint(Ut),++te}if(te===0)return!1;const Ue=G,fe=H;return Vt.GetWitnessPoints(Ue,fe),Ut.LengthSquared()>0&&(e.b2Vec2.Negate(Ut,Mt),Mt.Normalize()),e.b2Vec2.AddScaled(Ue,st,Mt,j.point),j.normal.Copy(Mt),j.lambda=Tt,j.iterations=te,!0}a.b2ShapeCast=k})(On);Object.defineProperty(yt,"__esModule",{value:!0});yt.b2ValidateHull=yt.b2ComputeHull=yt.b2TestOverlap=yt.b2ClipSegmentToLine=yt.b2AABB=yt.b2RayCastOutput=yt.b2RayCastInput=yt.b2ClipVertex=yt.b2GetPointStates=yt.b2PointState=yt.b2WorldManifold=yt.b2Manifold=yt.b2ManifoldType=yt.b2ManifoldPoint=yt.b2ContactID=yt.b2ContactFeature=yt.b2ContactFeatureType=void 0;const qt=jt,U=Dt,Jn=On,zs=Qe;var Bs;(function(a){a[a.e_vertex=0]="e_vertex",a[a.e_face=1]="e_face"})(Bs||(yt.b2ContactFeatureType=Bs={}));class ja{constructor(){this.m_key=0,this.m_key_invalid=!1,this.m_indexA=0,this.m_indexB=0,this.m_typeA=Bs.e_vertex,this.m_typeB=Bs.e_vertex}get key(){return this.m_key_invalid&&(this.m_key_invalid=!1,this.m_key=this.m_indexA|this.m_indexB<<8|this.m_typeA<<16|this.m_typeB<<24),this.m_key}set key(t){this.m_key=t,this.m_key_invalid=!1,this.m_indexA=this.m_key&255,this.m_indexB=this.m_key>>8&255,this.m_typeA=this.m_key>>16&255,this.m_typeB=this.m_key>>24&255}get indexA(){return this.m_indexA}set indexA(t){this.m_indexA=t,this.m_key_invalid=!0}get indexB(){return this.m_indexB}set indexB(t){this.m_indexB=t,this.m_key_invalid=!0}get typeA(){return this.m_typeA}set typeA(t){this.m_typeA=t,this.m_key_invalid=!0}get typeB(){return this.m_typeB}set typeB(t){this.m_typeB=t,this.m_key_invalid=!0}}yt.b2ContactFeature=ja;class Zs{constructor(){this.cf=new ja}Copy(t){return this.key=t.key,this}Clone(){return new Zs().Copy(this)}get key(){return this.cf.key}set key(t){this.cf.key=t}}yt.b2ContactID=Zs;class Oa{constructor(){this.localPoint=new U.b2Vec2,this.normalImpulse=0,this.tangentImpulse=0,this.id=new Zs}Reset(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}Copy(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}yt.b2ManifoldPoint=Oa;var ts;(function(a){a[a.e_circles=0]="e_circles",a[a.e_faceA=1]="e_faceA",a[a.e_faceB=2]="e_faceB"})(ts||(yt.b2ManifoldType=ts={}));class ir{constructor(){this.points=(0,qt.b2MakeArray)(qt.b2_maxManifoldPoints,Oa),this.localNormal=new U.b2Vec2,this.localPoint=new U.b2Vec2,this.type=ts.e_circles,this.pointCount=0}Reset(){for(let t=0;t<qt.b2_maxManifoldPoints;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=ts.e_circles,this.pointCount=0}Copy(t){this.pointCount=t.pointCount;for(let e=0;e<qt.b2_maxManifoldPoints;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}Clone(){return new ir().Copy(this)}}yt.b2Manifold=ir;class he{constructor(){this.normal=new U.b2Vec2,this.points=(0,qt.b2MakeArray)(qt.b2_maxManifoldPoints,U.b2Vec2),this.separations=(0,qt.b2MakeNumberArray)(qt.b2_maxManifoldPoints)}Initialize(t,e,n,c,r){if(t.pointCount!==0)switch(t.type){case ts.e_circles:{this.normal.Set(1,0);const m=U.b2Transform.MultiplyVec2(e,t.localPoint,he.Initialize_s_pointA),u=U.b2Transform.MultiplyVec2(c,t.points[0].localPoint,he.Initialize_s_pointB);U.b2Vec2.DistanceSquared(m,u)>qt.b2_epsilon_sq&&U.b2Vec2.Subtract(u,m,this.normal).Normalize();const p=U.b2Vec2.AddScaled(m,n,this.normal,he.Initialize_s_cA),b=U.b2Vec2.SubtractScaled(u,r,this.normal,he.Initialize_s_cB);U.b2Vec2.Mid(p,b,this.points[0]),this.separations[0]=U.b2Vec2.Dot(U.b2Vec2.Subtract(b,p,U.b2Vec2.s_t0),this.normal);break}case ts.e_faceA:{U.b2Rot.MultiplyVec2(e.q,t.localNormal,this.normal);const m=U.b2Transform.MultiplyVec2(e,t.localPoint,he.Initialize_s_planePoint);for(let u=0;u<t.pointCount;++u){const p=U.b2Transform.MultiplyVec2(c,t.points[u].localPoint,he.Initialize_s_clipPoint),b=n-U.b2Vec2.Dot(U.b2Vec2.Subtract(p,m,U.b2Vec2.s_t0),this.normal),d=U.b2Vec2.AddScaled(p,b,this.normal,he.Initialize_s_cA),A=U.b2Vec2.SubtractScaled(p,r,this.normal,he.Initialize_s_cB);U.b2Vec2.Mid(d,A,this.points[u]),this.separations[u]=U.b2Vec2.Dot(U.b2Vec2.Subtract(A,d,U.b2Vec2.s_t0),this.normal)}break}case ts.e_faceB:{U.b2Rot.MultiplyVec2(c.q,t.localNormal,this.normal);const m=U.b2Transform.MultiplyVec2(c,t.localPoint,he.Initialize_s_planePoint);for(let u=0;u<t.pointCount;++u){const p=U.b2Transform.MultiplyVec2(e,t.points[u].localPoint,he.Initialize_s_clipPoint),b=r-U.b2Vec2.Dot(U.b2Vec2.Subtract(p,m,U.b2Vec2.s_t0),this.normal),d=U.b2Vec2.AddScaled(p,b,this.normal,he.Initialize_s_cB),A=U.b2Vec2.SubtractScaled(p,n,this.normal,he.Initialize_s_cA);U.b2Vec2.Mid(A,d,this.points[u]),this.separations[u]=U.b2Vec2.Dot(U.b2Vec2.Subtract(A,d,U.b2Vec2.s_t0),this.normal)}this.normal.Negate();break}}}}yt.b2WorldManifold=he;he.Initialize_s_pointA=new U.b2Vec2;he.Initialize_s_pointB=new U.b2Vec2;he.Initialize_s_cA=new U.b2Vec2;he.Initialize_s_cB=new U.b2Vec2;he.Initialize_s_planePoint=new U.b2Vec2;he.Initialize_s_clipPoint=new U.b2Vec2;var Ei;(function(a){a[a.b2_nullState=0]="b2_nullState",a[a.b2_addState=1]="b2_addState",a[a.b2_persistState=2]="b2_persistState",a[a.b2_removeState=3]="b2_removeState"})(Ei||(yt.b2PointState=Ei={}));function Uc(a,t,e,n){let c;for(c=0;c<e.pointCount;++c){const{key:r}=e.points[c].id;a[c]=Ei.b2_removeState;for(let m=0;m<n.pointCount;++m)if(n.points[m].id.key===r){a[c]=Ei.b2_persistState;break}}for(;c<qt.b2_maxManifoldPoints;++c)a[c]=Ei.b2_nullState;for(c=0;c<n.pointCount;++c){const{key:r}=n.points[c].id;t[c]=Ei.b2_addState;for(let m=0;m<e.pointCount;++m)if(e.points[m].id.key===r){t[c]=Ei.b2_persistState;break}}for(;c<qt.b2_maxManifoldPoints;++c)t[c]=Ei.b2_nullState}yt.b2GetPointStates=Uc;class Kc{constructor(){this.v=new U.b2Vec2,this.id=new Zs}Copy(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}yt.b2ClipVertex=Kc;class tl{constructor(){this.p1=new U.b2Vec2,this.p2=new U.b2Vec2,this.maxFraction=1}Copy(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}yt.b2RayCastInput=tl;class el{constructor(){this.normal=new U.b2Vec2,this.fraction=0}Copy(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}yt.b2RayCastOutput=el;class Ja{constructor(){this.lowerBound=new U.b2Vec2,this.upperBound=new U.b2Vec2}Copy(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}IsValid(){return this.lowerBound.IsValid()&&this.upperBound.IsValid()&&this.upperBound.x>=this.lowerBound.x&&this.upperBound.y>=this.lowerBound.y}GetCenter(t){return U.b2Vec2.Mid(this.lowerBound,this.upperBound,t)}GetExtents(t){return U.b2Vec2.Extents(this.lowerBound,this.upperBound,t)}GetPerimeter(){const t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;return 2*(t+e)}Combine1(t){return this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this}Combine2(t,e){return this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y),this}static Combine(t,e,n){return n.Combine2(t,e),n}Contains(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y}RayCast(t,e){let n=-qt.b2_maxFloat,c=qt.b2_maxFloat;const r=e.p1.x,m=e.p1.y,u=e.p2.x-e.p1.x,p=e.p2.y-e.p1.y,b=Math.abs(u),d=Math.abs(p),{normal:A}=t;if(b<qt.b2_epsilon){if(r<this.lowerBound.x||this.upperBound.x<r)return!1}else{const y=1/u;let f=(this.lowerBound.x-r)*y,x=(this.upperBound.x-r)*y,S=-1;if(f>x){const V=f;f=x,x=V,S=1}if(f>n&&(A.x=S,A.y=0,n=f),c=Math.min(c,x),n>c)return!1}if(d<qt.b2_epsilon){if(m<this.lowerBound.y||this.upperBound.y<m)return!1}else{const y=1/p;let f=(this.lowerBound.y-m)*y,x=(this.upperBound.y-m)*y,S=-1;if(f>x){const V=f;f=x,x=V,S=1}if(f>n&&(A.x=0,A.y=S,n=f),c=Math.min(c,x),n>c)return!1}return n<0||e.maxFraction<n?!1:(t.fraction=n,!0)}TestContain(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)}TestOverlap(t){return!(this.upperBound.x<t.lowerBound.x||this.upperBound.y<t.lowerBound.y||t.upperBound.x<this.lowerBound.x||t.upperBound.y<this.lowerBound.y)}}yt.b2AABB=Ja;function il(a,[t,e],n,c,r){let m=0;const u=U.b2Vec2.Dot(n,t.v)-c,p=U.b2Vec2.Dot(n,e.v)-c;if(u<=0&&a[m++].Copy(t),p<=0&&a[m++].Copy(e),u*p<0){const b=u/(u-p),{v:d,id:A}=a[m];d.x=t.v.x+b*(e.v.x-t.v.x),d.y=t.v.y+b*(e.v.y-t.v.y),A.cf.indexA=r,A.cf.indexB=t.id.cf.indexB,A.cf.typeA=Bs.e_vertex,A.cf.typeB=Bs.e_face,++m}return m}yt.b2ClipSegmentToLine=il;const sl=new Jn.b2DistanceInput,nl=new Jn.b2SimplexCache,ol=new Jn.b2DistanceOutput;function rl(a,t,e,n,c,r){const m=sl.Reset();m.proxyA.SetShape(a,t),m.proxyB.SetShape(e,n),m.transformA.Copy(c),m.transformB.Copy(r),m.useRadii=!0;const u=nl.Reset();u.count=0;const p=ol.Reset();return(0,Jn.b2Distance)(p,u,m),p.distance<10*qt.b2_epsilon}yt.b2TestOverlap=rl;const al=new U.b2Vec2,la=new U.b2Vec2,$s=[];function Fn(a,t,e){if(e.length===0)return $s;const n=U.b2Vec2.Subtract(t,a,al);n.Normalize();const c=[];let r=0,m=U.b2Vec2.Cross(U.b2Vec2.Subtract(e[r],a,la),n);m>0&&c.push(e[r]);for(let A=1;A<e.length;++A){const y=U.b2Vec2.Cross(U.b2Vec2.Subtract(e[A],a,la),n);y>m&&(r=A,m=y),y>0&&c.push(e[A])}if(m<2*qt.b2_linearSlop)return $s;const u=e[r],p=Fn(a,u,c),b=Fn(u,t,c),d=[...p,u,...b];return(0,qt.b2Assert)(d.length<zs.b2_maxPolygonVertices),d}const ma=new U.b2Vec2,cl=new U.b2Vec2,ll=new U.b2Vec2,ml=new U.b2Vec2,hl=new Ja;function _l(a,t){if(t<3||t>zs.b2_maxPolygonVertices)return $s;t=Math.min(t,zs.b2_maxPolygonVertices);const e=hl;e.lowerBound.Set(qt.b2_maxFloat,qt.b2_maxFloat),e.upperBound.Set(-qt.b2_maxFloat,-qt.b2_maxFloat);const n=[],c=16*qt.b2_linearSlop*qt.b2_linearSlop;for(let w=0;w<t;++w){U.b2Vec2.Min(e.lowerBound,a[w],e.lowerBound),U.b2Vec2.Max(e.upperBound,a[w],e.upperBound);const M=a[w];let L=!0;for(let R=0;R<w;++R){const z=a[R];if(U.b2Vec2.DistanceSquared(M,z)<c){L=!1;break}}L&&n.push(M)}let r=n.length;if(r<3)return $s;const m=e.GetCenter(ll);let u=0,p=U.b2Vec2.DistanceSquared(m,n[u]);for(let w=1;w<r;++w){const M=U.b2Vec2.DistanceSquared(m,n[w]);M>p&&(u=w,p=M)}const b=n[u];n[u]=n[r-1],r-=1;let d=0,A=U.b2Vec2.DistanceSquared(b,n[d]);for(let w=1;w<r;++w){const M=U.b2Vec2.DistanceSquared(b,n[w]);M>A&&(d=w,A=M)}const y=n[d];n[d]=n[r-1],r-=1;const f=[],x=[],S=U.b2Vec2.Subtract(y,b,ma);S.Normalize();for(let w=0;w<r;++w){const M=U.b2Vec2.Cross(U.b2Vec2.Subtract(n[w],b,ml),S);M>=2*qt.b2_linearSlop?f.push(n[w]):M<=-2*qt.b2_linearSlop&&x.push(n[w])}const V=Fn(b,y,f),C=Fn(y,b,x);if(V.length===0&&C.length===0)return $s;const _=[b,...V,y,...C];(0,qt.b2Assert)(_.length<=zs.b2_maxPolygonVertices);let g=!0;for(;g&&_.length>2;){g=!1;for(let w=0;w<_.length;++w){const M=w,L=(w+1)%_.length,R=(w+2)%_.length,z=_[M],N=_[L],G=_[R],H=U.b2Vec2.Subtract(G,z,ma);H.Normalize();const k=U.b2Vec2.Subtract(N,z,cl);if(U.b2Vec2.Cross(k,H)<=2*qt.b2_linearSlop){_.splice(L,1),g=!0;break}}}return _.length<3&&(_.length=0),_}yt.b2ComputeHull=_l;const ha=new U.b2Vec2,_a=new U.b2Vec2;function ul(a,t){if(t<3||zs.b2_maxPolygonVertices<t)return!1;for(let e=0;e<t;++e){const n=e,c=e<t-1?n+1:0,r=a[n],m=U.b2Vec2.Subtract(a[c],r,ha);m.Normalize();for(let u=0;u<t;++u){if(u===n||u===c)continue;if(U.b2Vec2.Cross(U.b2Vec2.Subtract(a[u],r,_a),m)>=0)return!1}}for(let e=0;e<t;++e){const n=e,c=(e+1)%t,r=(e+2)%t,m=a[n],u=a[c],p=a[r],b=U.b2Vec2.Subtract(p,m,ha);if(b.Normalize(),U.b2Vec2.Cross(U.b2Vec2.Subtract(u,m,_a),b)<=qt.b2_linearSlop)return!1}return!0}yt.b2ValidateHull=ul;(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.b2Fixture=a.b2FixtureProxy=a.b2DefaultFilter=void 0;const t=Dt,e=yt,n=De,c=jt,r=Qe,m={c1:new t.b2Vec2,c2:new t.b2Vec2};a.b2DefaultFilter={categoryBits:1,maskBits:65535,groupIndex:0};class u{constructor(f,x,S,V){this.aabb=new e.b2AABB,this.fixture=f,this.childIndex=V,f.m_shape.ComputeAABB(this.aabb,S,V),this.treeNode=x.CreateProxy(this.aabb,this)}}a.b2FixtureProxy=u;const p=new e.b2AABB,b=new e.b2AABB,d=new t.b2Vec2;class A{get m_proxyCount(){return this.m_proxies.length}constructor(f,x){var S,V,C,_,g;this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_restitutionThreshold=0,this.m_proxies=[],this.m_isSensor=!1,this.m_userData={},this.m_body=f,this.m_shape=x.shape.Clone(),x.userData&&this.SetUserData(x.userData),this.m_friction=(S=x.friction)!==null&&S!==void 0?S:.2,this.m_restitution=(V=x.restitution)!==null&&V!==void 0?V:0,this.m_restitutionThreshold=(C=x.restitutionThreshold)!==null&&C!==void 0?C:r.b2_lengthUnitsPerMeter,this.m_filter={...a.b2DefaultFilter,...x.filter},this.m_isSensor=(_=x.isSensor)!==null&&_!==void 0?_:!1,this.m_density=(g=x.density)!==null&&g!==void 0?g:0}GetType(){return this.m_shape.GetType()}GetShape(){return this.m_shape}SetSensor(f){f!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=f)}IsSensor(){return this.m_isSensor}SetFilterData(f){var x,S,V;this.m_filter.categoryBits=(x=f.categoryBits)!==null&&x!==void 0?x:a.b2DefaultFilter.categoryBits,this.m_filter.groupIndex=(S=f.groupIndex)!==null&&S!==void 0?S:a.b2DefaultFilter.groupIndex,this.m_filter.maskBits=(V=f.maskBits)!==null&&V!==void 0?V:a.b2DefaultFilter.maskBits,this.Refilter()}GetFilterData(){return this.m_filter}Refilter(){let f=this.m_body.GetContactList();for(;f;){const{contact:V}=f,C=V.GetFixtureA(),_=V.GetFixtureB();(C===this||_===this)&&V.FlagForFiltering(),f=f.next}const S=this.m_body.GetWorld().m_contactManager.m_broadPhase;for(const V of this.m_proxies)S.TouchProxy(V.treeNode)}GetBody(){return this.m_body}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(f){Object.assign(this.m_userData,f)}TestPoint(f){return this.m_shape.TestPoint(this.m_body.GetTransform(),f)}RayCast(f,x,S){return this.m_shape.RayCast(f,x,this.m_body.GetTransform(),S)}GetMassData(f=new n.b2MassData){return this.m_shape.ComputeMass(f,this.m_density),f}SetDensity(f){this.m_density=f}GetDensity(){return this.m_density}GetFriction(){return this.m_friction}SetFriction(f){this.m_friction=f}GetRestitution(){return this.m_restitution}SetRestitution(f){this.m_restitution=f}GetRestitutionThreshold(){return this.m_restitutionThreshold}SetRestitutionThreshold(f){this.m_restitutionThreshold=f}GetAABB(f){return this.m_proxies[f].aabb}CreateProxies(f,x){(0,c.b2Assert)(this.m_proxies.length===0),this.m_proxies.length=this.m_shape.GetChildCount();for(let S=0;S<this.m_proxies.length;++S)this.m_proxies[S]=new u(this,f,x,S)}DestroyProxies(f){for(const x of this.m_proxies)f.DestroyProxy(x.treeNode);this.m_proxies.length=0}Synchronize(f,x,S){const{c1:V,c2:C}=m,_=d;for(const g of this.m_proxies){const w=p,M=b;this.m_shape.ComputeAABB(w,x,g.childIndex),this.m_shape.ComputeAABB(M,S,g.childIndex),g.aabb.Combine2(w,M),t.b2Vec2.Subtract(M.GetCenter(C),w.GetCenter(V),_),f.MoveProxy(g.treeNode,g.aabb,_)}}}a.b2Fixture=A})(er);Object.defineProperty(pi,"__esModule",{value:!0});pi.b2Body=pi.b2BodyType=void 0;const St=Dt,dl=De,pl=er,vs=jt;var ae;(function(a){a[a.b2_staticBody=0]="b2_staticBody",a[a.b2_kinematicBody=1]="b2_kinematicBody",a[a.b2_dynamicBody=2]="b2_dynamicBody"})(ae||(pi.b2BodyType=ae={}));class Xe{constructor(t,e){var n,c,r,m,u,p,b,d,A,y,f,x,S,V;this.m_type=ae.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_enabledFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new St.b2Transform,this.m_sweep=new St.b2Sweep,this.m_linearVelocity=new St.b2Vec2,this.m_angularVelocity=0,this.m_force=new St.b2Vec2,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData={},this.m_bulletFlag=(n=t.bullet)!==null&&n!==void 0?n:!1,this.m_fixedRotationFlag=(c=t.fixedRotation)!==null&&c!==void 0?c:!1,this.m_autoSleepFlag=(r=t.allowSleep)!==null&&r!==void 0?r:!0,(!((m=t.awake)!==null&&m!==void 0)||m)&&((u=t.type)!==null&&u!==void 0?u:ae.b2_staticBody)!==ae.b2_staticBody&&(this.m_awakeFlag=!0),this.m_enabledFlag=(p=t.enabled)!==null&&p!==void 0?p:!0,this.m_world=e,this.m_xf.p.Copy((b=t.position)!==null&&b!==void 0?b:St.b2Vec2.ZERO),this.m_xf.q.Set((d=t.angle)!==null&&d!==void 0?d:0),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy((A=t.linearVelocity)!==null&&A!==void 0?A:St.b2Vec2.ZERO),this.m_angularVelocity=(y=t.angularVelocity)!==null&&y!==void 0?y:0,this.m_linearDamping=(f=t.linearDamping)!==null&&f!==void 0?f:0,this.m_angularDamping=(x=t.angularDamping)!==null&&x!==void 0?x:0,this.m_gravityScale=(S=t.gravityScale)!==null&&S!==void 0?S:1,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=(V=t.type)!==null&&V!==void 0?V:ae.b2_staticBody,this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,t.userData&&this.SetUserData(t.userData),this.m_fixtureList=null,this.m_fixtureCount=0}CreateFixture(t){(0,vs.b2Assert)(!this.m_world.IsLocked());const e=new pl.b2Fixture(this,t);if(this.m_enabledFlag){const n=this.m_world.m_contactManager.m_broadPhase;e.CreateProxies(n,this.m_xf)}return e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newContacts=!0,e}DestroyFixture(t){(0,vs.b2Assert)(!this.m_world.IsLocked());let e=this.m_fixtureList,n=null;for(;e!==null;){if(e===t){n?n.m_next=t.m_next:this.m_fixtureList=t.m_next;break}n=e,e=e.m_next}const c=t.m_density;let r=this.m_contactList;for(;r;){const m=r.contact;r=r.next;const u=m.GetFixtureA(),p=m.GetFixtureB();(t===u||t===p)&&this.m_world.m_contactManager.Destroy(m)}if(this.m_enabledFlag){const m=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxies(m)}t.m_next=null,--this.m_fixtureCount,c>0&&this.ResetMassData()}SetTransformVec(t,e){this.SetTransformXY(t.x,t.y,e)}SetTransformXY(t,e,n){(0,vs.b2Assert)(!this.m_world.IsLocked()),this.m_xf.q.Set(n),this.m_xf.p.Set(t,e),St.b2Transform.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=n,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=n;const c=this.m_world.m_contactManager.m_broadPhase;for(let r=this.m_fixtureList;r;r=r.m_next)r.Synchronize(c,this.m_xf,this.m_xf);this.m_world.m_newContacts=!0}SetTransform(t){this.SetTransformVec(t.p,t.GetAngle())}GetTransform(){return this.m_xf}GetPosition(){return this.m_xf.p}GetAngle(){return this.m_sweep.a}SetAngle(t){this.SetTransformVec(this.GetPosition(),t)}GetWorldCenter(){return this.m_sweep.c}GetLocalCenter(){return this.m_sweep.localCenter}SetLinearVelocity(t){this.m_type!==ae.b2_staticBody&&(St.b2Vec2.Dot(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))}GetLinearVelocity(){return this.m_linearVelocity}SetAngularVelocity(t){this.m_type!==ae.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}GetAngularVelocity(){return this.m_angularVelocity}ApplyForce(t,e,n=!0){this.m_type===ae.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}ApplyForceToCenter(t,e=!0){this.m_type===ae.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}ApplyTorque(t,e=!0){this.m_type===ae.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}ApplyLinearImpulse(t,e,n=!0){this.m_type===ae.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}ApplyLinearImpulseToCenter(t,e=!0){this.m_type===ae.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}ApplyAngularImpulse(t,e=!0){this.m_type===ae.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}GetMass(){return this.m_mass}GetInertia(){return this.m_I+this.m_mass*St.b2Vec2.Dot(this.m_sweep.localCenter,this.m_sweep.localCenter)}GetMassData(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*St.b2Vec2.Dot(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}SetMassData(t){if((0,vs.b2Assert)(!this.m_world.IsLocked()),this.m_type!==ae.b2_dynamicBody)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*St.b2Vec2.Dot(t.center,t.center),this.m_invI=1/this.m_I);const e=Xe.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t.center),St.b2Transform.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),St.b2Vec2.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,St.b2Vec2.Subtract(this.m_sweep.c,e,St.b2Vec2.s_t0),this.m_linearVelocity)}ResetMassData(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===ae.b2_staticBody||this.m_type===ae.b2_kinematicBody){this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}const t=Xe.ResetMassData_s_localCenter.SetZero();for(let n=this.m_fixtureList;n;n=n.m_next){if(n.m_density===0)continue;const c=n.GetMassData(Xe.ResetMassData_s_massData);this.m_mass+=c.mass,t.AddScaled(c.mass,c.center),this.m_I+=c.I}this.m_mass>0&&(this.m_invMass=1/this.m_mass,t.Scale(this.m_invMass)),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*St.b2Vec2.Dot(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);const e=Xe.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t),St.b2Transform.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),St.b2Vec2.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,St.b2Vec2.Subtract(this.m_sweep.c,e,St.b2Vec2.s_t0),this.m_linearVelocity)}GetWorldPoint(t,e){return St.b2Transform.MultiplyVec2(this.m_xf,t,e)}GetWorldVector(t,e){return St.b2Rot.MultiplyVec2(this.m_xf.q,t,e)}GetLocalPoint(t,e){return St.b2Transform.TransposeMultiplyVec2(this.m_xf,t,e)}GetLocalVector(t,e){return St.b2Rot.TransposeMultiplyVec2(this.m_xf.q,t,e)}GetLinearVelocityFromWorldPoint(t,e){return St.b2Vec2.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,St.b2Vec2.Subtract(t,this.m_sweep.c,St.b2Vec2.s_t0),e)}GetLinearVelocityFromLocalPoint(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}GetLinearDamping(){return this.m_linearDamping}SetLinearDamping(t){this.m_linearDamping=t}GetAngularDamping(){return this.m_angularDamping}SetAngularDamping(t){this.m_angularDamping=t}GetGravityScale(){return this.m_gravityScale}SetGravityScale(t){this.m_gravityScale=t}SetType(t){if((0,vs.b2Assert)(!this.m_world.IsLocked()),this.m_type===t)return;this.m_type=t,this.ResetMassData(),this.m_type===ae.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_awakeFlag=!1,this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;let e=this.m_contactList;for(;e;){const c=e;e=e.next,this.m_world.m_contactManager.Destroy(c.contact)}this.m_contactList=null;const n=this.m_world.m_contactManager.m_broadPhase;for(let c=this.m_fixtureList;c;c=c.m_next)for(const r of c.m_proxies)n.TouchProxy(r.treeNode)}GetType(){return this.m_type}SetBullet(t){this.m_bulletFlag=t}IsBullet(){return this.m_bulletFlag}SetSleepingAllowed(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}IsSleepingAllowed(){return this.m_autoSleepFlag}SetAwake(t){this.m_type!==ae.b2_staticBody&&(t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0))}IsAwake(){return this.m_awakeFlag}SetEnabled(t){if((0,vs.b2Assert)(!this.m_world.IsLocked()),t===this.IsEnabled())return;this.m_enabledFlag=t;const e=this.m_world.m_contactManager.m_broadPhase;if(t){for(let n=this.m_fixtureList;n;n=n.m_next)n.CreateProxies(e,this.m_xf);this.m_world.m_newContacts=!0}else{for(let c=this.m_fixtureList;c;c=c.m_next)c.DestroyProxies(e);let n=this.m_contactList;for(;n;){const c=n;n=n.next,this.m_world.m_contactManager.Destroy(c.contact)}this.m_contactList=null}}IsEnabled(){return this.m_enabledFlag}SetFixedRotation(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}IsFixedRotation(){return this.m_fixedRotationFlag}GetFixtureList(){return this.m_fixtureList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactList}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){Object.assign(this.m_userData,t)}GetWorld(){return this.m_world}SynchronizeFixtures(){const t=this.m_world.m_contactManager.m_broadPhase;if(this.m_awakeFlag){const e=Xe.SynchronizeFixtures_s_xf1;e.q.Set(this.m_sweep.a0),St.b2Rot.MultiplyVec2(e.q,this.m_sweep.localCenter,e.p),St.b2Vec2.Subtract(this.m_sweep.c0,e.p,e.p);for(let n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(t,e,this.m_xf)}else for(let e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(t,this.m_xf,this.m_xf)}SynchronizeTransform(){this.m_xf.q.Set(this.m_sweep.a),St.b2Rot.MultiplyVec2(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),St.b2Vec2.Subtract(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}ShouldCollide(t){return this.m_type!==ae.b2_dynamicBody&&t.m_type!==ae.b2_dynamicBody?!1:this.ShouldCollideConnected(t)}ShouldCollideConnected(t){for(let e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}Advance(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.Set(this.m_sweep.a),St.b2Rot.MultiplyVec2(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),St.b2Vec2.Subtract(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}}pi.b2Body=Xe;Xe.SetMassData_s_oldCenter=new St.b2Vec2;Xe.ResetMassData_s_localCenter=new St.b2Vec2;Xe.ResetMassData_s_oldCenter=new St.b2Vec2;Xe.ResetMassData_s_massData=new dl.b2MassData;Xe.SynchronizeFixtures_s_xf1=new St.b2Transform;Object.defineProperty(Re,"__esModule",{value:!0});Re.DrawCenterOfMasses=Re.DrawAABBs=Re.DrawPairs=Re.DrawJoints=Re.DrawShapes=Re.GetShapeColor=void 0;const Pn=Dt,ji=Ge,Co=pi,bl=jt,Rn={cA:new Pn.b2Vec2,cB:new Pn.b2Vec2,vs:(0,bl.b2MakeArray)(4,Pn.b2Vec2),xf:new Pn.b2Transform};function qa(a){return a.GetType()===Co.b2BodyType.b2_dynamicBody&&a.m_mass===0?ji.debugColors.badBody:a.IsEnabled()?a.GetType()===Co.b2BodyType.b2_staticBody?ji.debugColors.staticBody:a.GetType()===Co.b2BodyType.b2_kinematicBody?ji.debugColors.kinematicBody:a.IsAwake()?ji.debugColors.body:ji.debugColors.sleepingBody:ji.debugColors.disabledBody}Re.GetShapeColor=qa;function fl(a,t){for(let e=0;e<a.m_proxyCount;e++)if(t.TestOverlap(a.GetAABB(e)))return!0;return!1}function yl(a,t,e){for(let n=t.GetBodyList();n;n=n.m_next){const c=n.m_xf;a.PushTransform(c);for(let r=n.GetFixtureList();r;r=r.m_next)e&&!fl(r,e)||r.GetShape().Draw(a,qa(n));a.PopTransform(c)}}Re.DrawShapes=yl;function vl(a,t){for(let e=t.GetJointList();e;e=e.m_next)e.Draw(a)}Re.DrawJoints=vl;function Al(a,t){for(let e=t.GetContactList();e;e=e.m_next){const n=e.GetFixtureA(),c=e.GetFixtureB(),r=e.GetChildIndexA(),m=e.GetChildIndexB(),u=n.GetAABB(r).GetCenter(Rn.cA),p=c.GetAABB(m).GetCenter(Rn.cB);a.DrawSegment(u,p,ji.debugColors.pair)}}Re.DrawPairs=Al;function wl(a,t,e){const{vs:n}=Rn;for(let c=t.GetBodyList();c;c=c.m_next)if(c.IsEnabled())for(let r=c.GetFixtureList();r;r=r.m_next)for(let m=0;m<r.m_proxyCount;++m){const{aabb:u}=r.m_proxies[m].treeNode;e&&!e.TestOverlap(u)||(n[0].Set(u.lowerBound.x,u.lowerBound.y),n[1].Set(u.upperBound.x,u.lowerBound.y),n[2].Set(u.upperBound.x,u.upperBound.y),n[3].Set(u.lowerBound.x,u.upperBound.y),a.DrawPolygon(n,4,ji.debugColors.aabb))}}Re.DrawAABBs=wl;function gl(a,t){const{xf:e}=Rn;for(let n=t.GetBodyList();n;n=n.m_next)e.q.Copy(n.m_xf.q),e.p.Copy(n.GetWorldCenter()),a.DrawTransform(e)}Re.DrawCenterOfMasses=gl;var hs={};Object.defineProperty(hs,"__esModule",{value:!0});hs.b2Timer=void 0;class xl{constructor(){this.m_start=performance.now()}Reset(){return this.m_start=performance.now(),this}GetMilliseconds(){return performance.now()-this.m_start}}hs.b2Timer=xl;var qn={};Object.defineProperty(qn,"__esModule",{value:!0});qn.b2_augment=void 0;function Sl(a,t){for(const e of Object.keys(t)){const n=t[e],c=a[e],r=function(...m){return n.call(this,c.bind(this),...m)};Object.defineProperty(r,"name",{value:e}),a[e]=r}}qn.b2_augment=Sl;var za={};Object.defineProperty(za,"__esModule",{value:!0});var Xs={},es={};Object.defineProperty(es,"__esModule",{value:!0});es.b2DynamicTree=es.b2TreeNode=void 0;const Zt=jt,le=Dt,Ki=yt,Si={stack:[],t:new le.b2Vec2,r:new le.b2Vec2,v:new le.b2Vec2,abs_v:new le.b2Vec2,segmentAABB:new Ki.b2AABB,subInput:new Ki.b2RayCastInput,combinedAABB:new Ki.b2AABB,aabb:new Ki.b2AABB,fatAABB:new Ki.b2AABB,hugeAABB:new Ki.b2AABB,c:new le.b2Vec2,h:new le.b2Vec2};let Bl=0;class $a{constructor(){this.aabb=new Ki.b2AABB,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.moved=!1,this.id=Bl++}Reset(){this.child1=null,this.child2=null,this.height=-1,this.userData=null}IsLeaf(){return this.child1===null}GetArea(){if(this.IsLeaf())return 0;let t=this.aabb.GetPerimeter();return this.child1&&(t+=this.child1.GetArea()),this.child2&&(t+=this.child2.GetArea()),t}ComputeHeight(){if(this.IsLeaf())return 0;(0,Zt.b2Assert)(this.child1!==null&&this.child2!==null);const t=(0,Zt.b2Verify)(this.child1).ComputeHeight(),e=(0,Zt.b2Verify)(this.child2).ComputeHeight();return 1+Math.max(t,e)}GetMaxBalance(){if(this.height<=1)return 0;const t=(0,Zt.b2Verify)(this.child1),e=(0,Zt.b2Verify)(this.child2);return Math.max(t.GetMaxBalance(),e.GetMaxBalance(),Math.abs(e.height-t.height))}ShiftOrigin(t){this.height<=1||((0,Zt.b2Verify)(this.child1).ShiftOrigin(t),(0,Zt.b2Verify)(this.child2).ShiftOrigin(t),this.aabb.lowerBound.Subtract(t),this.aabb.upperBound.Subtract(t))}}es.b2TreeNode=$a;class Vl{constructor(){this.m_root=null,this.m_freeList=null}Query(t,e){const n=Si.stack;n.length=0;let c=this.m_root;for(;c;){if(c.aabb.TestOverlap(t))if(c.IsLeaf()){if(!e(c))return}else n.push(c.child1),n.push(c.child2);c=n.pop()}}QueryPoint(t,e){const n=Si.stack;n.length=0;let c=this.m_root;for(;c;){if(c.aabb.TestContain(t))if(c.IsLeaf()){if(!e(c))return}else n.push(c.child1),n.push(c.child2);c=n.pop()}}RayCast(t,e){const{p1:n,p2:c}=t,r=le.b2Vec2.Subtract(c,n,Si.r);r.Normalize();const m=le.b2Vec2.CrossOneVec2(r,Si.v),u=m.GetAbs(Si.abs_v);let{maxFraction:p}=t;const{segmentAABB:b,subInput:d,c:A,h:y,t:f}=Si;le.b2Vec2.AddScaled(n,p,le.b2Vec2.Subtract(c,n,f),f),le.b2Vec2.Min(n,f,b.lowerBound),le.b2Vec2.Max(n,f,b.upperBound);const x=Si.stack;x.length=0;let S=this.m_root;for(;S;){if(!S.aabb.TestOverlap(b)){S=x.pop();continue}if(S.aabb.GetCenter(A),S.aabb.GetExtents(y),Math.abs(le.b2Vec2.Dot(m,le.b2Vec2.Subtract(n,A,le.b2Vec2.s_t0)))-le.b2Vec2.Dot(u,y)>0){S=x.pop();continue}if(S.IsLeaf()){d.p1.Copy(t.p1),d.p2.Copy(t.p2),d.maxFraction=p;const C=e(d,S);if(C===0)return;C>0&&(p=C,le.b2Vec2.AddScaled(n,p,le.b2Vec2.Subtract(c,n,f),f),le.b2Vec2.Min(n,f,b.lowerBound),le.b2Vec2.Max(n,f,b.upperBound))}else x.push(S.child1),x.push(S.child2);S=x.pop()}}AllocateNode(){if(this.m_freeList===null)return new $a;const t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,t.moved=!1,t}FreeNode(t){t.parent=this.m_freeList,t.Reset(),this.m_freeList=t}CreateProxy(t,e){const n=this.AllocateNode(),c=Zt.b2_aabbExtension;return n.aabb.lowerBound.Set(t.lowerBound.x-c,t.lowerBound.y-c),n.aabb.upperBound.Set(t.upperBound.x+c,t.upperBound.y+c),n.userData=e,n.height=0,n.moved=!0,this.InsertLeaf(n),n}DestroyProxy(t){this.RemoveLeaf(t),this.FreeNode(t)}MoveProxy(t,e,n){const{fatAABB:c,hugeAABB:r}=Si,m=Zt.b2_aabbExtension;c.lowerBound.Set(e.lowerBound.x-m,e.lowerBound.y-m),c.upperBound.Set(e.upperBound.x+m,e.upperBound.y+m);const u=Zt.b2_aabbMultiplier*n.x,p=Zt.b2_aabbMultiplier*n.y;u<0?c.lowerBound.x+=u:c.upperBound.x+=u,p<0?c.lowerBound.y+=p:c.upperBound.y+=p;const b=t.aabb;if(b.Contains(e)){const d=4*Zt.b2_aabbExtension;if(r.lowerBound.Set(c.lowerBound.x-d,e.lowerBound.y-d),r.upperBound.Set(c.upperBound.x+d,e.upperBound.y+d),r.Contains(b))return!1}return this.RemoveLeaf(t),t.aabb.Copy(c),this.InsertLeaf(t),t.moved=!0,!0}InsertLeaf(t){if(this.m_root===null){this.m_root=t,this.m_root.parent=null;return}const{combinedAABB:e,aabb:n}=Si,c=t.aabb;let r=this.m_root;for(;!r.IsLeaf();){const b=(0,Zt.b2Verify)(r.child1),d=(0,Zt.b2Verify)(r.child2),A=r.aabb.GetPerimeter();e.Combine2(r.aabb,c);const y=e.GetPerimeter(),f=2*y,x=2*(y-A);let S,V,C;b.IsLeaf()?(n.Combine2(c,b.aabb),S=n.GetPerimeter()+x):(n.Combine2(c,b.aabb),V=b.aabb.GetPerimeter(),C=n.GetPerimeter(),S=C-V+x);let _;if(d.IsLeaf()?(n.Combine2(c,d.aabb),_=n.GetPerimeter()+x):(n.Combine2(c,d.aabb),V=d.aabb.GetPerimeter(),C=n.GetPerimeter(),_=C-V+x),f<S&&f<_)break;S<_?r=b:r=d}const m=r.parent,u=this.AllocateNode();u.parent=m,u.userData=null,u.aabb.Combine2(c,r.aabb),u.height=r.height+1,m!==null?(m.child1===r?m.child1=u:m.child2=u,u.child1=r,u.child2=t,r.parent=u,t.parent=u):(u.child1=r,u.child2=t,r.parent=u,t.parent=u,this.m_root=u);let p=t.parent;for(;p!==null;){p=this.Balance(p);const b=(0,Zt.b2Verify)(p.child1),d=(0,Zt.b2Verify)(p.child2);p.height=1+Math.max(b.height,d.height),p.aabb.Combine2(b.aabb,d.aabb),p=p.parent}}RemoveLeaf(t){if(t===this.m_root){this.m_root=null;return}const e=(0,Zt.b2Verify)(t.parent),n=e.parent,c=(0,Zt.b2Verify)(e.child1===t?e.child2:e.child1);if(n!==null){n.child1===e?n.child1=c:n.child2=c,c.parent=n,this.FreeNode(e);let r=n;for(;r!==null;){r=this.Balance(r);const m=(0,Zt.b2Verify)(r.child1),u=(0,Zt.b2Verify)(r.child2);r.aabb.Combine2(m.aabb,u.aabb),r.height=1+Math.max(m.height,u.height),r=r.parent}}else this.m_root=c,c.parent=null,this.FreeNode(e)}Balance(t){if(t.IsLeaf()||t.height<2)return t;const e=(0,Zt.b2Verify)(t.child1),n=(0,Zt.b2Verify)(t.child2),c=n.height-e.height;if(c>1){const r=(0,Zt.b2Verify)(n.child1),m=(0,Zt.b2Verify)(n.child2);return n.child1=t,n.parent=t.parent,t.parent=n,n.parent!==null?n.parent.child1===t?n.parent.child1=n:n.parent.child2=n:this.m_root=n,r.height>m.height?(n.child2=r,t.child2=m,m.parent=t,t.aabb.Combine2(e.aabb,m.aabb),n.aabb.Combine2(t.aabb,r.aabb),t.height=1+Math.max(e.height,m.height),n.height=1+Math.max(t.height,r.height)):(n.child2=m,t.child2=r,r.parent=t,t.aabb.Combine2(e.aabb,r.aabb),n.aabb.Combine2(t.aabb,m.aabb),t.height=1+Math.max(e.height,r.height),n.height=1+Math.max(t.height,m.height)),n}if(c<-1){const r=(0,Zt.b2Verify)(e.child1),m=(0,Zt.b2Verify)(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,e.parent!==null?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,r.height>m.height?(e.child2=r,t.child1=m,m.parent=t,t.aabb.Combine2(n.aabb,m.aabb),e.aabb.Combine2(t.aabb,r.aabb),t.height=1+Math.max(n.height,m.height),e.height=1+Math.max(t.height,r.height)):(e.child2=m,t.child1=r,r.parent=t,t.aabb.Combine2(n.aabb,r.aabb),e.aabb.Combine2(t.aabb,m.aabb),t.height=1+Math.max(n.height,r.height),e.height=1+Math.max(t.height,m.height)),e}return t}GetHeight(){return this.m_root===null?0:this.m_root.height}GetAreaRatio(){if(this.m_root===null)return 0;const t=this.m_root,e=t.aabb.GetPerimeter();return t.GetArea()/e}GetMaxBalance(){return this.m_root===null?0:this.m_root.GetMaxBalance()}ShiftOrigin(t){var e;(e=this.m_root)===null||e===void 0||e.ShiftOrigin(t)}}es.b2DynamicTree=Vl;Object.defineProperty(Xs,"__esModule",{value:!0});Xs.b2BroadPhase=void 0;const ua=jt,da=es;class Cl{constructor(){this.m_tree=new da.b2DynamicTree,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[],this.m_queryProxy=new da.b2TreeNode,this.QueryCallback=t=>(t.id===this.m_queryProxy.id||t.moved&&t.id>this.m_queryProxy.id||(this.m_pairBuffer[this.m_pairCount]=t.id<this.m_queryProxy.id?[t,this.m_queryProxy]:[this.m_queryProxy,t],++this.m_pairCount),!0)}CreateProxy(t,e){const n=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(n),n}DestroyProxy(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}MoveProxy(t,e,n){this.m_tree.MoveProxy(t,e,n)&&this.BufferMove(t)}TouchProxy(t){this.BufferMove(t)}GetProxyCount(){return this.m_proxyCount}UpdatePairs(t){this.m_pairCount=0;for(let e=0;e<this.m_moveCount;++e){const n=this.m_moveBuffer[e];if(n===null)continue;this.m_queryProxy=n;const c=n.aabb;this.m_tree.Query(c,this.QueryCallback)}for(let e=0;e<this.m_pairCount;++e){const n=this.m_pairBuffer[e],c=(0,ua.b2Verify)(n[0].userData),r=(0,ua.b2Verify)(n[1].userData);t(c,r)}for(let e=0;e<this.m_moveCount;++e){const n=this.m_moveBuffer[e];n&&(n.moved=!1)}this.m_moveCount=0}Query(t,e){this.m_tree.Query(t,e)}QueryPoint(t,e){this.m_tree.QueryPoint(t,e)}RayCast(t,e){this.m_tree.RayCast(t,e)}GetTreeHeight(){return this.m_tree.GetHeight()}GetTreeBalance(){return this.m_tree.GetMaxBalance()}GetTreeQuality(){return this.m_tree.GetAreaRatio()}ShiftOrigin(t){this.m_tree.ShiftOrigin(t)}BufferMove(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}UnBufferMove(t){const e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null}}Xs.b2BroadPhase=Cl;var sr={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.b2TimeOfImpact=a.b2TOIOutput=a.b2TOIOutputState=a.b2TOIInput=a.b2Toi=void 0;const t=jt,e=Qe,n=Dt,c=hs,r=On;a.b2Toi={time:0,maxTime:0,calls:0,iters:0,maxIters:0,rootIters:0,maxRootIters:0,reset(){this.time=0,this.maxTime=0,this.calls=0,this.iters=0,this.maxIters=0,this.rootIters=0,this.maxRootIters=0}};const m=new n.b2Transform,u=new n.b2Transform,p=new n.b2Vec2,b=new n.b2Vec2,d=new n.b2Vec2,A=new n.b2Vec2,y=new n.b2Vec2;class f{constructor(){this.proxyA=new r.b2DistanceProxy,this.proxyB=new r.b2DistanceProxy,this.sweepA=new n.b2Sweep,this.sweepB=new n.b2Sweep,this.tMax=0}}a.b2TOIInput=f;var x;(function(k){k[k.e_unknown=0]="e_unknown",k[k.e_failed=1]="e_failed",k[k.e_overlapped=2]="e_overlapped",k[k.e_touching=3]="e_touching",k[k.e_separated=4]="e_separated"})(x||(a.b2TOIOutputState=x={}));class S{constructor(){this.state=x.e_unknown,this.t=0}}a.b2TOIOutput=S;var V;(function(k){k[k.e_points=0]="e_points",k[k.e_faceA=1]="e_faceA",k[k.e_faceB=2]="e_faceB"})(V||(V={}));class C{constructor(){this.m_sweepA=new n.b2Sweep,this.m_sweepB=new n.b2Sweep,this.m_type=V.e_points,this.m_localPoint=new n.b2Vec2,this.m_axis=new n.b2Vec2}Initialize(j,O,W,tt,st,_t){this.m_proxyA=O,this.m_proxyB=tt;const{count:pt}=j;this.m_sweepA.Copy(W),this.m_sweepB.Copy(st);const Q=this.m_sweepA.GetTransform(m,_t),nt=this.m_sweepB.GetTransform(u,_t);if(pt===1){this.m_type=V.e_points;const se=this.m_proxyA.GetVertex(j.indexA[0]),It=this.m_proxyB.GetVertex(j.indexB[0]),Ut=n.b2Transform.MultiplyVec2(Q,se,p),pe=n.b2Transform.MultiplyVec2(nt,It,b);return n.b2Vec2.Subtract(pe,Ut,this.m_axis),this.m_axis.Normalize()}if(j.indexA[0]===j.indexA[1]){this.m_type=V.e_faceB;const se=this.m_proxyB.GetVertex(j.indexB[0]),It=this.m_proxyB.GetVertex(j.indexB[1]);n.b2Vec2.CrossVec2One(n.b2Vec2.Subtract(It,se,n.b2Vec2.s_t0),this.m_axis).Normalize();const Ut=n.b2Rot.MultiplyVec2(nt.q,this.m_axis,d);n.b2Vec2.Mid(se,It,this.m_localPoint);const pe=n.b2Transform.MultiplyVec2(nt,this.m_localPoint,b),be=this.m_proxyA.GetVertex(j.indexA[0]),Ie=n.b2Transform.MultiplyVec2(Q,be,p);let te=n.b2Vec2.Dot(n.b2Vec2.Subtract(Ie,pe,n.b2Vec2.s_t0),Ut);return te<0&&(this.m_axis.Negate(),te=-te),te}this.m_type=V.e_faceA;const ft=this.m_proxyA.GetVertex(j.indexA[0]),Mt=this.m_proxyA.GetVertex(j.indexA[1]);n.b2Vec2.CrossVec2One(n.b2Vec2.Subtract(Mt,ft,n.b2Vec2.s_t0),this.m_axis).Normalize();const Tt=n.b2Rot.MultiplyVec2(Q.q,this.m_axis,d);n.b2Vec2.Mid(ft,Mt,this.m_localPoint);const Vt=n.b2Transform.MultiplyVec2(Q,this.m_localPoint,p),ce=this.m_proxyB.GetVertex(j.indexB[0]),Qt=n.b2Transform.MultiplyVec2(nt,ce,b);let Ct=n.b2Vec2.Dot(n.b2Vec2.Subtract(Qt,Vt,n.b2Vec2.s_t0),Tt);return Ct<0&&(this.m_axis.Negate(),Ct=-Ct),Ct}FindMinSeparation(j,O,W){const tt=this.m_sweepA.GetTransform(m,W),st=this.m_sweepB.GetTransform(u,W);switch(this.m_type){case V.e_points:{const _t=n.b2Rot.TransposeMultiplyVec2(tt.q,this.m_axis,A),pt=n.b2Rot.TransposeMultiplyVec2(st.q,n.b2Vec2.Negate(this.m_axis,n.b2Vec2.s_t0),y);j[0]=this.m_proxyA.GetSupport(_t),O[0]=this.m_proxyB.GetSupport(pt);const Q=this.m_proxyA.GetVertex(j[0]),nt=this.m_proxyB.GetVertex(O[0]),ft=n.b2Transform.MultiplyVec2(tt,Q,p),Mt=n.b2Transform.MultiplyVec2(st,nt,b);return n.b2Vec2.Dot(n.b2Vec2.Subtract(Mt,ft,n.b2Vec2.s_t0),this.m_axis)}case V.e_faceA:{const _t=n.b2Rot.MultiplyVec2(tt.q,this.m_axis,d),pt=n.b2Transform.MultiplyVec2(tt,this.m_localPoint,p),Q=n.b2Rot.TransposeMultiplyVec2(st.q,n.b2Vec2.Negate(_t,n.b2Vec2.s_t0),y);j[0]=-1,O[0]=this.m_proxyB.GetSupport(Q);const nt=this.m_proxyB.GetVertex(O[0]),ft=n.b2Transform.MultiplyVec2(st,nt,b);return n.b2Vec2.Dot(n.b2Vec2.Subtract(ft,pt,n.b2Vec2.s_t0),_t)}case V.e_faceB:{const _t=n.b2Rot.MultiplyVec2(st.q,this.m_axis,d),pt=n.b2Transform.MultiplyVec2(st,this.m_localPoint,b),Q=n.b2Rot.TransposeMultiplyVec2(tt.q,n.b2Vec2.Negate(_t,n.b2Vec2.s_t0),A);O[0]=-1,j[0]=this.m_proxyA.GetSupport(Q);const nt=this.m_proxyA.GetVertex(j[0]),ft=n.b2Transform.MultiplyVec2(tt,nt,p);return n.b2Vec2.Dot(n.b2Vec2.Subtract(ft,pt,n.b2Vec2.s_t0),_t)}default:return j[0]=-1,O[0]=-1,0}}Evaluate(j,O,W){const tt=this.m_sweepA.GetTransform(m,W),st=this.m_sweepB.GetTransform(u,W);switch(this.m_type){case V.e_points:{const _t=this.m_proxyA.GetVertex(j),pt=this.m_proxyB.GetVertex(O),Q=n.b2Transform.MultiplyVec2(tt,_t,p),nt=n.b2Transform.MultiplyVec2(st,pt,b);return n.b2Vec2.Dot(n.b2Vec2.Subtract(nt,Q,n.b2Vec2.s_t0),this.m_axis)}case V.e_faceA:{const _t=n.b2Rot.MultiplyVec2(tt.q,this.m_axis,d),pt=n.b2Transform.MultiplyVec2(tt,this.m_localPoint,p),Q=this.m_proxyB.GetVertex(O),nt=n.b2Transform.MultiplyVec2(st,Q,b);return n.b2Vec2.Dot(n.b2Vec2.Subtract(nt,pt,n.b2Vec2.s_t0),_t)}case V.e_faceB:{const _t=n.b2Rot.MultiplyVec2(st.q,this.m_axis,d),pt=n.b2Transform.MultiplyVec2(st,this.m_localPoint,b),Q=this.m_proxyA.GetVertex(j),nt=n.b2Transform.MultiplyVec2(tt,Q,p);return n.b2Vec2.Dot(n.b2Vec2.Subtract(nt,pt,n.b2Vec2.s_t0),_t)}default:return(0,t.b2Assert)(!1),0}}}const _=new c.b2Timer,g=new r.b2SimplexCache,w=new r.b2DistanceInput,M=new r.b2DistanceOutput,L=new C,R=[0],z=[0],N=new n.b2Sweep,G=new n.b2Sweep;function H(k,j){const O=_.Reset();++a.b2Toi.calls,k.state=x.e_unknown,k.t=j.tMax;const{proxyA:W,proxyB:tt,tMax:st}=j,_t=Math.max(e.b2_maxPolygonVertices,W.m_count,tt.m_count),pt=N.Copy(j.sweepA),Q=G.Copy(j.sweepB);pt.Normalize(),Q.Normalize();const nt=W.m_radius+tt.m_radius,ft=Math.max(t.b2_linearSlop,nt-3*t.b2_linearSlop),Mt=.25*t.b2_linearSlop;let Tt=0;const Vt=20;let ce=0;const Qt=g;Qt.count=0;const Ct=w;for(Ct.proxyA.Copy(j.proxyA),Ct.proxyB.Copy(j.proxyB),Ct.useRadii=!1;;){const It=pt.GetTransform(m,Tt),Ut=Q.GetTransform(u,Tt);Ct.transformA.Copy(It),Ct.transformB.Copy(Ut);const pe=M;if((0,r.b2Distance)(pe,Qt,Ct),pe.distance<=0){k.state=x.e_overlapped,k.t=0;break}if(pe.distance<ft+Mt){k.state=x.e_touching,k.t=Tt;break}const be=L;be.Initialize(Qt,W,pt,tt,Q,Tt);let Ie=!1,te=st,Ue=0;for(;;){const fe=R,zi=z;let ai=be.FindMinSeparation(fe,zi,te);if(ai>ft+Mt){k.state=x.e_separated,k.t=st,Ie=!0;break}if(ai>ft-Mt){Tt=te;break}let Le=be.Evaluate(fe[0],zi[0],Tt);if(Le<ft-Mt){k.state=x.e_failed,k.t=Tt,Ie=!0;break}if(Le<=ft+Mt){k.state=x.e_touching,k.t=Tt,Ie=!0;break}let we=0,ge=Tt,$i=te;for(;;){let ci;we&1?ci=ge+(ft-Le)*($i-ge)/(ai-Le):ci=.5*(ge+$i),++we,++a.b2Toi.rootIters;const li=be.Evaluate(fe[0],zi[0],ci);if(Math.abs(li-ft)<Mt){te=ci;break}if(li>ft?(ge=ci,Le=li):($i=ci,ai=li),we===50)break}if(a.b2Toi.maxRootIters=Math.max(a.b2Toi.maxRootIters,we),++Ue,Ue===_t)break}if(++ce,++a.b2Toi.iters,Ie)break;if(ce===Vt){k.state=x.e_failed,k.t=Tt;break}}a.b2Toi.maxIters=Math.max(a.b2Toi.maxIters,ce);const se=O.GetMilliseconds();a.b2Toi.maxTime=Math.max(a.b2Toi.maxTime,se),a.b2Toi.time+=se}a.b2TimeOfImpact=H})(sr);var Ji={};Object.defineProperty(Ji,"__esModule",{value:!0});Ji.b2CollidePolygonAndCircle=Ji.b2CollideCircles=void 0;const pa=jt,Rt=Dt,Js=yt,Ml=new Rt.b2Vec2,Il=new Rt.b2Vec2;function Pl(a,t,e,n,c){a.pointCount=0;const r=Rt.b2Transform.MultiplyVec2(e,t.m_p,Ml),m=Rt.b2Transform.MultiplyVec2(c,n.m_p,Il),u=Rt.b2Vec2.DistanceSquared(r,m),p=t.m_radius+n.m_radius;u>p*p||(a.type=Js.b2ManifoldType.e_circles,a.localPoint.Copy(t.m_p),a.localNormal.SetZero(),a.pointCount=1,a.points[0].localPoint.Copy(n.m_p),a.points[0].id.key=0)}Ji.b2CollideCircles=Pl;const Tl=new Rt.b2Vec2,Dl=new Rt.b2Vec2,Gl=new Rt.b2Vec2;function Ll(a,t,e,n,c){a.pointCount=0;const r=Rt.b2Transform.MultiplyVec2(c,n.m_p,Tl),m=Rt.b2Transform.TransposeMultiplyVec2(e,r,Dl);let u=0,p=-pa.b2_maxFloat;const b=t.m_radius+n.m_radius,d=t.m_count,A=t.m_vertices,y=t.m_normals;for(let g=0;g<d;++g){const w=Rt.b2Vec2.Dot(y[g],Rt.b2Vec2.Subtract(m,A[g],Rt.b2Vec2.s_t0));if(w>b)return;w>p&&(p=w,u=g)}const f=u,x=f+1<d?f+1:0,S=A[f],V=A[x];if(p<pa.b2_epsilon){a.pointCount=1,a.type=Js.b2ManifoldType.e_faceA,a.localNormal.Copy(y[u]),Rt.b2Vec2.Mid(S,V,a.localPoint),a.points[0].localPoint.Copy(n.m_p),a.points[0].id.key=0;return}const C=Rt.b2Vec2.Dot(Rt.b2Vec2.Subtract(m,S,Rt.b2Vec2.s_t0),Rt.b2Vec2.Subtract(V,S,Rt.b2Vec2.s_t1)),_=Rt.b2Vec2.Dot(Rt.b2Vec2.Subtract(m,V,Rt.b2Vec2.s_t0),Rt.b2Vec2.Subtract(S,V,Rt.b2Vec2.s_t1));if(C<=0){if(Rt.b2Vec2.DistanceSquared(m,S)>b*b)return;a.pointCount=1,a.type=Js.b2ManifoldType.e_faceA,Rt.b2Vec2.Subtract(m,S,a.localNormal).Normalize(),a.localPoint.Copy(S),a.points[0].localPoint.Copy(n.m_p),a.points[0].id.key=0}else if(_<=0){if(Rt.b2Vec2.DistanceSquared(m,V)>b*b)return;a.pointCount=1,a.type=Js.b2ManifoldType.e_faceA,Rt.b2Vec2.Subtract(m,V,a.localNormal).Normalize(),a.localPoint.Copy(V),a.points[0].localPoint.Copy(n.m_p),a.points[0].id.key=0}else{const g=Rt.b2Vec2.Mid(S,V,Gl);if(Rt.b2Vec2.Dot(Rt.b2Vec2.Subtract(m,g,Rt.b2Vec2.s_t1),y[f])>b)return;a.pointCount=1,a.type=Js.b2ManifoldType.e_faceA,a.localNormal.Copy(y[f]),a.localPoint.Copy(g),a.points[0].localPoint.Copy(n.m_p),a.points[0].id.key=0}}Ji.b2CollidePolygonAndCircle=Ll;var Ys={};Object.defineProperty(Ys,"__esModule",{value:!0});Ys.b2CollidePolygons=void 0;const Ws=jt,Bt=Dt,Ee=yt,Fl=new Bt.b2Transform,Rl=new Bt.b2Vec2,kl=new Bt.b2Vec2;function ba(a,t,e,n,c){const r=t.m_count,m=n.m_count,u=t.m_normals,p=t.m_vertices,b=n.m_vertices,d=Bt.b2Transform.TransposeMultiply(c,e,Fl);let A=0,y=-Ws.b2_maxFloat;for(let f=0;f<r;++f){const x=Bt.b2Rot.MultiplyVec2(d.q,u[f],Rl),S=Bt.b2Transform.MultiplyVec2(d,p[f],kl);let V=Ws.b2_maxFloat;for(let C=0;C<m;++C){const _=Bt.b2Vec2.Dot(x,Bt.b2Vec2.Subtract(b[C],S,Bt.b2Vec2.s_t0));_<V&&(V=_)}V>y&&(y=V,A=f)}return a[0]=A,y}const El=new Bt.b2Vec2;function jl(a,t,e,n,c,r){const m=t.m_normals,u=c.m_count,p=c.m_vertices,b=c.m_normals,d=Bt.b2Rot.TransposeMultiplyVec2(r.q,Bt.b2Rot.MultiplyVec2(e.q,m[n],Bt.b2Vec2.s_t0),El);let A=0,y=Ws.b2_maxFloat;for(let g=0;g<u;++g){const w=Bt.b2Vec2.Dot(d,b[g]);w<y&&(y=w,A=g)}const f=A,x=f+1<u?f+1:0,S=a[0];Bt.b2Transform.MultiplyVec2(r,p[f],S.v);const V=S.id.cf;V.indexA=n,V.indexB=f,V.typeA=Ee.b2ContactFeatureType.e_face,V.typeB=Ee.b2ContactFeatureType.e_vertex;const C=a[1];Bt.b2Transform.MultiplyVec2(r,p[x],C.v);const _=C.id.cf;_.indexA=n,_.indexB=x,_.typeA=Ee.b2ContactFeatureType.e_face,_.typeB=Ee.b2ContactFeatureType.e_vertex}const Ol=[new Ee.b2ClipVertex,new Ee.b2ClipVertex],Jl=[new Ee.b2ClipVertex,new Ee.b2ClipVertex],ql=[new Ee.b2ClipVertex,new Ee.b2ClipVertex],zl=[0],$l=[0],Nl=new Bt.b2Vec2,Wl=new Bt.b2Vec2,Hl=new Bt.b2Vec2,Zl=new Bt.b2Vec2,Xl=new Bt.b2Vec2,Yl=new Bt.b2Vec2,Ql=new Bt.b2Vec2,Ul=new Bt.b2Vec2;function Kl(a,t,e,n,c){a.pointCount=0;const r=t.m_radius+n.m_radius,m=zl,u=ba(m,t,e,n,c);if(u>r)return;const p=$l,b=ba(p,n,c,t,e);if(b>r)return;let d,A,y,f,x,S;const V=.1*Ws.b2_linearSlop;b>u+V?(d=n,A=t,y=c,f=e,x=p[0],a.type=Ee.b2ManifoldType.e_faceB,S=1):(d=t,A=n,y=e,f=c,x=m[0],a.type=Ee.b2ManifoldType.e_faceA,S=0);const C=Ol;jl(C,d,y,x,A,f);const _=d.m_count,g=d.m_vertices,w=x,M=x+1<_?x+1:0;let L=g[w],R=g[M];const z=Bt.b2Vec2.Subtract(R,L,Nl);z.Normalize();const N=Bt.b2Vec2.CrossVec2One(z,Wl),G=Bt.b2Vec2.Mid(L,R,Hl),H=Bt.b2Rot.MultiplyVec2(y.q,z,Xl),k=Bt.b2Vec2.CrossVec2One(H,Zl);L=Bt.b2Transform.MultiplyVec2(y,L,Ql),R=Bt.b2Transform.MultiplyVec2(y,R,Ul);const j=Bt.b2Vec2.Dot(k,L),O=-Bt.b2Vec2.Dot(H,L)+r,W=Bt.b2Vec2.Dot(H,R)+r,tt=Jl,st=ql,_t=Bt.b2Vec2.Negate(H,Yl);let pt=(0,Ee.b2ClipSegmentToLine)(tt,C,_t,O,w);if(pt<2||(pt=(0,Ee.b2ClipSegmentToLine)(st,tt,H,W,M),pt<2))return;a.localNormal.Copy(N),a.localPoint.Copy(G);let Q=0;for(let nt=0;nt<Ws.b2_maxManifoldPoints;++nt){const ft=st[nt];if(Bt.b2Vec2.Dot(k,ft.v)-j<=r){const Tt=a.points[Q];if(Bt.b2Transform.TransposeMultiplyVec2(f,ft.v,Tt.localPoint),Tt.id.Copy(ft.id),S){const{cf:Vt}=Tt.id;Vt.indexA=Vt.indexB,Vt.indexB=Vt.indexA,Vt.typeA=Vt.typeB,Vt.typeB=Vt.typeA}++Q}}a.pointCount=Q}Ys.b2CollidePolygons=Kl;var bi={};Object.defineProperty(bi,"__esModule",{value:!0});bi.b2CollideEdgeAndPolygon=bi.b2CollideEdgeAndCircle=void 0;const Oi=jt,Y=Dt,Xt=yt,fa=Qe,tm=new Y.b2Vec2,em=new Y.b2Vec2,Mo=new Y.b2Vec2,im=new Y.b2Vec2,sm=new Y.b2Vec2,nm=new Y.b2Vec2,om=new Y.b2Vec2,rm=new Xt.b2ContactID;function am(a,t,e,n,c){a.pointCount=0;const r=Y.b2Transform.TransposeMultiplyVec2(e,Y.b2Transform.MultiplyVec2(c,n.m_p,Y.b2Vec2.s_t0),tm),m=t.m_vertex1,u=t.m_vertex2,p=Y.b2Vec2.Subtract(u,m,em),b=om.Set(p.y,-p.x),d=Y.b2Vec2.Dot(b,Y.b2Vec2.Subtract(r,m,Y.b2Vec2.s_t0));if(t.m_oneSided&&d<0)return;const y=Y.b2Vec2.Dot(p,Y.b2Vec2.Subtract(u,r,Y.b2Vec2.s_t0)),f=Y.b2Vec2.Dot(p,Y.b2Vec2.Subtract(r,m,Y.b2Vec2.s_t0)),x=t.m_radius+n.m_radius,S=rm;if(S.cf.indexB=0,S.cf.typeB=Xt.b2ContactFeatureType.e_vertex,f<=0){const w=m,M=Y.b2Vec2.Subtract(r,w,Mo);if(Y.b2Vec2.Dot(M,M)>x*x)return;if(t.m_oneSided){const R=t.m_vertex0,z=m,N=Y.b2Vec2.Subtract(z,R,im);if(Y.b2Vec2.Dot(N,Y.b2Vec2.Subtract(z,r,Y.b2Vec2.s_t0))>0)return}S.cf.indexA=0,S.cf.typeA=Xt.b2ContactFeatureType.e_vertex,a.pointCount=1,a.type=Xt.b2ManifoldType.e_circles,a.localNormal.SetZero(),a.localPoint.Copy(w),a.points[0].id.Copy(S),a.points[0].localPoint.Copy(n.m_p);return}if(y<=0){const w=u,M=Y.b2Vec2.Subtract(r,w,Mo);if(Y.b2Vec2.Dot(M,M)>x*x)return;if(t.m_oneSided){const R=t.m_vertex3,z=u,N=Y.b2Vec2.Subtract(R,z,sm);if(Y.b2Vec2.Dot(N,Y.b2Vec2.Subtract(r,z,Y.b2Vec2.s_t0))>0)return}S.cf.indexA=1,S.cf.typeA=Xt.b2ContactFeatureType.e_vertex,a.pointCount=1,a.type=Xt.b2ManifoldType.e_circles,a.localNormal.SetZero(),a.localPoint.Copy(w),a.points[0].id.Copy(S),a.points[0].localPoint.Copy(n.m_p);return}const V=Y.b2Vec2.Dot(p,p),C=nm;C.x=1/V*(y*m.x+f*u.x),C.y=1/V*(y*m.y+f*u.y);const _=Y.b2Vec2.Subtract(r,C,Mo);Y.b2Vec2.Dot(_,_)>x*x||(d<0&&b.Set(-b.x,-b.y),b.Normalize(),S.cf.indexA=0,S.cf.typeA=Xt.b2ContactFeatureType.e_face,a.pointCount=1,a.type=Xt.b2ManifoldType.e_faceA,a.localNormal.Copy(b),a.localPoint.Copy(m),a.points[0].id.Copy(S),a.points[0].localPoint.Copy(n.m_p))}bi.b2CollideEdgeAndCircle=am;var Ii;(function(a){a[a.e_unknown=0]="e_unknown",a[a.e_edgeA=1]="e_edgeA",a[a.e_edgeB=2]="e_edgeB"})(Ii||(Ii={}));class Na{constructor(){this.normal=new Y.b2Vec2,this.type=Ii.e_unknown,this.index=0,this.separation=0}}class cm{constructor(){this.vertices=(0,Oi.b2MakeArray)(fa.b2_maxPolygonVertices,Y.b2Vec2),this.normals=(0,Oi.b2MakeArray)(fa.b2_maxPolygonVertices,Y.b2Vec2),this.count=0}}class lm{constructor(){this.i1=0,this.i2=0,this.v1=new Y.b2Vec2,this.v2=new Y.b2Vec2,this.normal=new Y.b2Vec2,this.sideNormal1=new Y.b2Vec2,this.sideOffset1=0,this.sideNormal2=new Y.b2Vec2,this.sideOffset2=0}}const mm=new Na,hm=[new Y.b2Vec2,new Y.b2Vec2];function _m(a,t,e){const n=mm;n.type=Ii.e_edgeA,n.index=-1,n.separation=-Oi.b2_maxFloat,n.normal.SetZero();const c=hm;c[0].Copy(e),Y.b2Vec2.Negate(e,c[1]);for(let r=0;r<2;++r){let m=Oi.b2_maxFloat;for(let u=0;u<a.count;++u){const p=Y.b2Vec2.Dot(c[r],Y.b2Vec2.Subtract(a.vertices[u],t,Y.b2Vec2.s_t0));p<m&&(m=p)}m>n.separation&&(n.index=r,n.separation=m,n.normal.Copy(c[r]))}return n}const um=new Na,dm=new Y.b2Vec2;function pm(a,t,e){const n=um;n.type=Ii.e_unknown,n.index=-1,n.separation=-Oi.b2_maxFloat,n.normal.SetZero();for(let c=0;c<a.count;++c){const r=Y.b2Vec2.Negate(a.normals[c],dm),m=Y.b2Vec2.Dot(r,Y.b2Vec2.Subtract(a.vertices[c],t,Y.b2Vec2.s_t0)),u=Y.b2Vec2.Dot(r,Y.b2Vec2.Subtract(a.vertices[c],e,Y.b2Vec2.s_t0)),p=Math.min(m,u);p>n.separation&&(n.type=Ii.e_edgeB,n.index=c,n.separation=p,n.normal.Copy(r))}return n}const bm=new Y.b2Transform,fm=new Y.b2Vec2,ym=new Y.b2Vec2,vm=new Y.b2Vec2,Am=new Y.b2Vec2,wm=new Y.b2Vec2,gm=new Y.b2Vec2,xm=new Y.b2Vec2,Sm=new cm,Bm=new lm,Vm=[new Xt.b2ClipVertex,new Xt.b2ClipVertex],Cm=[new Xt.b2ClipVertex,new Xt.b2ClipVertex],Mm=[new Xt.b2ClipVertex,new Xt.b2ClipVertex];function Im(a,t,e,n,c){a.pointCount=0;const r=Y.b2Transform.TransposeMultiply(e,c,bm),m=Y.b2Transform.MultiplyVec2(r,n.m_centroid,fm),u=t.m_vertex1,p=t.m_vertex2,b=Y.b2Vec2.Subtract(p,u,ym);b.Normalize();const d=vm.Set(b.y,-b.x),A=Y.b2Vec2.Dot(d,Y.b2Vec2.Subtract(m,u,Y.b2Vec2.s_t0)),y=t.m_oneSided;if(y&&A<0)return;const f=Sm;f.count=n.m_count;for(let G=0;G<n.m_count;++G)Y.b2Transform.MultiplyVec2(r,n.m_vertices[G],f.vertices[G]),Y.b2Rot.MultiplyVec2(r.q,n.m_normals[G],f.normals[G]);const x=n.m_radius+t.m_radius,S=_m(f,u,d);if(S.separation>x)return;const V=pm(f,u,p);if(V.separation>x)return;const C=.98,_=.001;let g;if(V.separation-x>C*(S.separation-x)+_?g=V:g=S,y){const G=Y.b2Vec2.Subtract(u,t.m_vertex0,Am);G.Normalize();const H=wm.Set(G.y,-G.x),k=Y.b2Vec2.Cross(G,b)>=0,j=Y.b2Vec2.Subtract(t.m_vertex3,p,gm);j.Normalize();const O=xm.Set(j.y,-j.x),W=Y.b2Vec2.Cross(b,j)>=0,tt=.1;if(Y.b2Vec2.Dot(g.normal,b)<=0)if(k){if(Y.b2Vec2.Cross(g.normal,H)>tt)return}else g=S;else if(W){if(Y.b2Vec2.Cross(O,g.normal)>tt)return}else g=S}const w=Vm,M=Bm;if(g.type===Ii.e_edgeA){a.type=Xt.b2ManifoldType.e_faceA;let G=0,H=Y.b2Vec2.Dot(g.normal,f.normals[0]);for(let O=1;O<f.count;++O){const W=Y.b2Vec2.Dot(g.normal,f.normals[O]);W<H&&(H=W,G=O)}const k=G,j=k+1<f.count?k+1:0;w[0].v.Copy(f.vertices[k]),w[0].id.cf.indexA=0,w[0].id.cf.indexB=k,w[0].id.cf.typeA=Xt.b2ContactFeatureType.e_face,w[0].id.cf.typeB=Xt.b2ContactFeatureType.e_vertex,w[1].v.Copy(f.vertices[j]),w[1].id.cf.indexA=0,w[1].id.cf.indexB=j,w[1].id.cf.typeA=Xt.b2ContactFeatureType.e_face,w[1].id.cf.typeB=Xt.b2ContactFeatureType.e_vertex,M.i1=0,M.i2=1,M.v1.Copy(u),M.v2.Copy(p),M.normal.Copy(g.normal),Y.b2Vec2.Negate(b,M.sideNormal1),M.sideNormal2.Copy(b)}else a.type=Xt.b2ManifoldType.e_faceB,w[0].v.Copy(p),w[0].id.cf.indexA=1,w[0].id.cf.indexB=g.index,w[0].id.cf.typeA=Xt.b2ContactFeatureType.e_vertex,w[0].id.cf.typeB=Xt.b2ContactFeatureType.e_face,w[1].v.Copy(u),w[1].id.cf.indexA=0,w[1].id.cf.indexB=g.index,w[1].id.cf.typeA=Xt.b2ContactFeatureType.e_vertex,w[1].id.cf.typeB=Xt.b2ContactFeatureType.e_face,M.i1=g.index,M.i2=M.i1+1<f.count?M.i1+1:0,M.v1.Copy(f.vertices[M.i1]),M.v2.Copy(f.vertices[M.i2]),M.normal.Copy(f.normals[M.i1]),M.sideNormal1.Set(M.normal.y,-M.normal.x),Y.b2Vec2.Negate(M.sideNormal1,M.sideNormal2);M.sideOffset1=Y.b2Vec2.Dot(M.sideNormal1,M.v1),M.sideOffset2=Y.b2Vec2.Dot(M.sideNormal2,M.v2);const L=Cm,R=Mm;let z;if(z=(0,Xt.b2ClipSegmentToLine)(L,w,M.sideNormal1,M.sideOffset1,M.i1),z<Oi.b2_maxManifoldPoints||(z=(0,Xt.b2ClipSegmentToLine)(R,L,M.sideNormal2,M.sideOffset2,M.i2),z<Oi.b2_maxManifoldPoints))return;g.type===Ii.e_edgeA?(a.localNormal.Copy(M.normal),a.localPoint.Copy(M.v1)):(a.localNormal.Copy(n.m_normals[M.i1]),a.localPoint.Copy(n.m_vertices[M.i1]));let N=0;for(let G=0;G<Oi.b2_maxManifoldPoints;++G)if(Y.b2Vec2.Dot(M.normal,Y.b2Vec2.Subtract(R[G].v,M.v1,Y.b2Vec2.s_t0))<=x){const k=a.points[N];g.type===Ii.e_edgeA?(Y.b2Transform.TransposeMultiplyVec2(r,R[G].v,k.localPoint),k.id.Copy(R[G].id)):(k.localPoint.Copy(R[G].v),k.id.cf.typeA=R[G].id.cf.typeB,k.id.cf.typeB=R[G].id.cf.typeA,k.id.cf.indexA=R[G].id.cf.indexB,k.id.cf.indexB=R[G].id.cf.indexA),++N}a.pointCount=N}bi.b2CollideEdgeAndPolygon=Im;var zn={};Object.defineProperty(zn,"__esModule",{value:!0});zn.b2CircleShape=void 0;const Pm=jt,me=Dt,ya=De;class Pe extends ya.b2Shape{constructor(t=0){super(ya.b2ShapeType.e_circle,t),this.m_p=new me.b2Vec2}Set(t,e=this.m_radius){return this.m_p.Copy(t),this.m_radius=e,this}Clone(){return new Pe().Copy(this)}Copy(t){return super.Copy(t),this.m_p.Copy(t.m_p),this}GetChildCount(){return 1}TestPoint(t,e){const n=me.b2Transform.MultiplyVec2(t,this.m_p,Pe.TestPoint_s_center),c=me.b2Vec2.Subtract(e,n,Pe.TestPoint_s_d);return me.b2Vec2.Dot(c,c)<=this.m_radius**2}RayCast(t,e,n,c){const r=me.b2Transform.MultiplyVec2(n,this.m_p,Pe.RayCast_s_position),m=me.b2Vec2.Subtract(e.p1,r,Pe.RayCast_s_s),u=me.b2Vec2.Dot(m,m)-this.m_radius**2,p=me.b2Vec2.Subtract(e.p2,e.p1,Pe.RayCast_s_r),b=me.b2Vec2.Dot(m,p),d=me.b2Vec2.Dot(p,p),A=b*b-d*u;if(A<0||d<Pm.b2_epsilon)return!1;let y=-(b+Math.sqrt(A));return y>=0&&y<=e.maxFraction*d?(y/=d,t.fraction=y,me.b2Vec2.AddScaled(m,y,p,t.normal).Normalize(),!0):!1}ComputeAABB(t,e,n){const c=me.b2Transform.MultiplyVec2(e,this.m_p,Pe.ComputeAABB_s_p);t.lowerBound.Set(c.x-this.m_radius,c.y-this.m_radius),t.upperBound.Set(c.x+this.m_radius,c.y+this.m_radius)}ComputeMass(t,e){const n=this.m_radius**2;t.mass=e*Math.PI*n,t.center.Copy(this.m_p),t.I=t.mass*(.5*n+me.b2Vec2.Dot(this.m_p,this.m_p))}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0]=this.m_p,t.m_count=1,t.m_radius=this.m_radius}Draw(t,e){const n=this.m_p,c=this.m_radius,r=me.b2Vec2.UNITX;t.DrawSolidCircle(n,c,r,e)}}zn.b2CircleShape=Pe;Pe.TestPoint_s_center=new me.b2Vec2;Pe.TestPoint_s_d=new me.b2Vec2;Pe.RayCast_s_position=new me.b2Vec2;Pe.RayCast_s_s=new me.b2Vec2;Pe.RayCast_s_r=new me.b2Vec2;Pe.ComputeAABB_s_p=new me.b2Vec2;var $n={};Object.defineProperty($n,"__esModule",{value:!0});$n.b2PolygonShape=void 0;const Li=jt,ht=Dt,Tm=Qe,va=yt,Aa=De,ni={ComputeCentroid:{s:new ht.b2Vec2,p1:new ht.b2Vec2,p2:new ht.b2Vec2,p3:new ht.b2Vec2,e1:new ht.b2Vec2,e2:new ht.b2Vec2},TestPoint:{pLocal:new ht.b2Vec2},ComputeAABB:{v:new ht.b2Vec2},ComputeMass:{center:new ht.b2Vec2,s:new ht.b2Vec2,e1:new ht.b2Vec2,e2:new ht.b2Vec2},Validate:{e:new ht.b2Vec2,v:new ht.b2Vec2},Set:{r:new ht.b2Vec2,v:new ht.b2Vec2},RayCast:{p1:new ht.b2Vec2,p2:new ht.b2Vec2,d:new ht.b2Vec2},SetAsBox:{xf:new ht.b2Transform}};function Dm(a,t,e){const n=e;n.SetZero();let c=0;const{s:r,p1:m,p2:u,p3:p,e1:b,e2:d}=ni.ComputeCentroid;r.Copy(a[0]);const A=1/3;for(let f=0;f<t;++f){ht.b2Vec2.Subtract(a[0],r,m),ht.b2Vec2.Subtract(a[f],r,u),ht.b2Vec2.Subtract(a[f+1<t?f+1:0],r,p),ht.b2Vec2.Subtract(u,m,b),ht.b2Vec2.Subtract(p,m,d);const S=.5*ht.b2Vec2.Cross(b,d);c+=S,n.x+=S*A*(m.x+u.x+p.x),n.y+=S*A*(m.y+u.y+p.y)}const y=1/c;return n.x=y*n.x+r.x,n.y=y*n.y+r.y,n}const Gm=new ht.b2Vec2;class nr extends Aa.b2Shape{constructor(){super(Aa.b2ShapeType.e_polygon,Li.b2_polygonRadius),this.m_centroid=new ht.b2Vec2,this.m_vertices=[],this.m_normals=[],this.m_count=0}Clone(){return new nr().Copy(this)}Copy(t){super.Copy(t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=(0,Li.b2MakeArray)(this.m_count,ht.b2Vec2),this.m_normals=(0,Li.b2MakeArray)(this.m_count,ht.b2Vec2);for(let e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}GetChildCount(){return 1}Set(t,e=t.length){const n=(0,va.b2ComputeHull)(t,e);return n.length<3?!1:(this.SetHull(n,n.length),!0)}SetHull(t,e){(0,Li.b2Assert)(e>=3),this.m_count=e,this.m_vertices=(0,Li.b2MakeArray)(e,ht.b2Vec2);for(let n=0;n<e;++n)this.m_vertices[n].Copy(t[n]);this.m_normals=(0,Li.b2MakeArray)(e,ht.b2Vec2);for(let n=0;n<this.m_count;++n){const c=n,r=n+1<this.m_count?n+1:0,m=ht.b2Vec2.Subtract(this.m_vertices[r],this.m_vertices[c],Gm);ht.b2Vec2.CrossVec2Scalar(m,1,this.m_normals[n]),this.m_normals[n].Normalize()}return Dm(this.m_vertices,this.m_count,this.m_centroid),this}SetAsBox(t,e,n,c=0){if(this.m_count=4,this.m_vertices=(0,Li.b2MakeArray)(this.m_count,ht.b2Vec2),this.m_normals=(0,Li.b2MakeArray)(this.m_count,ht.b2Vec2),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),n){this.m_centroid.Copy(n);const{xf:r}=ni.SetAsBox;r.SetPosition(n),r.SetRotationAngle(c);for(let m=0;m<this.m_count;++m)ht.b2Transform.MultiplyVec2(r,this.m_vertices[m],this.m_vertices[m]),ht.b2Rot.MultiplyVec2(r.q,this.m_normals[m],this.m_normals[m])}else this.m_centroid.SetZero();return this}TestPoint(t,e){const n=ht.b2Transform.TransposeMultiplyVec2(t,e,ni.TestPoint.pLocal);for(let c=0;c<this.m_count;++c)if(ht.b2Vec2.Dot(this.m_normals[c],ht.b2Vec2.Subtract(n,this.m_vertices[c],ht.b2Vec2.s_t0))>0)return!1;return!0}RayCast(t,e,n,c){const r=ht.b2Transform.TransposeMultiplyVec2(n,e.p1,ni.RayCast.p1),m=ht.b2Transform.TransposeMultiplyVec2(n,e.p2,ni.RayCast.p2),u=ht.b2Vec2.Subtract(m,r,ni.RayCast.d);let p=0,b=e.maxFraction,d=-1;for(let A=0;A<this.m_count;++A){const y=ht.b2Vec2.Dot(this.m_normals[A],ht.b2Vec2.Subtract(this.m_vertices[A],r,ht.b2Vec2.s_t0)),f=ht.b2Vec2.Dot(this.m_normals[A],u);if(f===0){if(y<0)return!1}else f<0&&y<p*f?(p=y/f,d=A):f>0&&y<b*f&&(b=y/f);if(b<p)return!1}return d>=0?(t.fraction=p,ht.b2Rot.MultiplyVec2(n.q,this.m_normals[d],t.normal),!0):!1}ComputeAABB(t,e,n){const c=ht.b2Transform.MultiplyVec2(e,this.m_vertices[0],t.lowerBound),r=t.upperBound.Copy(c);for(let u=1;u<this.m_count;++u){const p=ht.b2Transform.MultiplyVec2(e,this.m_vertices[u],ni.ComputeAABB.v);ht.b2Vec2.Min(c,p,c),ht.b2Vec2.Max(r,p,r)}const m=this.m_radius;c.SubtractXY(m,m),r.AddXY(m,m)}ComputeMass(t,e){const n=ni.ComputeMass.center.SetZero();let c=0,r=0;const m=ni.ComputeMass.s.Copy(this.m_vertices[0]),u=1/3;for(let p=0;p<this.m_count;++p){const b=ht.b2Vec2.Subtract(this.m_vertices[p],m,ni.ComputeMass.e1),d=ht.b2Vec2.Subtract(this.m_vertices[p+1<this.m_count?p+1:0],m,ni.ComputeMass.e2),A=ht.b2Vec2.Cross(b,d),y=.5*A;c+=y,n.AddScaled(y*u,ht.b2Vec2.Add(b,d,ht.b2Vec2.s_t0));const f=b.x,x=b.y,S=d.x,V=d.y,C=f*f+S*f+S*S,_=x*x+V*x+V*V;r+=.25*u*A*(C+_)}t.mass=e*c,n.Scale(1/c),ht.b2Vec2.Add(n,m,t.center),t.I=e*r,t.I+=t.mass*(ht.b2Vec2.Dot(t.center,t.center)-ht.b2Vec2.Dot(n,n))}Validate(){return this.m_count<3||Tm.b2_maxPolygonVertices<this.m_count?!1:(0,va.b2ValidateHull)(this.m_vertices,this.m_count)}SetupDistanceProxy(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}Draw(t,e){const n=this.m_count,c=this.m_vertices;t.DrawSolidPolygon(c,n,e)}}$n.b2PolygonShape=nr;var _s={};Object.defineProperty(_s,"__esModule",{value:!0});_s.b2EdgeShape=void 0;const Lm=jt,kt=Dt,wa=De;class _e extends wa.b2Shape{constructor(){super(wa.b2ShapeType.e_edge,Lm.b2_polygonRadius),this.m_vertex1=new kt.b2Vec2,this.m_vertex2=new kt.b2Vec2,this.m_vertex0=new kt.b2Vec2,this.m_vertex3=new kt.b2Vec2,this.m_oneSided=!1}SetOneSided(t,e,n,c){return this.m_vertex0.Copy(t),this.m_vertex1.Copy(e),this.m_vertex2.Copy(n),this.m_vertex3.Copy(c),this.m_oneSided=!0,this}SetTwoSided(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_oneSided=!1,this}Clone(){return new _e().Copy(this)}Copy(t){return super.Copy(t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_oneSided=t.m_oneSided,this}GetChildCount(){return 1}TestPoint(t,e){return!1}RayCast(t,e,n,c){const r=kt.b2Transform.TransposeMultiplyVec2(n,e.p1,_e.RayCast_s_p1),m=kt.b2Transform.TransposeMultiplyVec2(n,e.p2,_e.RayCast_s_p2),u=kt.b2Vec2.Subtract(m,r,_e.RayCast_s_d),p=this.m_vertex1,b=this.m_vertex2,d=kt.b2Vec2.Subtract(b,p,_e.RayCast_s_e),{normal:A}=t;A.Set(d.y,-d.x).Normalize();const y=kt.b2Vec2.Dot(A,kt.b2Vec2.Subtract(p,r,kt.b2Vec2.s_t0));if(this.m_oneSided&&y>0)return!1;const f=kt.b2Vec2.Dot(A,u);if(f===0)return!1;const x=y/f;if(x<0||e.maxFraction<x)return!1;const S=kt.b2Vec2.AddScaled(r,x,u,_e.RayCast_s_q),V=kt.b2Vec2.Subtract(b,p,_e.RayCast_s_r),C=kt.b2Vec2.Dot(V,V);if(C===0)return!1;const _=kt.b2Vec2.Dot(kt.b2Vec2.Subtract(S,p,kt.b2Vec2.s_t0),V)/C;return _<0||_>1?!1:(t.fraction=x,kt.b2Rot.MultiplyVec2(n.q,t.normal,t.normal),y>0&&t.normal.Negate(),!0)}ComputeAABB(t,e,n){const c=kt.b2Transform.MultiplyVec2(e,this.m_vertex1,_e.ComputeAABB_s_v1),r=kt.b2Transform.MultiplyVec2(e,this.m_vertex2,_e.ComputeAABB_s_v2);kt.b2Vec2.Min(c,r,t.lowerBound),kt.b2Vec2.Max(c,r,t.upperBound);const m=this.m_radius;t.lowerBound.SubtractXY(m,m),t.upperBound.AddXY(m,m)}ComputeMass(t,e){t.mass=0,kt.b2Vec2.Mid(this.m_vertex1,this.m_vertex2,t.center),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0]=this.m_vertex1,t.m_vertices[1]=this.m_vertex2,t.m_count=2,t.m_radius=this.m_radius}Draw(t,e){const n=this.m_vertex1,c=this.m_vertex2;t.DrawSegment(n,c,e),this.m_oneSided===!1&&(t.DrawPoint(n,4,e),t.DrawPoint(c,4,e))}}_s.b2EdgeShape=_e;_e.RayCast_s_p1=new kt.b2Vec2;_e.RayCast_s_p2=new kt.b2Vec2;_e.RayCast_s_d=new kt.b2Vec2;_e.RayCast_s_e=new kt.b2Vec2;_e.RayCast_s_q=new kt.b2Vec2;_e.RayCast_s_r=new kt.b2Vec2;_e.ComputeAABB_s_v1=new kt.b2Vec2;_e.ComputeAABB_s_v2=new kt.b2Vec2;var Nn={};Object.defineProperty(Nn,"__esModule",{value:!0});Nn.b2ChainShape=void 0;const Fm=jt,Ze=Dt,ga=De,Rm=_s;class $e extends ga.b2Shape{constructor(){super(ga.b2ShapeType.e_chain,Fm.b2_polygonRadius),this.m_vertices=[],this.m_prevVertex=new Ze.b2Vec2,this.m_nextVertex=new Ze.b2Vec2}CreateLoop(t,e=t.length){if(e<3)return this;this.m_vertices.length=e+1;for(let n=0;n<e;++n){const{x:c,y:r}=t[n];this.m_vertices[n]=new Ze.b2Vec2(c,r)}return this.m_vertices[e]=this.m_vertices[0].Clone(),this.m_prevVertex.Copy(this.m_vertices[this.m_vertices.length-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this}CreateChain(t,e,n,c){this.m_vertices.length=e;for(let r=0;r<e;++r){const{x:m,y:u}=t[r];this.m_vertices[r]=new Ze.b2Vec2(m,u)}return this.m_prevVertex.Copy(n),this.m_nextVertex.Copy(c),this}Clone(){return new $e().Copy(this)}Copy(t){return super.Copy(t),this.CreateChain(t.m_vertices,t.m_vertices.length,t.m_prevVertex,t.m_nextVertex)}GetChildCount(){return this.m_vertices.length-1}GetChildEdge(t,e){t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),t.m_oneSided=!0,e>0?t.m_vertex0.Copy(this.m_vertices[e-1]):t.m_vertex0.Copy(this.m_prevVertex),e<this.m_vertices.length-2?t.m_vertex3.Copy(this.m_vertices[e+2]):t.m_vertex3.Copy(this.m_nextVertex)}TestPoint(t,e){return!1}RayCast(t,e,n,c){const r=$e.RayCast_s_edgeShape,m=c;let u=c+1;return u===this.m_vertices.length&&(u=0),r.m_vertex1.Copy(this.m_vertices[m]),r.m_vertex2.Copy(this.m_vertices[u]),r.RayCast(t,e,n,0)}ComputeAABB(t,e,n){const c=n;let r=n+1;r===this.m_vertices.length&&(r=0);const m=Ze.b2Transform.MultiplyVec2(e,this.m_vertices[c],$e.ComputeAABB_s_v1),u=Ze.b2Transform.MultiplyVec2(e,this.m_vertices[r],$e.ComputeAABB_s_v2),p=Ze.b2Vec2.Min(m,u,$e.ComputeAABB_s_lower),b=Ze.b2Vec2.Max(m,u,$e.ComputeAABB_s_upper);t.lowerBound.x=p.x-this.m_radius,t.lowerBound.y=p.y-this.m_radius,t.upperBound.x=b.x+this.m_radius,t.upperBound.y=b.y+this.m_radius}ComputeMass(t,e){t.mass=0,t.center.SetZero(),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0]=this.m_vertices[e];const n=e+1<this.m_vertices.length?e+1:0;t.m_vertices[1]=this.m_vertices[n],t.m_count=2,t.m_radius=this.m_radius}Draw(t,e){const n=this.m_vertices;let c=n[0];for(let r=1;r<n.length;++r){const m=n[r];t.DrawSegment(c,m,e),c=m}}}Nn.b2ChainShape=$e;$e.RayCast_s_edgeShape=new Rm.b2EdgeShape;$e.ComputeAABB_s_v1=new Ze.b2Vec2;$e.ComputeAABB_s_v2=new Ze.b2Vec2;$e.ComputeAABB_s_lower=new Ze.b2Vec2;$e.ComputeAABB_s_upper=new Ze.b2Vec2;var Wn={},Yt={};Object.defineProperty(Yt,"__esModule",{value:!0});Yt.b2Joint=Yt.b2AngularStiffness=Yt.b2LinearStiffness=Yt.b2JointDef=Yt.b2JointEdge=Yt.b2JointType=void 0;const Io=Ge,xa=Dt,Sa={pA:new xa.b2Vec2,pB:new xa.b2Vec2};var Ro;(function(a){a[a.e_unknownJoint=0]="e_unknownJoint",a[a.e_revoluteJoint=1]="e_revoluteJoint",a[a.e_prismaticJoint=2]="e_prismaticJoint",a[a.e_distanceJoint=3]="e_distanceJoint",a[a.e_pulleyJoint=4]="e_pulleyJoint",a[a.e_mouseJoint=5]="e_mouseJoint",a[a.e_gearJoint=6]="e_gearJoint",a[a.e_wheelJoint=7]="e_wheelJoint",a[a.e_weldJoint=8]="e_weldJoint",a[a.e_frictionJoint=9]="e_frictionJoint",a[a.e_motorJoint=10]="e_motorJoint",a[a.e_areaJoint=11]="e_areaJoint"})(Ro||(Yt.b2JointType=Ro={}));class ko{constructor(t,e){this.prev=null,this.next=null,this.joint=t,this.other=e}}Yt.b2JointEdge=ko;class km{constructor(t){this.userData={},this.collideConnected=!1,this.type=t}}Yt.b2JointDef=km;function Em(a,t,e,n,c){const r=n.GetMass(),m=c.GetMass();let u;r>0&&m>0?u=r*m/(r+m):r>0?u=r:u=m;const p=2*Math.PI*t;a.stiffness=u*p*p,a.damping=2*u*e*p}Yt.b2LinearStiffness=Em;function jm(a,t,e,n,c){const r=n.GetInertia(),m=c.GetInertia();let u;r>0&&m>0?u=r*m/(r+m):r>0?u=r:u=m;const p=2*Math.PI*t;a.stiffness=u*p*p,a.damping=2*u*e*p}Yt.b2AngularStiffness=jm;class Om{constructor(t){var e;this.m_type=Ro.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData={},this.m_type=t.type,this.m_edgeA=new ko(this,t.bodyB),this.m_edgeB=new ko(this,t.bodyA),this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=(e=t.collideConnected)!==null&&e!==void 0?e:!1,this.SetUserData(t.userData)}GetType(){return this.m_type}GetBodyA(){return this.m_bodyA}GetBodyB(){return this.m_bodyB}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){Object.assign(this.m_userData,t)}IsEnabled(){return this.m_bodyA.IsEnabled()&&this.m_bodyB.IsEnabled()}GetCollideConnected(){return this.m_collideConnected}ShiftOrigin(t){}Draw(t){const e=this.m_bodyA.GetTransform().p,n=this.m_bodyB.GetTransform().p,c=this.GetAnchorA(Sa.pA),r=this.GetAnchorB(Sa.pB);t.DrawSegment(e,c,Io.debugColors.joint6),t.DrawSegment(c,r,Io.debugColors.joint6),t.DrawSegment(n,r,Io.debugColors.joint6)}}Yt.b2Joint=Om;var is={},qi={};Object.defineProperty(qi,"__esModule",{value:!0});qi.b2DistanceJoint=qi.b2DistanceJointDef=void 0;const _i=jt,it=Dt,Eo=Yt,Tn=Ge,ie={worldPointA:new it.b2Vec2,worldPointB:new it.b2Vec2,vpA:new it.b2Vec2,vpB:new it.b2Vec2,vpBA:new it.b2Vec2,P:new it.b2Vec2,qA:new it.b2Rot,qB:new it.b2Rot,lalcA:new it.b2Vec2,lalcB:new it.b2Vec2,Draw:{pA:new it.b2Vec2,pB:new it.b2Vec2,axis:new it.b2Vec2,pRest:new it.b2Vec2,p1:new it.b2Vec2,p2:new it.b2Vec2}};class Jm extends Eo.b2JointDef{constructor(){super(Eo.b2JointType.e_distanceJoint),this.localAnchorA=new it.b2Vec2,this.localAnchorB=new it.b2Vec2,this.length=1,this.minLength=0,this.maxLength=_i.b2_maxFloat,this.stiffness=0,this.damping=0}Initialize(t,e,n,c){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(c,this.localAnchorB),this.length=Math.max(it.b2Vec2.Distance(n,c),_i.b2_linearSlop),this.minLength=this.length,this.maxLength=this.length}}qi.b2DistanceJointDef=Jm;class qm extends Eo.b2Joint{constructor(t){var e,n;super(t),this.m_bias=0,this.m_localAnchorA=new it.b2Vec2,this.m_localAnchorB=new it.b2Vec2,this.m_gamma=0,this.m_impulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new it.b2Vec2,this.m_rA=new it.b2Vec2,this.m_rB=new it.b2Vec2,this.m_localCenterA=new it.b2Vec2,this.m_localCenterB=new it.b2Vec2,this.m_currentLength=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_softMass=0,this.m_mass=0,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_length=Math.max(t.length,_i.b2_linearSlop),this.m_minLength=Math.max(t.minLength,_i.b2_linearSlop),this.m_maxLength=Math.max(t.maxLength,this.m_minLength),this.m_stiffness=(e=t.stiffness)!==null&&e!==void 0?e:0,this.m_damping=(n=t.damping)!==null&&n!==void 0?n:0}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){const n=t*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse);return e.x=n*this.m_u.x,e.y=n*this.m_u.y,e}GetReactionTorque(t){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetLength(t){return this.m_impulse=0,this.m_length=Math.max(_i.b2_linearSlop,t),this.m_length}GetLength(){return this.m_length}SetMinLength(t){return this.m_lowerImpulse=0,this.m_minLength=(0,it.b2Clamp)(t,_i.b2_linearSlop,this.m_maxLength),this.m_minLength}GetMinLength(){return this.m_minLength}SetMaxLength(t){return this.m_upperImpulse=0,this.m_maxLength=Math.max(t,this.m_minLength),this.m_maxLength}GetMaxLength(){return this.m_maxLength}GetCurrentLength(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,ie.worldPointA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,ie.worldPointB);return it.b2Vec2.Distance(e,t)}SetStiffness(t){this.m_stiffness=t}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t}GetDamping(){return this.m_damping}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,c=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const m=t.positions[this.m_indexB].c,u=t.positions[this.m_indexB].a,p=t.velocities[this.m_indexB].v;let b=t.velocities[this.m_indexB].w;const{qA:d,qB:A,lalcA:y,lalcB:f}=ie;d.Set(n),A.Set(u),it.b2Rot.MultiplyVec2(d,it.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,y),this.m_rA),it.b2Rot.MultiplyVec2(A,it.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,f),this.m_rB),this.m_u.x=m.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=m.y+this.m_rB.y-e.y-this.m_rA.y,this.m_currentLength=this.m_u.Length(),this.m_currentLength>_i.b2_linearSlop?this.m_u.Scale(1/this.m_currentLength):(this.m_u.SetZero(),this.m_mass=0,this.m_impulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0);const x=it.b2Vec2.Cross(this.m_rA,this.m_u),S=it.b2Vec2.Cross(this.m_rB,this.m_u);let V=this.m_invMassA+this.m_invIA*x*x+this.m_invMassB+this.m_invIB*S*S;if(this.m_mass=V!==0?1/V:0,this.m_stiffness>0&&this.m_minLength<this.m_maxLength){const C=this.m_currentLength-this.m_length,_=this.m_damping,g=this.m_stiffness,w=t.step.dt;this.m_gamma=w*(_+w*g),this.m_gamma=this.m_gamma!==0?1/this.m_gamma:0,this.m_bias=C*w*g*this.m_gamma,V+=this.m_gamma,this.m_softMass=V!==0?1/V:0}else this.m_gamma=0,this.m_bias=0,this.m_softMass=this.m_mass;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;const{P:C}=ie;it.b2Vec2.Scale(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse,this.m_u,C),c.SubtractScaled(this.m_invMassA,C),r-=this.m_invIA*it.b2Vec2.Cross(this.m_rA,C),p.AddScaled(this.m_invMassB,C),b+=this.m_invIB*it.b2Vec2.Cross(this.m_rB,C)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=b}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const c=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;if(this.m_minLength<this.m_maxLength){if(this.m_stiffness>0){const m=it.b2Vec2.AddCrossScalarVec2(e,n,this.m_rA,ie.vpA),u=it.b2Vec2.AddCrossScalarVec2(c,r,this.m_rB,ie.vpB),p=it.b2Vec2.Dot(this.m_u,it.b2Vec2.Subtract(u,m,ie.vpBA)),b=-this.m_softMass*(p+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=b;const d=it.b2Vec2.Scale(b,this.m_u,ie.P);e.SubtractScaled(this.m_invMassA,d),n-=this.m_invIA*it.b2Vec2.Cross(this.m_rA,d),c.AddScaled(this.m_invMassB,d),r+=this.m_invIB*it.b2Vec2.Cross(this.m_rB,d)}{const m=this.m_currentLength-this.m_minLength,u=Math.max(0,m)*t.step.inv_dt,p=it.b2Vec2.AddCrossScalarVec2(e,n,this.m_rA,ie.vpA),b=it.b2Vec2.AddCrossScalarVec2(c,r,this.m_rB,ie.vpB),d=it.b2Vec2.Dot(this.m_u,it.b2Vec2.Subtract(b,p,ie.vpBA));let A=-this.m_mass*(d+u);const y=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(0,this.m_lowerImpulse+A),A=this.m_lowerImpulse-y;const f=it.b2Vec2.Scale(A,this.m_u,ie.P);e.SubtractScaled(this.m_invMassA,f),n-=this.m_invIA*it.b2Vec2.Cross(this.m_rA,f),c.AddScaled(this.m_invMassB,f),r+=this.m_invIB*it.b2Vec2.Cross(this.m_rB,f)}{const m=this.m_maxLength-this.m_currentLength,u=Math.max(0,m)*t.step.inv_dt,p=it.b2Vec2.AddCrossScalarVec2(e,n,this.m_rA,ie.vpA),b=it.b2Vec2.AddCrossScalarVec2(c,r,this.m_rB,ie.vpB),d=it.b2Vec2.Dot(this.m_u,it.b2Vec2.Subtract(p,b,ie.vpBA));let A=-this.m_mass*(d+u);const y=this.m_upperImpulse;this.m_upperImpulse=Math.max(0,this.m_upperImpulse+A),A=this.m_upperImpulse-y;const f=it.b2Vec2.Scale(-A,this.m_u,ie.P);e.SubtractScaled(this.m_invMassA,f),n-=this.m_invIA*it.b2Vec2.Cross(this.m_rA,f),c.AddScaled(this.m_invMassB,f),r+=this.m_invIB*it.b2Vec2.Cross(this.m_rB,f)}}else{const m=it.b2Vec2.AddCrossScalarVec2(e,n,this.m_rA,ie.vpA),u=it.b2Vec2.AddCrossScalarVec2(c,r,this.m_rB,ie.vpB),p=it.b2Vec2.Dot(this.m_u,it.b2Vec2.Subtract(u,m,ie.vpBA)),b=-this.m_mass*p;this.m_impulse+=b;const d=it.b2Vec2.Scale(b,this.m_u,ie.P);e.SubtractScaled(this.m_invMassA,d),n-=this.m_invIA*it.b2Vec2.Cross(this.m_rA,d),c.AddScaled(this.m_invMassB,d),r+=this.m_invIB*it.b2Vec2.Cross(this.m_rB,d)}t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let n=t.positions[this.m_indexA].a;const c=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const{qA:m,qB:u,lalcA:p,lalcB:b,P:d}=ie;m.Set(n),u.Set(r);const A=it.b2Rot.MultiplyVec2(m,it.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,p),this.m_rA),y=it.b2Rot.MultiplyVec2(u,it.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,b),this.m_rB);this.m_u.x=c.x+y.x-e.x-A.x,this.m_u.y=c.y+y.y-e.y-A.y;const f=this.m_u.Normalize();let x;if(this.m_minLength===this.m_maxLength)x=f-this.m_minLength;else if(f<this.m_minLength)x=f-this.m_minLength;else if(this.m_maxLength<f)x=f-this.m_maxLength;else return!0;const S=-this.m_mass*x;return it.b2Vec2.Scale(S,this.m_u,d),e.SubtractScaled(this.m_invMassA,d),n-=this.m_invIA*it.b2Vec2.Cross(A,d),c.AddScaled(this.m_invMassB,d),r+=this.m_invIB*it.b2Vec2.Cross(y,d),t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,Math.abs(x)<_i.b2_linearSlop}Draw(t){const{pA:e,pB:n,axis:c,pRest:r}=ie.Draw,m=this.m_bodyA.GetTransform(),u=this.m_bodyB.GetTransform();if(it.b2Transform.MultiplyVec2(m,this.m_localAnchorA,e),it.b2Transform.MultiplyVec2(u,this.m_localAnchorB,n),it.b2Vec2.Subtract(n,e,c),c.Normalize(),t.DrawSegment(e,n,Tn.debugColors.joint5),it.b2Vec2.AddScaled(e,this.m_length,c,r),t.DrawPoint(r,8,Tn.debugColors.joint1),this.m_minLength!==this.m_maxLength){if(this.m_minLength>_i.b2_linearSlop){const p=it.b2Vec2.AddScaled(e,this.m_minLength,c,ie.Draw.p1);t.DrawPoint(p,4,Tn.debugColors.joint2)}if(this.m_maxLength<_i.b2_maxFloat){const p=it.b2Vec2.AddScaled(e,this.m_maxLength,c,ie.Draw.p1);t.DrawPoint(p,4,Tn.debugColors.joint3)}}}}qi.b2DistanceJoint=qm;Object.defineProperty(is,"__esModule",{value:!0});is.b2AreaJoint=is.b2AreaJointDef=void 0;const Xi=jt,hi=Dt,jo=Yt,zm=qi;class $m extends jo.b2JointDef{constructor(){super(jo.b2JointType.e_areaJoint),this.bodies=[],this.stiffness=0,this.damping=0}AddBody(t){this.bodies.push(t),this.bodies.length===1?this.bodyA=t:this.bodies.length===2&&(this.bodyB=t)}}is.b2AreaJointDef=$m;class Nm extends jo.b2Joint{constructor(t){var e,n;super(t),this.m_stiffness=0,this.m_damping=0,this.m_impulse=0,this.m_targetArea=0,this.m_joints=[],this.m_delta=new hi.b2Vec2,this.m_bodies=t.bodies,this.m_stiffness=(e=t.stiffness)!==null&&e!==void 0?e:0,this.m_damping=(n=t.damping)!==null&&n!==void 0?n:0,this.m_targetLengths=(0,Xi.b2MakeNumberArray)(t.bodies.length),this.m_normals=(0,Xi.b2MakeArray)(t.bodies.length,hi.b2Vec2),this.m_deltas=(0,Xi.b2MakeArray)(t.bodies.length,hi.b2Vec2);const c=new zm.b2DistanceJointDef;c.stiffness=this.m_stiffness,c.damping=this.m_damping,this.m_targetArea=0;for(let r=0;r<this.m_bodies.length;++r){const m=this.m_bodies[r],u=this.m_bodies[(r+1)%this.m_bodies.length],p=m.GetWorldCenter(),b=u.GetWorldCenter();this.m_targetLengths[r]=hi.b2Vec2.Distance(p,b),this.m_targetArea+=hi.b2Vec2.Cross(p,b),c.Initialize(m,u,p,b),this.m_joints[r]=m.GetWorld().CreateJoint(c)}this.m_targetArea*=.5}GetAnchorA(t){return t}GetAnchorB(t){return t}GetReactionForce(t,e){return e}GetReactionTorque(t){return 0}SetStiffness(t){this.m_stiffness=t;for(const e of this.m_joints)e.SetStiffness(t)}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t;for(const e of this.m_joints)e.SetDamping(t)}GetDamping(){return this.m_damping}InitVelocityConstraints(t){for(let e=0;e<this.m_bodies.length;++e){const n=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],c=this.m_bodies[(e+1)%this.m_bodies.length],r=t.positions[n.m_islandIndex].c,m=t.positions[c.m_islandIndex].c,u=this.m_deltas[e];hi.b2Vec2.Subtract(m,r,u)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(let e=0;e<this.m_bodies.length;++e){const n=this.m_bodies[e],c=t.velocities[n.m_islandIndex].v,r=this.m_deltas[e];c.x+=n.m_invMass*r.y*.5*this.m_impulse,c.y+=n.m_invMass*-r.x*.5*this.m_impulse}}else this.m_impulse=0}SolveVelocityConstraints(t){let e=0,n=0;for(let r=0;r<this.m_bodies.length;++r){const m=this.m_bodies[r],u=t.velocities[m.m_islandIndex].v,p=this.m_deltas[r];e+=p.LengthSquared()/m.GetMass(),n+=hi.b2Vec2.Cross(u,p)}const c=-2*n/e;this.m_impulse+=c;for(let r=0;r<this.m_bodies.length;++r){const m=this.m_bodies[r],u=t.velocities[m.m_islandIndex].v,p=this.m_deltas[r];u.x+=m.m_invMass*p.y*.5*c,u.y+=m.m_invMass*-p.x*.5*c}}SolvePositionConstraints(t){let e=0,n=0;for(let u=0;u<this.m_bodies.length;++u){const p=this.m_bodies[u],b=this.m_bodies[(u+1)%this.m_bodies.length],d=t.positions[p.m_islandIndex].c,A=t.positions[b.m_islandIndex].c,y=hi.b2Vec2.Subtract(A,d,this.m_delta);let f=y.Length();f<Xi.b2_epsilon&&(f=1),this.m_normals[u].x=y.y/f,this.m_normals[u].y=-y.x/f,e+=f,n+=hi.b2Vec2.Cross(d,A)}n*=.5;const r=.5*(this.m_targetArea-n)/e;let m=!0;for(let u=0;u<this.m_bodies.length;++u){const p=this.m_bodies[u],b=t.positions[p.m_islandIndex].c,d=(u+1)%this.m_bodies.length,A=hi.b2Vec2.Add(this.m_normals[u],this.m_normals[d],this.m_delta);A.Scale(r);const y=A.LengthSquared();y>Xi.b2_maxLinearCorrection**2&&A.Scale(Xi.b2_maxLinearCorrection/Math.sqrt(y)),y>Xi.b2_linearSlop**2&&(m=!1),b.Add(A)}return m}}is.b2AreaJoint=Nm;var ss={};Object.defineProperty(ss,"__esModule",{value:!0});ss.b2FrictionJoint=ss.b2FrictionJointDef=void 0;const Ft=Dt,Oo=Yt,Ba={qA:new Ft.b2Rot,qB:new Ft.b2Rot,lalcA:new Ft.b2Vec2,lalcB:new Ft.b2Vec2,Cdot:new Ft.b2Vec2,impulse:new Ft.b2Vec2,oldImpulse:new Ft.b2Vec2};class Wm extends Oo.b2JointDef{constructor(){super(Oo.b2JointType.e_frictionJoint),this.localAnchorA=new Ft.b2Vec2,this.localAnchorB=new Ft.b2Vec2,this.maxForce=0,this.maxTorque=0}Initialize(t,e,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB)}}ss.b2FrictionJointDef=Wm;class Hm extends Oo.b2Joint{constructor(t){var e,n;super(t),this.m_localAnchorA=new Ft.b2Vec2,this.m_localAnchorB=new Ft.b2Vec2,this.m_linearImpulse=new Ft.b2Vec2,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new Ft.b2Vec2,this.m_rB=new Ft.b2Vec2,this.m_localCenterA=new Ft.b2Vec2,this.m_localCenterB=new Ft.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new Ft.b2Mat22,this.m_angularMass=0,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_linearImpulse.SetZero(),this.m_maxForce=(e=t.maxForce)!==null&&e!==void 0?e:0,this.m_maxTorque=(n=t.maxTorque)!==null&&n!==void 0?n:0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let c=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let u=t.velocities[this.m_indexB].w;const{qA:p,qB:b,lalcA:d,lalcB:A}=Ba;p.Set(e),b.Set(r),Ft.b2Rot.MultiplyVec2(p,Ft.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,d),this.m_rA),Ft.b2Rot.MultiplyVec2(b,Ft.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,A),this.m_rB);const y=this.m_invMassA,f=this.m_invMassB,x=this.m_invIA,S=this.m_invIB,V=this.m_linearMass;if(V.ex.x=y+f+x*this.m_rA.y*this.m_rA.y+S*this.m_rB.y*this.m_rB.y,V.ex.y=-x*this.m_rA.x*this.m_rA.y-S*this.m_rB.x*this.m_rB.y,V.ey.x=V.ex.y,V.ey.y=y+f+x*this.m_rA.x*this.m_rA.x+S*this.m_rB.x*this.m_rB.x,V.Inverse(),this.m_angularMass=x+S,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.Scale(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const C=this.m_linearImpulse;n.SubtractScaled(y,C),c-=x*(Ft.b2Vec2.Cross(this.m_rA,C)+this.m_angularImpulse),m.AddScaled(f,C),u+=S*(Ft.b2Vec2.Cross(this.m_rB,C)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=c,t.velocities[this.m_indexB].w=u}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const c=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const m=this.m_invMassA,u=this.m_invMassB,p=this.m_invIA,b=this.m_invIB,d=t.step.dt;{const A=r-n;let y=-this.m_angularMass*A;const f=this.m_angularImpulse,x=d*this.m_maxTorque;this.m_angularImpulse=(0,Ft.b2Clamp)(this.m_angularImpulse+y,-x,x),y=this.m_angularImpulse-f,n-=p*y,r+=b*y}{const{Cdot:A,impulse:y,oldImpulse:f}=Ba;Ft.b2Vec2.Subtract(Ft.b2Vec2.AddCrossScalarVec2(c,r,this.m_rB,Ft.b2Vec2.s_t0),Ft.b2Vec2.AddCrossScalarVec2(e,n,this.m_rA,Ft.b2Vec2.s_t1),A),Ft.b2Mat22.MultiplyVec2(this.m_linearMass,A,y).Negate(),f.Copy(this.m_linearImpulse),this.m_linearImpulse.Add(y);const x=d*this.m_maxForce;this.m_linearImpulse.LengthSquared()>x*x&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Scale(x)),Ft.b2Vec2.Subtract(this.m_linearImpulse,f,y),e.SubtractScaled(m,y),n-=p*Ft.b2Vec2.Cross(this.m_rA,y),c.AddScaled(u,y),r+=b*Ft.b2Vec2.Cross(this.m_rB,y)}t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){return!0}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e}GetReactionTorque(t){return t*this.m_angularImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}}ss.b2FrictionJoint=Hm;var ns={};Object.defineProperty(ns,"__esModule",{value:!0});ns.b2GearJoint=ns.b2GearJointDef=void 0;const Va=jt,K=Dt,oi=Yt,As={qA:new K.b2Rot,qB:new K.b2Rot,qC:new K.b2Rot,qD:new K.b2Rot,lalcA:new K.b2Vec2,lalcB:new K.b2Vec2,lalcC:new K.b2Vec2,lalcD:new K.b2Vec2,u:new K.b2Vec2,rA:new K.b2Vec2,rB:new K.b2Vec2,rC:new K.b2Vec2,rD:new K.b2Vec2,JvAC:new K.b2Vec2,JvBD:new K.b2Vec2};class Zm extends oi.b2JointDef{constructor(){super(oi.b2JointType.e_gearJoint),this.ratio=1}}ns.b2GearJointDef=Zm;class Xm extends oi.b2Joint{constructor(t){var e;super(t),this.m_typeA=oi.b2JointType.e_unknownJoint,this.m_typeB=oi.b2JointType.e_unknownJoint,this.m_localAnchorA=new K.b2Vec2,this.m_localAnchorB=new K.b2Vec2,this.m_localAnchorC=new K.b2Vec2,this.m_localAnchorD=new K.b2Vec2,this.m_localAxisC=new K.b2Vec2,this.m_localAxisD=new K.b2Vec2,this.m_referenceAngleA=0,this.m_referenceAngleB=0,this.m_constant=0,this.m_ratio=0,this.m_tolerance=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_indexC=0,this.m_indexD=0,this.m_lcA=new K.b2Vec2,this.m_lcB=new K.b2Vec2,this.m_lcC=new K.b2Vec2,this.m_lcD=new K.b2Vec2,this.m_mA=0,this.m_mB=0,this.m_mC=0,this.m_mD=0,this.m_iA=0,this.m_iB=0,this.m_iC=0,this.m_iD=0,this.m_JvAC=new K.b2Vec2,this.m_JvBD=new K.b2Vec2,this.m_JwA=0,this.m_JwB=0,this.m_JwC=0,this.m_JwD=0,this.m_mass=0,this.m_joint1=t.joint1,this.m_joint2=t.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType();let n,c;this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();const r=this.m_bodyA.m_xf,m=this.m_bodyA.m_sweep.a,u=this.m_bodyC.m_xf,p=this.m_bodyC.m_sweep.a;if(this.m_typeA===oi.b2JointType.e_revoluteJoint){const f=t.joint1;this.m_localAnchorC.Copy(f.m_localAnchorA),this.m_localAnchorA.Copy(f.m_localAnchorB),this.m_referenceAngleA=f.m_referenceAngle,this.m_localAxisC.SetZero(),n=m-p-this.m_referenceAngleA,this.m_tolerance=Va.b2_angularSlop}else{const f=t.joint1;this.m_localAnchorC.Copy(f.m_localAnchorA),this.m_localAnchorA.Copy(f.m_localAnchorB),this.m_referenceAngleA=f.m_referenceAngle,this.m_localAxisC.Copy(f.m_localXAxisA);const x=this.m_localAnchorC,S=K.b2Rot.TransposeMultiplyVec2(u.q,K.b2Rot.MultiplyVec2(r.q,this.m_localAnchorA,K.b2Vec2.s_t0).Add(r.p).Subtract(u.p),K.b2Vec2.s_t0);n=K.b2Vec2.Dot(S.Subtract(x),this.m_localAxisC),this.m_tolerance=Va.b2_linearSlop}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();const b=this.m_bodyB.m_xf,d=this.m_bodyB.m_sweep.a,A=this.m_bodyD.m_xf,y=this.m_bodyD.m_sweep.a;if(this.m_typeB===oi.b2JointType.e_revoluteJoint){const f=t.joint2;this.m_localAnchorD.Copy(f.m_localAnchorA),this.m_localAnchorB.Copy(f.m_localAnchorB),this.m_referenceAngleB=f.m_referenceAngle,this.m_localAxisD.SetZero(),c=d-y-this.m_referenceAngleB}else{const f=t.joint2;this.m_localAnchorD.Copy(f.m_localAnchorA),this.m_localAnchorB.Copy(f.m_localAnchorB),this.m_referenceAngleB=f.m_referenceAngle,this.m_localAxisD.Copy(f.m_localXAxisA);const x=this.m_localAnchorD,S=K.b2Rot.TransposeMultiplyVec2(A.q,K.b2Rot.MultiplyVec2(b.q,this.m_localAnchorB,K.b2Vec2.s_t0).Add(b.p).Subtract(A.p),K.b2Vec2.s_t0);c=K.b2Vec2.Dot(S.Subtract(x),this.m_localAxisD)}this.m_ratio=(e=t.ratio)!==null&&e!==void 0?e:1,this.m_constant=n+this.m_ratio*c,this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;const e=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let c=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let u=t.velocities[this.m_indexB].w;const p=t.positions[this.m_indexC].a,b=t.velocities[this.m_indexC].v;let d=t.velocities[this.m_indexC].w;const A=t.positions[this.m_indexD].a,y=t.velocities[this.m_indexD].v;let f=t.velocities[this.m_indexD].w;const{qA:x,qB:S,qC:V,qD:C}=As;if(x.Set(e),S.Set(r),V.Set(p),C.Set(A),this.m_mass=0,this.m_typeA===oi.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{const{u:_,rC:g,rA:w,lalcA:M,lalcC:L}=As;K.b2Rot.MultiplyVec2(V,this.m_localAxisC,_),K.b2Rot.MultiplyVec2(V,K.b2Vec2.Subtract(this.m_localAnchorC,this.m_lcC,L),g),K.b2Rot.MultiplyVec2(x,K.b2Vec2.Subtract(this.m_localAnchorA,this.m_lcA,M),w),this.m_JvAC.Copy(_),this.m_JwC=K.b2Vec2.Cross(g,_),this.m_JwA=K.b2Vec2.Cross(w,_),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===oi.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{const{u:_,rB:g,rD:w,lalcB:M,lalcD:L}=As;K.b2Rot.MultiplyVec2(C,this.m_localAxisD,_),K.b2Rot.MultiplyVec2(C,K.b2Vec2.Subtract(this.m_localAnchorD,this.m_lcD,L),w),K.b2Rot.MultiplyVec2(S,K.b2Vec2.Subtract(this.m_localAnchorB,this.m_lcB,M),g),K.b2Vec2.Scale(this.m_ratio,_,this.m_JvBD),this.m_JwD=this.m_ratio*K.b2Vec2.Cross(w,_),this.m_JwB=this.m_ratio*K.b2Vec2.Cross(g,_),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(n.AddScaled(this.m_mA*this.m_impulse,this.m_JvAC),c+=this.m_iA*this.m_impulse*this.m_JwA,m.AddScaled(this.m_mB*this.m_impulse,this.m_JvBD),u+=this.m_iB*this.m_impulse*this.m_JwB,b.SubtractScaled(this.m_mC*this.m_impulse,this.m_JvAC),d-=this.m_iC*this.m_impulse*this.m_JwC,y.SubtractScaled(this.m_mD*this.m_impulse,this.m_JvBD),f-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=c,t.velocities[this.m_indexB].w=u,t.velocities[this.m_indexC].w=d,t.velocities[this.m_indexD].w=f}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const c=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const m=t.velocities[this.m_indexC].v;let u=t.velocities[this.m_indexC].w;const p=t.velocities[this.m_indexD].v;let b=t.velocities[this.m_indexD].w,d=K.b2Vec2.Dot(this.m_JvAC,K.b2Vec2.Subtract(e,m,K.b2Vec2.s_t0))+K.b2Vec2.Dot(this.m_JvBD,K.b2Vec2.Subtract(c,p,K.b2Vec2.s_t0));d+=this.m_JwA*n-this.m_JwC*u+(this.m_JwB*r-this.m_JwD*b);const A=-this.m_mass*d;this.m_impulse+=A,e.AddScaled(this.m_mA*A,this.m_JvAC),n+=this.m_iA*A*this.m_JwA,c.AddScaled(this.m_mB*A,this.m_JvBD),r+=this.m_iB*A*this.m_JwB,m.SubtractScaled(this.m_mC*A,this.m_JvAC),u-=this.m_iC*A*this.m_JwC,p.SubtractScaled(this.m_mD*A,this.m_JvBD),b-=this.m_iD*A*this.m_JwD,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r,t.velocities[this.m_indexC].w=u,t.velocities[this.m_indexD].w=b}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let n=t.positions[this.m_indexA].a;const c=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const m=t.positions[this.m_indexC].c;let u=t.positions[this.m_indexC].a;const p=t.positions[this.m_indexD].c;let b=t.positions[this.m_indexD].a;const{qA:d,qB:A,qC:y,qD:f,JvAC:x,JvBD:S}=As;d.Set(n),A.Set(r),y.Set(u),f.Set(b);let V,C,_,g,w,M,L=0;if(this.m_typeA===oi.b2JointType.e_revoluteJoint)x.SetZero(),_=1,w=1,L+=this.m_iA+this.m_iC,V=n-u-this.m_referenceAngleA;else{const{u:N,rC:G,rA:H,lalcC:k,lalcA:j}=As;K.b2Rot.MultiplyVec2(y,this.m_localAxisC,N),K.b2Rot.MultiplyVec2(y,K.b2Vec2.Subtract(this.m_localAnchorC,this.m_lcC,k),G),K.b2Rot.MultiplyVec2(d,K.b2Vec2.Subtract(this.m_localAnchorA,this.m_lcA,j),H),x.Copy(N),w=K.b2Vec2.Cross(G,N),_=K.b2Vec2.Cross(H,N),L+=this.m_mC+this.m_mA+this.m_iC*w*w+this.m_iA*_*_;const O=k,W=K.b2Rot.TransposeMultiplyVec2(y,K.b2Vec2.Add(H,e,K.b2Vec2.s_t0).Subtract(m),K.b2Vec2.s_t0);V=K.b2Vec2.Dot(K.b2Vec2.Subtract(W,O,K.b2Vec2.s_t0),this.m_localAxisC)}if(this.m_typeB===oi.b2JointType.e_revoluteJoint)S.SetZero(),g=this.m_ratio,M=this.m_ratio,L+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),C=r-b-this.m_referenceAngleB;else{const{u:N,rD:G,rB:H,lalcD:k,lalcB:j}=As;K.b2Rot.MultiplyVec2(f,this.m_localAxisD,N),K.b2Rot.MultiplyVec2(f,K.b2Vec2.Subtract(this.m_localAnchorD,this.m_lcD,k),G),K.b2Rot.MultiplyVec2(A,K.b2Vec2.Subtract(this.m_localAnchorB,this.m_lcB,j),H),K.b2Vec2.Scale(this.m_ratio,N,S),M=this.m_ratio*K.b2Vec2.Cross(G,N),g=this.m_ratio*K.b2Vec2.Cross(H,N),L+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*M*M+this.m_iB*g*g;const O=k,W=K.b2Rot.TransposeMultiplyVec2(f,K.b2Vec2.Add(H,c,K.b2Vec2.s_t0).Subtract(p),K.b2Vec2.s_t0);C=K.b2Vec2.Dot(W.Subtract(O),this.m_localAxisD)}const R=V+this.m_ratio*C-this.m_constant;let z=0;return L>0&&(z=-R/L),e.AddScaled(this.m_mA*z,x),n+=this.m_iA*z*_,c.AddScaled(this.m_mB*z,S),r+=this.m_iB*z*g,m.SubtractScaled(this.m_mC*z,x),u-=this.m_iC*z*w,p.SubtractScaled(this.m_mD*z,S),b-=this.m_iD*z*M,t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,t.positions[this.m_indexC].a=u,t.positions[this.m_indexD].a=b,Math.abs(R)<this.m_tolerance}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return K.b2Vec2.Scale(t*this.m_impulse,this.m_JvAC,e)}GetReactionTorque(t){return t*this.m_impulse*this.m_JwA}GetJoint1(){return this.m_joint1}GetJoint2(){return this.m_joint2}GetRatio(){return this.m_ratio}SetRatio(t){this.m_ratio=t}}ns.b2GearJoint=Xm;var os={};Object.defineProperty(os,"__esModule",{value:!0});os.b2MotorJoint=os.b2MotorJointDef=void 0;const vt=Dt,Jo=Yt,Ca={qA:new vt.b2Rot,qB:new vt.b2Rot,K:new vt.b2Mat22,Cdot:new vt.b2Vec2,impulse:new vt.b2Vec2,oldImpulse:new vt.b2Vec2};class Ym extends Jo.b2JointDef{constructor(){super(Jo.b2JointType.e_motorJoint),this.linearOffset=new vt.b2Vec2,this.angularOffset=0,this.maxForce=1,this.maxTorque=1,this.correctionFactor=.3}Initialize(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(e.GetPosition(),this.linearOffset);const n=t.GetAngle(),c=e.GetAngle();this.angularOffset=c-n}}os.b2MotorJointDef=Ym;class Qm extends Jo.b2Joint{constructor(t){var e,n,c,r,m;super(t),this.m_linearOffset=new vt.b2Vec2,this.m_linearImpulse=new vt.b2Vec2,this.m_angularImpulse=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new vt.b2Vec2,this.m_rB=new vt.b2Vec2,this.m_localCenterA=new vt.b2Vec2,this.m_localCenterB=new vt.b2Vec2,this.m_linearError=new vt.b2Vec2,this.m_angularError=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new vt.b2Mat22,this.m_angularMass=0,this.m_linearOffset.Copy((e=t.linearOffset)!==null&&e!==void 0?e:vt.b2Vec2.ZERO),this.m_angularOffset=(n=t.angularOffset)!==null&&n!==void 0?n:0,this.m_linearImpulse.SetZero(),this.m_maxForce=(c=t.maxForce)!==null&&c!==void 0?c:1,this.m_maxTorque=(r=t.maxTorque)!==null&&r!==void 0?r:1,this.m_correctionFactor=(m=t.correctionFactor)!==null&&m!==void 0?m:.3}GetAnchorA(t){const e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t}GetAnchorB(t){const e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t}GetReactionForce(t,e){return vt.b2Vec2.Scale(t,this.m_linearImpulse,e)}GetReactionTorque(t){return t*this.m_angularImpulse}SetLinearOffset(t){vt.b2Vec2.Equals(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}GetLinearOffset(){return this.m_linearOffset}SetAngularOffset(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}GetAngularOffset(){return this.m_angularOffset}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}GetCorrectionFactor(){return this.m_correctionFactor}SetCorrectionFactor(t){this.m_correctionFactor=t}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,c=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const m=t.positions[this.m_indexB].c,u=t.positions[this.m_indexB].a,p=t.velocities[this.m_indexB].v;let b=t.velocities[this.m_indexB].w;const{qA:d,qB:A}=Ca;d.Set(n),A.Set(u);const y=vt.b2Rot.MultiplyVec2(d,vt.b2Vec2.Subtract(this.m_linearOffset,this.m_localCenterA,vt.b2Vec2.s_t0),this.m_rA),f=vt.b2Rot.MultiplyVec2(A,vt.b2Vec2.Negate(this.m_localCenterB,vt.b2Vec2.s_t0),this.m_rB),x=this.m_invMassA,S=this.m_invMassB,V=this.m_invIA,C=this.m_invIB,_=this.m_linearMass;if(_.ex.x=x+S+V*y.y*y.y+C*f.y*f.y,_.ex.y=-V*y.x*y.y-C*f.x*f.y,_.ey.x=_.ex.y,_.ey.y=x+S+V*y.x*y.x+C*f.x*f.x,_.Inverse(),this.m_angularMass=V+C,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),vt.b2Vec2.Subtract(vt.b2Vec2.Add(m,f,vt.b2Vec2.s_t0),vt.b2Vec2.Add(e,y,vt.b2Vec2.s_t1),this.m_linearError),this.m_angularError=u-n-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.Scale(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const g=this.m_linearImpulse;c.SubtractScaled(x,g),r-=V*(vt.b2Vec2.Cross(y,g)+this.m_angularImpulse),p.AddScaled(S,g),b+=C*(vt.b2Vec2.Cross(f,g)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=b}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const c=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const m=this.m_invMassA,u=this.m_invMassB,p=this.m_invIA,b=this.m_invIB,d=t.step.dt,A=t.step.inv_dt;{const y=r-n+A*this.m_correctionFactor*this.m_angularError;let f=-this.m_angularMass*y;const x=this.m_angularImpulse,S=d*this.m_maxTorque;this.m_angularImpulse=(0,vt.b2Clamp)(this.m_angularImpulse+f,-S,S),f=this.m_angularImpulse-x,n-=p*f,r+=b*f}{const{impulse:y,oldImpulse:f,Cdot:x}=Ca;vt.b2Vec2.AddScaled(vt.b2Vec2.Subtract(vt.b2Vec2.AddCrossScalarVec2(c,r,this.m_rB,vt.b2Vec2.s_t0),vt.b2Vec2.AddCrossScalarVec2(e,n,this.m_rA,vt.b2Vec2.s_t1),vt.b2Vec2.s_t2),A*this.m_correctionFactor,this.m_linearError,x),vt.b2Mat22.MultiplyVec2(this.m_linearMass,x,y).Negate(),f.Copy(this.m_linearImpulse),this.m_linearImpulse.Add(y);const S=d*this.m_maxForce;this.m_linearImpulse.LengthSquared()>S*S&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Scale(S)),vt.b2Vec2.Subtract(this.m_linearImpulse,f,y),e.SubtractScaled(m,y),n-=p*vt.b2Vec2.Cross(this.m_rA,y),c.AddScaled(u,y),r+=b*vt.b2Vec2.Cross(this.m_rB,y)}t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){return!0}}os.b2MotorJoint=Qm;var rs={};Object.defineProperty(rs,"__esModule",{value:!0});rs.b2MouseJoint=rs.b2MouseJointDef=void 0;const Po=Ge,$t=Dt,qo=Yt,Dn={qB:new $t.b2Rot,lalcB:new $t.b2Vec2,Cdot:new $t.b2Vec2,impulse:new $t.b2Vec2,oldImpulse:new $t.b2Vec2,pA:new $t.b2Vec2,pB:new $t.b2Vec2};class Um extends qo.b2JointDef{constructor(){super(qo.b2JointType.e_mouseJoint),this.target=new $t.b2Vec2,this.maxForce=0,this.stiffness=0,this.damping=0}}rs.b2MouseJointDef=Um;class Km extends qo.b2Joint{constructor(t){var e,n,c,r;super(t),this.m_localAnchorB=new $t.b2Vec2,this.m_targetA=new $t.b2Vec2,this.m_stiffness=0,this.m_damping=0,this.m_beta=0,this.m_impulse=new $t.b2Vec2,this.m_maxForce=0,this.m_gamma=0,this.m_indexB=0,this.m_rB=new $t.b2Vec2,this.m_localCenterB=new $t.b2Vec2,this.m_invMassB=0,this.m_invIB=0,this.m_mass=new $t.b2Mat22,this.m_C=new $t.b2Vec2,this.m_targetA.Copy((e=t.target)!==null&&e!==void 0?e:$t.b2Vec2.ZERO),$t.b2Transform.TransposeMultiplyVec2(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=(n=t.maxForce)!==null&&n!==void 0?n:0,this.m_stiffness=(c=t.stiffness)!==null&&c!==void 0?c:0,this.m_damping=(r=t.damping)!==null&&r!==void 0?r:0,this.m_beta=0,this.m_gamma=0}SetTarget(t){$t.b2Vec2.Equals(t,this.m_targetA)||(this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t))}GetTarget(){return this.m_targetA}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetStiffness(t){this.m_stiffness=t}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t}GetDamping(){return this.m_damping}InitVelocityConstraints(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexB].c,n=t.positions[this.m_indexB].a,c=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const{qB:m,lalcB:u}=Dn;m.Set(n);const p=this.m_damping,b=this.m_stiffness,d=t.step.dt;this.m_gamma=d*(p+d*b),this.m_gamma!==0&&(this.m_gamma=1/this.m_gamma),this.m_beta=d*b*this.m_gamma,$t.b2Rot.MultiplyVec2(m,$t.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,u),this.m_rB);const A=this.m_mass;A.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,A.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,A.ey.x=A.ex.y,A.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,A.Inverse(),$t.b2Vec2.Add(e,this.m_rB,this.m_C).Subtract(this.m_targetA),this.m_C.Scale(this.m_beta),r*=Math.max(0,1-.02*(60*t.step.dt)),t.step.warmStarting?(this.m_impulse.Scale(t.step.dtRatio),c.AddScaled(this.m_invMassB,this.m_impulse),r+=this.m_invIB*$t.b2Vec2.Cross(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=r}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const{Cdot:c,impulse:r,oldImpulse:m}=Dn;$t.b2Vec2.AddCrossScalarVec2(e,n,this.m_rB,c),$t.b2Mat22.MultiplyVec2(this.m_mass,$t.b2Vec2.Add(c,this.m_C,r).AddScaled(this.m_gamma,this.m_impulse).Negate(),r),m.Copy(this.m_impulse),this.m_impulse.Add(r);const u=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>u*u&&this.m_impulse.Scale(u/this.m_impulse.Length()),$t.b2Vec2.Subtract(this.m_impulse,m,r),e.AddScaled(this.m_invMassB,r),n+=this.m_invIB*$t.b2Vec2.Cross(this.m_rB,r),t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){return!0}GetAnchorA(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return $t.b2Vec2.Scale(t,this.m_impulse,e)}GetReactionTorque(t){return 0}ShiftOrigin(t){this.m_targetA.Subtract(t)}Draw(t){const e=this.GetAnchorA(Dn.pA),n=this.GetAnchorB(Dn.pB);t.DrawPoint(e,4,Po.debugColors.joint7),t.DrawPoint(n,4,Po.debugColors.joint7),t.DrawSegment(e,n,Po.debugColors.joint8)}}rs.b2MouseJoint=Km;var as={};Object.defineProperty(as,"__esModule",{value:!0});as.b2PrismaticJoint=as.b2PrismaticJointDef=void 0;const To=jt,Yi=Ge,J=Dt,zo=Yt,Je={K3:new J.b2Mat33,K2:new J.b2Mat22,qA:new J.b2Rot,qB:new J.b2Rot,lalcA:new J.b2Vec2,lalcB:new J.b2Vec2,rA:new J.b2Vec2,rB:new J.b2Vec2,GetJointTranslation:{pA:new J.b2Vec2,pB:new J.b2Vec2,d:new J.b2Vec2,axis:new J.b2Vec2},InitVelocityConstraints:{d:new J.b2Vec2,P:new J.b2Vec2},SolveVelocityConstraints:{P:new J.b2Vec2,df:new J.b2Vec2},SolvePositionConstraints:{d:new J.b2Vec2,impulse:new J.b2Vec3,impulse1:new J.b2Vec2,P:new J.b2Vec2},Draw:{p1:new J.b2Vec2,p2:new J.b2Vec2,pA:new J.b2Vec2,pB:new J.b2Vec2,axis:new J.b2Vec2,lower:new J.b2Vec2,upper:new J.b2Vec2,perp:new J.b2Vec2}};class th extends zo.b2JointDef{constructor(){super(zo.b2JointType.e_prismaticJoint),this.localAnchorA=new J.b2Vec2,this.localAnchorB=new J.b2Vec2,this.localAxisA=new J.b2Vec2(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0}Initialize(t,e,n,c){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.bodyA.GetLocalVector(c,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}as.b2PrismaticJointDef=th;class eh extends zo.b2Joint{constructor(t){var e,n,c,r,m,u,p,b,d,A;super(t),this.m_localAnchorA=new J.b2Vec2,this.m_localAnchorB=new J.b2Vec2,this.m_localXAxisA=new J.b2Vec2,this.m_localYAxisA=new J.b2Vec2,this.m_referenceAngle=0,this.m_impulse=new J.b2Vec2,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_lowerTranslation=0,this.m_upperTranslation=0,this.m_maxMotorForce=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_enableMotor=!1,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new J.b2Vec2,this.m_localCenterB=new J.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_axis=new J.b2Vec2,this.m_perp=new J.b2Vec2,this.m_s1=0,this.m_s2=0,this.m_a1=0,this.m_a2=0,this.m_K=new J.b2Mat22,this.m_translation=0,this.m_axialMass=0,this.m_localAnchorA.Copy((e=t.localAnchorA)!==null&&e!==void 0?e:J.b2Vec2.ZERO),this.m_localAnchorB.Copy((n=t.localAnchorB)!==null&&n!==void 0?n:J.b2Vec2.ZERO),J.b2Vec2.Normalize((c=t.localAxisA)!==null&&c!==void 0?c:J.b2Vec2.UNITX,this.m_localXAxisA),J.b2Vec2.CrossOneVec2(this.m_localXAxisA,this.m_localYAxisA),this.m_referenceAngle=(r=t.referenceAngle)!==null&&r!==void 0?r:0,this.m_lowerTranslation=(m=t.lowerTranslation)!==null&&m!==void 0?m:0,this.m_upperTranslation=(u=t.upperTranslation)!==null&&u!==void 0?u:0,this.m_maxMotorForce=(p=t.maxMotorForce)!==null&&p!==void 0?p:0,this.m_motorSpeed=(b=t.motorSpeed)!==null&&b!==void 0?b:0,this.m_enableLimit=(d=t.enableLimit)!==null&&d!==void 0?d:!1,this.m_enableMotor=(A=t.enableMotor)!==null&&A!==void 0?A:!1}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,c=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const m=t.positions[this.m_indexB].c,u=t.positions[this.m_indexB].a,p=t.velocities[this.m_indexB].v;let b=t.velocities[this.m_indexB].w;const{qA:d,qB:A,lalcA:y,lalcB:f,rA:x,rB:S}=Je;d.Set(n),A.Set(u),J.b2Rot.MultiplyVec2(d,J.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,y),x),J.b2Rot.MultiplyVec2(A,J.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,f),S);const V=J.b2Vec2.Subtract(m,e,Je.InitVelocityConstraints.d).Add(S).Subtract(x),C=this.m_invMassA,_=this.m_invMassB,g=this.m_invIA,w=this.m_invIB;J.b2Rot.MultiplyVec2(d,this.m_localXAxisA,this.m_axis),this.m_a1=J.b2Vec2.Cross(J.b2Vec2.Add(V,x,J.b2Vec2.s_t0),this.m_axis),this.m_a2=J.b2Vec2.Cross(S,this.m_axis),this.m_axialMass=C+_+g*this.m_a1*this.m_a1+w*this.m_a2*this.m_a2,this.m_axialMass>0&&(this.m_axialMass=1/this.m_axialMass),J.b2Rot.MultiplyVec2(d,this.m_localYAxisA,this.m_perp),this.m_s1=J.b2Vec2.Cross(J.b2Vec2.Add(V,x,J.b2Vec2.s_t0),this.m_perp),this.m_s2=J.b2Vec2.Cross(S,this.m_perp);const M=C+_+g*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2,L=g*this.m_s1+w*this.m_s2;let R=g+w;if(R===0&&(R=1),this.m_K.ex.Set(M,L),this.m_K.ey.Set(L,R),this.m_enableLimit?this.m_translation=J.b2Vec2.Dot(this.m_axis,V):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.Scale(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;const z=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,{P:N}=Je.InitVelocityConstraints;J.b2Vec2.Scale(this.m_impulse.x,this.m_perp,N).AddScaled(z,this.m_axis);const G=this.m_impulse.x*this.m_s1+this.m_impulse.y+z*this.m_a1,H=this.m_impulse.x*this.m_s2+this.m_impulse.y+z*this.m_a2;c.SubtractScaled(C,N),r-=g*G,p.AddScaled(_,N),b+=w*H}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=b}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const c=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const m=this.m_invMassA,u=this.m_invMassB,p=this.m_invIA,b=this.m_invIB,{P:d,df:A}=Je.SolveVelocityConstraints;if(this.m_enableMotor){const y=J.b2Vec2.Dot(this.m_axis,J.b2Vec2.Subtract(c,e,J.b2Vec2.s_t0))+this.m_a2*r-this.m_a1*n;let f=this.m_axialMass*(this.m_motorSpeed-y);const x=this.m_motorImpulse,S=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=(0,J.b2Clamp)(this.m_motorImpulse+f,-S,S),f=this.m_motorImpulse-x,J.b2Vec2.Scale(f,this.m_axis,d);const V=f*this.m_a1,C=f*this.m_a2;e.SubtractScaled(m,d),n-=p*V,c.AddScaled(u,d),r+=b*C}if(this.m_enableLimit){{const y=this.m_translation-this.m_lowerTranslation,f=J.b2Vec2.Dot(this.m_axis,J.b2Vec2.Subtract(c,e,J.b2Vec2.s_t0))+this.m_a2*r-this.m_a1*n;let x=-this.m_axialMass*(f+Math.max(y,0)*t.step.inv_dt);const S=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+x,0),x=this.m_lowerImpulse-S,J.b2Vec2.Scale(x,this.m_axis,d);const V=x*this.m_a1,C=x*this.m_a2;e.SubtractScaled(m,d),n-=p*V,c.AddScaled(u,d),r+=b*C}{const y=this.m_upperTranslation-this.m_translation,f=J.b2Vec2.Dot(this.m_axis,J.b2Vec2.Subtract(e,c,J.b2Vec2.s_t0))+this.m_a1*n-this.m_a2*r;let x=-this.m_axialMass*(f+Math.max(y,0)*t.step.inv_dt);const S=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+x,0),x=this.m_upperImpulse-S,J.b2Vec2.Scale(x,this.m_axis,d);const V=x*this.m_a1,C=x*this.m_a2;e.AddScaled(m,d),n+=p*V,c.SubtractScaled(u,d),r-=b*C}}{const y=J.b2Vec2.Dot(this.m_perp,J.b2Vec2.Subtract(c,e,J.b2Vec2.s_t0))+this.m_s2*r-this.m_s1*n,f=r-n;this.m_K.Solve(-y,-f,A),this.m_impulse.Add(A),J.b2Vec2.Scale(A.x,this.m_perp,d);const x=A.x*this.m_s1+A.y,S=A.x*this.m_s2+A.y;e.SubtractScaled(m,d),n-=p*x,c.AddScaled(u,d),r+=b*S}t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let n=t.positions[this.m_indexA].a;const c=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const{qA:m,qB:u,lalcA:p,lalcB:b,rA:d,rB:A}=Je;m.Set(n),u.Set(r);const y=this.m_invMassA,f=this.m_invMassB,x=this.m_invIA,S=this.m_invIB,{d:V,impulse:C,P:_}=Je.SolvePositionConstraints;J.b2Rot.MultiplyVec2(m,J.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,p),d),J.b2Rot.MultiplyVec2(u,J.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,b),A),J.b2Vec2.Add(c,A,V).Subtract(e).Subtract(d);const g=J.b2Rot.MultiplyVec2(m,this.m_localXAxisA,this.m_axis),w=J.b2Vec2.Cross(J.b2Vec2.Add(V,d,J.b2Vec2.s_t0),g),M=J.b2Vec2.Cross(A,g),L=J.b2Rot.MultiplyVec2(m,this.m_localYAxisA,this.m_perp),R=J.b2Vec2.Cross(J.b2Vec2.Add(V,d,J.b2Vec2.s_t0),L),z=J.b2Vec2.Cross(A,L),N=J.b2Vec2.Dot(L,V),G=r-n-this.m_referenceAngle;let H=Math.abs(N);const k=Math.abs(G);let j=!1,O=0;if(this.m_enableLimit){const st=J.b2Vec2.Dot(g,V);Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*To.b2_linearSlop?(O=st,H=Math.max(H,Math.abs(st)),j=!0):st<=this.m_lowerTranslation?(O=Math.min(st-this.m_lowerTranslation,0),H=Math.max(H,this.m_lowerTranslation-st),j=!0):st>=this.m_upperTranslation&&(O=Math.max(st-this.m_upperTranslation,0),H=Math.max(H,st-this.m_upperTranslation),j=!0)}if(j){const st=y+f+x*R*R+S*z*z,_t=x*R+S*z,pt=x*R*w+S*z*M;let Q=x+S;Q===0&&(Q=1);const nt=x*w+S*M,ft=y+f+x*w*w+S*M*M,Mt=Je.K3;Mt.ex.Set(st,_t,pt),Mt.ey.Set(_t,Q,nt),Mt.ez.Set(pt,nt,ft),Mt.Solve33(-N,-G,-O,C)}else{const st=y+f+x*R*R+S*z*z,_t=x*R+S*z;let pt=x+S;pt===0&&(pt=1);const Q=Je.K2;Q.ex.Set(st,_t),Q.ey.Set(_t,pt);const nt=Q.Solve(-N,-G,Je.SolvePositionConstraints.impulse1);C.x=nt.x,C.y=nt.y,C.z=0}J.b2Vec2.Scale(C.x,L,_).AddScaled(C.z,g);const W=C.x*R+C.y+C.z*w,tt=C.x*z+C.y+C.z*M;return e.SubtractScaled(y,_),n-=x*W,c.AddScaled(f,_),r+=S*tt,t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,H<=To.b2_linearSlop&&k<=To.b2_angularSlop}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){const n=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse;return e.x=t*(this.m_impulse.x*this.m_perp.x+n*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+n*this.m_axis.y),e}GetReactionTorque(t){return t*this.m_impulse.y}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetReferenceAngle(){return this.m_referenceAngle}GetJointTranslation(){const{pA:t,pB:e,axis:n,d:c}=Je.GetJointTranslation;return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t),this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e),J.b2Vec2.Subtract(e,t,c),this.m_bodyA.GetWorldVector(this.m_localXAxisA,n),J.b2Vec2.Dot(c,n)}GetJointSpeed(){const t=this.m_bodyA,e=this.m_bodyB,{lalcA:n,lalcB:c,rA:r,rB:m}=Je;J.b2Rot.MultiplyVec2(t.m_xf.q,J.b2Vec2.Subtract(this.m_localAnchorA,t.m_sweep.localCenter,n),r),J.b2Rot.MultiplyVec2(e.m_xf.q,J.b2Vec2.Subtract(this.m_localAnchorB,e.m_sweep.localCenter,c),m);const u=J.b2Vec2.Add(t.m_sweep.c,r,J.b2Vec2.s_t0),p=J.b2Vec2.Add(e.m_sweep.c,m,J.b2Vec2.s_t1),b=J.b2Vec2.Subtract(p,u,J.b2Vec2.s_t2),d=J.b2Rot.MultiplyVec2(t.m_xf.q,this.m_localXAxisA,this.m_axis),A=t.m_linearVelocity,y=e.m_linearVelocity,f=t.m_angularVelocity,x=e.m_angularVelocity;return J.b2Vec2.Dot(b,J.b2Vec2.CrossScalarVec2(f,d,J.b2Vec2.s_t0))+J.b2Vec2.Dot(d,J.b2Vec2.Subtract(J.b2Vec2.AddCrossScalarVec2(y,x,m,J.b2Vec2.s_t0),J.b2Vec2.AddCrossScalarVec2(A,f,r,J.b2Vec2.s_t1),J.b2Vec2.s_t0))}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){return t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0),t}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(t,e){(t!==this.m_lowerTranslation||e!==this.m_upperTranslation)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_lowerImpulse=0,this.m_upperImpulse=0)}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){return t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t),t}SetMotorSpeed(t){return t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t),t}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorForce(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}GetMaxMotorForce(){return this.m_maxMotorForce}GetMotorForce(t){return t*this.m_motorImpulse}Draw(t){const{p1:e,p2:n,pA:c,pB:r,axis:m}=Je.Draw,u=this.m_bodyA.GetTransform(),p=this.m_bodyB.GetTransform();if(J.b2Transform.MultiplyVec2(u,this.m_localAnchorA,c),J.b2Transform.MultiplyVec2(p,this.m_localAnchorB,r),J.b2Rot.MultiplyVec2(u.q,this.m_localXAxisA,m),t.DrawSegment(c,r,Yi.debugColors.joint5),this.m_enableLimit){const{lower:b,upper:d,perp:A}=Je.Draw;J.b2Vec2.AddScaled(c,this.m_lowerTranslation,m,b),J.b2Vec2.AddScaled(c,this.m_upperTranslation,m,d),J.b2Rot.MultiplyVec2(u.q,this.m_localYAxisA,A),t.DrawSegment(b,d,Yi.debugColors.joint1),t.DrawSegment(J.b2Vec2.SubtractScaled(b,.5,A,e),J.b2Vec2.AddScaled(b,.5,A,n),Yi.debugColors.joint2),t.DrawSegment(J.b2Vec2.SubtractScaled(d,.5,A,e),J.b2Vec2.AddScaled(d,.5,A,n),Yi.debugColors.joint3)}else t.DrawSegment(J.b2Vec2.Subtract(c,m,e),J.b2Vec2.Add(c,m,n),Yi.debugColors.joint1);t.DrawPoint(c,5,Yi.debugColors.joint1),t.DrawPoint(r,5,Yi.debugColors.joint4)}}as.b2PrismaticJoint=eh;var Pi={};Object.defineProperty(Pi,"__esModule",{value:!0});Pi.b2PulleyJoint=Pi.b2PulleyJointDef=Pi.b2_minPulleyLength=void 0;const js=jt,Do=Ge,lt=Dt,$o=Yt;Pi.b2_minPulleyLength=2;const Fi={qA:new lt.b2Rot,qB:new lt.b2Rot,lalcA:new lt.b2Vec2,lalcB:new lt.b2Vec2,p:new lt.b2Vec2,PA:new lt.b2Vec2,PB:new lt.b2Vec2,vpA:new lt.b2Vec2,vpB:new lt.b2Vec2,pA:new lt.b2Vec2,pB:new lt.b2Vec2};class ih extends $o.b2JointDef{constructor(){super($o.b2JointType.e_pulleyJoint),this.groundAnchorA=new lt.b2Vec2(-1,1),this.groundAnchorB=new lt.b2Vec2(1,1),this.localAnchorA=new lt.b2Vec2(-1,0),this.localAnchorB=new lt.b2Vec2(1,0),this.lengthA=0,this.lengthB=0,this.ratio=1,this.collideConnected=!0}Initialize(t,e,n,c,r,m,u){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(n),this.groundAnchorB.Copy(c),this.bodyA.GetLocalPoint(r,this.localAnchorA),this.bodyB.GetLocalPoint(m,this.localAnchorB),this.lengthA=lt.b2Vec2.Distance(r,n),this.lengthB=lt.b2Vec2.Distance(m,c),this.ratio=u}}Pi.b2PulleyJointDef=ih;const sh=new lt.b2Vec2(-1,1),nh=lt.b2Vec2.UNITX,oh=new lt.b2Vec2(-1,0),rh=lt.b2Vec2.UNITX;class ah extends $o.b2Joint{constructor(t){var e,n,c,r,m,u,p;super(t),this.m_groundAnchorA=new lt.b2Vec2,this.m_groundAnchorB=new lt.b2Vec2,this.m_lengthA=0,this.m_lengthB=0,this.m_localAnchorA=new lt.b2Vec2,this.m_localAnchorB=new lt.b2Vec2,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_uA=new lt.b2Vec2,this.m_uB=new lt.b2Vec2,this.m_rA=new lt.b2Vec2,this.m_rB=new lt.b2Vec2,this.m_localCenterA=new lt.b2Vec2,this.m_localCenterB=new lt.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_groundAnchorA.Copy((e=t.groundAnchorA)!==null&&e!==void 0?e:sh),this.m_groundAnchorB.Copy((n=t.groundAnchorB)!==null&&n!==void 0?n:nh),this.m_localAnchorA.Copy((c=t.localAnchorA)!==null&&c!==void 0?c:oh),this.m_localAnchorB.Copy((r=t.localAnchorB)!==null&&r!==void 0?r:rh),this.m_lengthA=(m=t.lengthA)!==null&&m!==void 0?m:0,this.m_lengthB=(u=t.lengthB)!==null&&u!==void 0?u:0,this.m_ratio=(p=t.ratio)!==null&&p!==void 0?p:1,this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,c=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const m=t.positions[this.m_indexB].c,u=t.positions[this.m_indexB].a,p=t.velocities[this.m_indexB].v;let b=t.velocities[this.m_indexB].w;const{qA:d,qB:A,lalcA:y,lalcB:f}=Fi;d.Set(n),A.Set(u),lt.b2Rot.MultiplyVec2(d,lt.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,y),this.m_rA),lt.b2Rot.MultiplyVec2(A,lt.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,f),this.m_rB),lt.b2Vec2.Add(e,this.m_rA,this.m_uA).Subtract(this.m_groundAnchorA),lt.b2Vec2.Add(m,this.m_rB,this.m_uB).Subtract(this.m_groundAnchorB);const x=this.m_uA.Length(),S=this.m_uB.Length();x>10*js.b2_linearSlop?this.m_uA.Scale(1/x):this.m_uA.SetZero(),S>10*js.b2_linearSlop?this.m_uB.Scale(1/S):this.m_uB.SetZero();const V=lt.b2Vec2.Cross(this.m_rA,this.m_uA),C=lt.b2Vec2.Cross(this.m_rB,this.m_uB),_=this.m_invMassA+this.m_invIA*V*V,g=this.m_invMassB+this.m_invIB*C*C;if(this.m_mass=_+this.m_ratio*this.m_ratio*g,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const{PA:w,PB:M}=Fi;lt.b2Vec2.Scale(-this.m_impulse,this.m_uA,w),lt.b2Vec2.Scale(-this.m_ratio*this.m_impulse,this.m_uB,M),c.AddScaled(this.m_invMassA,w),r+=this.m_invIA*lt.b2Vec2.Cross(this.m_rA,w),p.AddScaled(this.m_invMassB,M),b+=this.m_invIB*lt.b2Vec2.Cross(this.m_rB,M)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=b}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const c=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const{PA:m,PB:u,vpA:p,vpB:b}=Fi;lt.b2Vec2.AddCrossScalarVec2(e,n,this.m_rA,p),lt.b2Vec2.AddCrossScalarVec2(c,r,this.m_rB,b);const d=-lt.b2Vec2.Dot(this.m_uA,p)-this.m_ratio*lt.b2Vec2.Dot(this.m_uB,b),A=-this.m_mass*d;this.m_impulse+=A,lt.b2Vec2.Scale(-A,this.m_uA,m),lt.b2Vec2.Scale(-this.m_ratio*A,this.m_uB,u),e.AddScaled(this.m_invMassA,m),n+=this.m_invIA*lt.b2Vec2.Cross(this.m_rA,m),c.AddScaled(this.m_invMassB,u),r+=this.m_invIB*lt.b2Vec2.Cross(this.m_rB,u),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let n=t.positions[this.m_indexA].a;const c=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const{qA:m,qB:u,lalcA:p,lalcB:b,PA:d,PB:A}=Fi;m.Set(n),u.Set(r);const y=lt.b2Rot.MultiplyVec2(m,lt.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,p),this.m_rA),f=lt.b2Rot.MultiplyVec2(u,lt.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,b),this.m_rB),x=lt.b2Vec2.Add(e,y,this.m_uA).Subtract(this.m_groundAnchorA),S=lt.b2Vec2.Add(c,f,this.m_uB).Subtract(this.m_groundAnchorB),V=x.Length(),C=S.Length();V>10*js.b2_linearSlop?x.Scale(1/V):x.SetZero(),C>10*js.b2_linearSlop?S.Scale(1/C):S.SetZero();const _=lt.b2Vec2.Cross(y,x),g=lt.b2Vec2.Cross(f,S),w=this.m_invMassA+this.m_invIA*_*_,M=this.m_invMassB+this.m_invIB*g*g;let L=w+this.m_ratio*this.m_ratio*M;L>0&&(L=1/L);const R=this.m_constant-V-this.m_ratio*C,z=Math.abs(R),N=-L*R;return lt.b2Vec2.Scale(-N,x,d),lt.b2Vec2.Scale(-this.m_ratio*N,S,A),e.AddScaled(this.m_invMassA,d),n+=this.m_invIA*lt.b2Vec2.Cross(y,d),c.AddScaled(this.m_invMassB,A),r+=this.m_invIB*lt.b2Vec2.Cross(f,A),t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,z<js.b2_linearSlop}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e}GetReactionTorque(t){return 0}GetGroundAnchorA(){return this.m_groundAnchorA}GetGroundAnchorB(){return this.m_groundAnchorB}GetLengthA(){return this.m_lengthA}GetLengthB(){return this.m_lengthB}GetRatio(){return this.m_ratio}GetCurrentLengthA(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,Fi.p),e=this.m_groundAnchorA;return lt.b2Vec2.Distance(t,e)}GetCurrentLengthB(){const t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,Fi.p),e=this.m_groundAnchorB;return lt.b2Vec2.Distance(t,e)}ShiftOrigin(t){this.m_groundAnchorA.Subtract(t),this.m_groundAnchorB.Subtract(t)}Draw(t){const e=this.GetAnchorA(Fi.pA),n=this.GetAnchorB(Fi.pB),c=this.GetGroundAnchorA(),r=this.GetGroundAnchorB();t.DrawSegment(c,e,Do.debugColors.joint6),t.DrawSegment(r,n,Do.debugColors.joint6),t.DrawSegment(c,r,Do.debugColors.joint6)}}Pi.b2PulleyJoint=ah;var cs={};Object.defineProperty(cs,"__esModule",{value:!0});cs.b2RevoluteJoint=cs.b2RevoluteJointDef=void 0;const Bi=jt,Vi=Ge,dt=Dt,No=Yt,Qi={qA:new dt.b2Rot,qB:new dt.b2Rot,lalcA:new dt.b2Vec2,lalcB:new dt.b2Vec2,P:new dt.b2Vec2,Cdot:new dt.b2Vec2,C:new dt.b2Vec2,impulse:new dt.b2Vec2,p2:new dt.b2Vec2,r:new dt.b2Vec2,pA:new dt.b2Vec2,pB:new dt.b2Vec2,rlo:new dt.b2Vec2,rhi:new dt.b2Vec2};class ch extends No.b2JointDef{constructor(){super(No.b2JointType.e_revoluteJoint),this.localAnchorA=new dt.b2Vec2,this.localAnchorB=new dt.b2Vec2,this.referenceAngle=0,this.enableLimit=!1,this.lowerAngle=0,this.upperAngle=0,this.enableMotor=!1,this.motorSpeed=0,this.maxMotorTorque=0}Initialize(t,e,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}cs.b2RevoluteJointDef=ch;class lh extends No.b2Joint{constructor(t){var e,n,c,r,m,u,p,b,d;super(t),this.m_localAnchorA=new dt.b2Vec2,this.m_localAnchorB=new dt.b2Vec2,this.m_impulse=new dt.b2Vec2,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_enableMotor=!1,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_referenceAngle=0,this.m_lowerAngle=0,this.m_upperAngle=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new dt.b2Vec2,this.m_rB=new dt.b2Vec2,this.m_localCenterA=new dt.b2Vec2,this.m_localCenterB=new dt.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_K=new dt.b2Mat22,this.m_angle=0,this.m_axialMass=0,this.m_localAnchorA.Copy((e=t.localAnchorA)!==null&&e!==void 0?e:dt.b2Vec2.ZERO),this.m_localAnchorB.Copy((n=t.localAnchorB)!==null&&n!==void 0?n:dt.b2Vec2.ZERO),this.m_referenceAngle=(c=t.referenceAngle)!==null&&c!==void 0?c:0,this.m_impulse.SetZero(),this.m_lowerAngle=(r=t.lowerAngle)!==null&&r!==void 0?r:0,this.m_upperAngle=(m=t.upperAngle)!==null&&m!==void 0?m:0,this.m_maxMotorTorque=(u=t.maxMotorTorque)!==null&&u!==void 0?u:0,this.m_motorSpeed=(p=t.motorSpeed)!==null&&p!==void 0?p:0,this.m_enableLimit=(b=t.enableLimit)!==null&&b!==void 0?b:!1,this.m_enableMotor=(d=t.enableMotor)!==null&&d!==void 0?d:!1}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let c=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let u=t.velocities[this.m_indexB].w;const{qA:p,qB:b,lalcA:d,lalcB:A}=Qi;p.Set(e),b.Set(r),dt.b2Rot.MultiplyVec2(p,dt.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,d),this.m_rA),dt.b2Rot.MultiplyVec2(b,dt.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,A),this.m_rB);const y=this.m_invMassA,f=this.m_invMassB,x=this.m_invIA,S=this.m_invIB;this.m_K.ex.x=y+f+this.m_rA.y*this.m_rA.y*x+this.m_rB.y*this.m_rB.y*S,this.m_K.ey.x=-this.m_rA.y*this.m_rA.x*x-this.m_rB.y*this.m_rB.x*S,this.m_K.ex.y=this.m_K.ey.x,this.m_K.ey.y=y+f+this.m_rA.x*this.m_rA.x*x+this.m_rB.x*this.m_rB.x*S,this.m_axialMass=x+S;let V;if(this.m_axialMass>0?(this.m_axialMass=1/this.m_axialMass,V=!1):V=!0,this.m_angle=r-e-this.m_referenceAngle,(this.m_enableLimit===!1||V)&&(this.m_lowerImpulse=0,this.m_upperImpulse=0),(this.m_enableMotor===!1||V)&&(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.Scale(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;const C=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,_=Qi.P.Set(this.m_impulse.x,this.m_impulse.y);n.SubtractScaled(y,_),c-=x*(dt.b2Vec2.Cross(this.m_rA,_)+C),m.AddScaled(f,_),u+=S*(dt.b2Vec2.Cross(this.m_rB,_)+C)}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=c,t.velocities[this.m_indexB].w=u}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const c=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const m=this.m_invMassA,u=this.m_invMassB,p=this.m_invIA,b=this.m_invIB,d=p+b===0;if(this.m_enableMotor&&!d){const A=r-n-this.m_motorSpeed;let y=-this.m_axialMass*A;const f=this.m_motorImpulse,x=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=(0,dt.b2Clamp)(this.m_motorImpulse+y,-x,x),y=this.m_motorImpulse-f,n-=p*y,r+=b*y}if(this.m_enableLimit&&!d){{const A=this.m_angle-this.m_lowerAngle,y=r-n;let f=-this.m_axialMass*(y+Math.max(A,0)*t.step.inv_dt);const x=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+f,0),f=this.m_lowerImpulse-x,n-=p*f,r+=b*f}{const A=this.m_upperAngle-this.m_angle,y=n-r;let f=-this.m_axialMass*(y+Math.max(A,0)*t.step.inv_dt);const x=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+f,0),f=this.m_upperImpulse-x,n+=p*f,r-=b*f}}{const{Cdot:A,impulse:y}=Qi;dt.b2Vec2.Subtract(dt.b2Vec2.AddCrossScalarVec2(c,r,this.m_rB,dt.b2Vec2.s_t0),dt.b2Vec2.AddCrossScalarVec2(e,n,this.m_rA,dt.b2Vec2.s_t1),A),this.m_K.Solve(-A.x,-A.y,y),this.m_impulse.x+=y.x,this.m_impulse.y+=y.y,e.SubtractScaled(m,y),n-=p*dt.b2Vec2.Cross(this.m_rA,y),c.AddScaled(u,y),r+=b*dt.b2Vec2.Cross(this.m_rB,y)}t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let n=t.positions[this.m_indexA].a;const c=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const{qA:m,qB:u,lalcA:p,lalcB:b,impulse:d}=Qi;m.Set(n),u.Set(r);let A=0,y=0;const f=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&!f){const x=r-n-this.m_referenceAngle;let S=0;Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*Bi.b2_angularSlop?S=(0,dt.b2Clamp)(x-this.m_lowerAngle,-Bi.b2_maxAngularCorrection,Bi.b2_maxAngularCorrection):x<=this.m_lowerAngle?S=(0,dt.b2Clamp)(x-this.m_lowerAngle+Bi.b2_angularSlop,-Bi.b2_maxAngularCorrection,0):x>=this.m_upperAngle&&(S=(0,dt.b2Clamp)(x-this.m_upperAngle-Bi.b2_angularSlop,0,Bi.b2_maxAngularCorrection));const V=-this.m_axialMass*S;n-=this.m_invIA*V,r+=this.m_invIB*V,A=Math.abs(S)}{m.Set(n),u.Set(r);const x=dt.b2Rot.MultiplyVec2(m,dt.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,p),this.m_rA),S=dt.b2Rot.MultiplyVec2(u,dt.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,b),this.m_rB),V=dt.b2Vec2.Add(c,S,Qi.C).Subtract(e).Subtract(x);y=V.Length();const C=this.m_invMassA,_=this.m_invMassB,g=this.m_invIA,w=this.m_invIB,M=this.m_K;M.ex.x=C+_+g*x.y*x.y+w*S.y*S.y,M.ex.y=-g*x.x*x.y-w*S.x*S.y,M.ey.x=M.ex.y,M.ey.y=C+_+g*x.x*x.x+w*S.x*S.x,M.Solve(V.x,V.y,d).Negate(),e.SubtractScaled(C,d),n-=g*dt.b2Vec2.Cross(x,d),c.AddScaled(_,d),r+=w*dt.b2Vec2.Cross(S,d)}return t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,y<=Bi.b2_linearSlop&&A<=Bi.b2_angularSlop}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}GetReactionTorque(t){return t*(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}GetJointSpeed(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){return t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t),t}GetMotorTorque(t){return t*this.m_motorImpulse}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorTorque(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}GetMaxMotorTorque(){return this.m_maxMotorTorque}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){return t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0),t}GetLowerLimit(){return this.m_lowerAngle}GetUpperLimit(){return this.m_upperAngle}SetLimits(t,e){(t!==this.m_lowerAngle||e!==this.m_upperAngle)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_lowerAngle=t,this.m_upperAngle=e)}SetMotorSpeed(t){return t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t),t}Draw(t){const{p2:e,r:n,pA:c,pB:r}=Qi,m=this.m_bodyA.GetTransform(),u=this.m_bodyB.GetTransform();dt.b2Transform.MultiplyVec2(m,this.m_localAnchorA,c),dt.b2Transform.MultiplyVec2(u,this.m_localAnchorB,r),t.DrawPoint(c,5,Vi.debugColors.joint4),t.DrawPoint(r,5,Vi.debugColors.joint5);const p=this.m_bodyA.GetAngle(),d=this.m_bodyB.GetAngle()-p-this.m_referenceAngle,A=.5;if(n.Set(Math.cos(d),Math.sin(d)).Scale(A),t.DrawSegment(r,dt.b2Vec2.Add(r,n,e),Vi.debugColors.joint1),t.DrawCircle(r,A,Vi.debugColors.joint1),this.m_enableLimit){const{rlo:y,rhi:f}=Qi;y.Set(Math.cos(this.m_lowerAngle),Math.sin(this.m_lowerAngle)).Scale(A),f.Set(Math.cos(this.m_upperAngle),Math.sin(this.m_upperAngle)).Scale(A),t.DrawSegment(r,dt.b2Vec2.Add(r,y,e),Vi.debugColors.joint2),t.DrawSegment(r,dt.b2Vec2.Add(r,f,e),Vi.debugColors.joint3)}t.DrawSegment(m.p,c,Vi.debugColors.joint6),t.DrawSegment(c,r,Vi.debugColors.joint6),t.DrawSegment(u.p,r,Vi.debugColors.joint6)}}cs.b2RevoluteJoint=lh;var ls={};Object.defineProperty(ls,"__esModule",{value:!0});ls.b2WeldJoint=ls.b2WeldJointDef=void 0;const Ma=jt,mt=Dt,Wo=Yt,ws={qA:new mt.b2Rot,qB:new mt.b2Rot,rA:new mt.b2Vec2,rB:new mt.b2Vec2,lalcA:new mt.b2Vec2,lalcB:new mt.b2Vec2,K:new mt.b2Mat33,P:new mt.b2Vec2,Cdot1:new mt.b2Vec3,impulse1:new mt.b2Vec2,impulse:new mt.b2Vec3,C1:new mt.b2Vec2,C:new mt.b2Vec3};class mh extends Wo.b2JointDef{constructor(){super(Wo.b2JointType.e_weldJoint),this.localAnchorA=new mt.b2Vec2,this.localAnchorB=new mt.b2Vec2,this.referenceAngle=0,this.stiffness=0,this.damping=0}Initialize(t,e,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}ls.b2WeldJointDef=mh;class hh extends Wo.b2Joint{constructor(t){var e,n,c,r,m;super(t),this.m_stiffness=0,this.m_damping=0,this.m_bias=0,this.m_localAnchorA=new mt.b2Vec2,this.m_localAnchorB=new mt.b2Vec2,this.m_referenceAngle=0,this.m_gamma=0,this.m_impulse=new mt.b2Vec3,this.m_indexA=0,this.m_indexB=0,this.m_rA=new mt.b2Vec2,this.m_rB=new mt.b2Vec2,this.m_localCenterA=new mt.b2Vec2,this.m_localCenterB=new mt.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new mt.b2Mat33,this.m_localAnchorA.Copy((e=t.localAnchorA)!==null&&e!==void 0?e:mt.b2Vec2.ZERO),this.m_localAnchorB.Copy((n=t.localAnchorB)!==null&&n!==void 0?n:mt.b2Vec2.ZERO),this.m_referenceAngle=(c=t.referenceAngle)!==null&&c!==void 0?c:0,this.m_stiffness=(r=t.stiffness)!==null&&r!==void 0?r:0,this.m_damping=(m=t.damping)!==null&&m!==void 0?m:0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let c=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let u=t.velocities[this.m_indexB].w;const{qA:p,qB:b,lalcA:d,lalcB:A,K:y}=ws;p.Set(e),b.Set(r),mt.b2Rot.MultiplyVec2(p,mt.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,d),this.m_rA),mt.b2Rot.MultiplyVec2(b,mt.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,A),this.m_rB);const f=this.m_invMassA,x=this.m_invMassB,S=this.m_invIA,V=this.m_invIB;if(y.ex.x=f+x+this.m_rA.y*this.m_rA.y*S+this.m_rB.y*this.m_rB.y*V,y.ey.x=-this.m_rA.y*this.m_rA.x*S-this.m_rB.y*this.m_rB.x*V,y.ez.x=-this.m_rA.y*S-this.m_rB.y*V,y.ex.y=y.ey.x,y.ey.y=f+x+this.m_rA.x*this.m_rA.x*S+this.m_rB.x*this.m_rB.x*V,y.ez.y=this.m_rA.x*S+this.m_rB.x*V,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=S+V,this.m_stiffness>0){y.GetInverse22(this.m_mass);let C=S+V;const _=r-e-this.m_referenceAngle,g=this.m_damping,w=this.m_stiffness,M=t.step.dt;this.m_gamma=M*(g+M*w),this.m_gamma=this.m_gamma!==0?1/this.m_gamma:0,this.m_bias=_*M*w*this.m_gamma,C+=this.m_gamma,this.m_mass.ez.z=C!==0?1/C:0}else y.ez.z===0?(y.GetInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(y.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(t.step.warmStarting){this.m_impulse.Scale(t.step.dtRatio);const{P:C}=ws;C.Copy(this.m_impulse),n.SubtractScaled(f,C),c-=S*(mt.b2Vec2.Cross(this.m_rA,C)+this.m_impulse.z),m.AddScaled(x,C),u+=V*(mt.b2Vec2.Cross(this.m_rB,C)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=c,t.velocities[this.m_indexB].w=u}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const c=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const m=this.m_invMassA,u=this.m_invMassB,p=this.m_invIA,b=this.m_invIB;if(this.m_stiffness>0){const d=r-n,A=-this.m_mass.ez.z*(d+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=A,n-=p*A,r+=b*A;const{Cdot1:y,impulse1:f}=ws;mt.b2Vec2.Subtract(mt.b2Vec2.AddCrossScalarVec2(c,r,this.m_rB,mt.b2Vec2.s_t0),mt.b2Vec2.AddCrossScalarVec2(e,n,this.m_rA,mt.b2Vec2.s_t1),y),mt.b2Mat33.MultiplyVec2(this.m_mass,y,f).Negate(),this.m_impulse.x+=f.x,this.m_impulse.y+=f.y;const x=f;e.SubtractScaled(m,x),n-=p*mt.b2Vec2.Cross(this.m_rA,x),c.AddScaled(u,x),r+=b*mt.b2Vec2.Cross(this.m_rB,x)}else{const{Cdot1:d,impulse:A,P:y}=ws;mt.b2Vec2.Subtract(mt.b2Vec2.AddCrossScalarVec2(c,r,this.m_rB,mt.b2Vec2.s_t0),mt.b2Vec2.AddCrossScalarVec2(e,n,this.m_rA,mt.b2Vec2.s_t1),d),d.z=r-n,mt.b2Mat33.MultiplyVec3(this.m_mass,d,A).Negate(),this.m_impulse.Add(A),y.Set(A.x,A.y),e.SubtractScaled(m,y),n-=p*(mt.b2Vec2.Cross(this.m_rA,y)+A.z),c.AddScaled(u,y),r+=b*(mt.b2Vec2.Cross(this.m_rB,y)+A.z)}t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let n=t.positions[this.m_indexA].a;const c=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const{qA:m,qB:u,lalcA:p,lalcB:b,K:d,C1:A,P:y,rA:f,rB:x}=ws;m.Set(n),u.Set(r);const S=this.m_invMassA,V=this.m_invMassB,C=this.m_invIA,_=this.m_invIB;mt.b2Rot.MultiplyVec2(m,mt.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,p),f),mt.b2Rot.MultiplyVec2(u,mt.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,b),x);let g,w;if(d.ex.x=S+V+f.y*f.y*C+x.y*x.y*_,d.ey.x=-f.y*f.x*C-x.y*x.x*_,d.ez.x=-f.y*C-x.y*_,d.ex.y=d.ey.x,d.ey.y=S+V+f.x*f.x*C+x.x*x.x*_,d.ez.y=f.x*C+x.x*_,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=C+_,this.m_stiffness>0)mt.b2Vec2.Add(c,x,A).Subtract(e).Subtract(f),g=A.Length(),w=0,d.Solve22(A.x,A.y,y).Negate(),e.SubtractScaled(S,y),n-=C*mt.b2Vec2.Cross(f,y),c.AddScaled(V,y),r+=_*mt.b2Vec2.Cross(x,y);else{mt.b2Vec2.Add(c,x,A).Subtract(e).Subtract(f),mt.b2Vec2.Subtract(mt.b2Vec2.Add(c,x,mt.b2Vec2.s_t0),mt.b2Vec2.Add(e,f,mt.b2Vec2.s_t1),A);const M=r-n-this.m_referenceAngle;g=A.Length(),w=Math.abs(M);const{impulse:L,C:R}=ws;R.Set(A.x,A.y,M),d.ez.z>0?d.Solve33(R.x,R.y,R.z,L).Negate():(d.Solve22(A.x,A.y,L).Negate(),L.z=0),y.Copy(L),e.SubtractScaled(S,y),n-=C*(mt.b2Vec2.Cross(f,y)+L.z),c.AddScaled(V,y),r+=_*(mt.b2Vec2.Cross(x,y)+L.z)}return t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,g<=Ma.b2_linearSlop&&w<=Ma.b2_angularSlop}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}GetReactionTorque(t){return t*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}SetStiffness(t){this.m_stiffness=t}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t}GetDamping(){return this.m_damping}}ls.b2WeldJoint=hh;var ms={};Object.defineProperty(ms,"__esModule",{value:!0});ms.b2WheelJoint=ms.b2WheelJointDef=void 0;const Ia=jt,q=Dt,Ho=Yt,Ui=Ge,Ri={qA:new q.b2Rot,qB:new q.b2Rot,lalcA:new q.b2Vec2,lalcB:new q.b2Vec2,rA:new q.b2Vec2,rB:new q.b2Vec2,d:new q.b2Vec2,P:new q.b2Vec2,ay:new q.b2Vec2,pA:new q.b2Vec2,pB:new q.b2Vec2,axis:new q.b2Vec2,Draw:{p1:new q.b2Vec2,p2:new q.b2Vec2,pA:new q.b2Vec2,pB:new q.b2Vec2,axis:new q.b2Vec2,lower:new q.b2Vec2,upper:new q.b2Vec2,perp:new q.b2Vec2}};class _h extends Ho.b2JointDef{constructor(){super(Ho.b2JointType.e_wheelJoint),this.localAnchorA=new q.b2Vec2,this.localAnchorB=new q.b2Vec2,this.localAxisA=new q.b2Vec2(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.stiffness=0,this.damping=0}Initialize(t,e,n,c){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.bodyA.GetLocalVector(c,this.localAxisA)}}ms.b2WheelJointDef=_h;class uh extends Ho.b2Joint{constructor(t){var e,n,c,r,m,u,p,b,d,A,y;super(t),this.m_localAnchorA=new q.b2Vec2,this.m_localAnchorB=new q.b2Vec2,this.m_localXAxisA=new q.b2Vec2,this.m_localYAxisA=new q.b2Vec2,this.m_impulse=0,this.m_motorImpulse=0,this.m_springImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_translation=0,this.m_lowerTranslation=0,this.m_upperTranslation=0,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_enableMotor=!1,this.m_stiffness=0,this.m_damping=0,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new q.b2Vec2,this.m_localCenterB=new q.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_ax=new q.b2Vec2,this.m_ay=new q.b2Vec2,this.m_sAx=0,this.m_sBx=0,this.m_sAy=0,this.m_sBy=0,this.m_mass=0,this.m_motorMass=0,this.m_axialMass=0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_localAnchorA.Copy((e=t.localAnchorA)!==null&&e!==void 0?e:q.b2Vec2.ZERO),this.m_localAnchorB.Copy((n=t.localAnchorB)!==null&&n!==void 0?n:q.b2Vec2.ZERO),this.m_localXAxisA.Copy((c=t.localAxisA)!==null&&c!==void 0?c:q.b2Vec2.UNITX),q.b2Vec2.CrossOneVec2(this.m_localXAxisA,this.m_localYAxisA),this.m_lowerTranslation=(r=t.lowerTranslation)!==null&&r!==void 0?r:0,this.m_upperTranslation=(m=t.upperTranslation)!==null&&m!==void 0?m:0,this.m_enableLimit=(u=t.enableLimit)!==null&&u!==void 0?u:!1,this.m_maxMotorTorque=(p=t.maxMotorTorque)!==null&&p!==void 0?p:0,this.m_motorSpeed=(b=t.motorSpeed)!==null&&b!==void 0?b:0,this.m_enableMotor=(d=t.enableMotor)!==null&&d!==void 0?d:!1,this.m_ax.SetZero(),this.m_ay.SetZero(),this.m_stiffness=(A=t.stiffness)!==null&&A!==void 0?A:0,this.m_damping=(y=t.damping)!==null&&y!==void 0?y:0}GetMotorSpeed(){return this.m_motorSpeed}GetMaxMotorTorque(){return this.m_maxMotorTorque}SetStiffness(t){this.m_stiffness=t}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t}GetDamping(){return this.m_damping}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_invMassA,n=this.m_invMassB,c=this.m_invIA,r=this.m_invIB,m=t.positions[this.m_indexA].c,u=t.positions[this.m_indexA].a,p=t.velocities[this.m_indexA].v;let b=t.velocities[this.m_indexA].w;const d=t.positions[this.m_indexB].c,A=t.positions[this.m_indexB].a,y=t.velocities[this.m_indexB].v;let f=t.velocities[this.m_indexB].w;const{qA:x,qB:S,lalcA:V,lalcB:C,rA:_,rB:g,d:w}=Ri;x.Set(u),S.Set(A),q.b2Rot.MultiplyVec2(x,q.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,V),_),q.b2Rot.MultiplyVec2(S,q.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,C),g),q.b2Vec2.Add(d,g,w).Subtract(m).Subtract(_),q.b2Rot.MultiplyVec2(x,this.m_localYAxisA,this.m_ay),this.m_sAy=q.b2Vec2.Cross(q.b2Vec2.Add(w,_,q.b2Vec2.s_t0),this.m_ay),this.m_sBy=q.b2Vec2.Cross(g,this.m_ay),this.m_mass=e+n+c*this.m_sAy*this.m_sAy+r*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),q.b2Rot.MultiplyVec2(x,this.m_localXAxisA,this.m_ax),this.m_sAx=q.b2Vec2.Cross(q.b2Vec2.Add(w,_,q.b2Vec2.s_t0),this.m_ax),this.m_sBx=q.b2Vec2.Cross(g,this.m_ax);const M=e+n+c*this.m_sAx*this.m_sAx+r*this.m_sBx*this.m_sBx;if(M>0?this.m_axialMass=1/M:this.m_axialMass=0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_stiffness>0&&M>0){this.m_springMass=1/M;const L=q.b2Vec2.Dot(w,this.m_ax),R=t.step.dt;this.m_gamma=R*(this.m_damping+R*this.m_stiffness),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=L*R*this.m_stiffness*this.m_gamma,this.m_springMass=M+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}else this.m_springImpulse=0;if(this.m_enableLimit?this.m_translation=q.b2Vec2.Dot(this.m_ax,w):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor?(this.m_motorMass=c+r,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;const L=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse,{P:R}=Ri;q.b2Vec2.Scale(this.m_impulse,this.m_ay,R).AddScaled(L,this.m_ax);const z=this.m_impulse*this.m_sAy+L*this.m_sAx+this.m_motorImpulse,N=this.m_impulse*this.m_sBy+L*this.m_sBx+this.m_motorImpulse;p.SubtractScaled(this.m_invMassA,R),b-=this.m_invIA*z,y.AddScaled(this.m_invMassB,R),f+=this.m_invIB*N}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=b,t.velocities[this.m_indexB].w=f}SolveVelocityConstraints(t){const e=this.m_invMassA,n=this.m_invMassB,c=this.m_invIA,r=this.m_invIB,m=t.velocities[this.m_indexA].v;let u=t.velocities[this.m_indexA].w;const p=t.velocities[this.m_indexB].v;let b=t.velocities[this.m_indexB].w;const{P:d}=Ri;{const A=q.b2Vec2.Dot(this.m_ax,q.b2Vec2.Subtract(p,m,q.b2Vec2.s_t0))+this.m_sBx*b-this.m_sAx*u,y=-this.m_springMass*(A+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=y,q.b2Vec2.Scale(y,this.m_ax,d);const f=y*this.m_sAx,x=y*this.m_sBx;m.SubtractScaled(e,d),u-=c*f,p.AddScaled(n,d),b+=r*x}{const A=b-u-this.m_motorSpeed;let y=-this.m_motorMass*A;const f=this.m_motorImpulse,x=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=(0,q.b2Clamp)(this.m_motorImpulse+y,-x,x),y=this.m_motorImpulse-f,u-=c*y,b+=r*y}if(this.m_enableLimit){{const A=this.m_translation-this.m_lowerTranslation,y=q.b2Vec2.Dot(this.m_ax,q.b2Vec2.Subtract(p,m,q.b2Vec2.s_t0))+this.m_sBx*b-this.m_sAx*u;let f=-this.m_axialMass*(y+Math.max(A,0)*t.step.inv_dt);const x=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+f,0),f=this.m_lowerImpulse-x,q.b2Vec2.Scale(f,this.m_ax,d);const S=f*this.m_sAx,V=f*this.m_sBx;m.SubtractScaled(e,d),u-=c*S,p.AddScaled(n,d),b+=r*V}{const A=this.m_upperTranslation-this.m_translation,y=q.b2Vec2.Dot(this.m_ax,q.b2Vec2.Subtract(m,p,q.b2Vec2.s_t0))+this.m_sAx*u-this.m_sBx*b;let f=-this.m_axialMass*(y+Math.max(A,0)*t.step.inv_dt);const x=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+f,0),f=this.m_upperImpulse-x,q.b2Vec2.Scale(f,this.m_ax,d);const S=f*this.m_sAx,V=f*this.m_sBx;m.AddScaled(e,d),u+=c*S,p.SubtractScaled(n,d),b-=r*V}}{const A=q.b2Vec2.Dot(this.m_ay,q.b2Vec2.Subtract(p,m,q.b2Vec2.s_t0))+this.m_sBy*b-this.m_sAy*u,y=-this.m_mass*A;this.m_impulse+=y,q.b2Vec2.Scale(y,this.m_ay,d);const f=y*this.m_sAy,x=y*this.m_sBy;m.SubtractScaled(e,d),u-=c*f,p.AddScaled(n,d),b+=r*x}t.velocities[this.m_indexA].w=u,t.velocities[this.m_indexB].w=b}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let n=t.positions[this.m_indexA].a;const c=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a,m=0;const{qA:u,qB:p,lalcA:b,lalcB:d,rA:A,rB:y,d:f,P:x,ay:S}=Ri;if(this.m_enableLimit){u.Set(n),p.Set(r),q.b2Rot.MultiplyVec2(u,q.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,b),A),q.b2Rot.MultiplyVec2(p,q.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,d),y),q.b2Vec2.Subtract(c,e,f).Add(y).Subtract(A);const V=q.b2Rot.MultiplyVec2(u,this.m_localXAxisA,this.m_ax),C=q.b2Vec2.Cross(q.b2Vec2.Add(f,A,q.b2Vec2.s_t0),this.m_ax),_=q.b2Vec2.Cross(y,this.m_ax);let g=0;const w=q.b2Vec2.Dot(V,f);if(Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Ia.b2_linearSlop?g=w:w<=this.m_lowerTranslation?g=Math.min(w-this.m_lowerTranslation,0):w>=this.m_upperTranslation&&(g=Math.max(w-this.m_upperTranslation,0)),g!==0){const M=this.m_invMassA+this.m_invMassB+this.m_invIA*C*C+this.m_invIB*_*_;let L=0;M!==0&&(L=-g/M),q.b2Vec2.Scale(L,V,x);const R=L*C,z=L*_;e.SubtractScaled(this.m_invMassA,x),n-=this.m_invIA*R,c.AddScaled(this.m_invMassB,x),r+=this.m_invIB*z,m=Math.abs(g)}}{u.Set(n),p.Set(r),q.b2Rot.MultiplyVec2(u,q.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,b),A),q.b2Rot.MultiplyVec2(p,q.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,d),y),q.b2Vec2.Subtract(c,e,f).Add(y).Subtract(A),q.b2Rot.MultiplyVec2(u,this.m_localYAxisA,S);const V=q.b2Vec2.Cross(q.b2Vec2.Add(f,A,q.b2Vec2.s_t0),S),C=q.b2Vec2.Cross(y,S),_=q.b2Vec2.Dot(f,S),g=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;let w=0;g!==0&&(w=-_/g),q.b2Vec2.Scale(w,S,x);const M=w*V,L=w*C;e.SubtractScaled(this.m_invMassA,x),n-=this.m_invIA*M,c.AddScaled(this.m_invMassB,x),r+=this.m_invIB*L,m=Math.max(m,Math.abs(_))}return t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=r,m<=Ia.b2_linearSlop}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){const n=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse;return e.x=t*(this.m_impulse*this.m_ay.x+n*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+n*this.m_ax.y),e}GetReactionTorque(t){return t*this.m_motorImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetJointTranslation(){const t=this.m_bodyA,e=this.m_bodyB,{pA:n,pB:c,d:r,axis:m}=Ri;return t.GetWorldPoint(this.m_localAnchorA,n),e.GetWorldPoint(this.m_localAnchorB,c),q.b2Vec2.Subtract(c,n,r),t.GetWorldVector(this.m_localXAxisA,m),q.b2Vec2.Dot(r,m)}GetJointLinearSpeed(){const t=this.m_bodyA,e=this.m_bodyB,{rA:n,rB:c,lalcA:r,lalcB:m,axis:u}=Ri;q.b2Rot.MultiplyVec2(t.m_xf.q,q.b2Vec2.Subtract(this.m_localAnchorA,t.m_sweep.localCenter,r),n),q.b2Rot.MultiplyVec2(e.m_xf.q,q.b2Vec2.Subtract(this.m_localAnchorB,e.m_sweep.localCenter,m),c);const p=q.b2Vec2.Add(t.m_sweep.c,n,q.b2Vec2.s_t0),b=q.b2Vec2.Add(e.m_sweep.c,c,q.b2Vec2.s_t1),d=q.b2Vec2.Subtract(b,p,q.b2Vec2.s_t2);q.b2Rot.MultiplyVec2(t.m_xf.q,this.m_localXAxisA,u);const A=t.m_linearVelocity,y=e.m_linearVelocity,f=t.m_angularVelocity,x=e.m_angularVelocity;return q.b2Vec2.Dot(d,q.b2Vec2.CrossScalarVec2(f,u,q.b2Vec2.s_t0))+q.b2Vec2.Dot(u,q.b2Vec2.AddCrossScalarVec2(y,x,c,q.b2Vec2.s_t0).Subtract(A).Subtract(q.b2Vec2.CrossScalarVec2(f,n,q.b2Vec2.s_t1)))}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}GetJointAngularSpeed(){const t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){return t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t),t}SetMotorSpeed(t){return t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t),t}SetMaxMotorTorque(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}GetMotorTorque(t){return t*this.m_motorImpulse}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){return t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0),t}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(t,e){(t!==this.m_lowerTranslation||e!==this.m_upperTranslation)&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_lowerImpulse=0,this.m_upperImpulse=0)}Draw(t){const{p1:e,p2:n,pA:c,pB:r,axis:m}=Ri.Draw,u=this.m_bodyA.GetTransform(),p=this.m_bodyB.GetTransform();if(q.b2Transform.MultiplyVec2(u,this.m_localAnchorA,c),q.b2Transform.MultiplyVec2(p,this.m_localAnchorB,r),q.b2Rot.MultiplyVec2(u.q,this.m_localXAxisA,m),t.DrawSegment(c,r,Ui.debugColors.joint5),this.m_enableLimit){const{lower:b,upper:d,perp:A}=Ri.Draw;q.b2Vec2.AddScaled(c,this.m_lowerTranslation,m,b),q.b2Vec2.AddScaled(c,this.m_upperTranslation,m,d),q.b2Rot.MultiplyVec2(u.q,this.m_localYAxisA,A),t.DrawSegment(b,d,Ui.debugColors.joint1),t.DrawSegment(q.b2Vec2.SubtractScaled(b,.5,A,e),q.b2Vec2.AddScaled(b,.5,A,n),Ui.debugColors.joint2),t.DrawSegment(q.b2Vec2.SubtractScaled(d,.5,A,e),q.b2Vec2.AddScaled(d,.5,A,n),Ui.debugColors.joint3)}else t.DrawSegment(q.b2Vec2.Subtract(c,m,e),q.b2Vec2.Add(c,m,n),Ui.debugColors.joint1);t.DrawPoint(c,5,Ui.debugColors.joint1),t.DrawPoint(r,5,Ui.debugColors.joint4)}}ms.b2WheelJoint=uh;var Qs={},Us={},Hn={},ue={};Object.defineProperty(ue,"__esModule",{value:!0});ue.b2Contact=ue.b2ContactEdge=ue.b2MixRestitutionThreshold=ue.b2MixRestitution=ue.b2MixFriction=void 0;const Pa=jt,Go=yt;function Zo(a,t){return Math.sqrt(a*t)}ue.b2MixFriction=Zo;function Xo(a,t){return a>t?a:t}ue.b2MixRestitution=Xo;function Yo(a,t){return a<t?a:t}ue.b2MixRestitutionThreshold=Yo;class Qo{get other(){return(0,Pa.b2Assert)(this.m_other!==null),this.m_other}set other(t){(0,Pa.b2Assert)(this.m_other===null),this.m_other=t}constructor(t){this.m_other=null,this.prev=null,this.next=null,this.contact=t}Reset(){this.m_other=null,this.prev=null,this.next=null}}ue.b2ContactEdge=Qo;class dh{constructor(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_nodeA=new Qo(this),this.m_nodeB=new Qo(this),this.m_indexA=0,this.m_indexB=0,this.m_manifold=new Go.b2Manifold,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_restitutionThreshold=0,this.m_tangentSpeed=0,this.m_oldManifold=new Go.b2Manifold}GetManifold(){return this.m_manifold}GetWorldManifold(t){const e=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),c=this.GetShapeA(),r=this.GetShapeB();t.Initialize(this.m_manifold,e.GetTransform(),c.m_radius,n.GetTransform(),r.m_radius)}IsTouching(){return this.m_touchingFlag}SetEnabled(t){this.m_enabledFlag=t}IsEnabled(){return this.m_enabledFlag}GetNext(){return this.m_next}GetFixtureA(){return this.m_fixtureA}GetChildIndexA(){return this.m_indexA}GetShapeA(){return this.m_fixtureA.GetShape()}GetFixtureB(){return this.m_fixtureB}GetChildIndexB(){return this.m_indexB}GetShapeB(){return this.m_fixtureB.GetShape()}FlagForFiltering(){this.m_filterFlag=!0}SetFriction(t){this.m_friction=t}GetFriction(){return this.m_friction}ResetFriction(){this.m_friction=Zo(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}SetRestitution(t){this.m_restitution=t}GetRestitution(){return this.m_restitution}ResetRestitution(){this.m_restitution=Xo(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}SetRestitutionThreshold(t){this.m_restitutionThreshold=t}GetRestitutionThreshold(){return this.m_restitutionThreshold}ResetRestitutionThreshold(){this.m_restitutionThreshold=Yo(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}SetTangentSpeed(t){this.m_tangentSpeed=t}GetTangentSpeed(){return this.m_tangentSpeed}Reset(t,e,n,c){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=n,this.m_indexA=e,this.m_indexB=c,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=Zo(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Xo(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_restitutionThreshold=Yo(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}Update(t){const e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;let n=!1;const c=this.m_touchingFlag,r=this.m_fixtureA.IsSensor(),m=this.m_fixtureB.IsSensor(),u=r||m,p=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody(),d=p.GetTransform(),A=b.GetTransform();if(u){const y=this.GetShapeA(),f=this.GetShapeB();n=(0,Go.b2TestOverlap)(y,this.m_indexA,f,this.m_indexB,d,A),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,d,A),n=this.m_manifold.pointCount>0;for(let y=0;y<this.m_manifold.pointCount;++y){const f=this.m_manifold.points[y];f.normalImpulse=0,f.tangentImpulse=0;const x=f.id;for(let S=0;S<this.m_oldManifold.pointCount;++S){const V=this.m_oldManifold.points[S];if(V.id.key===x.key){f.normalImpulse=V.normalImpulse,f.tangentImpulse=V.tangentImpulse;break}}}n!==c&&(p.SetAwake(!0),b.SetAwake(!0))}this.m_touchingFlag=n,!c&&n&&t&&t.BeginContact(this),c&&!n&&t&&t.EndContact(this),!u&&n&&t&&t.PreSolve(this,this.m_oldManifold)}}ue.b2Contact=dh;Object.defineProperty(Hn,"__esModule",{value:!0});Hn.b2CircleContact=void 0;const ph=Ji,bh=ue;class fh extends bh.b2Contact{Evaluate(t,e,n){(0,ph.b2CollideCircles)(t,this.GetShapeA(),e,this.GetShapeB(),n)}}Hn.b2CircleContact=fh;var Zn={};Object.defineProperty(Zn,"__esModule",{value:!0});Zn.b2PolygonContact=void 0;const yh=Ys,vh=ue;class Ah extends vh.b2Contact{Evaluate(t,e,n){(0,yh.b2CollidePolygons)(t,this.GetShapeA(),e,this.GetShapeB(),n)}}Zn.b2PolygonContact=Ah;var Xn={};Object.defineProperty(Xn,"__esModule",{value:!0});Xn.b2PolygonAndCircleContact=void 0;const wh=Ji,gh=ue;class xh extends gh.b2Contact{Evaluate(t,e,n){(0,wh.b2CollidePolygonAndCircle)(t,this.GetShapeA(),e,this.GetShapeB(),n)}}Xn.b2PolygonAndCircleContact=xh;var Yn={};Object.defineProperty(Yn,"__esModule",{value:!0});Yn.b2EdgeAndCircleContact=void 0;const Sh=bi,Bh=ue;class Vh extends Bh.b2Contact{Evaluate(t,e,n){(0,Sh.b2CollideEdgeAndCircle)(t,this.GetShapeA(),e,this.GetShapeB(),n)}}Yn.b2EdgeAndCircleContact=Vh;var Qn={};Object.defineProperty(Qn,"__esModule",{value:!0});Qn.b2EdgeAndPolygonContact=void 0;const Ch=bi,Mh=ue;class Ih extends Mh.b2Contact{Evaluate(t,e,n){(0,Ch.b2CollideEdgeAndPolygon)(t,this.GetShapeA(),e,this.GetShapeB(),n)}}Qn.b2EdgeAndPolygonContact=Ih;var Un={};Object.defineProperty(Un,"__esModule",{value:!0});Un.b2ChainAndCircleContact=void 0;const Ph=bi,Th=_s,Dh=ue;class Kn extends Dh.b2Contact{Evaluate(t,e,n){const c=Kn.Evaluate_s_edge;this.GetShapeA().GetChildEdge(c,this.m_indexA),(0,Ph.b2CollideEdgeAndCircle)(t,c,e,this.GetShapeB(),n)}}Un.b2ChainAndCircleContact=Kn;Kn.Evaluate_s_edge=new Th.b2EdgeShape;var to={};Object.defineProperty(to,"__esModule",{value:!0});to.b2ChainAndPolygonContact=void 0;const Gh=bi,Lh=_s,Fh=ue;class eo extends Fh.b2Contact{Evaluate(t,e,n){const c=eo.Evaluate_s_edge;this.GetShapeA().GetChildEdge(c,this.m_indexA),(0,Gh.b2CollideEdgeAndPolygon)(t,c,e,this.GetShapeB(),n)}}to.b2ChainAndPolygonContact=eo;eo.Evaluate_s_edge=new Lh.b2EdgeShape;Object.defineProperty(Us,"__esModule",{value:!0});Us.b2ContactFactory=void 0;const ve=De,Rh=Hn,kh=Zn,Eh=Xn,jh=Yn,Oh=Qn,Jh=Un,qh=to;class zh{constructor(){const t=new Array(ve.b2ShapeType.e_typeCount);for(let e=0;e<ve.b2ShapeType.e_typeCount;e++)t[e]=new Array(ve.b2ShapeType.e_typeCount);this.m_registers=t,this.AddType(Rh.b2CircleContact,ve.b2ShapeType.e_circle,ve.b2ShapeType.e_circle),this.AddType(Eh.b2PolygonAndCircleContact,ve.b2ShapeType.e_polygon,ve.b2ShapeType.e_circle),this.AddType(kh.b2PolygonContact,ve.b2ShapeType.e_polygon,ve.b2ShapeType.e_polygon),this.AddType(jh.b2EdgeAndCircleContact,ve.b2ShapeType.e_edge,ve.b2ShapeType.e_circle),this.AddType(Oh.b2EdgeAndPolygonContact,ve.b2ShapeType.e_edge,ve.b2ShapeType.e_polygon),this.AddType(Jh.b2ChainAndCircleContact,ve.b2ShapeType.e_chain,ve.b2ShapeType.e_circle),this.AddType(qh.b2ChainAndPolygonContact,ve.b2ShapeType.e_chain,ve.b2ShapeType.e_polygon)}AddType(t,e,n){const c=[],r=m=>{c.push(m)};this.m_registers[e][n]={createFcn(m,u,p,b){var d;const A=(d=c.pop())!==null&&d!==void 0?d:new t;return A.Reset(m,u,p,b),A},destroyFcn:r},e!==n&&(this.m_registers[n][e]={createFcn(m,u,p,b){var d;const A=(d=c.pop())!==null&&d!==void 0?d:new t;return A.Reset(p,b,m,u),A},destroyFcn:r})}Create(t,e,n,c){const r=t.GetType(),m=n.GetType(),u=this.m_registers[r][m];return u?u.createFcn(t,e,n,c):null}Destroy(t){const e=t.m_fixtureA.GetType(),n=t.m_fixtureB.GetType(),c=this.m_registers[e][n];c==null||c.destroyFcn(t)}}Us.b2ContactFactory=zh;var Ye={};Object.defineProperty(Ye,"__esModule",{value:!0});Ye.b2ContactListener=Ye.b2ContactImpulse=Ye.b2ContactFilter=Ye.b2DestructionListener=void 0;const Gn=jt;class $h{SayGoodbyeJoint(t){}SayGoodbyeFixture(t){}}Ye.b2DestructionListener=$h;class Uo{ShouldCollide(t,e){const n=t.GetFilterData(),c=e.GetFilterData();return n.groupIndex===c.groupIndex&&n.groupIndex!==0?n.groupIndex>0:(n.maskBits&c.categoryBits)!==0&&(n.categoryBits&c.maskBits)!==0}}Ye.b2ContactFilter=Uo;Uo.b2_defaultFilter=new Uo;class Nh{constructor(){this.normalImpulses=(0,Gn.b2MakeNumberArray)(Gn.b2_maxManifoldPoints),this.tangentImpulses=(0,Gn.b2MakeNumberArray)(Gn.b2_maxManifoldPoints),this.count=0}}Ye.b2ContactImpulse=Nh;class Ko{BeginContact(t){}EndContact(t){}PreSolve(t,e){}PostSolve(t,e){}}Ye.b2ContactListener=Ko;Ko.b2_defaultListener=new Ko;Object.defineProperty(Qs,"__esModule",{value:!0});Qs.b2ContactManager=void 0;const Wh=Xs,Hh=Us,Ta=pi,Da=Ye;class Zh{constructor(){this.m_broadPhase=new Wh.b2BroadPhase,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=Da.b2ContactFilter.b2_defaultFilter,this.m_contactListener=Da.b2ContactListener.b2_defaultListener,this.m_contactFactory=new Hh.b2ContactFactory,this.AddPair=(t,e)=>{let n=t.fixture,c=e.fixture,r=t.childIndex,m=e.childIndex,u=n.GetBody(),p=c.GetBody();if(u===p)return;let b=p.GetContactList();for(;b;){if(b.other===u){const A=b.contact.GetFixtureA(),y=b.contact.GetFixtureB(),f=b.contact.GetChildIndexA(),x=b.contact.GetChildIndexB();if(A===n&&y===c&&f===r&&x===m||A===c&&y===n&&f===m&&x===r)return}b=b.next}if(p.ShouldCollide(u)===!1||this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(n,c))return;const d=this.m_contactFactory.Create(n,r,c,m);d!==null&&(n=d.GetFixtureA(),c=d.GetFixtureB(),r=d.GetChildIndexA(),m=d.GetChildIndexB(),u=n.m_body,p=c.m_body,d.m_prev=null,d.m_next=this.m_contactList,this.m_contactList!==null&&(this.m_contactList.m_prev=d),this.m_contactList=d,d.m_nodeA.other=p,d.m_nodeA.prev=null,d.m_nodeA.next=u.m_contactList,u.m_contactList!==null&&(u.m_contactList.prev=d.m_nodeA),u.m_contactList=d.m_nodeA,d.m_nodeB.other=u,d.m_nodeB.prev=null,d.m_nodeB.next=p.m_contactList,p.m_contactList!==null&&(p.m_contactList.prev=d.m_nodeB),p.m_contactList=d.m_nodeB,++this.m_contactCount)}}FindNewContacts(){this.m_broadPhase.UpdatePairs(this.AddPair)}Destroy(t){const e=t.GetFixtureA(),n=t.GetFixtureB(),c=e.GetBody(),r=n.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===c.m_contactList&&(c.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===r.m_contactList&&(r.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!n.IsSensor()&&(e.GetBody().SetAwake(!0),n.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount}Collide(){let t=this.m_contactList;for(;t;){const e=t.GetFixtureA(),n=t.GetFixtureB(),c=t.GetChildIndexA(),r=t.GetChildIndexB(),m=e.GetBody(),u=n.GetBody();if(t.m_filterFlag){if(!u.ShouldCollide(m)||this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,n)){const f=t;t=f.m_next,this.Destroy(f);continue}t.m_filterFlag=!1}const p=m.IsAwake()&&m.m_type!==Ta.b2BodyType.b2_staticBody,b=u.IsAwake()&&u.m_type!==Ta.b2BodyType.b2_staticBody;if(!p&&!b){t=t.m_next;continue}const d=e.m_proxies[c].treeNode,A=n.m_proxies[r].treeNode;if(!d.aabb.TestOverlap(A.aabb)){const f=t;t=f.m_next,this.Destroy(f);continue}t.Update(this.m_contactListener),t=t.m_next}}}Qs.b2ContactManager=Zh;var io={},Ne={},Te={};Object.defineProperty(Te,"__esModule",{value:!0});Te.b2SolverData=Te.b2Velocity=Te.b2Position=Te.b2TimeStep=Te.b2Profile=void 0;const Wa=Dt;class Xh{constructor(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}Reset(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}Te.b2Profile=Xh;class so{constructor(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.config={velocityIterations:0,positionIterations:0},this.warmStarting=!1}static Create(){return new so}Copy(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.config={...t.config},this.warmStarting=t.warmStarting,this}}Te.b2TimeStep=so;class Yh{constructor(){this.c=new Wa.b2Vec2,this.a=0}}Te.b2Position=Yh;class Qh{constructor(){this.v=new Wa.b2Vec2,this.w=0}}Te.b2Velocity=Qh;class Uh{constructor(){this.step=so.Create()}}Te.b2SolverData=Uh;Object.defineProperty(Ne,"__esModule",{value:!0});Ne.b2ContactSolver=Ne.b2ContactSolverDef=Ne.b2ContactVelocityConstraint=Ne.b2GetBlockSolve=Ne.b2SetBlockSolve=void 0;const Fe=jt,D=Dt,Ns=yt,Ha=Te;let kn=!0;function Kh(a){kn=a}Ne.b2SetBlockSolve=Kh;function t_(){return kn}Ne.b2GetBlockSolve=t_;class e_{constructor(){this.rA=new D.b2Vec2,this.rB=new D.b2Vec2,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}}class tr{constructor(){this.points=(0,Fe.b2MakeArray)(Fe.b2_maxManifoldPoints,e_),this.normal=new D.b2Vec2,this.tangent=new D.b2Vec2,this.normalMass=new D.b2Mat22,this.K=new D.b2Mat22,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.threshold=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}}Ne.b2ContactVelocityConstraint=tr;class Ga{constructor(){this.localPoints=(0,Fe.b2MakeArray)(Fe.b2_maxManifoldPoints,D.b2Vec2),this.localNormal=new D.b2Vec2,this.localPoint=new D.b2Vec2,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new D.b2Vec2,this.localCenterB=new D.b2Vec2,this.invIA=0,this.invIB=0,this.type=Ns.b2ManifoldType.e_circles,this.radiusA=0,this.radiusB=0,this.pointCount=0}}class i_{constructor(){this.step=Ha.b2TimeStep.Create(),this.count=0}}Ne.b2ContactSolverDef=i_;class ri{constructor(){this.normal=new D.b2Vec2,this.point=new D.b2Vec2,this.separation=0}Initialize(t,e,n,c){const r=ri.Initialize_s_pointA,m=ri.Initialize_s_pointB,u=ri.Initialize_s_planePoint,p=ri.Initialize_s_clipPoint;switch(t.type){case Ns.b2ManifoldType.e_circles:D.b2Transform.MultiplyVec2(e,t.localPoint,r),D.b2Transform.MultiplyVec2(n,t.localPoints[0],m),D.b2Vec2.Subtract(m,r,this.normal).Normalize(),D.b2Vec2.Mid(r,m,this.point),this.separation=D.b2Vec2.Dot(D.b2Vec2.Subtract(m,r,D.b2Vec2.s_t0),this.normal)-t.radiusA-t.radiusB;break;case Ns.b2ManifoldType.e_faceA:D.b2Rot.MultiplyVec2(e.q,t.localNormal,this.normal),D.b2Transform.MultiplyVec2(e,t.localPoint,u),D.b2Transform.MultiplyVec2(n,t.localPoints[c],p),this.separation=D.b2Vec2.Dot(D.b2Vec2.Subtract(p,u,D.b2Vec2.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(p);break;case Ns.b2ManifoldType.e_faceB:D.b2Rot.MultiplyVec2(n.q,t.localNormal,this.normal),D.b2Transform.MultiplyVec2(n,t.localPoint,u),D.b2Transform.MultiplyVec2(e,t.localPoints[c],p),this.separation=D.b2Vec2.Dot(D.b2Vec2.Subtract(p,u,D.b2Vec2.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(p),this.normal.Negate();break}}}ri.Initialize_s_pointA=new D.b2Vec2;ri.Initialize_s_pointB=new D.b2Vec2;ri.Initialize_s_planePoint=new D.b2Vec2;ri.Initialize_s_clipPoint=new D.b2Vec2;class ut{constructor(){this.m_step=Ha.b2TimeStep.Create(),this.m_positionConstraints=(0,Fe.b2MakeArray)(1024,Ga),this.m_velocityConstraints=(0,Fe.b2MakeArray)(1024,tr),this.m_count=0}Initialize(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count){const e=Math.max(this.m_positionConstraints.length*2,this.m_count);for(;this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new Ga}if(this.m_velocityConstraints.length<this.m_count){const e=Math.max(this.m_velocityConstraints.length*2,this.m_count);for(;this.m_velocityConstraints.length<e;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new tr}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(let e=0;e<this.m_count;++e){const n=this.m_contacts[e],c=n.m_fixtureA,r=n.m_fixtureB,m=c.GetShape(),u=r.GetShape(),p=m.m_radius,b=u.m_radius,d=c.GetBody(),A=r.GetBody(),y=n.GetManifold(),{pointCount:f}=y,x=this.m_velocityConstraints[e];x.friction=n.m_friction,x.restitution=n.m_restitution,x.threshold=n.m_restitutionThreshold,x.tangentSpeed=n.m_tangentSpeed,x.indexA=d.m_islandIndex,x.indexB=A.m_islandIndex,x.invMassA=d.m_invMass,x.invMassB=A.m_invMass,x.invIA=d.m_invI,x.invIB=A.m_invI,x.contactIndex=e,x.pointCount=f,x.K.SetZero(),x.normalMass.SetZero();const S=this.m_positionConstraints[e];S.indexA=d.m_islandIndex,S.indexB=A.m_islandIndex,S.invMassA=d.m_invMass,S.invMassB=A.m_invMass,S.localCenterA.Copy(d.m_sweep.localCenter),S.localCenterB.Copy(A.m_sweep.localCenter),S.invIA=d.m_invI,S.invIB=A.m_invI,S.localNormal.Copy(y.localNormal),S.localPoint.Copy(y.localPoint),S.pointCount=f,S.radiusA=p,S.radiusB=b,S.type=y.type;for(let V=0;V<f;++V){const C=y.points[V],_=x.points[V];this.m_step.warmStarting?(_.normalImpulse=this.m_step.dtRatio*C.normalImpulse,_.tangentImpulse=this.m_step.dtRatio*C.tangentImpulse):(_.normalImpulse=0,_.tangentImpulse=0),_.rA.SetZero(),_.rB.SetZero(),_.normalMass=0,_.tangentMass=0,_.velocityBias=0,S.localPoints[V].Copy(C.localPoint)}}return this}InitializeVelocityConstraints(){const t=ut.InitializeVelocityConstraints_s_xfA,e=ut.InitializeVelocityConstraints_s_xfB,n=ut.InitializeVelocityConstraints_s_worldManifold,c=1e3;for(let r=0;r<this.m_count;++r){const m=this.m_velocityConstraints[r],u=this.m_positionConstraints[r],{radiusA:p,radiusB:b,localCenterA:d,localCenterB:A}=u,y=this.m_contacts[m.contactIndex].GetManifold(),{indexA:f,indexB:x,tangent:S,pointCount:V}=m,C=m.invMassA,_=m.invMassB,g=m.invIA,w=m.invIB,M=this.m_positions[f].c,L=this.m_positions[f].a,R=this.m_velocities[f].v,z=this.m_velocities[f].w,N=this.m_positions[x].c,G=this.m_positions[x].a,H=this.m_velocities[x].v,k=this.m_velocities[x].w;t.q.Set(L),e.q.Set(G),D.b2Vec2.Subtract(M,D.b2Rot.MultiplyVec2(t.q,d,D.b2Vec2.s_t0),t.p),D.b2Vec2.Subtract(N,D.b2Rot.MultiplyVec2(e.q,A,D.b2Vec2.s_t0),e.p),n.Initialize(y,t,p,e,b),m.normal.Copy(n.normal),D.b2Vec2.CrossVec2One(m.normal,S);for(let j=0;j<V;++j){const O=m.points[j];D.b2Vec2.Subtract(n.points[j],M,O.rA),D.b2Vec2.Subtract(n.points[j],N,O.rB);const W=D.b2Vec2.Cross(O.rA,m.normal),tt=D.b2Vec2.Cross(O.rB,m.normal),st=C+_+g*W*W+w*tt*tt;O.normalMass=st>0?1/st:0;const _t=D.b2Vec2.Cross(O.rA,S),pt=D.b2Vec2.Cross(O.rB,S),Q=C+_+g*_t*_t+w*pt*pt;O.tangentMass=Q>0?1/Q:0,O.velocityBias=0;const nt=D.b2Vec2.Dot(m.normal,D.b2Vec2.Subtract(D.b2Vec2.AddCrossScalarVec2(H,k,O.rB,D.b2Vec2.s_t0),D.b2Vec2.AddCrossScalarVec2(R,z,O.rA,D.b2Vec2.s_t1),D.b2Vec2.s_t0));nt<-m.threshold&&(O.velocityBias=-m.restitution*nt)}if(m.pointCount===2&&kn){const j=m.points[0],O=m.points[1],W=D.b2Vec2.Cross(j.rA,m.normal),tt=D.b2Vec2.Cross(j.rB,m.normal),st=D.b2Vec2.Cross(O.rA,m.normal),_t=D.b2Vec2.Cross(O.rB,m.normal),pt=C+_+g*W*W+w*tt*tt,Q=C+_+g*st*st+w*_t*_t,nt=C+_+g*W*st+w*tt*_t;pt*pt<c*(pt*Q-nt*nt)?(m.K.ex.Set(pt,nt),m.K.ey.Set(nt,Q),m.K.GetInverse(m.normalMass)):m.pointCount=1}}}WarmStart(){const t=ut.WarmStart_s_P;for(let e=0;e<this.m_count;++e){const n=this.m_velocityConstraints[e],{indexA:c,indexB:r,pointCount:m,normal:u,tangent:p}=n,b=n.invMassA,d=n.invIA,A=n.invMassB,y=n.invIB,f=this.m_velocities[c].v;let x=this.m_velocities[c].w;const S=this.m_velocities[r].v;let V=this.m_velocities[r].w;for(let C=0;C<m;++C){const _=n.points[C];D.b2Vec2.Add(D.b2Vec2.Scale(_.normalImpulse,u,D.b2Vec2.s_t0),D.b2Vec2.Scale(_.tangentImpulse,p,D.b2Vec2.s_t1),t),x-=d*D.b2Vec2.Cross(_.rA,t),f.SubtractScaled(b,t),V+=y*D.b2Vec2.Cross(_.rB,t),S.AddScaled(A,t)}this.m_velocities[c].w=x,this.m_velocities[r].w=V}}SolveVelocityConstraints(){const t=ut.SolveVelocityConstraints_s_dv,e=ut.SolveVelocityConstraints_s_dv1,n=ut.SolveVelocityConstraints_s_dv2,c=ut.SolveVelocityConstraints_s_P,r=ut.SolveVelocityConstraints_s_a,m=ut.SolveVelocityConstraints_s_b,u=ut.SolveVelocityConstraints_s_x,p=ut.SolveVelocityConstraints_s_d,b=ut.SolveVelocityConstraints_s_P1,d=ut.SolveVelocityConstraints_s_P2,A=ut.SolveVelocityConstraints_s_P1P2;for(let y=0;y<this.m_count;++y){const f=this.m_velocityConstraints[y],{indexA:x,indexB:S,pointCount:V,normal:C,tangent:_,friction:g}=f,w=f.invMassA,M=f.invIA,L=f.invMassB,R=f.invIB,z=this.m_velocities[x].v;let N=this.m_velocities[x].w;const G=this.m_velocities[S].v;let H=this.m_velocities[S].w;for(let k=0;k<V;++k){const j=f.points[k];D.b2Vec2.Subtract(D.b2Vec2.AddCrossScalarVec2(G,H,j.rB,D.b2Vec2.s_t0),D.b2Vec2.AddCrossScalarVec2(z,N,j.rA,D.b2Vec2.s_t1),t);const O=D.b2Vec2.Dot(t,_)-f.tangentSpeed;let W=j.tangentMass*-O;const tt=g*j.normalImpulse,st=(0,D.b2Clamp)(j.tangentImpulse+W,-tt,tt);W=st-j.tangentImpulse,j.tangentImpulse=st,D.b2Vec2.Scale(W,_,c),z.SubtractScaled(w,c),N-=M*D.b2Vec2.Cross(j.rA,c),G.AddScaled(L,c),H+=R*D.b2Vec2.Cross(j.rB,c)}if(f.pointCount===1||kn===!1)for(let k=0;k<V;++k){const j=f.points[k];D.b2Vec2.Subtract(D.b2Vec2.AddCrossScalarVec2(G,H,j.rB,D.b2Vec2.s_t0),D.b2Vec2.AddCrossScalarVec2(z,N,j.rA,D.b2Vec2.s_t1),t);const O=D.b2Vec2.Dot(t,C);let W=-j.normalMass*(O-j.velocityBias);const tt=Math.max(j.normalImpulse+W,0);W=tt-j.normalImpulse,j.normalImpulse=tt,D.b2Vec2.Scale(W,C,c),z.SubtractScaled(w,c),N-=M*D.b2Vec2.Cross(j.rA,c),G.AddScaled(L,c),H+=R*D.b2Vec2.Cross(j.rB,c)}else{const k=f.points[0],j=f.points[1];r.Set(k.normalImpulse,j.normalImpulse),D.b2Vec2.Subtract(D.b2Vec2.AddCrossScalarVec2(G,H,k.rB,D.b2Vec2.s_t0),D.b2Vec2.AddCrossScalarVec2(z,N,k.rA,D.b2Vec2.s_t1),e),D.b2Vec2.Subtract(D.b2Vec2.AddCrossScalarVec2(G,H,j.rB,D.b2Vec2.s_t0),D.b2Vec2.AddCrossScalarVec2(z,N,j.rA,D.b2Vec2.s_t1),n);let O=D.b2Vec2.Dot(e,C),W=D.b2Vec2.Dot(n,C);for(m.x=O-k.velocityBias,m.y=W-j.velocityBias,m.Subtract(D.b2Mat22.MultiplyVec2(f.K,r,D.b2Vec2.s_t0));;){if(D.b2Mat22.MultiplyVec2(f.normalMass,m,u).Negate(),u.x>=0&&u.y>=0){D.b2Vec2.Subtract(u,r,p),D.b2Vec2.Scale(p.x,C,b),D.b2Vec2.Scale(p.y,C,d),D.b2Vec2.Add(b,d,A),z.SubtractScaled(w,A),N-=M*(D.b2Vec2.Cross(k.rA,b)+D.b2Vec2.Cross(j.rA,d)),G.AddScaled(L,A),H+=R*(D.b2Vec2.Cross(k.rB,b)+D.b2Vec2.Cross(j.rB,d)),k.normalImpulse=u.x,j.normalImpulse=u.y;break}if(u.x=-k.normalMass*m.x,u.y=0,O=0,W=f.K.ex.y*u.x+m.y,u.x>=0&&W>=0){D.b2Vec2.Subtract(u,r,p),D.b2Vec2.Scale(p.x,C,b),D.b2Vec2.Scale(p.y,C,d),D.b2Vec2.Add(b,d,A),z.SubtractScaled(w,A),N-=M*(D.b2Vec2.Cross(k.rA,b)+D.b2Vec2.Cross(j.rA,d)),G.AddScaled(L,A),H+=R*(D.b2Vec2.Cross(k.rB,b)+D.b2Vec2.Cross(j.rB,d)),k.normalImpulse=u.x,j.normalImpulse=u.y;break}if(u.x=0,u.y=-j.normalMass*m.y,O=f.K.ey.x*u.y+m.x,W=0,u.y>=0&&O>=0){D.b2Vec2.Subtract(u,r,p),D.b2Vec2.Scale(p.x,C,b),D.b2Vec2.Scale(p.y,C,d),D.b2Vec2.Add(b,d,A),z.SubtractScaled(w,A),N-=M*(D.b2Vec2.Cross(k.rA,b)+D.b2Vec2.Cross(j.rA,d)),G.AddScaled(L,A),H+=R*(D.b2Vec2.Cross(k.rB,b)+D.b2Vec2.Cross(j.rB,d)),k.normalImpulse=u.x,j.normalImpulse=u.y;break}if(u.x=0,u.y=0,O=m.x,W=m.y,O>=0&&W>=0){D.b2Vec2.Subtract(u,r,p),D.b2Vec2.Scale(p.x,C,b),D.b2Vec2.Scale(p.y,C,d),D.b2Vec2.Add(b,d,A),z.SubtractScaled(w,A),N-=M*(D.b2Vec2.Cross(k.rA,b)+D.b2Vec2.Cross(j.rA,d)),G.AddScaled(L,A),H+=R*(D.b2Vec2.Cross(k.rB,b)+D.b2Vec2.Cross(j.rB,d)),k.normalImpulse=u.x,j.normalImpulse=u.y;break}break}}this.m_velocities[x].w=N,this.m_velocities[S].w=H}}StoreImpulses(){for(let t=0;t<this.m_count;++t){const e=this.m_velocityConstraints[t],n=this.m_contacts[e.contactIndex].GetManifold();for(let c=0;c<e.pointCount;++c)n.points[c].normalImpulse=e.points[c].normalImpulse,n.points[c].tangentImpulse=e.points[c].tangentImpulse}}SolvePositionConstraints(){const t=ut.SolvePositionConstraints_s_xfA,e=ut.SolvePositionConstraints_s_xfB,n=ut.SolvePositionConstraints_s_psm,c=ut.SolvePositionConstraints_s_rA,r=ut.SolvePositionConstraints_s_rB,m=ut.SolvePositionConstraints_s_P;let u=0;for(let p=0;p<this.m_count;++p){const b=this.m_positionConstraints[p],{indexA:d,indexB:A,localCenterA:y,localCenterB:f,pointCount:x}=b,S=b.invMassA,V=b.invIA,C=b.invMassB,_=b.invIB,g=this.m_positions[d].c;let w=this.m_positions[d].a;const M=this.m_positions[A].c;let L=this.m_positions[A].a;for(let R=0;R<x;++R){t.q.Set(w),e.q.Set(L),D.b2Vec2.Subtract(g,D.b2Rot.MultiplyVec2(t.q,y,D.b2Vec2.s_t0),t.p),D.b2Vec2.Subtract(M,D.b2Rot.MultiplyVec2(e.q,f,D.b2Vec2.s_t0),e.p),n.Initialize(b,t,e,R);const{normal:z,point:N,separation:G}=n;D.b2Vec2.Subtract(N,g,c),D.b2Vec2.Subtract(N,M,r),u=Math.min(u,G);const H=(0,D.b2Clamp)(Fe.b2_baumgarte*(G+Fe.b2_linearSlop),-Fe.b2_maxLinearCorrection,0),k=D.b2Vec2.Cross(c,z),j=D.b2Vec2.Cross(r,z),O=S+C+V*k*k+_*j*j,W=O>0?-H/O:0;D.b2Vec2.Scale(W,z,m),g.SubtractScaled(S,m),w-=V*D.b2Vec2.Cross(c,m),M.AddScaled(C,m),L+=_*D.b2Vec2.Cross(r,m)}this.m_positions[d].c.Copy(g),this.m_positions[d].a=w,this.m_positions[A].c.Copy(M),this.m_positions[A].a=L}return u>=-3*Fe.b2_linearSlop}SolveTOIPositionConstraints(t,e){const n=ut.SolveTOIPositionConstraints_s_xfA,c=ut.SolveTOIPositionConstraints_s_xfB,r=ut.SolveTOIPositionConstraints_s_psm,m=ut.SolveTOIPositionConstraints_s_rA,u=ut.SolveTOIPositionConstraints_s_rB,p=ut.SolveTOIPositionConstraints_s_P;let b=0;for(let d=0;d<this.m_count;++d){const A=this.m_positionConstraints[d],{indexA:y,indexB:f,localCenterA:x,localCenterB:S,pointCount:V}=A;let C=0,_=0;(y===t||y===e)&&(C=A.invMassA,_=A.invIA);let g=0,w=0;(f===t||f===e)&&(g=A.invMassB,w=A.invIB);const M=this.m_positions[y].c;let L=this.m_positions[y].a;const R=this.m_positions[f].c;let z=this.m_positions[f].a;for(let N=0;N<V;++N){n.q.Set(L),c.q.Set(z),D.b2Vec2.Subtract(M,D.b2Rot.MultiplyVec2(n.q,x,D.b2Vec2.s_t0),n.p),D.b2Vec2.Subtract(R,D.b2Rot.MultiplyVec2(c.q,S,D.b2Vec2.s_t0),c.p),r.Initialize(A,n,c,N);const{normal:G,point:H,separation:k}=r;D.b2Vec2.Subtract(H,M,m),D.b2Vec2.Subtract(H,R,u),b=Math.min(b,k);const j=(0,D.b2Clamp)(Fe.b2_toiBaumgarte*(k+Fe.b2_linearSlop),-Fe.b2_maxLinearCorrection,0),O=D.b2Vec2.Cross(m,G),W=D.b2Vec2.Cross(u,G),tt=C+g+_*O*O+w*W*W,st=tt>0?-j/tt:0;D.b2Vec2.Scale(st,G,p),M.SubtractScaled(C,p),L-=_*D.b2Vec2.Cross(m,p),R.AddScaled(g,p),z+=w*D.b2Vec2.Cross(u,p)}this.m_positions[y].a=L,this.m_positions[f].a=z}return b>=-1.5*Fe.b2_linearSlop}}Ne.b2ContactSolver=ut;ut.InitializeVelocityConstraints_s_xfA=new D.b2Transform;ut.InitializeVelocityConstraints_s_xfB=new D.b2Transform;ut.InitializeVelocityConstraints_s_worldManifold=new Ns.b2WorldManifold;ut.WarmStart_s_P=new D.b2Vec2;ut.SolveVelocityConstraints_s_dv=new D.b2Vec2;ut.SolveVelocityConstraints_s_dv1=new D.b2Vec2;ut.SolveVelocityConstraints_s_dv2=new D.b2Vec2;ut.SolveVelocityConstraints_s_P=new D.b2Vec2;ut.SolveVelocityConstraints_s_a=new D.b2Vec2;ut.SolveVelocityConstraints_s_b=new D.b2Vec2;ut.SolveVelocityConstraints_s_x=new D.b2Vec2;ut.SolveVelocityConstraints_s_d=new D.b2Vec2;ut.SolveVelocityConstraints_s_P1=new D.b2Vec2;ut.SolveVelocityConstraints_s_P2=new D.b2Vec2;ut.SolveVelocityConstraints_s_P1P2=new D.b2Vec2;ut.SolvePositionConstraints_s_xfA=new D.b2Transform;ut.SolvePositionConstraints_s_xfB=new D.b2Transform;ut.SolvePositionConstraints_s_psm=new ri;ut.SolvePositionConstraints_s_rA=new D.b2Vec2;ut.SolvePositionConstraints_s_rB=new D.b2Vec2;ut.SolvePositionConstraints_s_P=new D.b2Vec2;ut.SolveTOIPositionConstraints_s_xfA=new D.b2Transform;ut.SolveTOIPositionConstraints_s_xfB=new D.b2Transform;ut.SolveTOIPositionConstraints_s_psm=new ri;ut.SolveTOIPositionConstraints_s_rA=new D.b2Vec2;ut.SolveTOIPositionConstraints_s_rB=new D.b2Vec2;ut.SolveTOIPositionConstraints_s_P=new D.b2Vec2;Object.defineProperty(io,"__esModule",{value:!0});io.b2Island=void 0;const Ce=jt,xs=Dt,s_=hs,Za=Ne,La=pi,qs=Te,n_=Ye;class Ae{constructor(t,e,n,c){this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=t,this.m_listener=c,this.m_bodies=new Array(t),this.m_contacts=new Array(e),this.m_joints=new Array(n),this.m_velocities=(0,Ce.b2MakeArray)(t,qs.b2Velocity),this.m_positions=(0,Ce.b2MakeArray)(t,qs.b2Position),this.Resize(t)}Resize(t){for(;this.m_bodyCapacity<t;)this.m_velocities[this.m_bodyCapacity]=new qs.b2Velocity,this.m_positions[this.m_bodyCapacity]=new qs.b2Position,this.m_bodyCapacity++}Clear(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}AddBody(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount]=t,++this.m_bodyCount}AddContact(t){this.m_contacts[this.m_contactCount++]=t}AddJoint(t){this.m_joints[this.m_jointCount++]=t}Solve(t,e,n,c){const r=Ae.s_timer.Reset(),m=e.dt;for(let A=0;A<this.m_bodyCount;++A){const y=this.m_bodies[A];this.m_positions[A].c.Copy(y.m_sweep.c);const{a:f}=y.m_sweep,x=this.m_velocities[A].v.Copy(y.m_linearVelocity);let S=y.m_angularVelocity;y.m_sweep.c0.Copy(y.m_sweep.c),y.m_sweep.a0=y.m_sweep.a,y.m_type===La.b2BodyType.b2_dynamicBody&&(x.x+=m*y.m_invMass*(y.m_gravityScale*y.m_mass*n.x+y.m_force.x),x.y+=m*y.m_invMass*(y.m_gravityScale*y.m_mass*n.y+y.m_force.y),S+=m*y.m_invI*y.m_torque,x.Scale(1/(1+m*y.m_linearDamping)),S*=1/(1+m*y.m_angularDamping)),this.m_positions[A].a=f,this.m_velocities[A].w=S}r.Reset();const u=Ae.s_solverData;u.step.Copy(e),u.positions=this.m_positions,u.velocities=this.m_velocities;const p=Ae.s_contactSolverDef;p.step.Copy(e),p.contacts=this.m_contacts,p.count=this.m_contactCount,p.positions=this.m_positions,p.velocities=this.m_velocities;const b=Ae.s_contactSolver.Initialize(p);b.InitializeVelocityConstraints(),e.warmStarting&&b.WarmStart();for(let A=0;A<this.m_jointCount;++A)this.m_joints[A].InitVelocityConstraints(u);t.solveInit=r.GetMilliseconds(),r.Reset();for(let A=0;A<e.config.velocityIterations;++A){for(let y=0;y<this.m_jointCount;++y)this.m_joints[y].SolveVelocityConstraints(u);b.SolveVelocityConstraints()}b.StoreImpulses(),t.solveVelocity=r.GetMilliseconds();for(let A=0;A<this.m_bodyCount;++A){const{c:y}=this.m_positions[A];let{a:f}=this.m_positions[A];const{v:x}=this.m_velocities[A];let{w:S}=this.m_velocities[A];const V=xs.b2Vec2.Scale(m,x,Ae.s_translation);if(xs.b2Vec2.Dot(V,V)>Ce.b2_maxTranslationSquared){const _=Ce.b2_maxTranslation/V.Length();x.Scale(_)}const C=m*S;if(C*C>Ce.b2_maxRotationSquared){const _=Ce.b2_maxRotation/Math.abs(C);S*=_}y.AddScaled(m,x),f+=m*S,this.m_positions[A].a=f,this.m_velocities[A].w=S}r.Reset();let d=!1;for(let A=0;A<e.config.positionIterations;++A){const y=b.SolvePositionConstraints();let f=!0;for(let x=0;x<this.m_jointCount;++x){const S=this.m_joints[x].SolvePositionConstraints(u);f=f&&S}if(y&&f){d=!0;break}}for(let A=0;A<this.m_bodyCount;++A){const y=this.m_bodies[A];y.m_sweep.c.Copy(this.m_positions[A].c),y.m_sweep.a=this.m_positions[A].a,y.m_linearVelocity.Copy(this.m_velocities[A].v),y.m_angularVelocity=this.m_velocities[A].w,y.SynchronizeTransform()}if(t.solvePosition=r.GetMilliseconds(),this.Report(b.m_velocityConstraints),c){let A=Ce.b2_maxFloat;const y=Ce.b2_linearSleepTolerance*Ce.b2_linearSleepTolerance,f=Ce.b2_angularSleepTolerance*Ce.b2_angularSleepTolerance;for(let x=0;x<this.m_bodyCount;++x){const S=this.m_bodies[x];S.GetType()!==La.b2BodyType.b2_staticBody&&(!S.m_autoSleepFlag||S.m_angularVelocity*S.m_angularVelocity>f||xs.b2Vec2.Dot(S.m_linearVelocity,S.m_linearVelocity)>y?(S.m_sleepTime=0,A=0):(S.m_sleepTime+=m,A=Math.min(A,S.m_sleepTime)))}if(A>=Ce.b2_timeToSleep&&d)for(let x=0;x<this.m_bodyCount;++x)this.m_bodies[x].SetAwake(!1)}}SolveTOI(t,e,n){for(let u=0;u<this.m_bodyCount;++u){const p=this.m_bodies[u];this.m_positions[u].c.Copy(p.m_sweep.c),this.m_positions[u].a=p.m_sweep.a,this.m_velocities[u].v.Copy(p.m_linearVelocity),this.m_velocities[u].w=p.m_angularVelocity}const c=Ae.s_contactSolverDef;c.contacts=this.m_contacts,c.count=this.m_contactCount,c.step.Copy(t),c.positions=this.m_positions,c.velocities=this.m_velocities;const r=Ae.s_contactSolver.Initialize(c);for(let u=0;u<t.config.positionIterations&&!r.SolveTOIPositionConstraints(e,n);++u);this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[n].m_sweep.c0.Copy(this.m_positions[n].c),this.m_bodies[n].m_sweep.a0=this.m_positions[n].a,r.InitializeVelocityConstraints();for(let u=0;u<t.config.velocityIterations;++u)r.SolveVelocityConstraints();const m=t.dt;for(let u=0;u<this.m_bodyCount;++u){const{c:p}=this.m_positions[u];let{a:b}=this.m_positions[u];const{v:d}=this.m_velocities[u];let{w:A}=this.m_velocities[u];const y=xs.b2Vec2.Scale(m,d,Ae.s_translation);if(xs.b2Vec2.Dot(y,y)>Ce.b2_maxTranslationSquared){const S=Ce.b2_maxTranslation/y.Length();d.Scale(S)}const f=m*A;if(f*f>Ce.b2_maxRotationSquared){const S=Ce.b2_maxRotation/Math.abs(f);A*=S}p.AddScaled(m,d),b+=m*A,this.m_positions[u].a=b,this.m_velocities[u].w=A;const x=this.m_bodies[u];x.m_sweep.c.Copy(p),x.m_sweep.a=b,x.m_linearVelocity.Copy(d),x.m_angularVelocity=A,x.SynchronizeTransform()}this.Report(r.m_velocityConstraints)}Report(t){for(let e=0;e<this.m_contactCount;++e){const n=this.m_contacts[e],c=t[e],r=Ae.s_impulse;r.count=c.pointCount;for(let m=0;m<c.pointCount;++m)r.normalImpulses[m]=c.points[m].normalImpulse,r.tangentImpulses[m]=c.points[m].tangentImpulse;this.m_listener.PostSolve(n,r)}}}io.b2Island=Ae;Ae.s_timer=new s_.b2Timer;Ae.s_solverData=new qs.b2SolverData;Ae.s_contactSolverDef=new Za.b2ContactSolverDef;Ae.s_contactSolver=new Za.b2ContactSolver;Ae.s_translation=new xs.b2Vec2;Ae.s_impulse=new n_.b2ContactImpulse;Object.defineProperty(Wn,"__esModule",{value:!0});Wn.b2World=void 0;const Me=jt,Ks=Dt,or=hs,no=yt,En=sr,si=Yt,o_=is,r_=qi,a_=ss,c_=ns,l_=os,m_=rs,h_=as,__=Pi,u_=cs,d_=ls,p_=ms,qe=pi,b_=Qs,f_=io,jn=Te;class Et{constructor(t){this.m_contactManager=new b_.b2ContactManager,this.m_bodyList=null,this.m_jointList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new Ks.b2Vec2,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_inv_dt0=0,this.m_newContacts=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new jn.b2Profile,this.m_island=new f_.b2Island(2*Me.b2_maxTOIContacts,Me.b2_maxTOIContacts,0,this.m_contactManager.m_contactListener),this.s_stack=[],this.m_gravity.Copy(t)}static Create(t){return new Et(t)}SetDestructionListener(t){this.m_destructionListener=t}GetDestructionListener(){return this.m_destructionListener}SetContactFilter(t){this.m_contactManager.m_contactFilter=t}SetContactListener(t){this.m_contactManager.m_contactListener=t,this.m_island.m_listener=t}CreateBody(t={}){(0,Me.b2Assert)(!this.IsLocked());const e=new qe.b2Body(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}DestroyBody(t){var e,n;(0,Me.b2Assert)(!this.IsLocked());let c=t.m_jointList;for(;c;){const p=c;c=c.next,(e=this.m_destructionListener)===null||e===void 0||e.SayGoodbyeJoint(p.joint),this.DestroyJoint(p.joint),t.m_jointList=c}t.m_jointList=null;let r=t.m_contactList;for(;r;){const p=r;r=r.next,this.m_contactManager.Destroy(p.contact)}t.m_contactList=null;const m=this.m_contactManager.m_broadPhase;let u=t.m_fixtureList;for(;u;){const p=u;u=u.m_next,(n=this.m_destructionListener)===null||n===void 0||n.SayGoodbyeFixture(p),p.DestroyProxies(m),t.m_fixtureList=u,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}static Joint_Create(t){switch(t.type){case si.b2JointType.e_distanceJoint:return new r_.b2DistanceJoint(t);case si.b2JointType.e_mouseJoint:return new m_.b2MouseJoint(t);case si.b2JointType.e_prismaticJoint:return new h_.b2PrismaticJoint(t);case si.b2JointType.e_revoluteJoint:return new u_.b2RevoluteJoint(t);case si.b2JointType.e_pulleyJoint:return new __.b2PulleyJoint(t);case si.b2JointType.e_gearJoint:return new c_.b2GearJoint(t);case si.b2JointType.e_wheelJoint:return new p_.b2WheelJoint(t);case si.b2JointType.e_weldJoint:return new d_.b2WeldJoint(t);case si.b2JointType.e_frictionJoint:return new a_.b2FrictionJoint(t);case si.b2JointType.e_motorJoint:return new l_.b2MotorJoint(t);case si.b2JointType.e_areaJoint:return new o_.b2AreaJoint(t)}throw new Error}CreateJoint(t){(0,Me.b2Assert)(!this.IsLocked());const e=Et.Joint_Create(t);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;const n=e.m_bodyA,c=e.m_bodyB;if(!t.collideConnected){let r=c.GetContactList();for(;r;)r.other===n&&r.contact.FlagForFiltering(),r=r.next}return e}DestroyJoint(t){(0,Me.b2Assert)(!this.IsLocked()),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);const e=t.m_bodyA,n=t.m_bodyB,c=t.m_collideConnected;if(e.SetAwake(!0),n.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===n.m_jointList&&(n.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,!c){let r=n.GetContactList();for(;r;)r.other===e&&r.contact.FlagForFiltering(),r=r.next}}Step(t,e){const n=Et.Step_s_stepTimer.Reset();this.m_newContacts&&(this.m_contactManager.FindNewContacts(),this.m_newContacts=!1),this.m_locked=!0;const c=Et.Step_s_step;c.dt=t,c.config={...e},t>0?c.inv_dt=1/t:c.inv_dt=0,c.dtRatio=this.m_inv_dt0*t,c.warmStarting=this.m_warmStarting;{const r=Et.Step_s_timer.Reset();this.m_contactManager.Collide(),this.m_profile.collide=r.GetMilliseconds()}if(this.m_stepComplete&&c.dt>0){const r=Et.Step_s_timer.Reset();this.Solve(c),this.m_profile.solve=r.GetMilliseconds()}if(this.m_continuousPhysics&&c.dt>0){const r=Et.Step_s_timer.Reset();this.SolveTOI(c),this.m_profile.solveTOI=r.GetMilliseconds()}c.dt>0&&(this.m_inv_dt0=c.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=n.GetMilliseconds()}ClearForces(){for(let t=this.m_bodyList;t;t=t.GetNext())t.m_force.SetZero(),t.m_torque=0}QueryAABB(t,e){this.m_contactManager.m_broadPhase.Query(t,n=>{const c=(0,Me.b2Verify)(n.userData);return e(c.fixture)})}QueryAllAABB(t,e=[]){return this.QueryAABB(t,n=>(e.push(n),!0)),e}QueryPointAABB(t,e){this.m_contactManager.m_broadPhase.QueryPoint(t,n=>{const c=(0,Me.b2Verify)(n.userData);return e(c.fixture)})}QueryAllPointAABB(t,e=[]){return this.QueryPointAABB(t,n=>(e.push(n),!0)),e}QueryFixtureShape(t,e,n,c){const r=Et.QueryFixtureShape_s_aabb;t.ComputeAABB(r,n,e),this.m_contactManager.m_broadPhase.Query(r,m=>{const u=(0,Me.b2Verify)(m.userData),{fixture:p}=u;return!(0,no.b2TestOverlap)(t,e,p.GetShape(),u.childIndex,n,p.GetBody().GetTransform())||c(p)})}QueryAllFixtureShape(t,e,n,c=[]){return this.QueryFixtureShape(t,e,n,r=>(c.push(r),!0)),c}QueryFixturePoint(t,e){this.m_contactManager.m_broadPhase.QueryPoint(t,n=>{const c=(0,Me.b2Verify)(n.userData),{fixture:r}=c;return!r.TestPoint(t)||e(r)})}QueryAllFixturePoint(t,e=[]){return this.QueryFixturePoint(t,n=>(e.push(n),!0)),e}RayCast(t,e,n){const c=Et.RayCast_s_input;c.maxFraction=1,c.p1.Copy(t),c.p2.Copy(e),this.m_contactManager.m_broadPhase.RayCast(c,(r,m)=>{const u=(0,Me.b2Verify)(m.userData),{fixture:p}=u,b=u.childIndex,d=Et.RayCast_s_output;if(p.RayCast(d,r,b)){const{fraction:y}=d,f=Et.RayCast_s_point;return f.Set((1-y)*t.x+y*e.x,(1-y)*t.y+y*e.y),n(p,f,d.normal,y)}return r.maxFraction})}RayCastOne(t,e){let n=null,c=1;return this.RayCast(t,e,(r,m,u,p)=>(p<c&&(c=p,n=r),c)),n}RayCastAll(t,e,n=[]){return this.RayCast(t,e,c=>(n.push(c),1)),n}GetBodyList(){return this.m_bodyList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactManager.m_contactList}SetAllowSleeping(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(let e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)}GetAllowSleeping(){return this.m_allowSleep}SetWarmStarting(t){this.m_warmStarting=t}GetWarmStarting(){return this.m_warmStarting}SetContinuousPhysics(t){this.m_continuousPhysics=t}GetContinuousPhysics(){return this.m_continuousPhysics}SetSubStepping(t){this.m_subStepping=t}GetSubStepping(){return this.m_subStepping}GetProxyCount(){return this.m_contactManager.m_broadPhase.GetProxyCount()}GetBodyCount(){return this.m_bodyCount}GetJointCount(){return this.m_jointCount}GetContactCount(){return this.m_contactManager.m_contactCount}GetTreeHeight(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}GetTreeBalance(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}GetTreeQuality(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}SetGravity(t){this.m_gravity.Copy(t)}GetGravity(){return this.m_gravity}IsLocked(){return this.m_locked}SetAutoClearForces(t){this.m_clearForces=t}GetAutoClearForces(){return this.m_clearForces}ShiftOrigin(t){(0,Me.b2Assert)(!this.IsLocked());for(let e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.Subtract(t),e.m_sweep.c0.Subtract(t),e.m_sweep.c.Subtract(t);for(let e=this.m_jointList;e;e=e.m_next)e.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}GetContactManager(){return this.m_contactManager}GetProfile(){return this.m_profile}Solve(t){this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;const e=this.m_island;e.Resize(this.m_bodyCount),e.Clear();for(let r=this.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1;for(let r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_islandFlag=!1;for(let r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;const n=this.s_stack;for(let r=this.m_bodyList;r;r=r.m_next){if(r.m_islandFlag||!r.IsAwake()||!r.IsEnabled()||r.GetType()===qe.b2BodyType.b2_staticBody)continue;e.Clear();let m=0;for(n[m++]=r,r.m_islandFlag=!0;m>0;){const p=n[--m];if((0,Me.b2Assert)(p!==null),e.AddBody(p),p.GetType()!==qe.b2BodyType.b2_staticBody){p.m_awakeFlag=!0;for(let b=p.m_contactList;b;b=b.next){const{contact:d}=b;if(d.m_islandFlag||!d.IsEnabled()||!d.IsTouching())continue;const A=d.m_fixtureA.m_isSensor,y=d.m_fixtureB.m_isSensor;if(A||y)continue;e.AddContact(d),d.m_islandFlag=!0;const{other:f}=b;f.m_islandFlag||(n[m++]=f,f.m_islandFlag=!0)}for(let b=p.m_jointList;b;b=b.next){if(b.joint.m_islandFlag)continue;const{other:d}=b;d.IsEnabled()&&(e.AddJoint(b.joint),b.joint.m_islandFlag=!0,!d.m_islandFlag&&(n[m++]=d,d.m_islandFlag=!0))}}}const u=new jn.b2Profile;e.Solve(u,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=u.solveInit,this.m_profile.solveVelocity+=u.solveVelocity,this.m_profile.solvePosition+=u.solvePosition;for(let p=0;p<e.m_bodyCount;++p){const b=e.m_bodies[p];b.GetType()===qe.b2BodyType.b2_staticBody&&(b.m_islandFlag=!1)}}for(let r=0;r<n.length&&n[r];++r)n[r]=null;const c=new or.b2Timer;for(let r=this.m_bodyList;r;r=r.m_next)r.m_islandFlag&&r.GetType()!==qe.b2BodyType.b2_staticBody&&r.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=c.GetMilliseconds()}SolveTOI(t){const e=this.m_island;if(e.Clear(),this.m_stepComplete){for(let n=this.m_bodyList;n;n=n.m_next)n.m_islandFlag=!1,n.m_sweep.alpha0=0;for(let n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_toiFlag=!1,n.m_islandFlag=!1,n.m_toiCount=0,n.m_toi=1}for(;;){let n=null,c=1;for(let y=this.m_contactManager.m_contactList;y;y=y.m_next){if(!y.IsEnabled()||y.m_toiCount>Me.b2_maxSubSteps)continue;let f=1;if(y.m_toiFlag)f=y.m_toi;else{const x=y.GetFixtureA(),S=y.GetFixtureB();if(x.IsSensor()||S.IsSensor())continue;const V=x.GetBody(),C=S.GetBody(),_=V.m_type,g=C.m_type,w=V.IsAwake()&&_!==qe.b2BodyType.b2_staticBody,M=C.IsAwake()&&g!==qe.b2BodyType.b2_staticBody;if(!w&&!M)continue;const L=V.IsBullet()||_!==qe.b2BodyType.b2_dynamicBody,R=C.IsBullet()||g!==qe.b2BodyType.b2_dynamicBody;if(!L&&!R)continue;let{alpha0:z}=V.m_sweep;V.m_sweep.alpha0<C.m_sweep.alpha0?(z=C.m_sweep.alpha0,V.m_sweep.Advance(z)):C.m_sweep.alpha0<V.m_sweep.alpha0&&(z=V.m_sweep.alpha0,C.m_sweep.Advance(z));const N=y.GetChildIndexA(),G=y.GetChildIndexB(),H=Et.SolveTOI_s_toi_input;H.proxyA.SetShape(x.GetShape(),N),H.proxyB.SetShape(S.GetShape(),G),H.sweepA.Copy(V.m_sweep),H.sweepB.Copy(C.m_sweep),H.tMax=1;const k=Et.SolveTOI_s_toi_output;(0,En.b2TimeOfImpact)(k,H);const j=k.t;k.state===En.b2TOIOutputState.e_touching?f=Math.min(z+(1-z)*j,1):f=1,y.m_toi=f,y.m_toiFlag=!0}f<c&&(n=y,c=f)}if(n===null||1-10*Me.b2_epsilon<c){this.m_stepComplete=!0;break}const r=n.GetFixtureA(),m=n.GetFixtureB(),u=r.GetBody(),p=m.GetBody(),b=Et.SolveTOI_s_backup1.Copy(u.m_sweep),d=Et.SolveTOI_s_backup2.Copy(p.m_sweep);if(u.Advance(c),p.Advance(c),n.Update(this.m_contactManager.m_contactListener),n.m_toiFlag=!1,++n.m_toiCount,!n.IsEnabled()||!n.IsTouching()){n.SetEnabled(!1),u.m_sweep.Copy(b),p.m_sweep.Copy(d),u.SynchronizeTransform(),p.SynchronizeTransform();continue}u.SetAwake(!0),p.SetAwake(!0),e.Clear(),e.AddBody(u),e.AddBody(p),e.AddContact(n),u.m_islandFlag=!0,p.m_islandFlag=!0,n.m_islandFlag=!0;for(let y=0;y<2;++y){const f=y===0?u:p;if(f.m_type===qe.b2BodyType.b2_dynamicBody)for(let x=f.m_contactList;x&&!(e.m_bodyCount===e.m_bodyCapacity||e.m_contactCount===Me.b2_maxTOIContacts);x=x.next){const{contact:S}=x;if(S.m_islandFlag)continue;const{other:V}=x;if(V.m_type===qe.b2BodyType.b2_dynamicBody&&!f.IsBullet()&&!V.IsBullet())continue;const C=S.m_fixtureA.m_isSensor,_=S.m_fixtureB.m_isSensor;if(C||_)continue;const g=Et.SolveTOI_s_backup.Copy(V.m_sweep);if(V.m_islandFlag||V.Advance(c),S.Update(this.m_contactManager.m_contactListener),!S.IsEnabled()){V.m_sweep.Copy(g),V.SynchronizeTransform();continue}if(!S.IsTouching()){V.m_sweep.Copy(g),V.SynchronizeTransform();continue}S.m_islandFlag=!0,e.AddContact(S),!V.m_islandFlag&&(V.m_islandFlag=!0,V.m_type!==qe.b2BodyType.b2_staticBody&&V.SetAwake(!0),e.AddBody(V))}}const A=Et.SolveTOI_s_subStep;A.dt=(1-c)*t.dt,A.inv_dt=1/A.dt,A.dtRatio=1,A.config={...t.config,positionIterations:20},A.warmStarting=!1,e.SolveTOI(A,u.m_islandIndex,p.m_islandIndex);for(let y=0;y<e.m_bodyCount;++y){const f=e.m_bodies[y];if(f.m_islandFlag=!1,f.m_type===qe.b2BodyType.b2_dynamicBody){f.SynchronizeFixtures();for(let x=f.m_contactList;x;x=x.next)x.contact.m_toiFlag=!1,x.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}}}Wn.b2World=Et;Et.Step_s_step=jn.b2TimeStep.Create();Et.Step_s_stepTimer=new or.b2Timer;Et.Step_s_timer=new or.b2Timer;Et.QueryFixtureShape_s_aabb=new no.b2AABB;Et.RayCast_s_input=new no.b2RayCastInput;Et.RayCast_s_output=new no.b2RayCastOutput;Et.RayCast_s_point=new Ks.b2Vec2;Et.SolveTOI_s_subStep=jn.b2TimeStep.Create();Et.SolveTOI_s_backup=new Ks.b2Sweep;Et.SolveTOI_s_backup1=new Ks.b2Sweep;Et.SolveTOI_s_backup2=new Ks.b2Sweep;Et.SolveTOI_s_toi_input=new En.b2TOIInput;Et.SolveTOI_s_toi_output=new En.b2TOIOutput;var di={};Object.defineProperty(di,"__esModule",{value:!0});di.b2Rope=di.b2RopeTuning=di.b2BendingModel=di.b2StretchingModel=void 0;const gs=jt,Os=Ge,X=Dt,Ci={J1:new X.b2Vec2,J2:new X.b2Vec2,J3:new X.b2Vec2,r:new X.b2Vec2,e1:new X.b2Vec2,e2:new X.b2Vec2,Jd1:new X.b2Vec2,Jd2:new X.b2Vec2,d:new X.b2Vec2,u:new X.b2Vec2,dp1:new X.b2Vec2,dp2:new X.b2Vec2,dp3:new X.b2Vec2,d1:new X.b2Vec2,d2:new X.b2Vec2,dHat:new X.b2Vec2};var Hs;(function(a){a[a.b2_pbdStretchingModel=0]="b2_pbdStretchingModel",a[a.b2_xpbdStretchingModel=1]="b2_xpbdStretchingModel"})(Hs||(di.b2StretchingModel=Hs={}));var Mi;(function(a){a[a.b2_springAngleBendingModel=0]="b2_springAngleBendingModel",a[a.b2_pbdAngleBendingModel=1]="b2_pbdAngleBendingModel",a[a.b2_xpbdAngleBendingModel=2]="b2_xpbdAngleBendingModel",a[a.b2_pbdDistanceBendingModel=3]="b2_pbdDistanceBendingModel",a[a.b2_pbdHeightBendingModel=4]="b2_pbdHeightBendingModel",a[a.b2_pbdTriangleBendingModel=5]="b2_pbdTriangleBendingModel"})(Mi||(di.b2BendingModel=Mi={}));class Xa{constructor(){this.stretchingModel=Hs.b2_pbdStretchingModel,this.bendingModel=Mi.b2_pbdAngleBendingModel,this.damping=0,this.stretchStiffness=1,this.stretchHertz=1,this.stretchDamping=0,this.bendStiffness=.5,this.bendHertz=1,this.bendDamping=0,this.isometric=!1,this.fixedEffectiveMass=!1,this.warmStart=!1}Copy(t){return this.stretchingModel=t.stretchingModel,this.bendingModel=t.bendingModel,this.damping=t.damping,this.stretchStiffness=t.stretchStiffness,this.stretchHertz=t.stretchHertz,this.stretchDamping=t.stretchDamping,this.bendStiffness=t.bendStiffness,this.bendHertz=t.bendHertz,this.bendDamping=t.bendDamping,this.isometric=t.isometric,this.fixedEffectiveMass=t.fixedEffectiveMass,this.warmStart=t.warmStart,this}}di.b2RopeTuning=Xa;class y_{constructor(){this.i1=0,this.i2=0,this.invMass1=0,this.invMass2=0,this.L=0,this.lambda=0,this.spring=0,this.damper=0}}class v_{constructor(){this.i1=0,this.i2=0,this.i3=0,this.invMass1=0,this.invMass2=0,this.invMass3=0,this.invEffectiveMass=0,this.lambda=0,this.L1=0,this.L2=0,this.alpha1=0,this.alpha2=0,this.spring=0,this.damper=0}}class A_{constructor(t){this.m_position=new X.b2Vec2,this.m_count=0,this.m_stretchCount=0,this.m_bendCount=0,this.m_gravity=new X.b2Vec2,this.m_tuning=new Xa,(0,gs.b2Assert)(t.vertices.length>=3),this.m_position.Copy(t.position),this.m_count=t.vertices.length,this.m_bindPositions=(0,gs.b2MakeArray)(this.m_count,X.b2Vec2),this.m_ps=(0,gs.b2MakeArray)(this.m_count,X.b2Vec2),this.m_p0s=(0,gs.b2MakeArray)(this.m_count,X.b2Vec2),this.m_vs=(0,gs.b2MakeArray)(this.m_count,X.b2Vec2),this.m_invMasses=(0,gs.b2MakeNumberArray)(this.m_count);for(let b=0;b<this.m_count;++b){this.m_bindPositions[b].Copy(t.vertices[b]),X.b2Vec2.Add(t.vertices[b],this.m_position,this.m_ps[b]),X.b2Vec2.Add(t.vertices[b],this.m_position,this.m_p0s[b]),this.m_vs[b].SetZero();const d=t.masses[b];d>0?this.m_invMasses[b]=1/d:this.m_invMasses[b]=0}this.m_stretchCount=this.m_count-1,this.m_bendCount=this.m_count-2,this.m_stretchConstraints=new Array(this.m_stretchCount);for(let b=0;b<this.m_stretchCount;b++)this.m_stretchConstraints[b]=new y_;this.m_bendConstraints=new Array(this.m_bendCount);for(let b=0;b<this.m_bendCount;b++)this.m_bendConstraints[b]=new v_;for(let b=0;b<this.m_stretchCount;++b){const d=this.m_stretchConstraints[b],A=this.m_ps[b],y=this.m_ps[b+1];d.i1=b,d.i2=b+1,d.L=X.b2Vec2.Distance(A,y),d.invMass1=this.m_invMasses[b],d.invMass2=this.m_invMasses[b+1],d.lambda=0,d.damper=0,d.spring=0}const{J1:e,J2:n,r:c,e1:r,e2:m,Jd1:u,Jd2:p}=Ci;for(let b=0;b<this.m_bendCount;++b){const d=this.m_bendConstraints[b],A=this.m_ps[b],y=this.m_ps[b+1],f=this.m_ps[b+2];d.i1=b,d.i2=b+1,d.i3=b+2,d.invMass1=this.m_invMasses[b],d.invMass2=this.m_invMasses[b+1],d.invMass3=this.m_invMasses[b+2],d.invEffectiveMass=0,d.L1=X.b2Vec2.Distance(A,y),d.L2=X.b2Vec2.Distance(y,f),d.lambda=0,X.b2Vec2.Subtract(y,A,r),X.b2Vec2.Subtract(f,y,m);const x=r.LengthSquared(),S=m.LengthSquared();if(x*S===0)continue;X.b2Vec2.Skew(r,u).Scale(-1/x),X.b2Vec2.Skew(m,p).Scale(1/S),X.b2Vec2.Negate(u,e),X.b2Vec2.Subtract(u,p,n);const V=p;d.invEffectiveMass=d.invMass1*X.b2Vec2.Dot(e,e)+d.invMass2*X.b2Vec2.Dot(n,n)+d.invMass3*X.b2Vec2.Dot(V,V),X.b2Vec2.Subtract(f,A,c);const C=c.LengthSquared();C!==0&&(d.alpha1=X.b2Vec2.Dot(m,c)/C,d.alpha2=X.b2Vec2.Dot(r,c)/C)}this.m_gravity.Copy(t.gravity),this.SetTuning(t.tuning)}SetTuning(t){this.m_tuning.Copy(t);const e=2*Math.PI*this.m_tuning.bendHertz;for(let c=0;c<this.m_bendCount;++c){const r=this.m_bendConstraints[c],m=r.L1*r.L1,u=r.L2*r.L2;if(m*u===0){r.spring=0,r.damper=0;continue}const p=1/r.L1+1/r.L2,b=r.invMass1/m+r.invMass2*p*p+r.invMass3/u;if(b===0){r.spring=0,r.damper=0;continue}const d=1/b;r.spring=d*e*e,r.damper=2*d*this.m_tuning.bendDamping*e}const n=2*Math.PI*this.m_tuning.stretchHertz;for(let c=0;c<this.m_stretchCount;++c){const r=this.m_stretchConstraints[c],m=r.invMass1+r.invMass2;if(m===0)continue;const u=1/m;r.spring=u*n*n,r.damper=2*u*this.m_tuning.stretchDamping*n}}Step(t,e,n){if(t===0)return;const c=1/t,r=Math.exp(-t*this.m_tuning.damping);for(let m=0;m<this.m_count;++m)this.m_invMasses[m]>0?(this.m_vs[m].Scale(r),this.m_vs[m].AddScaled(t,this.m_gravity)):(this.m_vs[m].x=c*(this.m_bindPositions[m].x+n.x-this.m_p0s[m].x),this.m_vs[m].y=c*(this.m_bindPositions[m].y+n.y-this.m_p0s[m].y));this.m_tuning.bendingModel===Mi.b2_springAngleBendingModel&&this.ApplyBendForces(t);for(let m=0;m<this.m_bendCount;++m)this.m_bendConstraints[m].lambda=0;for(let m=0;m<this.m_stretchCount;++m)this.m_stretchConstraints[m].lambda=0;for(let m=0;m<this.m_count;++m)this.m_ps[m].AddScaled(t,this.m_vs[m]);for(let m=0;m<e;++m)this.m_tuning.bendingModel===Mi.b2_pbdAngleBendingModel?this.SolveBend_PBD_Angle():this.m_tuning.bendingModel===Mi.b2_xpbdAngleBendingModel?this.SolveBend_XPBD_Angle(t):this.m_tuning.bendingModel===Mi.b2_pbdDistanceBendingModel?this.SolveBend_PBD_Distance():this.m_tuning.bendingModel===Mi.b2_pbdHeightBendingModel?this.SolveBend_PBD_Height():this.m_tuning.bendingModel===Mi.b2_pbdTriangleBendingModel&&this.SolveBend_PBD_Triangle(),this.m_tuning.stretchingModel===Hs.b2_pbdStretchingModel?this.SolveStretch_PBD():this.m_tuning.stretchingModel===Hs.b2_xpbdStretchingModel&&this.SolveStretch_XPBD(t);for(let m=0;m<this.m_count;++m)this.m_vs[m].x=c*(this.m_ps[m].x-this.m_p0s[m].x),this.m_vs[m].y=c*(this.m_ps[m].y-this.m_p0s[m].y),this.m_p0s[m].Copy(this.m_ps[m])}Reset(t){this.m_position.Copy(t);for(let e=0;e<this.m_count;++e)X.b2Vec2.Add(this.m_bindPositions[e],this.m_position,this.m_ps[e]),this.m_p0s[e].Copy(this.m_ps[e]),this.m_vs[e].SetZero();for(let e=0;e<this.m_bendCount;++e)this.m_bendConstraints[e].lambda=0;for(let e=0;e<this.m_stretchCount;++e)this.m_stretchConstraints[e].lambda=0}SolveStretch_PBD(){const t=this.m_tuning.stretchStiffness,{d:e}=Ci;for(let n=0;n<this.m_stretchCount;++n){const c=this.m_stretchConstraints[n],r=this.m_ps[c.i1],m=this.m_ps[c.i2];X.b2Vec2.Subtract(m,r,e);const u=e.Normalize(),p=c.invMass1+c.invMass2;if(p===0)continue;const b=c.invMass1/p,d=c.invMass2/p;r.SubtractScaled(t*b*(c.L-u),e),m.AddScaled(t*d*(c.L-u),e)}}SolveStretch_XPBD(t){const{dp1:e,dp2:n,u:c,J1:r}=Ci;for(let m=0;m<this.m_stretchCount;++m){const u=this.m_stretchConstraints[m],p=this.m_ps[u.i1],b=this.m_ps[u.i2];X.b2Vec2.Subtract(p,this.m_p0s[u.i1],e),X.b2Vec2.Subtract(b,this.m_p0s[u.i2],n),X.b2Vec2.Subtract(b,p,c);const d=c.Normalize();X.b2Vec2.Negate(c,r);const A=c,y=u.invMass1+u.invMass2;if(y===0)continue;const f=1/(u.spring*t*t),x=t*t*u.damper,S=f*x/t,V=d-u.L,C=X.b2Vec2.Dot(r,e)+X.b2Vec2.Dot(A,n),_=V+f*u.lambda+S*C,g=(1+S)*y+f,w=-_/g;p.AddScaled(u.invMass1*w,r),b.AddScaled(u.invMass2*w,A),u.lambda+=w}}SolveBend_PBD_Angle(){const t=this.m_tuning.bendStiffness,{Jd1:e,Jd2:n,J1:c,J2:r,d1:m,d2:u}=Ci;for(let p=0;p<this.m_bendCount;++p){const b=this.m_bendConstraints[p],d=this.m_ps[b.i1],A=this.m_ps[b.i2],y=this.m_ps[b.i3];X.b2Vec2.Subtract(A,d,m),X.b2Vec2.Subtract(y,A,u);const f=X.b2Vec2.Cross(m,u),x=X.b2Vec2.Dot(m,u),S=Math.atan2(f,x);let V,C;if(this.m_tuning.isometric?(V=b.L1*b.L1,C=b.L2*b.L2):(V=m.LengthSquared(),C=u.LengthSquared()),V*C===0)continue;X.b2Vec2.Skew(m,e).Scale(-1/V),X.b2Vec2.Skew(u,n).Scale(1/C),X.b2Vec2.Negate(e,c),X.b2Vec2.Subtract(e,n,r);const _=n;let g;this.m_tuning.fixedEffectiveMass?g=b.invEffectiveMass:g=b.invMass1*X.b2Vec2.Dot(c,c)+b.invMass2*X.b2Vec2.Dot(r,r)+b.invMass3*X.b2Vec2.Dot(_,_),g===0&&(g=b.invEffectiveMass);const w=-t*S/g;d.AddScaled(b.invMass1*w,c),A.AddScaled(b.invMass2*w,r),y.AddScaled(b.invMass3*w,_)}}SolveBend_XPBD_Angle(t){const{dp1:e,dp2:n,dp3:c,d1:r,d2:m,Jd1:u,Jd2:p,J1:b,J2:d}=Ci;for(let A=0;A<this.m_bendCount;++A){const y=this.m_bendConstraints[A],f=this.m_ps[y.i1],x=this.m_ps[y.i2],S=this.m_ps[y.i3];X.b2Vec2.Subtract(f,this.m_p0s[y.i1],e),X.b2Vec2.Subtract(x,this.m_p0s[y.i2],n),X.b2Vec2.Subtract(S,this.m_p0s[y.i3],c),X.b2Vec2.Subtract(x,f,r),X.b2Vec2.Subtract(S,x,m);let V,C;if(this.m_tuning.isometric?(V=y.L1*y.L1,C=y.L2*y.L2):(V=r.LengthSquared(),C=m.LengthSquared()),V*C===0)continue;const _=X.b2Vec2.Cross(r,m),g=X.b2Vec2.Dot(r,m),w=Math.atan2(_,g);X.b2Vec2.Skew(r,u).Scale(-1/V),X.b2Vec2.Skew(m,p).Scale(1/C),X.b2Vec2.Negate(u,b),X.b2Vec2.Subtract(u,p,d);const M=p;let L;if(this.m_tuning.fixedEffectiveMass?L=y.invEffectiveMass:L=y.invMass1*X.b2Vec2.Dot(b,b)+y.invMass2*X.b2Vec2.Dot(d,d)+y.invMass3*X.b2Vec2.Dot(M,M),L===0)continue;const R=1/(y.spring*t*t),z=t*t*y.damper,N=R*z/t,G=w,H=X.b2Vec2.Dot(b,e)+X.b2Vec2.Dot(d,n)+X.b2Vec2.Dot(M,c),k=G+R*y.lambda+N*H,j=(1+N)*L+R,O=-k/j;f.AddScaled(y.invMass1*O,b),x.AddScaled(y.invMass2*O,d),S.AddScaled(y.invMass3*O,M),y.lambda+=O}}SolveBend_PBD_Distance(){const t=this.m_tuning.bendStiffness,{d:e}=Ci;for(let n=0;n<this.m_bendCount;++n){const c=this.m_bendConstraints[n],{i1:r}=c,m=c.i3,u=this.m_ps[r],p=this.m_ps[m];X.b2Vec2.Subtract(p,u,e);const b=e.Normalize(),d=c.invMass1+c.invMass3;if(d===0)continue;const A=c.invMass1/d,y=c.invMass3/d;u.SubtractScaled(t*A*(c.L1+c.L2-b),e),p.AddScaled(t*y*(c.L1+c.L2-b),e)}}SolveBend_PBD_Height(){const t=this.m_tuning.bendStiffness,{dHat:e,J1:n,J2:c,J3:r,d:m}=Ci;for(let u=0;u<this.m_bendCount;++u){const p=this.m_bendConstraints[u],b=this.m_ps[p.i1],d=this.m_ps[p.i2],A=this.m_ps[p.i3];m.x=p.alpha1*b.x+p.alpha2*A.x-d.x,m.y=p.alpha1*b.y+p.alpha2*A.y-d.y;const y=m.Length();if(y===0)continue;X.b2Vec2.Scale(1/y,m,e),X.b2Vec2.Scale(p.alpha1,e,n),X.b2Vec2.Negate(e,c),X.b2Vec2.Scale(p.alpha2,e,r);const f=p.invMass1*p.alpha1*p.alpha1+p.invMass2+p.invMass3*p.alpha2*p.alpha2;if(f===0)continue;const x=y,S=1/f,V=-t*S*x;b.AddScaled(p.invMass1*V,n),d.AddScaled(p.invMass2*V,c),A.AddScaled(p.invMass3*V,r)}}SolveBend_PBD_Triangle(){const t=this.m_tuning.bendStiffness,{d:e}=Ci;for(let n=0;n<this.m_bendCount;++n){const c=this.m_bendConstraints[n],r=this.m_ps[c.i1],m=this.m_ps[c.i2],u=this.m_ps[c.i3],p=c.invMass1,b=c.invMass2,d=c.invMass3,A=p+d+2*b,y=t/A;e.x=m.x-1/3*(r.x+m.x+u.x),e.y=m.y-1/3*(r.y+m.y+u.y),r.AddScaled(2*p*y,e),m.AddScaled(-4*b*y,e),u.AddScaled(2*d*y,e)}}ApplyBendForces(t){const e=2*Math.PI*this.m_tuning.bendHertz,{d1:n,d2:c,Jd1:r,Jd2:m,J1:u,J2:p}=Ci;for(let b=0;b<this.m_bendCount;++b){const d=this.m_bendConstraints[b],A=this.m_ps[d.i1],y=this.m_ps[d.i2],f=this.m_ps[d.i3],x=this.m_vs[d.i1],S=this.m_vs[d.i2],V=this.m_vs[d.i3];X.b2Vec2.Subtract(y,A,n),X.b2Vec2.Subtract(f,y,c);let C,_;if(this.m_tuning.isometric?(C=d.L1*d.L1,_=d.L2*d.L2):(C=n.LengthSquared(),_=c.LengthSquared()),C*_===0)continue;const g=X.b2Vec2.Cross(n,c),w=X.b2Vec2.Dot(n,c),M=Math.atan2(g,w);X.b2Vec2.Skew(n,r).Scale(-1/C),X.b2Vec2.Skew(c,m).Scale(1/_),X.b2Vec2.Negate(r,u),X.b2Vec2.Subtract(r,m,p);const L=m;let R;if(this.m_tuning.fixedEffectiveMass?R=d.invEffectiveMass:R=d.invMass1*X.b2Vec2.Dot(u,u)+d.invMass2*X.b2Vec2.Dot(p,p)+d.invMass3*X.b2Vec2.Dot(L,L),R===0)continue;const z=1/R,N=z*e*e,G=2*z*this.m_tuning.bendDamping*e,H=M,k=X.b2Vec2.Dot(u,x)+X.b2Vec2.Dot(p,S)+X.b2Vec2.Dot(L,V),j=-t*(N*H+G*k);this.m_vs[d.i1].AddScaled(d.invMass1*j,u),this.m_vs[d.i2].AddScaled(d.invMass2*j,p),this.m_vs[d.i3].AddScaled(d.invMass3*j,L)}}Draw(t){for(let n=0;n<this.m_count-1;++n){t.DrawSegment(this.m_ps[n],this.m_ps[n+1],Os.debugColors.rope);const c=this.m_invMasses[n]>0?Os.debugColors.ropePointD:Os.debugColors.ropePointG;t.DrawPoint(this.m_ps[n],5,c)}const e=this.m_invMasses[this.m_count-1]>0?Os.debugColors.ropePointD:Os.debugColors.ropePointG;t.DrawPoint(this.m_ps[this.m_count-1],5,e)}}di.b2Rope=A_;(function(a){var t=In&&In.__createBinding||(Object.create?function(m,u,p,b){b===void 0&&(b=p);var d=Object.getOwnPropertyDescriptor(u,p);(!d||("get"in d?!u.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return u[p]}}),Object.defineProperty(m,b,d)}:function(m,u,p,b){b===void 0&&(b=p),m[b]=u[p]}),e=In&&In.__exportStar||function(m,u){for(var p in m)p!=="default"&&!Object.prototype.hasOwnProperty.call(u,p)&&t(u,m,p)};Object.defineProperty(a,"__esModule",{value:!0}),a.b2GetBlockSolve=a.b2SetBlockSolve=a.b2World=a.b2BodyType=a.b2Body=void 0,e(jt,a),e(Qe,a),e(Dt,a),e(Ge,a),e(Re,a),e(hs,a),e(qn,a),e(za,a),e(yt,a),e(On,a),e(Xs,a),e(es,a),e(sr,a),e(Ji,a),e(Ys,a),e(bi,a),e(De,a),e(zn,a),e($n,a),e(_s,a),e(Nn,a),e(er,a);var n=pi;Object.defineProperty(a,"b2Body",{enumerable:!0,get:function(){return n.b2Body}}),Object.defineProperty(a,"b2BodyType",{enumerable:!0,get:function(){return n.b2BodyType}});var c=Wn;Object.defineProperty(a,"b2World",{enumerable:!0,get:function(){return c.b2World}}),e(Ye,a),e(Te,a),e(Qs,a),e(ue,a),e(Us,a);var r=Ne;Object.defineProperty(a,"b2SetBlockSolve",{enumerable:!0,get:function(){return r.b2SetBlockSolve}}),Object.defineProperty(a,"b2GetBlockSolve",{enumerable:!0,get:function(){return r.b2GetBlockSolve}}),e(Yt,a),e(is,a),e(qi,a),e(ss,a),e(ns,a),e(os,a),e(rs,a),e(as,a),e(Pi,a),e(cs,a),e(ls,a),e(ms,a),e(di,a)})(ki);const Lt=class Lt{static getWorld(){if(!re.isInitiated)throw new Error("Game not initialized");const t=ki.b2World.Create(Lt.Gravity),e=Lt.getBoxShape(re.resolution.x,10),n=Lt.getBoxShape(re.resolution.x,10),c=Lt.getBoxShape(10,re.resolution.y),r=Lt.getBoxShape(10,re.resolution.y),m=t.CreateBody(Lt.staticBodyDef),u=t.CreateBody(Lt.staticBodyDef),p=t.CreateBody(Lt.staticBodyDef),b=t.CreateBody(Lt.staticBodyDef);m.CreateFixture({shape:e,density:0,friction:.3}),u.CreateFixture({shape:n,density:0,friction:.3}),p.CreateFixture({shape:c,density:0,friction:.3}),b.CreateFixture({shape:r,density:0,friction:.3});const d=Lt.toPhysicsTransform(new Ot(re.resolution.x/2,re.resolution.y));m.SetTransformXY(d.x,d.y,0);const A=Lt.toPhysicsTransform(new Ot(re.resolution.x/2,0));u.SetTransformXY(A.x,A.y,0);const y=Lt.toPhysicsTransform(new Ot(0,re.resolution.y/2));p.SetTransformXY(y.x,y.y,0);const f=Lt.toPhysicsTransform(new Ot(re.resolution.x,re.resolution.y/2));return b.SetTransformXY(f.x,f.y,0),t}static pixelToPhysicsScale(t){return t/Lt.PIXELS_PER_METER}static physicsToPixelScale(t){return t*Lt.PIXELS_PER_METER}static toPhysicsTransform(t){let e=Lt.pixelToPhysicsScale(t.x),n=t.y;return n=Lt.pixelToPhysicsScale(t.y),new ki.b2Vec2(e,n)}static toPixelTransform(t){let e=Lt.physicsToPixelScale(t.x),n=Lt.physicsToPixelScale(t.y);return new Ot(e,n)}static get staticBodyDef(){return{type:ki.b2BodyType.b2_staticBody}}static get dynamicBodyDef(){return{type:ki.b2BodyType.b2_dynamicBody}}static get kinematicBodyDef(){return{type:ki.b2BodyType.b2_kinematicBody}}static getBoxShape(t=Lt.BOX_SIZE,e=Lt.BOX_SIZE){if(!re.isInitiated)throw new Error("Game not initialized");return new ki.b2PolygonShape().SetAsBox(Lt.pixelToPhysicsScale(t)/2,Lt.pixelToPhysicsScale(e)/2)}};Lt.VELOCITY_ITERATIONS=3,Lt.POSITION_ITERATIONS=2,Lt.PIXELS_PER_METER=30,Lt.Gravity=new Ot(0,9.81),Lt.stepConfig={velocityIterations:Lt.VELOCITY_ITERATIONS,positionIterations:Lt.POSITION_ITERATIONS},Lt.BOX_SIZE=1;let We=Lt;class w_ extends Ra{constructor(t,e){super(t),this.frameOrigin=!1,this.fit=ke.rive.Fit.contain,this.alignment=ke.rive.Alignment.topLeft,this.artboard=e,this.artboard.frameOrigin=this.frameOrigin}get frame(){let t=this.artboard.bounds;return t.minX+=this.position.x,t.maxX+=this.position.x,t.minY+=this.position.y,t.maxY+=this.position.y,t.minX*=this.scale.x,t.maxX*=this.scale.x,t.minY*=this.scale.y,t.maxY*=this.scale.y,t}get width(){return(this.artboard.bounds.maxX-this.artboard.bounds.minX)*this.scale.x}get height(){return(this.artboard.bounds.maxY-this.artboard.bounds.minY)*this.scale.y}update(t){this.enabled&&this.artboard.advance(t)}fixedUpdate(t){if(this.physicsBody){this.artboard.transformComponent("Root")&&(this.artboard.transformComponent("Root").rotation=this.physicsBody.GetAngle());let e=We.toPixelTransform(this.physicsBody.GetPosition());this.position.x=e.x-this.width/this.scale.x/2,this.position.y=e.y-this.height/this.scale.y/2}}render(t){this.enabled&&(t.save(),t.align(this.fit,this.alignment,this.frame,this.artboard.bounds),this.artboard.draw(t),t.restore())}destroy(){}setPosition(t){this.position=t,this.physicsBody&&this.physicsBody.SetTransformXY(We.toPhysicsTransform(this.position).x,We.toPhysicsTransform(this.position).y,0)}}class g_ extends w_{constructor(t,e,n){super(t,e),this.inputs=[],this._reportedEvents=[],this._changedStates=[],this.generalEventListeners=[],this.openUrlEventListeners=[],this.smInstance=new ke.rive.StateMachineInstance(n,e);for(let c=0;c<this.smInstance.inputCount();c++){let r=this.smInstance.input(c);this.inputs.push(new Fo(r))}}update(t){this._reportedEvents=[],this._changedStates=[];let e=de.mouseToArtboardSpace(this);de.isMouseClicked&&this.smInstance.pointerDown(e.x,e.y),de.isMouseUp&&this.smInstance.pointerUp(e.x,e.y),de.hasMouseMoved&&this.smInstance.pointerMove(e.x,e.y),this.smInstance.advance(t);const n=this.smInstance.reportedEventCount();for(let r=0;r<n;r++){const m=this.smInstance.reportedEventAt(r);m&&(this._reportedEvents.push(m),this.handleEvent(m))}const c=this.smInstance.stateChangedCount();for(let r=0;r<c;r++){const m=this.smInstance.stateChangedNameByIndex(r);m&&this._changedStates.push(m)}super.update(t)}get reportedEvents(){return this._reportedEvents}get changedStates(){return this._changedStates}addRiveEventListener(t){this.generalEventListeners.push(t)}addOpenUrlEventListener(t){this.openUrlEventListeners.push(t)}removeRiveEventListener(t){const e=this.generalEventListeners.indexOf(t);e!==-1&&this.generalEventListeners.splice(e,1)}removeOpenUrlEventListener(t){const e=this.openUrlEventListeners.indexOf(t);e!==-1&&this.openUrlEventListeners.splice(e,1)}handleEvent(t){t.type===131?this.openUrlEventListeners.forEach(e=>e(t)):this.generalEventListeners.forEach(e=>e(t))}destroy(){this.smInstance.delete()}}class x_{constructor(t){this.enabled=!0,this.entities=[],this.shouldDebugRender=!1,this.name=t,this.world=We.getWorld()}add(t,e=!0){if(this.entities.push(t),e){let n=this.world.CreateBody(We.dynamicBodyDef);t.initPhysics(n)}return t}remove(t){const e=this.entities.indexOf(t);e>=0&&(t.destroy(),this.entities.splice(e,1))}destroy(){for(;this.entities.length>0;){const t=this.entities[0];this.remove(t)}}update(t){for(let e of this.entities)e.enabled&&e.update(t)}fixedUpdate(t){for(let e of this.entities)e.enabled&&e.fixedUpdate(t);this.world.Step(t,We.stepConfig)}render(t){for(let e of this.entities)!e.render||!e.enabled||e.render(t)}debugRender(t){if(!this.shouldDebugRender)return;const e=t.getContext("2d");if(!e)return;e.fillStyle="#000000",e.font="12px Arial",e.textAlign="right",e.textBaseline="top",e.fillText(`Bodies: ${this.world.GetBodyCount()}`,t.width-10,10);let n=0;for(let c of this.entities){let r=c.physicsBody;if(!r||r.GetType()===ki.b2BodyType.b2_staticBody)continue;let m=We.toPixelTransform(r.GetPosition()),u=m.x,p=m.y,b=r.GetAngle();const d=Math.sin(n*.3)*127+128,A=Math.sin(n*.3+2)*127+128,y=Math.sin(n*.3+4)*127+128;e.fillStyle=`rgb(${Math.floor(d)},${Math.floor(A)},${Math.floor(y)})`;const f=c.width,x=c.height;e.save(),e.translate(u,p),e.rotate(b),e.fillRect(-f/2,-x/2,f,x),e.restore(),e.fillStyle="#000000",e.font="12px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(`x: ${m.x.toFixed(1)}, y: ${m.y.toFixed(1)}, θ: ${(b*180/Math.PI).toFixed(1)}°`,u+5,p-10),n++}}}class S_ extends Ra{constructor(){super(...arguments),this._script=t=>{},this._fixedUpdateScript=t=>{}}setScriptFunction(t){this._script=t}setFixedUpdateFunction(t){this._fixedUpdateScript=t}update(t){this._script(t)}fixedUpdate(t){this._fixedUpdateScript(t)}destroy(){}}const ze=class ze{static getInterpolationFunction(t,e){if(typeof t=="number"&&typeof e=="number")return ze.number;if(t instanceof Ot&&e instanceof Ot)return ze.vector2D;if(ze.isColor(t)&&ze.isColor(e))return ze.color;if(ze.isInterpolableObject(t,e))return ze.object;throw new Error(`Unsupported tween type: ${typeof t}. Supported types are: number, Vec2D, Color, or object with numeric properties.`)}static isColor(t){return typeof t=="object"&&"r"in t&&"g"in t&&"b"in t}static isInterpolableObject(t,e){return typeof t!="object"||typeof e!="object"?!1:Object.keys(t).some(n=>typeof t[n]=="number"&&typeof e[n]=="number")}};ze.number=(t,e,n)=>t+(e-t)*n,ze.vector2D=(t,e,n)=>new Ot(t.x+(e.x-t.x)*n,t.y+(e.y-t.y)*n),ze.color=(t,e,n)=>({r:Math.round(t.r+(e.r-t.r)*n),g:Math.round(t.g+(e.g-t.g)*n),b:Math.round(t.b+(e.b-t.b)*n)}),ze.object=(t,e,n)=>{const c={};for(const r in t)typeof t[r]=="number"&&typeof e[r]=="number"&&(c[r]=t[r]+(e[r]-t[r])*n);return c};let Fa=ze;async function B_(){await V_()}async function V_(){var c,r,m;await re.initiate(1920,1080),console.log("here?");let a=await ke.loadFile(new URL("/assets/fashion_app-CqW3cidK.riv",import.meta.url).href);const t=new x_("FashionTestScene");let e=[];for(let u=0;u<3;u++){let p=a.artboardByIndex(0),b=new g_("Fashion",p,p.stateMachineByIndex(0)),d=Math.random()*(re.resolution.x-100)+50,A=Math.random()*(re.resolution.y-100)+50;b.setPosition(new Ot(d,A)),t.add(b,!0),b.addCollider(We.getBoxShape(b.width,b.height),1,.3,.2),b.position=new Ot(re.resolution.x/2,re.resolution.y/2),(c=b.physicsBody)==null||c.SetTransformXY(We.toPhysicsTransform(b.position).x,We.toPhysicsTransform(b.position).y,0),(r=b.physicsBody)==null||r.ApplyForceToCenter(new Ot(99e3,1e4),!0),(m=b.physicsBody)==null||m.ApplyAngularImpulse(500*Math.random(),!0),b.physicsBody&&e.push(b.physicsBody)}re.addScene(t);const n=new S_("MouseControl");n.setFixedUpdateFunction(u=>{if(de.isMouseClicked){for(let p=0;p<e.length;p++){let b=e[p];if(!b)continue;let d=de.gameMouseX,A=de.gameMouseY,y=We.toPhysicsTransform(new Ot(d,A)),f=b.GetPosition(),x=new Ot(y.x-f.x,y.y-f.y);if(x.lengthSquared()>400)continue;let S=250;x.x*=-S,x.y*=-S,b.ApplyLinearImpulse(x,y,!0),b.ApplyAngularImpulse(1e4,!0)}return}}),t.add(n)}B_();
